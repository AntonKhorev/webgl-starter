!function e(t,r,n){function o(i,s){if(!r[i]){if(!t[i]){var p="function"==typeof require&&require;if(!s&&p)return p(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[i]={exports:{}};t[i][0].call(c.exports,function(e){var r=t[i][1][e];return o(r?r:e)},c,c.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){var n=e("./listeners.js"),o=e("./shapes.js");t.exports=function(e,t){function r(t){return parseInt(e[t])}function a(t){return e[t].toFixed(3)}function i(e){return a(e+".r")+","+a(e+".g")+","+a(e+".b")+","+a(e+".a")}function s(e){var t=a(e+".r"),r=a(e+".g"),n=a(e+".b"),o=a(e+".a");return t==o&&r==o&&n==o?o:t+","+r+","+n+","+o}function p(t){return["mousemovex","mousemovey"].indexOf(e[t+".input"])>=0}function l(e,t){return t.map(function(t){return Array(e+1).join("	")+t})}function c(e,t){var r=e.pop(),n=/^\s*/.exec(r)[0];t.forEach(function(t,o){0==o?e.push(r+t):e.push(n+t)})}function u(){var t=e.shape.charAt(0).toUpperCase()+e.shape.slice(1),n=e.getInputOptionsFor("shape").map(function(t){return"constant"==e[t.name+".input"]?{value:r(t.name),changes:!1}:{value:r(t.name),changes:!0,min:t.getMin(),max:t.getMax()}}),a=[null,e.shader].concat(n);return new(Function.prototype.bind.apply(o[t],a))}function h(){var t=2==x.dim&&!e.needsTransform("rotate.x")&&!e.needsTransform("rotate.y")&&e.needsTransform("rotate.z"),n=e.hasInputsFor("canvas"),o=!n&&e["canvas.width"]!=e["canvas.height"],i="light"==e.shader&&"perspective"==e.projection,s=[];return n&&s.push("uniform float aspect;"),["x","y","z"].forEach(function(t){var r=t.toUpperCase(),n="rotate."+t,o="rotate"+r;e.needsUniform(n)&&s.push("uniform float "+o+";")}),t?s.push("attribute vec2 position;"):s.push("attribute vec4 position;"),"light"==e.shader&&("perspective"==e.projection&&s.push("varying vec3 interpolatedView;"),x.dim>2&&s.push("attribute vec3 normal;"),s.push("varying vec3 interpolatedNormal;")),("vertex"==e.shader||"face"==e.shader)&&s.push("attribute vec4 color;","varying vec4 interpolatedColor;"),s.push("void main() {"),["x","y","z"].forEach(function(t){var r=t.toUpperCase(),n="rotate."+t,o="rotate"+r;e.needsTransform(n)&&(e.needsUniform("rotate."+t)?s.push("	float c"+t+"=cos(radians("+o+"));","	float s"+t+"=sin(radians("+o+"));"):s.push("	float c"+t+"=cos(radians("+a(n)+"));","	float s"+t+"=sin(radians("+a(n)+"));"))}),o&&s.push("	float aspect="+r("canvas.width")+".0/"+r("canvas.height")+".0;"),"perspective"==e.projection&&s.push("	float fovy=45.0;","	float near=1.0/tan(radians(fovy)/2.0);","	float far=near+2.0;"),i?s.push("	vec4 transformedPosition="):s.push("	gl_Position="),t?c(s,["vec4(position*mat2(","	cz, -sz,","	sz,  cz","),0,1)"]):(c(s,["position"]),e.transformOrder.forEach(function(t){e.needsTransform(t)&&c(s,{"rotate.x":["*mat4(","	1.0, 0.0, 0.0, 0.0,","	0.0,  cx, -sx, 0.0,","	0.0,  sx,  cx, 0.0,","	0.0, 0.0, 0.0, 1.0",")"],"rotate.y":["*mat4(","	 cy, 0.0,  sy, 0.0,","	0.0, 1.0, 0.0, 0.0,","	-sy, 0.0,  cy, 0.0,","	0.0, 0.0, 0.0, 1.0",")"],"rotate.z":["*mat4(","	 cz, -sz, 0.0, 0.0,","	 sz,  cz, 0.0, 0.0,","	0.0, 0.0, 1.0, 0.0,","	0.0, 0.0, 0.0, 1.0",")"]}[t])}),"perspective"==e.projection&&c(s,["*mat4( // move center of coords inside view","	1.0, 0.0, 0.0, 0.0,","	0.0, 1.0, 0.0, 0.0,","	0.0, 0.0, 1.0, -(near+far)/2.0,","	0.0, 0.0, 0.0, 1.0",")"])),i&&(c(s,[";"]),s.push("	gl_Position=transformedPosition")),"ortho"==e.projection?n||o?c(s,["*vec4(1.0/aspect,1.0,-1.0,1.0)"]):x.dim>2&&c(s,["*vec4(1.0,1.0,-1.0,1.0)"]):"perspective"==e.projection&&(n||o?c(s,["*mat4(","	near/aspect, 0.0,  0.0,                   0.0,","	0.0,         near, 0.0,                   0.0,","	0.0,         0.0,  (near+far)/(near-far), 2.0*near*far/(near-far),","	0.0,         0.0,  -1.0,                  0.0",")"]):c(s,["*mat4(","	near, 0.0,  0.0,                   0.0,","	0.0,  near, 0.0,                   0.0,","	0.0,  0.0,  (near+far)/(near-far), 2.0*near*far/(near-far),","	0.0,  0.0,  -1.0,                  0.0",")"])),c(s,[";"]),"light"==e.shader&&("perspective"==e.projection&&s.push("	interpolatedView=-vec3(transformedPosition);"),x.dim>2?s.push("	interpolatedNormal=normal"):s.push("	interpolatedNormal=vec3(0.0,0.0,1.0)"),e.transformOrder.forEach(function(t){e.needsTransform(t)&&c(s,{"rotate.x":["*mat3(","	1.0, 0.0, 0.0,","	0.0,  cx, -sx,","	0.0,  sx,  cx",")"],"rotate.y":["*mat3(","	 cy, 0.0,  sy,","	0.0, 1.0, 0.0,","	-sy, 0.0,  cy",")"],"rotate.z":["*mat3(","	 cz, -sz, 0.0,","	 sz,  cz, 0.0,","	0.0, 0.0, 1.0",")"]}[t])}),c(s,[";"])),("vertex"==e.shader||"face"==e.shader)&&s.push("	interpolatedColor=color;"),s.push("}"),s}function f(){if("single"==e.shader)return e.hasInputsFor("shader.single.color")?["uniform vec4 color;","void main() {","	gl_FragColor=color;","}"]:["void main() {","	gl_FragColor=vec4("+s("shader.single.color")+");","}"];if("vertex"==e.shader||"face"==e.shader)return["varying vec4 interpolatedColor;","void main() {","	gl_FragColor=interpolatedColor;","}"];if("light"==e.shader){var t=[];return"perspective"==e.projection&&t.push("varying vec3 interpolatedView;"),t.push("varying vec3 interpolatedNormal;","void main() {","	vec3 ambientColor=vec3(0.2,0.2,0.2);","	vec3 diffuseColor=vec3(0.4,0.4,0.4);","	vec3 specularColor=vec3(0.4,0.4,0.4);","	float shininess=100.0;"),"ortho"==e.projection?t.push("	vec3 V=vec3( 0.0, 0.0,+1.0);"):"perspective"==e.projection&&t.push("	vec3 V=normalize(interpolatedView);"),t.push("	vec3 N=normalize(interpolatedNormal);"),x.twoSided&&t.push("	if (!gl_FrontFacing) N=-N;"),t.push("	vec3 L=normalize(vec3(-1.0,+1.0,+1.0));","	vec3 H=normalize(L+V);","	gl_FragColor=vec4(","		ambientColor","		+diffuseColor*max(0.0,dot(L,N))","		+specularColor*pow(max(0.0,dot(H,N)),shininess)","	,1.0);","}"),t}}function d(){function r(r){r.filter(function(e){return p(e.name)}).forEach(function(r){n.push("	<li>"+t("controls.type."+e[r.name+".input"])+" "+t("controls.to")+" <strong>"+t("options."+r.name)+"</strong></li>")})}var n=[];return r(e.inputOptions),r(e.transformOptions),n.length?["<ul>"].concat(n,["</ul>"]):[]}function v(){function n(n){n.filter(function(t){return"slider"==e[t.name+".input"]}).forEach(function(e){o.push("<div>","	<label for='"+e.name+"'>"+t("options."+e.name)+":</label>","	<span class='min'>"+e.getMinLabel()+"</span> "+(1==e.getStep()?"<input type='range' id='"+e.name+"' min='"+e.getMin()+"' max='"+e.getMax()+"' value='"+r(e.name)+"' />":"<input type='range' id='"+e.name+"' min='"+e.getMin()+"' max='"+e.getMax()+"' step='"+e.getStep()+"' value='"+a(e.name)+"' />")+" <span class='max'>"+e.getMaxLabel()+"</span>","</div>")})}var o=[];return n(e.inputOptions),n(e.transformOptions),o}function m(){return lines=["function makeProgram(vertexShaderSrc,fragmentShaderSrc) {","	var vertexShader=gl.createShader(gl.VERTEX_SHADER);","	gl.shaderSource(vertexShader,vertexShaderSrc);","	gl.compileShader(vertexShader);"],e.debugShader&&lines.push("	if (!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(vertexShader));"),lines.push("	var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);","	gl.shaderSource(fragmentShader,fragmentShaderSrc);","	gl.compileShader(fragmentShader);"),e.debugShader&&lines.push("	if (!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(fragmentShader));"),lines.push("	var program=gl.createProgram();","	gl.attachShader(program,vertexShader);","	gl.attachShader(program,fragmentShader);","	gl.linkProgram(program);","	return program;","}"),lines}function g(){function t(t){f=f.concat(t.write(!e.isAnimated(),e.debugInputs))}function r(){f.push("function updateAspect() {","	gl.viewport(0,0,canvas.width,canvas.height);","	gl.uniform1f(aspectLoc,canvas.width/canvas.height);","}","updateAspect();")}function o(r){var o="canvas."+r;if("slider"==e[o+".input"]){var a=new n.SliderListener(o);a.enter().log("console.log(this.id,'input value:',parseInt(this.value));").post("canvas."+r+"=parseInt(this.value);").post("updateAspect();"),t(a)}}function i(e,t,r){["r","g","b","a"].forEach(function(t){var n=e+"."+t;p(n)&&f.push("var "+r+t.toUpperCase()+"="+a(n)+";")})}function s(t,r,n,o,i,s,l){f.push("function "+r+"() {"),e.hasAllSliderInputsFor(t)?f.push("	"+o+"['r','g','b','a'].map(function(c){","		return parseFloat(document.getElementById('"+t+".'+c).value);","	})"+i):f.push("	"+s+["r","g","b","a"].map(function(r){var o=t+"."+r;return"slider"==e[o+".input"]?"parseFloat(document.getElementById('"+o+"').value)":p(o)?n+r.toUpperCase():a(o)}).join()+l),f.push("}",r+"();")}function l(r,o,a){var i,s=e.getOnlyInputFor(r);i=null===s?new n.MultipleSliderListener('[id^="'+r+'."]'):new n.SliderListener(s.name),i.enter().log("console.log(this.id,'input value:',parseFloat(this.value));").post(o+"();"),t(i)}function c(r,o,a){["r","g","b","a"].forEach(function(i){var s=r+"."+i,l=a+i.toUpperCase();if("slider"==e[s+".input"]){var c=new n.SliderListener(s);c.enter().log("console.log(this.id,'input value:',parseFloat(this.value));").post(o+"();"),t(c)}else p(s)&&d.enter().prexy(e[s+".input"],l+"=(ev.clientX-rect.left)/(rect.width-1);",l+"=(rect.bottom-1-ev.clientY)/(rect.height-1);").log("console.log('"+s+" input value:',"+l+");").post(o+"();")})}function u(t,r,n){var o=["r","g","b","a"].every(function(r){var n=e[t+"."+r+".input"];return"constant"==n||"slider"==n});o?l(t,r,n):c(t,r,n)}function h(e,t,r,n,o,a,p){i(e,t,r),s(e,t,r,n,o,a,p),u(e,t,r)}var f=[],d=new n.CanvasMousemoveListener;return e.hasInputsFor("canvas")&&(f.push("var aspectLoc=gl.getUniformLocation(program,'aspect');"),r(),o("width"),o("height")),e.hasInputsFor("background.solid.color")&&h("background.solid.color","updateClearColor","clearColor","gl.clearColor.apply(gl,",");","gl.clearColor(",");"),e.hasInputsFor("shader.single.color")&&(f.push("var colorLoc=gl.getUniformLocation(program,'color');"),h("shader.single.color","updateColor","color","gl.uniform4fv(colorLoc,",");","gl.uniform4fv(colorLoc,[","]);")),e.getInputsFor("shape").forEach(function(r){function o(e,t){var n;return n=0===r.name.indexOf(e+".")?void 0!==t?r.name.replace(e,t):r.name.replace(e+".",""):r.name,n.replace(/\.[a-z]/g,function(e){return e.charAt(1).toUpperCase()})}var a;if("slider"==e[r.name+".input"]){var i=new n.SliderListener(r.name);a=i.enter().log("console.log(this.id,'input value:',parseInt(this.value));").post(x.storeFn+"(parseInt(this.value));").post("gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);"),x.usesElements()&&a.post("gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);"),t(i)}else if(p(r.name)){var s=o("shape"),l=o("shape","new"),c=o("shape","min"),u=o("shape","max");a=d.enter().prexy(e[r.name+".input"],"var "+l+"=Math.floor("+c+"+("+u+"-"+c+"+1)*(ev.clientX-rect.left)/rect.width);","var "+l+"=Math.floor("+c+"+("+u+"-"+c+"+1)*(rect.bottom-1-ev.clientY)/rect.height);").cond(l+"!="+s).log("console.log('"+r.name+" input value:',"+l+");").post(x.storeFn+"("+l+");").post("gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);"),x.usesElements()&&a.post("gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);")}}),["x","y","z"].forEach(function(r){var o=r.toUpperCase(),i="rotate."+r,s="rotate"+o,l="updateRotate"+o;if("slider"==e[i+".input"]){var c=new n.SliderListener(i),u=c.enter().log("console.log(this.id,'input value:',parseFloat(this.value));");0==e[i+".speed"]&&"constant"==e[i+".speed.input"]&&(f.push("var "+s+"Loc=gl.getUniformLocation(program,'"+s+"');","function "+l+"() {","	gl.uniform1f("+s+"Loc,parseFloat(document.getElementById('"+i+"').value));","};",l+"();"),u.post(l+"();")),t(c)}else p(i)&&(0==e[i+".speed"]&&"constant"==e[i+".speed.input"]?(f.push("var "+s+"Loc=gl.getUniformLocation(program,'"+s+"');","gl.uniform1f("+s+"Loc,"+a(i)+");"),d.enter().prexy(e[i+".input"],"var "+s+"=180*(-1+2*(ev.clientX-rect.left)/(rect.width-1));","var "+s+"=180*(-1+2*(rect.bottom-1-ev.clientY)/(rect.height-1));").log("console.log('"+i+" input value:',"+s+");").post("gl.uniform1f("+s+"Loc,"+s+");")):d.enter().state("var "+s+"="+a(i)+";").prexy(e[i+".input"],s+"=180*(-1+2*(ev.clientX-rect.left)/(rect.width-1));",s+"=180*(-1+2*(rect.bottom-1-ev.clientY)/(rect.height-1));").log("console.log('"+i+" input value:',"+s+");"));if("slider"==e[i+".speed.input"]){var c=new n.SliderListener(i+".speed");c.enter().log("console.log(this.id,'input value:',parseFloat(this.value));"),t(c)}else p(i+".speed")&&d.enter().state("var "+s+"Speed="+a(i+".speed")+";").prexy(e[i+".speed.input"],s+"Speed=360*(-1+2*(ev.clientX-rect.left)/(rect.width-1));",s+"Speed=360*(-1+2*(rect.bottom-1-ev.clientY)/(rect.height-1));").log("console.log('"+i+".speed input value:',"+s+"Speed);")}),t(d),f.length&&f.push("	"),f}function y(){function t(){function t(){var t=[];return["x","y","z"].forEach(function(i){var s=i.toUpperCase(),p="rotate."+i,l="rotate"+s;(0!=e[p+".speed"]||"constant"!=e[p+".speed.input"])&&("constant"==e[p+".speed.input"]&&"constant"==e[p+".input"]?(r=!0,t.push("var "+l+"="+(e[p]?a(p)+"+":"")+a(p+".speed")+"*(time-startTime)/1000;")):(n=!0,"slider"==e[p+".input"]&&t.push("var "+l+"Input=document.getElementById('"+p+"');","var "+l+"=parseFloat("+l+"Input.value);"),"slider"==e[p+".speed.input"]&&t.push("var "+l+"SpeedInput=document.getElementById('"+p+".speed');","var "+l+"Speed=parseFloat("+l+"SpeedInput.value);"),t.push(l+"+="+("constant"==e[p+".speed.input"]?a(p+".speed"):l+"Speed")+"*(time-prevTime)/1000;"),"slider"==e[p+".input"]&&(o=!0,t.push(l+"=wrap("+l+",180);",l+"Input.value="+l+";"))),t.push("gl.uniform1f("+l+"Loc,"+l+");"))}),t}var o=!1,i=t(),s=[];return o&&s.push("function wrap(v,maxAbsV) {","	v%=maxAbsV*2;","	if (Math.abs(v)<=maxAbsV) return v;","	return v-(v>0?1:-1)*maxAbsV*2;","}"),"solid"==e.background&&s.push("gl.clear(gl.COLOR_BUFFER_BIT);"),s=s.concat(i,x.writeDraw())}var r=!1,n=!1,o=[],i=t();return e.isAnimated()&&(["x","y","z"].forEach(function(t){var r=t.toUpperCase(),n="rotate."+t,i="rotate"+r;e.needsUniform(n)&&("slider"!=e[n+".input"]&&!p(n)||0!=e[n+".speed"]||"constant"!=e[n+".speed.input"])&&o.push("var "+i+"Loc=gl.getUniformLocation(program,'"+i+"');"),"constant"!=e[n+".speed.input"]&&"constant"==e[n+".input"]&&o.push("var "+i+"="+a(n)+";")}),r&&n?o.push("var startTime=performance.now();","var prevTime=startTime;"):r?o.push("var startTime=performance.now();"):n&&o.push("var prevTime=performance.now();")),e.isAnimated()?(o.push("function renderFrame(time) {"),o=o.concat(l(1,i)),n&&o.push("	prevTime=time;"),o.push("	requestAnimationFrame(renderFrame);","}","requestAnimationFrame(renderFrame);")):e.hasInputs()?(o.push("var frameId=null;","function renderFrame() {"),o=o.concat(l(1,i)),o.push("	frameId=null;","}","function scheduleFrame() {","	if (frameId===null) {","		frameId=requestAnimationFrame(renderFrame);","	}","}","scheduleFrame();")):o=o.concat(i),o}var x=u();return[].concat(["<!DOCTYPE html>","<html lang='en'>","<head>","<meta charset='utf-8' />","<title>Generated code</title>"],e.hasSliderInputs()?["<style>","	label {","		display: inline-block;","		width: 15em;","		text-align: right;","	}","	.min {","		display: inline-block;","		width: 3em;","		text-align: right;","	}","	.max {","		display: inline-block;","		width: 3em;","		text-align: left;","	}","</style>"]:[],["<script id='myVertexShader' type='x-shader/x-vertex'>"],l(1,h()),["</script>","<script id='myFragmentShader' type='x-shader/x-fragment'>","	precision mediump float;"],l(1,f()),["</script>","</head>","<body>","<div>","	<canvas id='myCanvas' width='"+r("canvas.width")+"' height='"+r("canvas.height")+"'></canvas>","</div>"],d(),v(),["<script>"],l(1,m()),["	","	var canvas=document.getElementById('myCanvas');","	var gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');"],"solid"!=e.background||e.hasInputsFor("background.solid.color")||0==e["background.solid.color.r"]&&0==e["background.solid.color.g"]&&0==e["background.solid.color.b"]&&0==e["background.solid.color.a"]?[]:["	gl.clearColor("+i("background.solid.color")+");"],x.dim>2?["	gl.enable(gl.DEPTH_TEST);"]:[],["	var program=makeProgram(","		document.getElementById('myVertexShader').text,","		document.getElementById('myFragmentShader').text","	);","	gl.useProgram(program);","	"],l(1,x.writeInit()),["	"],l(1,g()),l(1,y()),["</script>","</body>","</html>"]).join("\n")}},{"./listeners.js":2,"./shapes.js":5}],2:[function(e,t,r){var n=function(){this.entries=[]};n.prototype.enter=function(){function e(e){return function(){for(var t=0;t<arguments.length;t++)e.push(arguments[t]);return r}}var t={state:[],pre:[],cond:null,log:[],post:[]};this.entries.push(t);var r={state:e(t.state),pre:e(t.pre),cond:function(e){return t.cond=e,r},log:e(t.log),post:e(t.post)};return r},n.prototype.innerPrependedLines=function(){return[]},n.prototype.bracketFnArg=function(){return""},n.prototype.wrapCall=function(e){return e},n.prototype.write=function(e,t){function r(e){return"	"+e}function n(e,t){var r;r=e in s?s[e]:s[e]={prevs:[],conds:[],mark:c},null!==r.conds&&(null===t?r.conds=null:r.conds.push(t)),null!==l&&r.prevs.push(l),l=e}function o(){null!==l&&p.push(l),l=null}function a(){function e(e,t){var n=null;null!==t.conds&&(n=t.conds.join(" || ")),n!=a&&(null!==a&&o.push("}"),a=n,null!==a&&o.push("if ("+a+") {")),null!==a?o.push(r(e)):o.push(e)}function t(t,r){r.mark=u,n(r.prevs),r.mark=h,e(t,r)}function n(e){e.forEach(function(e){s[e].mark==c&&t(e,s[e])})}var o=[],a=null;return n(p),null!==a&&o.push("}"),o}var i=[],s={},p=[],l=null,c=0,u=1,h=2;this.entries.forEach(function(r){i=i.concat(r.state),r.pre.forEach(function(e){n(e,null)}),t&&r.log.forEach(function(e){n(e,r.cond)}),r.post.forEach(function(e){n(e,r.cond)}),e&&n("scheduleFrame();",r.cond),o()});var f=this.bracketListener(),d=a();if(d.length&&(d=this.innerPrependedLines().concat(d)),1==d.length){var v=/^(\w+)\(\);$/.exec(d[0]);if(v)return i.concat(this.wrapCall([f[0]+v[1]+f[1]]))}return d.length?i.concat(this.wrapCall([].concat([f[0]+"function("+this.bracketFnArg()+"){"],d.map(r),["}"+f[1]]))):i};var o=function(e){n.call(this),this.id=e};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.bracketListener=function(){return["document.getElementById('"+this.id+"').addEventListener('change',",");"]};var a=function(e){n.call(this),this.query=e};a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.wrapCall=function(e){return[].concat(["[].forEach.call(document.querySelectorAll('"+this.query+"'),function(el){"],e.map(function(e){return"	"+e}),["});"])},a.prototype.bracketListener=function(){return["el.addEventListener('change',",");"]};var i=function(){n.call(this)};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.enter=function(){var e=n.prototype.enter.call(this);return e.prexy=function(t,r,n){return"mousemovex"==t?e.pre(r):"mousemovey"==t?e.pre(n):e},e},i.prototype.bracketListener=function(){return["canvas.addEventListener('mousemove',",");"]},i.prototype.bracketFnArg=function(){return"ev"},i.prototype.innerPrependedLines=function(){return["var rect=this.getBoundingClientRect();"]},r.SliderListener=o,r.MultipleSliderListener=a,r.CanvasMousemoveListener=i},{}],3:[function(e,t,r){function n(){return"webgl-starter-id-"+a++}function o(e){return"data:text/html;charset=utf-8,"+encodeURIComponent(e)}var a=0,i=e("./options.js"),s=e("./code.js"),p=function(e){return{"message.hljs":"<a href='https://highlightjs.org/'>highlight.js</a> (hosted on cdnjs.cloudflare.com) is not loaded. Syntax highlighting is disabled.","options.general":"General options","options.background":"Background","options.background.none":"None (transparent)","options.background.solid":"Solid color","options.shader":"Shader","options.shader.single":"Single color","options.shader.vertex":"One color per vertex","options.shader.face":"One color per face","options.shader.light":"Directional light","options.shape":"Shape to draw","options.shape.square":"Square","options.shape.triangle":"Triangle","options.shape.gasket":"Sierpinski gasket","options.shape.cube":"Cube","options.shape.hat":"Mexican hat function","options.shape.terrain":"Diamond-square fractal terrain","options.projection":"Projection","options.projection.ortho":"Orthogonal","options.projection.perspective":"Perspective","options.input":"Input options","options.canvas.width":"Canvas width","options.canvas.height":"Canvas height","options.background.solid.color.r":"Background color red component","options.background.solid.color.g":"Background color green component","options.background.solid.color.b":"Background color blue component","options.background.solid.color.a":"Background color alpha component","options.shader.single.color.r":"Fragment color red component","options.shader.single.color.g":"Fragment color green component","options.shader.single.color.b":"Fragment color blue component","options.shader.single.color.a":"Fragment color alpha component","options.shape.gasket.depth":"Sierpinski gasket recursion depth","options.shape.hat.resolution":"Mexican hat mesh resolution","options.shape.terrain.depth":"Diamond-square recursion depth","options.*.input":"This value is","options.*.input.constant":"kept constant","options.*.input.slider":"updated with a slider","options.*.input.mousemovex":"updated by moving the mouse horizontally","options.*.input.mousemovey":"updated by moving the mouse vertically","options.*.input.animated":"animated","options.transform":"Transforms","options.rotate.x":"Angle of rotation around x axis","options.rotate.x.speed":"Speed of rotation around x axis","options.rotate.y":"Angle of rotation around y axis","options.rotate.y.speed":"Speed of rotation around y axis","options.rotate.z":"Angle of rotation around z axis","options.rotate.z.speed":"Speed of rotation around z axis","options.debug":"Debug options","options.debugShader":"Log shader compilation errors","options.debugInputs":"Log input values","controls.type.mousemovex":"Move the mouse pointer horizontally over the canvas","controls.type.mousemovey":"Move the mouse pointer vertically over the canvas","controls.to":"to update"}[e]};$(function(){$(".webgl-starter").each(function(){function e(e,t){d.find("[data-option^='"+e+".']").show().not("[data-option^='"+e+"."+t+".']").hide()}function t(){clearTimeout(y),y=setTimeout(function(){v.text(s(g.fix(),p)),window.hljs&&hljs.highlightBlock(v[0])},x)}function r(r){var o=n();return $("<div>").append("<label for='"+o+"'>"+p("options."+r.name)+":</label>").append(" ").append($("<select id='"+o+"'>").append(r.availableValues.map(function(e){return $("<option>").val(e).html(p("options."+r.name+"."+e))})).val(g[r.name]).change(function(){g[r.name]=this.value,e(r.name,this.value),t()}))}function a(e){function r(r){this.checkValidity()&&(r.val(this.value),g[e.name]=parseFloat(this.value),t())}var o,a,i=n(),s=n();return $("<div data-option='"+e.name+"'>").append("<label for='"+i+"'>"+p("options."+e.name)+":</label>").append(" <span class='min'>"+e.getMinLabel()+"</span> ").append(o=$("<input type='range' id='"+i+"'>").attr("min",e.getMin()).attr("max",e.getMax()).attr("step",e.getSetupStep()).val(g[e.name]).on("input change",function(){r.call(this,a)})).append(" <span class='max'>"+e.getMaxLabel()+"</span> ").append(a=$("<input type='number' required>").attr("min",e.getMin()).attr("max",e.getMax()).attr("step",e.getSetupStep()).val(g[e.name]).on("input change",function(){r.call(this,o)})).append(" ").append($("<button type='button'>Reset</button>").click(function(){o.val(e.defaultValue).change()})).append(" ").append("<label for='"+s+"'>"+p("options.*.input")+"</label> ").append($("<select id='"+s+"'>").append(e.availableInputTypes.map(function(e){return $("<option>").val(e).html(p("options.*.input."+e))})).val(g[e.name+".input"]).change(function(){g[e.name+".input"]=this.value,t()}))}function l(e){var r=n();return $("<div>").append($("<input type='checkbox' id='"+r+"'>").prop("checked",g[e.name]).change(function(){g[e.name]=$(this).prop("checked"),t()})).append(" <label for='"+r+"'>"+p("options."+e.name)+"</label>")}function c(e,t){var r=null;e.children().prepend($("<div draggable='true' tabindex='0' title='Drag or press up/down while in focus to reorder transforms'>").on("dragstart",function(e){r=$(this).parent(),e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("Text",name),e.originalEvent.dataTransfer.setDragImage&&e.originalEvent.dataTransfer.setDragImage(r[0],0,0),setTimeout(function(){r.addClass("ghost")},0)}).keydown(function(e){var r=$(this),n=r.parent();return 38==e.keyCode?(n.prev().before(n),r.focus(),t(),!1):40==e.keyCode?(n.next().after(n),r.focus(),t(),!1):void 0})).on("dragover",function(e){e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move";var n=$(this);r&&(n.nextAll().is(r)?(n.before(r),t()):n.prevAll().is(r)&&(n.after(r),t()))}).on("drop",function(e){e.preventDefault()}).on("dragend",function(e){e.preventDefault(),r&&(r.removeClass("ghost"),r=null)})}function u(){var e,n=$("<div>").append($("<fieldset>").append("<legend>"+p("options.general")+"</legend>").append(g.generalOptions.map(r))).append($("<fieldset>").append("<legend>"+p("options.input")+"</legend>").append(g.inputOptions.map(a))).append($("<fieldset>").append("<legend>"+p("options.transform")+"</legend>").append(e=$("<div>").append(g.transforms.map(function(e){return $("<div class='transform' data-transform='"+e.name+"'>").append(e.options.map(a))})))).append($("<fieldset>").append("<legend>"+p("options.debug")+"</legend>").append(g.debugOptions.map(l)));return c(e,function(){g.transformOrder=e.children().map(function(){return $(this).attr("data-transform")}).get(),t()}),n}function h(){g.generalOptions.forEach(function(t){e(t.name,g[t.name])})}function f(){return $("<div>").append($("<a download='source.html'><button type='button'>Save source code</button></a>").click(function(){$(this).attr("href",o(v.text()))})).append(" ").append($("<button type='button'>Run in new window</button>").click(function(){window.open(o(v.text()),"generatedCode")})).append(" these buttons don't work in Internet Explorer, copy-paste the code manually")}var d,v,m=$(this),g=new i,y=null,x=200;m.empty().append(d=u()),h(),m.append(f()).append($("<pre>").append(v=$("<code>").text(s(g.fix(),p)))),window.hljs?hljs.highlightBlock(v[0]):m.append("<p>"+p("message.hljs")+"</p>"),m.append(f())})})},{"./code.js":1,"./options.js":4}],4:[function(e,t,r){var n=function(e,t,r){this.name=e,this.availableValues=t,void 0===r?this.defaultValue=t[0]:this.defaultValue=r};n.prototype.doesValueHideOption=function(e,t){function r(e){return 0===t.name.indexOf(e)}return r(this.name+".")&&!r(this.name+"."+e+".")};var o=function(e,t,r){n.call(this,e,t,r)};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.availableInputTypes=["constant","slider","mousemovex","mousemovey"],o.prototype.getMin=function(){return this.availableValues[0]},o.prototype.getMax=function(){return this.availableValues[1]},o.prototype.getMinLabel=function(){return this.getMin().toString().replace("-","−")},o.prototype.getMaxLabel=function(){return this.getMax().toString().replace("-","−")};var a=function(e,t,r){o.call(this,e,t,r)};a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.getStep=function(){return"any"},a.prototype.getSetupStep=function(){return this.getMax()>=100?"0.1":this.getMax()>=10?"0.01":"0.001"};var i=function(e,t,r){o.call(this,e,t,r)};i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.getStep=function(){return 1},i.prototype.getSetupStep=function(){return 1};var s=function(e,t,r){i.call(this,e,t,r)};s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.availableInputTypes=["constant","slider"];var p=function(e,t){n.call(this,e,[!1,!0],t)};p.prototype=Object.create(n.prototype),p.prototype.constructor=p;var l=function(){this.reset()};l.prototype.generalOptions=[new n("background",["none","solid"]),new n("shader",["single","vertex","face","light"]),new n("shape",["square","triangle","gasket","cube","hat","terrain"]),new n("projection",["ortho","perspective"])],l.prototype.inputOptions=[new s("canvas.width",[1,1024],512),new s("canvas.height",[1,1024],512),new a("background.solid.color.r",[0,1],1),new a("background.solid.color.g",[0,1],1),new a("background.solid.color.b",[0,1],1),new a("background.solid.color.a",[0,1],1),new a("shader.single.color.r",[0,1],1),new a("shader.single.color.g",[0,1]),new a("shader.single.color.b",[0,1]),new a("shader.single.color.a",[0,1],1),new i("shape.gasket.depth",[0,10],6),new i("shape.hat.resolution",[1,255],32),new i("shape.terrain.depth",[0,7],5)],l.prototype.transformOptions=[],l.prototype.transforms=[],["rotate.x","rotate.y","rotate.z"].forEach(function(e){var t=new a(e,[-180,180],0),r=new a(e+".speed",[-360,360],0);l.prototype.transformOptions.push(t),l.prototype.transformOptions.push(r),l.prototype.transforms.push({name:e,options:[t,r]})}),l.prototype.debugOptions=[new p("debugShader",!0),new p("debugInputs")],l.prototype.reset=function(){this.generalOptions.forEach(function(e){this[e.name]=e.defaultValue},this),this.inputOptions.forEach(function(e){this[e.name]=e.defaultValue,this[e.name+".input"]="constant"},this),this.transformOptions.forEach(function(e){this[e.name]=e.defaultValue,this[e.name+".input"]="constant"},this),this.debugOptions.forEach(function(e){this[e.name]=e.defaultValue},this),this.transformOrder=this.transforms.map(function(e){return e.name})},l.prototype.fix=function(){return new c(this)};var c=function(e){["generalOptions","inputOptions","transformOptions","debugOptions"].forEach(function(t){this[t]=[],e[t].forEach(function(r){var n=e.generalOptions.some(function(t){return t.doesValueHideOption(e[t.name],r)});n||(this[t].push(r),this[r.name]=e[r.name],("inputOptions"==t||"transformOptions"==t)&&(this[r.name+".input"]=e[r.name+".input"]))},this)},this),this.transformOrder=e.transformOrder};c.prototype.getInputOptionsFor=function(e){return this.inputOptions.filter(function(t){return 0===t.name.indexOf(e+".")},this)},c.prototype.getInputsFor=function(e){return this.inputOptions.filter(function(t){return 0===t.name.indexOf(e+".")&&"constant"!=this[t.name+".input"]},this)},c.prototype.getOnlyInputFor=function(e){var t=this.getInputsFor(e);return 1==t.length?t[0]:null},c.prototype.hasInputs=function(){return this.inputOptions.some(function(e){return"constant"!=this[e.name+".input"]},this)||this.transformOptions.some(function(e){return"constant"!=this[e.name+".input"]},this)},c.prototype.hasSliderInputs=function(){return this.inputOptions.some(function(e){return"slider"==this[e.name+".input"]},this)||this.transformOptions.some(function(e){return"slider"==this[e.name+".input"]},this)},c.prototype.hasInputsFor=function(e){return this.getInputsFor(e).length>0},c.prototype.hasAllSliderInputsFor=function(e){return this.getInputOptionsFor(e).every(function(e){return"slider"==this[e.name+".input"]},this)},c.prototype.isAnimated=function(){function e(e,t){return-1!==e.indexOf(t,e.length-t.length)}return this.transformOptions.some(function(t){return e(t.name,".speed")&&(0!=this[t.name]||"constant"!=this[t.name+".input"])},this)},c.prototype.needsUniform=function(e){return"constant"!=this[e+".input"]||0!=this[e+".speed"]||"constant"!=this[e+".speed.input"]},c.prototype.needsTransform=function(e){return this.needsUniform(e)||0!=this[e]},t.exports=l},{}],5:[function(e,t,r){var n=function(e){this.shaderType=e};n.prototype.dim=2,n.prototype.twoSided=!0,n.prototype.glPrimitive="TRIANGLES",n.prototype.usesElements=function(){return!1},n.prototype.getNumbersPerPosition=function(){return this.dim},n.prototype.getNumbersPerNormal=function(){return"light"==this.shaderType&&3==this.dim?3:0},n.prototype.getNumbersPerColor=function(){return"vertex"==this.shaderType||"face"==this.shaderType?3:0},n.prototype.getNumbersPerVertex=function(){return this.getNumbersPerPosition()+this.getNumbersPerNormal()+this.getNumbersPerColor();
},n.prototype.writeInit=function(){var e="vertex"==this.shaderType||"face"==this.shaderType,t="vertex"==this.shaderType,r=this.writeArrays(e,t);return r.push("","gl.bindBuffer(gl.ARRAY_BUFFER,gl.createBuffer());","gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);",""),this.usesElements()&&r.push("gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,gl.createBuffer());","gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);",""),r.push("var positionLoc=gl.getAttribLocation(program,'position');"),e?r.push("gl.vertexAttribPointer(","	positionLoc,"+this.dim+",gl.FLOAT,false,","	Float32Array.BYTES_PER_ELEMENT*"+(this.dim+3)+",","	Float32Array.BYTES_PER_ELEMENT*0",");","gl.enableVertexAttribArray(positionLoc);","","var colorLoc=gl.getAttribLocation(program,'color');","gl.vertexAttribPointer(","	colorLoc,3,gl.FLOAT,false,","	Float32Array.BYTES_PER_ELEMENT*"+(this.dim+3)+",","	Float32Array.BYTES_PER_ELEMENT*"+this.dim,");","gl.enableVertexAttribArray(colorLoc);"):this.dim>2&&"light"==this.shaderType?r.push("gl.vertexAttribPointer(","	positionLoc,"+this.dim+",gl.FLOAT,false,","	Float32Array.BYTES_PER_ELEMENT*"+(this.dim+3)+",","	Float32Array.BYTES_PER_ELEMENT*0",");","gl.enableVertexAttribArray(positionLoc);","","var normalLoc=gl.getAttribLocation(program,'normal');","gl.vertexAttribPointer(","	normalLoc,3,gl.FLOAT,false,","	Float32Array.BYTES_PER_ELEMENT*"+(this.dim+3)+",","	Float32Array.BYTES_PER_ELEMENT*"+this.dim,");","gl.enableVertexAttribArray(normalLoc);"):r.push("gl.vertexAttribPointer(positionLoc,"+this.dim+",gl.FLOAT,false,0,0);","gl.enableVertexAttribArray(positionLoc);"),r},n.prototype.writeDraw=function(){return this.usesElements()?["gl.drawElements(gl."+this.glPrimitive+",nElements,gl.UNSIGNED_SHORT,0);"]:["gl.drawArrays(gl."+this.glPrimitive+",0,nVertices);"]};var o=function(e){n.call(this,e)};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.glPrimitive="TRIANGLE_FAN",o.prototype.writeArrays=function(e,t){return["var nVertices=4;","var vertices=new Float32Array([","	// x    y"+(e?"    r    g    b":""),"	-0.5,-0.5,"+(e?" 1.0, 0.0, 0.0,":""),"	+0.5,-0.5,"+(e?t?" 0.0, 1.0, 0.0,":" 1.0, 0.0, 0.0,":""),"	+0.5,+0.5,"+(e?t?" 0.0, 0.0, 1.0,":" 1.0, 0.0, 0.0,":""),"	-0.5,+0.5,"+(e?t?" 1.0, 1.0, 0.0,":" 1.0, 0.0, 0.0,":""),"]);"]};var a=function(e){n.call(this,e)};a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.writeArrays=function(e,t){return["var nVertices=3;","var vertices=new Float32Array([","	//                   x                      y"+(e?"    r    g    b":""),"	-Math.sin(0/3*Math.PI), Math.cos(0/3*Math.PI),"+(e?" 1.0, 0.0, 0.0,":""),"	-Math.sin(2/3*Math.PI), Math.cos(2/3*Math.PI),"+(e?t?" 0.0, 1.0, 0.0,":" 1.0, 0.0, 0.0,":""),"	-Math.sin(4/3*Math.PI), Math.cos(4/3*Math.PI),"+(e?t?" 0.0, 0.0, 1.0,":" 1.0, 0.0, 0.0,":""),"]);"]};var i=function(e,t){n.call(this,e),this.depth=t};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.storeFn="storeGasketVertices",i.prototype.writeArrays=function(e,t){return lines=[],this.depth.changes?lines.push("var minGasketDepth="+this.depth.min+";","var maxGasketDepth="+this.depth.max+";","var nMaxVertices=Math.pow(3,maxGasketDepth)*3;","var vertices=new Float32Array(nMaxVertices*"+this.getNumbersPerVertex()+");","var gasketDepth,nVertices;","function "+this.storeFn+"(newGasketDepth) {","	gasketDepth=newGasketDepth;","	nVertices=Math.pow(3,gasketDepth)*3;"):lines.push("var gasketDepth="+this.depth.value+";","var nVertices=Math.pow(3,gasketDepth)*3;","var vertices=new Float32Array(nVertices*"+this.getNumbersPerVertex()+");","function storeGasketVertices() {"),lines.push("	var iv=0;"),"face"==this.shaderType&&lines.push("	var ic=0;","	var colors=[","		[1.0, 0.0, 0.0],","		[0.0, 1.0, 0.0],","		[0.0, 0.0, 1.0],","		[1.0, 1.0, 0.0],","	];"),"vertex"==this.shaderType?lines.push("	function pushVertex(v,r,g,b) {","		vertices[iv++]=v[0]; vertices[iv++]=v[1];","		vertices[iv++]=r; vertices[iv++]=g; vertices[iv++]=b;","	}"):"face"==this.shaderType?lines.push("	function pushVertex(v,c) {","		vertices[iv++]=v[0]; vertices[iv++]=v[1];","		vertices[iv++]=c[0]; vertices[iv++]=c[1]; vertices[iv++]=c[2];","	}"):lines.push("	function pushVertex(v) {","		vertices[iv++]=v[0]; vertices[iv++]=v[1];","	}"),lines.push("	function mix(a,b,m) {","		return [","			a[0]*(1-m)+b[0]*m,","			a[1]*(1-m)+b[1]*m,","		];","	}","	function triangle(depth,a,b,c) {","		if (depth<=0) {"),"vertex"==this.shaderType?lines.push("			pushVertex(a,1.0,0.0,0.0);","			pushVertex(b,0.0,1.0,0.0);","			pushVertex(c,0.0,0.0,1.0);"):"face"==this.shaderType?lines.push("			pushVertex(a,colors[ic]);","			pushVertex(b,colors[ic]);","			pushVertex(c,colors[ic]);","			ic=(ic+1)%colors.length;"):lines.push("			pushVertex(a);","			pushVertex(b);","			pushVertex(c);"),lines.push("		} else {","			var ab=mix(a,b,0.5);","			var bc=mix(b,c,0.5);","			var ca=mix(c,a,0.5);","			triangle(depth-1,a,ab,ca);","			triangle(depth-1,b,bc,ab);","			triangle(depth-1,c,ca,bc);","		}","	}","	triangle(","		gasketDepth,","		[-Math.sin(0/3*Math.PI),Math.cos(0/3*Math.PI)],","		[-Math.sin(2/3*Math.PI),Math.cos(2/3*Math.PI)],","		[-Math.sin(4/3*Math.PI),Math.cos(4/3*Math.PI)]","	);","}"),this.depth.changes?lines.push(this.storeFn+"("+this.depth.value+");"):lines.push(this.storeFn+"();"),lines};var s=function(e){n.call(this,e)};s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.dim=3,s.prototype.twoSided=!1,s.prototype.usesElements=function(){return!0},s.prototype.writeArrays=function(e,t){if("face"==this.shaderType||"light"==this.shaderType){var r="light"==this.shaderType;return["var vertices=new Float32Array([","	// x    y    z "+(r?" n.x  n.y  n.z ":"   r    g    b"),"	-0.5,-0.5,-0.5,"+(r?"-1.0, 0.0, 0.0,":" 1.0, 0.0, 0.0,")+" // left face","	-0.5,-0.5,+0.5,"+(r?"-1.0, 0.0, 0.0,":" 1.0, 0.0, 0.0,"),"	-0.5,+0.5,-0.5,"+(r?"-1.0, 0.0, 0.0,":" 1.0, 0.0, 0.0,"),"	-0.5,+0.5,+0.5,"+(r?"-1.0, 0.0, 0.0,":" 1.0, 0.0, 0.0,"),"	+0.5,-0.5,-0.5,"+(r?"+1.0, 0.0, 0.0,":" 0.0, 1.0, 0.0,")+" // right face","	+0.5,+0.5,-0.5,"+(r?"+1.0, 0.0, 0.0,":" 0.0, 1.0, 0.0,"),"	+0.5,-0.5,+0.5,"+(r?"+1.0, 0.0, 0.0,":" 0.0, 1.0, 0.0,"),"	+0.5,+0.5,+0.5,"+(r?"+1.0, 0.0, 0.0,":" 0.0, 1.0, 0.0,"),"	-0.5,-0.5,-0.5,"+(r?" 0.0,-1.0, 0.0,":" 1.0, 1.0, 0.0,")+" // bottom face","	+0.5,-0.5,-0.5,"+(r?" 0.0,-1.0, 0.0,":" 1.0, 1.0, 0.0,"),"	-0.5,-0.5,+0.5,"+(r?" 0.0,-1.0, 0.0,":" 1.0, 1.0, 0.0,"),"	+0.5,-0.5,+0.5,"+(r?" 0.0,-1.0, 0.0,":" 1.0, 1.0, 0.0,"),"	-0.5,+0.5,-0.5,"+(r?" 0.0,+1.0, 0.0,":" 0.0, 0.0, 1.0,")+" // top face","	-0.5,+0.5,+0.5,"+(r?" 0.0,+1.0, 0.0,":" 0.0, 0.0, 1.0,"),"	+0.5,+0.5,-0.5,"+(r?" 0.0,+1.0, 0.0,":" 0.0, 0.0, 1.0,"),"	+0.5,+0.5,+0.5,"+(r?" 0.0,+1.0, 0.0,":" 0.0, 0.0, 1.0,"),"	-0.5,-0.5,-0.5,"+(r?" 0.0, 0.0,-1.0,":" 1.0, 0.0, 1.0,")+" // back face","	-0.5,+0.5,-0.5,"+(r?" 0.0, 0.0,-1.0,":" 1.0, 0.0, 1.0,"),"	+0.5,-0.5,-0.5,"+(r?" 0.0, 0.0,-1.0,":" 1.0, 0.0, 1.0,"),"	+0.5,+0.5,-0.5,"+(r?" 0.0, 0.0,-1.0,":" 1.0, 0.0, 1.0,"),"	-0.5,-0.5,+0.5,"+(r?" 0.0, 0.0,+1.0,":" 0.0, 1.0, 1.0,")+" // front face","	+0.5,-0.5,+0.5,"+(r?" 0.0, 0.0,+1.0,":" 0.0, 1.0, 1.0,"),"	-0.5,+0.5,+0.5,"+(r?" 0.0, 0.0,+1.0,":" 0.0, 1.0, 1.0,"),"	+0.5,+0.5,+0.5,"+(r?" 0.0, 0.0,+1.0,":" 0.0, 1.0, 1.0,"),"]);","var nElements=36;","var elements=new Uint16Array([","	 0,  1,  2,  2,  1,  3, // left face","	 4,  5,  6,  6,  5,  7, // right face","	 8,  9, 10, 10,  9, 11, // bottom face","	12, 13, 14, 14, 13, 15, // top face","	16, 17, 18, 18, 17, 19, // back face","	20, 21, 22, 22, 21, 23, // front face","]);"]}return["var vertices=new Float32Array([","	// x    y    z"+(e?"    r    g    b":""),"	-0.5,-0.5,-0.5,"+(e?" 0.0, 0.0, 0.0,":""),"	+0.5,-0.5,-0.5,"+(e?" 1.0, 0.0, 0.0,":""),"	-0.5,+0.5,-0.5,"+(e?" 0.0, 1.0, 0.0,":""),"	+0.5,+0.5,-0.5,"+(e?" 1.0, 1.0, 0.0,":""),"	-0.5,-0.5,+0.5,"+(e?" 0.0, 0.0, 1.0,":""),"	+0.5,-0.5,+0.5,"+(e?" 1.0, 0.0, 1.0,":""),"	-0.5,+0.5,+0.5,"+(e?" 0.0, 1.0, 1.0,":""),"	+0.5,+0.5,+0.5,"+(e?" 1.0, 1.0, 1.0,":""),"]);","var nElements=36;","var elements=new Uint16Array([","	4, 6, 0, 0, 6, 2, // left face","	1, 3, 5, 5, 3, 7, // right face","	0, 1, 4, 4, 1, 5, // bottom face","	2, 6, 3, 3, 6, 7, // top face","	0, 2, 1, 1, 2, 3, // back face","	5, 7, 4, 4, 7, 6, // front face","]);"]};var p=function(e,t){n.call(this,e),this.resolution=t};p.prototype=Object.create(n.prototype),p.prototype.constructor=p,p.prototype.dim=3,p.prototype.storeFn="storeHatVerticesAndElements",p.prototype.usesElements=function(){return"face"!=this.shaderType},p.prototype.writeArrays=function(e,t){lines=[],this.resolution.changes?(lines.push("var minHatResolution="+this.resolution.min+";","var maxHatResolution="+this.resolution.max+";"),"face"!=this.shaderType?lines.push("var nMaxVertices=(maxHatResolution+1)*(maxHatResolution+1);","var vertices=new Float32Array(nMaxVertices*"+this.getNumbersPerVertex()+");","var nMaxElements=maxHatResolution*maxHatResolution*6;","var elements=new Uint16Array(nMaxElements);","var hatResolution,nVertices,nElements;","function "+this.storeFn+"(newHatResolution) {","	hatResolution=newHatResolution;","	nVertices=(hatResolution+1)*(hatResolution+1);","	nElements=hatResolution*hatResolution*6;"):lines.push("var nMaxVertices=maxHatResolution*maxHatResolution*6;","var vertices=new Float32Array(nMaxVertices*"+this.getNumbersPerVertex()+");","var hatResolution,nVertices;","function "+this.storeFn+"(newHatResolution) {","	hatResolution=newHatResolution;","	nVertices=hatResolution*hatResolution*6;")):(lines.push("var hatResolution="+this.resolution.value+";"),"face"!=this.shaderType?lines.push("var nVertices=(hatResolution+1)*(hatResolution+1);","var vertices=new Float32Array(nVertices*"+this.getNumbersPerVertex()+");","var nElements=hatResolution*hatResolution*6;","var elements=new Uint16Array(nElements);","function "+this.storeFn+"() {"):lines.push("var nVertices=hatResolution*hatResolution*6;","var vertices=new Float32Array(nVertices*"+this.getNumbersPerVertex()+");","function "+this.storeFn+"() {")),lines.push("	var xyRange=4;","	var xyScale=1/(4*Math.sqrt(2));"),"face"!=this.shaderType?lines.push("	function vertexElement(i,j) {","		return i*(hatResolution+1)+j;","	}"):lines.push("	function vertexElement(i,j,k) {","		return (i*hatResolution+j)*6+k;","	}"),this.getNumbersPerNormal()&&lines.push("	function normalize(v) {","		var l=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);","		return [v[0]/l,v[1]/l,v[2]/l];","	}"),e&&lines.push("	var colors=[","		[1.0, 1.0, 0.0],","		[1.0, 0.0, 0.0],","		[0.0, 1.0, 0.0],","		[0.0, 0.0, 1.0],","	];");var r=[];return r.push("var r2=(x*x+y*y)/2;","var A=Math.exp(-r2)/Math.PI;","var z=A*(1-r2);","vertices[vertexOffset+0]=x*xyScale;","vertices[vertexOffset+1]=y*xyScale;","vertices[vertexOffset+2]=z;"),this.getNumbersPerNormal()?r.push("var normal=normalize([(z+A)*x/xyScale,(z+A)*y/xyScale,1]);","vertices[vertexOffset+3]=normal[0];","vertices[vertexOffset+4]=normal[1];","vertices[vertexOffset+5]=normal[2];"):e&&r.push("var ic=(i&1)*2+(j&1);","vertices[vertexOffset+3]=colors[ic][0];","vertices[vertexOffset+4]=colors[ic][1];","vertices[vertexOffset+5]=colors[ic][2];"),"face"!=this.shaderType?(lines.push("	var i,j;","	for (i=0;i<=hatResolution;i++) {","		var y=i/hatResolution*xyRange*2-xyRange;","		for (j=0;j<=hatResolution;j++) {","			var x=j/hatResolution*xyRange*2-xyRange;","			var vertexOffset=vertexElement(i,j)*"+this.getNumbersPerVertex()+";"),r.forEach(function(e){lines.push("			"+e)}),lines.push("		}","	}","	for (i=0;i<hatResolution;i++) {","		for (j=0;j<hatResolution;j++) {","			var elementOffset=(i*hatResolution+j)*6;","			elements[elementOffset+0]=vertexElement(i+0,j+0);","			elements[elementOffset+1]=vertexElement(i+0,j+1);","			elements[elementOffset+2]=vertexElement(i+1,j+0);","			elements[elementOffset+3]=vertexElement(i+1,j+0);","			elements[elementOffset+4]=vertexElement(i+0,j+1);","			elements[elementOffset+5]=vertexElement(i+1,j+1);","		}","	}","}")):(lines.push("	for (var i=0;i<hatResolution;i++) {","		for (var j=0;j<hatResolution;j++) {","			for (var k=0;k<6;k++) {","				var di=[0,0,1,1,0,1][k];","				var dj=[0,1,0,0,1,1][k];","				var y=(i+di)/hatResolution*xyRange*2-xyRange;","				var x=(j+dj)/hatResolution*xyRange*2-xyRange;","				var vertexOffset=vertexElement(i,j,k)*"+this.getNumbersPerVertex()+";"),r.forEach(function(e){lines.push("				"+e)}),lines.push("			}","		}","	}","}")),this.resolution.changes?lines.push(""+this.storeFn+"("+this.resolution.value+");"):lines.push(this.storeFn+"();"),lines};var l=function(e,t){n.call(this,e),this.depth=t};l.prototype=Object.create(n.prototype),l.prototype.constructor=l,l.prototype.dim=3,l.prototype.storeFn="storeTerrainVerticesAndElements",l.prototype.usesElements=function(){return"face"!=this.shaderType},l.prototype.writeArrays=function(e,t){lines=[],this.depth.changes?(lines.push("var minTerrainDepth="+this.depth.min+";","var maxTerrainDepth="+this.depth.max+";"),"face"!=this.shaderType?lines.push("var nMaxVertices=Math.pow((1<<maxTerrainDepth)+1,2);","var vertices=new Float32Array(nMaxVertices*"+this.getNumbersPerVertex()+");","var nMaxElements=Math.pow((1<<maxTerrainDepth),2)*6;","var elements=new Uint16Array(nMaxElements);","var terrainDepth,nVertices,nElements;","function "+this.storeFn+"(newTerrainDepth) {","	terrainDepth=newTerrainDepth;","	nVertices=Math.pow((1<<terrainDepth)+1,2);","	nElements=Math.pow((1<<terrainDepth),2)*6;"):lines.push("var nMaxVertices=Math.pow((1<<maxTerrainDepth),2)*6;","var vertices=new Float32Array(nMaxVertices*"+this.getNumbersPerVertex()+");","var terrainDepth,nVertices;","function "+this.storeFn+"(newTerrainDepth) {","	terrainDepth=newTerrainDepth;","	nVertices=Math.pow((1<<terrainDepth),2)*6;")):(lines.push("var terrainDepth="+this.depth.value+";"),"face"!=this.shaderType?lines.push("var nVertices=Math.pow((1<<terrainDepth)+1,2);","var vertices=new Float32Array(nVertices*"+this.getNumbersPerVertex()+");","var nElements=Math.pow((1<<terrainDepth),2)*6;","var elements=new Uint16Array(nElements);","function "+this.storeFn+"() {"):lines.push("var nVertices=Math.pow((1<<terrainDepth),2)*6;","var vertices=new Float32Array(nVertices*"+this.getNumbersPerVertex()+");","function "+this.storeFn+"() {")),lines.push("	var xyRange=1/Math.sqrt(2);","	var zRange=xyRange;","	var res=1<<terrainDepth;","	var mask=res-1;"),"face"!=this.shaderType?lines.push("	function vertexElement(i,j) {","		return i*(res+1)+j;","	}"):lines.push("	function vertexElement(i,j,k) {","		return (i*res+j)*6+k;","	}"),this.getNumbersPerNormal()&&lines.push("	function normalize(v) {","		var l=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);","		return [v[0]/l,v[1]/l,v[2]/l];","	}"),e&&lines.push("	var colors=[","		[1.0, 1.0, 0.0],","		[1.0, 0.0, 0.0],","		[0.0, 1.0, 0.0],","		[0.0, 0.0, 1.0],","	];");var r=[];return r.push("vertices[vertexOffset+0]=x;","vertices[vertexOffset+1]=y;","face"!=this.shaderType?"// vertices[vertexOffset+2] already written":"vertices[vertexOffset+2]=vertices[zOffset((i+di)&mask,(j+dj)&mask)];"),this.getNumbersPerNormal()?r.push("var d=4*xyRange/res;","var normal=normalize([","face"!=this.shaderType?"	(vertices[zOffset(i,(j-1)&mask)]-vertices[zOffset(i,(j+1)&mask)])/d,":"	(vertices[zOffset((i+di)&mask,(j+dj-1)&mask)]-vertices[zOffset((i+di)&mask,(j+dj+1)&mask)])/d,","face"!=this.shaderType?"	(vertices[zOffset((i-1)&mask,j)]-vertices[zOffset((i+1)&mask,j)])/d,":"	(vertices[zOffset((i+di-1)&mask,(j+dj)&mask)]-vertices[zOffset((i+di+1)&mask,(j+dj)&mask)])/d,","1]);","vertices[vertexOffset+3]=normal[0];","vertices[vertexOffset+4]=normal[1];","vertices[vertexOffset+5]=normal[2];"):e&&r.push("var ic=(i&1)*2+(j&1);","vertices[vertexOffset+3]=colors[ic][0];","vertices[vertexOffset+4]=colors[ic][1];","vertices[vertexOffset+5]=colors[ic][2];"),lines.push("	function zOffset(i,j) {","		return vertexElement(i,j"+("face"!=this.shaderType?"":",0")+")*"+this.getNumbersPerVertex()+"+2;","	}","	function noise(depth) {","		var r=zRange/Math.pow(2,terrainDepth-depth-1);","		return Math.random()*2*r-r;","	}","	vertices[2]=0.0;","	var i1,i2,i3,i4;","	var j1,j2,j3,j4;","	for (var depth=terrainDepth-1;depth>=0;depth--) {","		var d=1<<depth;","		// diamond step","		for (i2=d;i2<res;i2+=2*d) {","			for (j2=d;j2<res;j2+=2*d) {","				i1=i2-d;","				j1=j2-d;","				i3=(i2+d)&mask;","				j3=(j2+d)&mask;","				vertices[zOffset(i2,j2)]=(","					vertices[zOffset(i1,j1)]+vertices[zOffset(i1,j3)]+","					vertices[zOffset(i3,j1)]+vertices[zOffset(i3,j3)]","				)/4+noise(depth);","			}","		}","		// square step","		for (i2=d;i2<res;i2+=2*d) {","			for (j2=d;j2<res;j2+=2*d) {","				i0=(i2-2*d)&mask;","				j0=(j2-2*d)&mask;","				i1=(i2-d);","				j1=(j2-d);","				i3=(i2+d)&mask;","				j3=(j2+d)&mask;","				vertices[zOffset(i2,j1)]=(","					vertices[zOffset(i2,j0)]+vertices[zOffset(i1,j1)]+","					vertices[zOffset(i2,j2)]+vertices[zOffset(i3,j1)]","				)/4+noise(depth);","				vertices[zOffset(i1,j2)]=(","					vertices[zOffset(i0,j2)]+vertices[zOffset(i1,j1)]+","					vertices[zOffset(i2,j2)]+vertices[zOffset(i1,j3)]","				)/4+noise(depth);","			}","		}","	}"),"face"!=this.shaderType?(lines.push("	var i,j;","	for (i=0;i<res;i++) vertices[zOffset(i,res)]=vertices[zOffset(i,0)];","	for (j=0;j<res;j++) vertices[zOffset(res,j)]=vertices[zOffset(0,j)];","	vertices[zOffset(res,res)]=vertices[zOffset(0,0)];"),lines.push("	for (i=0;i<=res;i++) {","		var y=i/res*xyRange*2-xyRange;","		for (j=0;j<=res;j++) {","			var x=j/res*xyRange*2-xyRange;","			var vertexOffset=vertexElement(i,j)*"+this.getNumbersPerVertex()+";"),r.forEach(function(e){lines.push("			"+e)}),lines.push("		}","	}"),lines.push("	for (i=0;i<res;i++) {","		for (j=0;j<res;j++) {","			var elementOffset=(i*res+j)*6;","			elements[elementOffset+0]=vertexElement(i+0,j+0);","			elements[elementOffset+1]=vertexElement(i+0,j+1);","			elements[elementOffset+2]=vertexElement(i+1,j+0);","			elements[elementOffset+3]=vertexElement(i+1,j+0);","			elements[elementOffset+4]=vertexElement(i+0,j+1);","			elements[elementOffset+5]=vertexElement(i+1,j+1);","		}","	}","}")):(lines.push("	for (var i=0;i<res;i++) {","		for (var j=0;j<res;j++) {","			for (var k=0;k<6;k++) {","				var di=[0,0,1,1,0,1][k];","				var dj=[0,1,0,0,1,1][k];","				var y=(i+di)/res*xyRange*2-xyRange;","				var x=(j+dj)/res*xyRange*2-xyRange;","				var vertexOffset=vertexElement(i,j,k)*"+this.getNumbersPerVertex()+";"),r.forEach(function(e){lines.push("				"+e)}),lines.push("			}","		}","	}","}")),this.depth.changes?lines.push(""+this.storeFn+"("+this.depth.value+");"):lines.push(this.storeFn+"();"),lines},r.Square=o,r.Triangle=a,r.Gasket=i,r.Cube=s,r.Hat=p,r.Terrain=l},{}]},{},[3]);
//# sourceMappingURL=index.js.map