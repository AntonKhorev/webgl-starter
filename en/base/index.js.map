{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/code.js","index.js","src/main.js","src/options.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","options","i18n","intOptionValue","name","parseInt","floatOptionValue","toFixed","colorValue","prefix","indentLines","level","lines","map","line","Array","join","appendLinesToLastLine","addedLines","lastLine","pop","indent","exec","forEach","push","generateVertexShaderLines","animation","shader","generateFragmentShaderLines","hasInputsFor","generateInputLines","concat","apply","inputOptions","filter","option","getMinLabel","getStep","getMin","getMax","getMaxLabel","generateShapeLines","square","c","triangle","gasket","shape","generateBufferLines","generateInputHandlerLines","updater","optionPrefix","updateFnName","allInputsPre","allInputsPost","someInputsPre","someInputsPost","hasAllInputsFor","eventListener","onlyInput","getOnlyInputFor","generateRenderLines","renderInner","background","needUpdateCanvasFunction","hasInputs",2,"generateId","idCounter","getHtmlDataUri","html","encodeURIComponent","Options","generateCode","id","message.hljs","options.general","options.background","options.background.none","options.background.solid","options.shader","options.shader.single","options.shader.vertex","options.shape","options.shape.square","options.shape.triangle","options.shape.gasket","options.animation","options.animation.none","options.animation.rotation","options.input","options.background.solid.color.r","options.background.solid.color.g","options.background.solid.color.b","options.background.solid.color.a","options.shader.single.color.r","options.shader.single.color.g","options.shader.single.color.b","options.shader.single.color.a","options.shape.gasket.depth","options.animation.rotation.speed","options.*.input","$","each","showHideSuboptionInputs","optionName","optionValue","optionsNode","find","show","not","hide","updateCode","codeNode","text","cloneWithoutHidden","window","hljs","highlightBlock","writeGeneralOption","append","availableValues","availableValue","val","change","this","value","writeInputOption","checkboxId","attr","parseFloat","prop","writeOptions","generalOptions","hideSuboptionInputs","containerNode","empty","click","open","./code.js","./options.js",3,"Option","defaultValue","undefined","prototype","doesValueHideOption","optionStartsWith","indexOf","toString","replace","reset","some","every","matchedOptions","newOptions","generalOption"],"mappings":"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","file":"index.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports=function(options,i18n){\r\n\tfunction intOptionValue(name) {\r\n\t\treturn parseInt(options[name]);\r\n\t}\r\n\tfunction floatOptionValue(name) {\r\n\t\treturn options[name].toFixed(3);\r\n\t}\r\n\tfunction colorValue(prefix) {\r\n\t\treturn floatOptionValue(prefix+'.r')+\",\"+\r\n\t\t       floatOptionValue(prefix+'.g')+\",\"+\r\n\t\t       floatOptionValue(prefix+'.b')+\",\"+\r\n\t\t       floatOptionValue(prefix+'.a');\r\n\t}\r\n\tfunction indentLines(level,lines) {\r\n\t\treturn lines.map(function(line){\r\n\t\t\treturn Array(level+1).join(\"\t\")+line;\r\n\t\t});\r\n\t}\r\n\tfunction appendLinesToLastLine(lines,addedLines) {\r\n\t\tvar lastLine=lines.pop();\r\n\t\tvar indent=/^\\s*/.exec(lastLine)[0];\r\n\t\taddedLines.forEach(function(line,i){\r\n\t\t\tif (i==0) {\r\n\t\t\t\tlines.push(lastLine+line);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(indent+line);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction generateVertexShaderLines() {\r\n\t\tlines=[];\r\n\t\tif (options.animation=='rotation') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"uniform float rotationAngle;\",\r\n\t\t\t\t\"attribute vec2 position;\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"attribute vec4 position;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (options.shader=='vertex') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"attribute vec4 color;\",\r\n\t\t\t\t\"varying vec4 interpolatedColor;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.push(\r\n\t\t\t\"void main() {\"\r\n\t\t);\r\n\t\tif (options.animation=='rotation') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tfloat c=cos(radians(rotationAngle));\",\r\n\t\t\t\t\"\tfloat s=sin(radians(rotationAngle));\",\r\n\t\t\t\t\"\tgl_Position=vec4(mat2(\",\r\n\t\t\t\t\"\t\t c, s,\",\r\n\t\t\t\t\"\t\t-s, c\",\r\n\t\t\t\t\"\t)*position,0,1);\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tgl_Position=position;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (options.shader=='vertex') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tinterpolatedColor=color;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.push(\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateFragmentShaderLines() {\r\n\t\tif (options.shader=='vertex') {\r\n\t\t\treturn [\r\n\t\t\t\t\"varying vec4 interpolatedColor;\",\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"\tgl_FragColor=interpolatedColor;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t];\r\n\t\t} else if (options.hasInputsFor('shader.single.color')) {\r\n\t\t\treturn [\r\n\t\t\t\t\"uniform vec4 color;\",\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"\tgl_FragColor=color;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\treturn [\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"\tgl_FragColor=vec4(\"+colorValue('shader.single.color')+\");\",\r\n\t\t\t\t\"}\",\r\n\t\t\t];\r\n\t\t}\r\n\t}\r\n\tfunction generateInputLines() {\r\n\t\treturn [].concat.apply([],\r\n\t\t\toptions.inputOptions.filter(function(option){\r\n\t\t\t\treturn options[option.name+'.input'];\r\n\t\t\t}).map(function(option){\r\n\t\t\t\treturn [\r\n\t\t\t\t\t\"<div>\",\r\n\t\t\t\t\t\"\t<label for='\"+option.name+\"'>\"+i18n('options.'+option.name)+\":</label>\",\r\n\t\t\t\t\t\"\t<span class='min'>\"+option.getMinLabel()+\"</span> \"+\r\n\t\t\t\t\t\t(option.getStep()==1\r\n\t\t\t\t\t\t\t? \"<input type='range' id='\"+option.name+\"' min='\"+option.getMin()+\"' max='\"+option.getMax()+\"' value='\"+intOptionValue(option.name)+\"' />\"\r\n\t\t\t\t\t\t\t: \"<input type='range' id='\"+option.name+\"' min='\"+option.getMin()+\"' max='\"+option.getMax()+\"' step='\"+option.getStep()+\"' value='\"+floatOptionValue(option.name)+\"' />\"\r\n\t\t\t\t\t\t)+\r\n\t\t\t\t\t\t\" <span class='max'>\"+option.getMaxLabel()+\"</span>\",\r\n\t\t\t\t\t\"</div>\",\r\n\t\t\t\t];\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\tfunction generateShapeLines() {\r\n\t\tvar c=options.shader=='vertex';\r\n\t\tfunction square() {\r\n\t\t\treturn [\r\n\t\t\t\t\"var nVertices=4;\",\r\n\t\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\t\"\t// x    y\"+(c?\"    r    g    b\":\"\"),\r\n\t\t\t\t\"\t-0.5,-0.5,\"+(c?\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\t\t\"\t+0.5,-0.5,\"+(c?\" 0.0, 1.0, 0.0,\":\"\"),\r\n\t\t\t\t\"\t+0.5,+0.5,\"+(c?\" 0.0, 0.0, 1.0,\":\"\"),\r\n\t\t\t\t\"\t-0.5,+0.5,\"+(c?\" 1.0, 1.0, 0.0,\":\"\"),\r\n\t\t\t\t\"]);\",\r\n\t\t\t];\r\n\t\t}\r\n\t\tfunction triangle() {\r\n\t\t\treturn [\r\n\t\t\t\t\"var nVertices=3;\",\r\n\t\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\t\"\t//                   x                      y\"+(c?\"    r    g    b\":\"\"),\r\n\t\t\t\t\"\t-Math.sin(0/3*Math.PI), Math.cos(0/3*Math.PI),\"+(c?\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\t\t\"\t-Math.sin(2/3*Math.PI), Math.cos(2/3*Math.PI),\"+(c?\" 0.0, 1.0, 0.0,\":\"\"),\r\n\t\t\t\t\"\t-Math.sin(4/3*Math.PI), Math.cos(4/3*Math.PI),\"+(c?\" 0.0, 0.0, 1.0,\":\"\"),\r\n\t\t\t\t\"]);\",\r\n\t\t\t];\r\n\t\t}\r\n\t\tfunction gasket() {\r\n\t\t\tlines=[];\r\n\t\t\tif (options['shape.gasket.depth.input']) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var gasketMaxDepth=10;\",\r\n\t\t\t\t\t\"var nMaxVertices=Math.pow(3,gasketMaxDepth)*3;\",\r\n\t\t\t\t\t\"var vertices=new Float32Array(nMaxVertices*\"+(c?5:2)+\");\",\r\n\t\t\t\t\t\"var nVertices;\",\r\n\t\t\t\t\t\"function storeGasketVertices(gasketDepth) {\",\r\n\t\t\t\t\t\"\tnVertices=Math.pow(3,gasketDepth)*3;\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var gasketDepth=\"+intOptionValue('shape.gasket.depth')+\";\",\r\n\t\t\t\t\t\"var nVertices=Math.pow(3,gasketDepth)*3;\",\r\n\t\t\t\t\t\"var vertices=new Float32Array(nVertices*\"+(c?5:2)+\");\",\r\n\t\t\t\t\t\"function storeGasketVertices() {\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tvar iv=0;\"\r\n\t\t\t);\r\n\t\t\tif (c) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tfunction pushVertex(v,r,g,b) {\",\r\n\t\t\t\t\t\"\t\tvertices[iv++]=v[0]; vertices[iv++]=v[1];\",\r\n\t\t\t\t\t\"\t\tvertices[iv++]=r; vertices[iv++]=g; vertices[iv++]=b;\",\r\n\t\t\t\t\t\"\t}\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tfunction pushVertex(v) {\",\r\n\t\t\t\t\t\"\t\tvertices[iv++]=v[0]; vertices[iv++]=v[1];\",\r\n\t\t\t\t\t\"\t}\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tfunction mix(a,b,m) {\",\r\n\t\t\t\t\"\t\treturn [\",\r\n\t\t\t\t\"\t\t\ta[0]*(1-m)+b[0]*m,\",\r\n\t\t\t\t\"\t\t\ta[1]*(1-m)+b[1]*m,\",\r\n\t\t\t\t\"\t\t];\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"\tfunction triangle(depth,a,b,c) {\",\r\n\t\t\t\t\"\t\tif (depth<=0) {\"\r\n\t\t\t);\r\n\t\t\tif (c) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t\t\tpushVertex(a,1.0,0.0,0.0);\",\r\n\t\t\t\t\t\"\t\t\tpushVertex(b,0.0,1.0,0.0);\",\r\n\t\t\t\t\t\"\t\t\tpushVertex(c,0.0,0.0,1.0);\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t\t\tpushVertex(a);\",\r\n\t\t\t\t\t\"\t\t\tpushVertex(b);\",\r\n\t\t\t\t\t\"\t\t\tpushVertex(c);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\t\t} else {\",\r\n\t\t\t\t\"\t\t\tvar ab=mix(a,b,0.5);\",\r\n\t\t\t\t\"\t\t\tvar bc=mix(b,c,0.5);\",\r\n\t\t\t\t\"\t\t\tvar ca=mix(c,a,0.5);\",\r\n\t\t\t\t\"\t\t\ttriangle(depth-1,a,ab,ca);\",\r\n\t\t\t\t\"\t\t\ttriangle(depth-1,b,bc,ab);\",\r\n\t\t\t\t\"\t\t\ttriangle(depth-1,c,ca,bc);\",\r\n\t\t\t\t\"\t\t}\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"\ttriangle(\",\r\n\t\t\t\t\"\t\tgasketDepth,\",\r\n\t\t\t\t\"\t\t[-Math.sin(0/3*Math.PI),Math.cos(0/3*Math.PI)],\",\r\n\t\t\t\t\"\t\t[-Math.sin(2/3*Math.PI),Math.cos(2/3*Math.PI)],\",\r\n\t\t\t\t\"\t\t[-Math.sin(4/3*Math.PI),Math.cos(4/3*Math.PI)]\",\r\n\t\t\t\t\"\t);\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t\tif (options['shape.gasket.depth.input']) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"storeGasketVertices(\"+intOptionValue('shape.gasket.depth')+\");\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"storeGasketVertices();\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn lines;\r\n\t\t}\r\n\t\tif (options.shape=='square') {\r\n\t\t\treturn square();\r\n\t\t} else if (options.shape=='triangle') {\r\n\t\t\treturn triangle();\r\n\t\t} else if (options.shape=='gasket') {\r\n\t\t\treturn gasket();\r\n\t\t}\r\n\t}\r\n\tfunction generateBufferLines() {\r\n\t\tvar lines=[\r\n\t\t\t\"var buffer=gl.createBuffer();\",\r\n\t\t\t\"gl.bindBuffer(gl.ARRAY_BUFFER,buffer);\",\r\n\t\t\t\"gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);\",\r\n\t\t\t\"\",\r\n\t\t\t\"var positionLoc=gl.getAttribLocation(program,'position');\",\r\n\t\t];\r\n\t\tif (options.shader=='vertex') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\t\"\tpositionLoc,2,gl.FLOAT,false,\",\r\n\t\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*5,\",\r\n\t\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*0\",\r\n\t\t\t\t\");\",\r\n\t\t\t\t\"gl.enableVertexAttribArray(positionLoc);\",\r\n\t\t\t\t\"\",\r\n\t\t\t\t\"var colorLoc=gl.getAttribLocation(program,'color');\",\r\n\t\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\t\"\tcolorLoc,3,gl.FLOAT,false,\",\r\n\t\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*5,\",\r\n\t\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*2\",\r\n\t\t\t\t\");\",\r\n\t\t\t\t\"gl.enableVertexAttribArray(colorLoc);\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"gl.vertexAttribPointer(positionLoc,2,gl.FLOAT,false,0,0);\",\r\n\t\t\t\t\"gl.enableVertexAttribArray(positionLoc);\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateInputHandlerLines() {\r\n\t\tvar lines=[];\r\n\t\tfunction updater(optionPrefix,updateFnName,allInputsPre,allInputsPost,someInputsPre,someInputsPost) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"function \"+updateFnName+\"() {\"\r\n\t\t\t);\r\n\t\t\tif (options.hasAllInputsFor(optionPrefix)) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t\"+allInputsPre+\"['r','g','b','a'].map(function(c){\",\r\n\t\t\t\t\t\"\t\treturn parseFloat(document.getElementById('\"+optionPrefix+\".'+c).value);\",\r\n\t\t\t\t\t\"\t})\"+allInputsPost\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t\"+someInputsPre+['r','g','b','a'].map(function(c){\r\n\t\t\t\t\t\tvar name=optionPrefix+'.'+c;\r\n\t\t\t\t\t\tif (options[name+'.input']) {\r\n\t\t\t\t\t\t\treturn \"parseFloat(document.getElementById('\"+name+\"').value)\";\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn floatOptionValue(name);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).join()+someInputsPost\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"}\",\r\n\t\t\t\tupdateFnName+\"();\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tfunction eventListener(optionPrefix,updateFnName) {\r\n\t\t\tvar onlyInput=options.getOnlyInputFor(optionPrefix);\r\n\t\t\tif (onlyInput===null) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"[].forEach.call(document.querySelectorAll('[id^=\\\"\"+optionPrefix+\".\\\"]'),function(el){\",\r\n\t\t\t\t\t\"\tel\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"document.getElementById('\"+onlyInput.name+\"')\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (options.animation=='rotation') {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\".addEventListener('change',\"+updateFnName+\");\",\r\n\t\t\t\t]);\r\n\t\t\t} else {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\".addEventListener('change',function(){\",\r\n\t\t\t\t\t\"\t\"+updateFnName+\"();\",\r\n\t\t\t\t\t\"\tupdateCanvas();\",\r\n\t\t\t\t\t\"});\"\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t\tif (onlyInput===null) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"});\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (options.hasInputsFor('background.solid.color')) {\r\n\t\t\tupdater(\r\n\t\t\t\t'background.solid.color','updateClearColor',\r\n\t\t\t\t'gl.clearColor.apply(gl,',');',\r\n\t\t\t\t'gl.clearColor(',');'\r\n\t\t\t);\r\n\t\t\teventListener('background.solid.color','updateClearColor');\r\n\t\t}\r\n\t\tif (options.hasInputsFor('shader.single.color')) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var colorLoc=gl.getUniformLocation(program,'color');\"\r\n\t\t\t);\r\n\t\t\tupdater(\r\n\t\t\t\t'shader.single.color','updateColor',\r\n\t\t\t\t'gl.uniform4fv(colorLoc,',');',\r\n\t\t\t\t'gl.uniform4fv(colorLoc,[',']);'\r\n\t\t\t);\r\n\t\t\teventListener('shader.single.color','updateColor');\r\n\t\t}\r\n\t\tif (options['shape.gasket.depth.input']) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"document.getElementById('shape.gasket.depth').addEventListener('change',function(){\",\r\n\t\t\t\t\"\tstoreGasketVertices(parseInt(this.value));\",\r\n\t\t\t\t\"\tgl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);\"\r\n\t\t\t);\r\n\t\t\tif (options.animation!='rotation') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tupdateCanvas();\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"});\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (lines.length) lines.push(\"\t\");\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateRenderLines() {\r\n\t\tfunction renderInner() {\r\n\t\t\tvar lines=[];\r\n\t\t\tif (options.background=='solid') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"gl.clear(gl.COLOR_BUFFER_BIT);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (options.animation=='rotation') {\r\n\t\t\t\tif (options['animation.rotation.speed.input']) {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"var rotationSpeed=parseFloat(document.getElementById('animation.rotation.speed').value);\",\r\n\t\t\t\t\t\t\"rotationAngle+=rotationSpeed*360*(time-prevTime)/1000;\",\r\n\t\t\t\t\t\t\"gl.uniform1f(rotationAngleLoc,rotationAngle);\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"gl.uniform1f(rotationAngleLoc,\"+floatOptionValue('animation.rotation.speed')+\"*360*(time-startTime)/1000);\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (options.shape=='square') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"gl.drawArrays(gl.TRIANGLE_FAN,0,nVertices);\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"gl.drawArrays(gl.TRIANGLES,0,nVertices);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn lines;\r\n\t\t}\r\n\t\tvar lines=[];\r\n\t\tif (options.animation=='rotation') {\r\n\t\t\tif (options['animation.rotation.speed.input']) {\r\n\t\t\t\t// angle needs to be a state only if speed is controllable\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var rotationAngle=0;\",\r\n\t\t\t\t\t\"var prevTime=performance.now();\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var startTime=performance.now();\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar needUpdateCanvasFunction=options.animation=='rotation'||options.hasInputs()\r\n\t\tif (needUpdateCanvasFunction) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"function updateCanvas(time) {\"\r\n\t\t\t);\r\n\t\t\tlines=lines.concat(\r\n\t\t\t\tindentLines(1,renderInner())\r\n\t\t\t);\r\n\t\t\tif (options.animation=='rotation') {\r\n\t\t\t\tif (options['animation.rotation.speed.input']) {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"\tprevTime=time;\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\trequestAnimationFrame(updateCanvas);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t\tif (options.animation=='rotation') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"requestAnimationFrame(updateCanvas);\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"updateCanvas();\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlines=lines.concat(\r\n\t\t\t\trenderInner()\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\r\n\treturn [].concat([\r\n\t\t\"<!DOCTYPE html>\",\r\n\t\t\"<html lang='en'>\",\r\n\t\t\"<head>\",\r\n\t\t\"<meta charset='utf-8' />\",\r\n\t\t\"<title>Generated code</title>\",\r\n\t],options.hasInputs()?[\r\n\t\t\"<style>\",\r\n\t\t\"\tlabel {\",\r\n\t\t\"\t\tdisplay: inline-block;\",\r\n\t\t\"\t\twidth: 15em;\",\r\n\t\t\"\t\ttext-align: right;\",\r\n\t\t\"\t}\",\r\n\t\t\"\t.min {\",\r\n\t\t\"\t\tdisplay: inline-block;\",\r\n\t\t\"\t\twidth: 1.5em;\",\r\n\t\t\"\t\ttext-align: right;\",\r\n\t\t\"\t}\",\r\n\t\t\"\t.max {\",\r\n\t\t\"\t\tdisplay: inline-block;\",\r\n\t\t\"\t\twidth: 1.5em;\",\r\n\t\t\"\t\ttext-align: left;\",\r\n\t\t\"\t}\",\r\n\t\t\"</style>\",\r\n\t]:[],[\r\n\t\t\"<script id='myVertexShader' type='x-shader/x-vertex'>\",\r\n\t],indentLines(1,generateVertexShaderLines()),[\r\n\t\t\"</script>\",\r\n\t\t\"<script id='myFragmentShader' type='x-shader/x-fragment'>\",\r\n\t\t\"\tprecision mediump float;\",\r\n\t],indentLines(1,generateFragmentShaderLines()),[\r\n\t\t\"</script>\",\r\n\t\t\"</head>\",\r\n\t\t\"<body>\",\r\n\t\t\"<div>\",\r\n\t\t\"\t<canvas id='myCanvas' width='512' height='512'></canvas>\",\r\n\t\t\"</div>\",\r\n\t],generateInputLines(),[\r\n\t\t\"<script>\",\r\n\t\t\"\tfunction makeProgram(vertexShaderSrc,fragmentShaderSrc) {\",\r\n\t\t\"\t\tvar vertexShader=gl.createShader(gl.VERTEX_SHADER);\",\r\n\t\t\"\t\tgl.shaderSource(vertexShader,vertexShaderSrc);\",\r\n\t\t\"\t\tgl.compileShader(vertexShader);\",\r\n\t\t\"\t\tif (!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(vertexShader));\",\r\n\t\t\"\t\tvar fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);\",\r\n\t\t\"\t\tgl.shaderSource(fragmentShader,fragmentShaderSrc);\",\r\n\t\t\"\t\tgl.compileShader(fragmentShader);\",\r\n\t\t\"\t\tif (!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(fragmentShader));\",\r\n\t\t\"\t\tvar program=gl.createProgram();\",\r\n\t\t\"\t\tgl.attachShader(program,vertexShader);\",\r\n\t\t\"\t\tgl.attachShader(program,fragmentShader);\",\r\n\t\t\"\t\tgl.linkProgram(program);\",\r\n\t\t\"\t\treturn program;\",\r\n\t\t\"\t}\",\r\n\t\t\"\t\",\r\n\t\t\"\tvar canvas=document.getElementById('myCanvas');\",\r\n\t\t\"\tvar gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');\",\r\n\t],(options.background=='solid' && !options.hasInputsFor('background.solid.color'))?[\r\n\t\t\"\tgl.clearColor(\"+colorValue('background.solid.color')+\");\",\r\n\t]:[],[\r\n\t\t\"\tvar program=makeProgram(\",\r\n\t\t\"\t\tdocument.getElementById('myVertexShader').text,\",\r\n\t\t\"\t\tdocument.getElementById('myFragmentShader').text\",\r\n\t\t\"\t);\",\r\n\t\t\"\tgl.useProgram(program);\",\r\n\t\t\"\t\",\r\n\t],indentLines(1,generateShapeLines()),[\r\n\t\t\"\t\",\r\n\t],indentLines(1,generateBufferLines()),[\r\n\t\t\"\t\",\r\n\t],indentLines(1,generateInputHandlerLines()),options.animation=='rotation'?[\r\n\t\t\"\tvar rotationAngleLoc=gl.getUniformLocation(program,'rotationAngle');\",\r\n\t\t\"\t\",\r\n\t]:[],indentLines(1,generateRenderLines()),[\r\n\t\t\"</script>\",\r\n\t\t\"</body>\",\r\n\t\t\"</html>\",\r\n\t]).join(\"\\n\");\r\n};\r\n",null,"var idCounter=0;\r\nfunction generateId() {\r\n\treturn 'webgl-starter-id-'+(idCounter++);\r\n}\r\n\r\nvar Options=require('./options.js');\r\nvar generateCode=require('./code.js');\r\n\r\nfunction getHtmlDataUri(html) {\r\n\t// with base64: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/btoa\r\n\t//return \"data:text/html;charset=utf-8;base64,\"+window.btoa(unescape(encodeURIComponent(str)));\r\n\t// without base64: https://en.wikipedia.org/wiki/Data_URI_scheme\r\n\treturn 'data:text/html;charset=utf-8,'+encodeURIComponent(html);\r\n}\r\n\r\nvar i18n=function(id){ // fake temporary i18n\r\n\treturn {\r\n\t\t'message.hljs': \"<a href='https://highlightjs.org/'>highlight.js</a> (hosted on cdnjs.cloudflare.com) is not loaded. Syntax highlighting is disabled.\",\r\n\r\n\t\t'options.general': 'General options',\r\n\t\t'options.background': 'Background',\r\n\t\t'options.background.none': 'None (transparent)',\r\n\t\t'options.background.solid': 'Solid color',\r\n\t\t'options.shader': 'Shader',\r\n\t\t'options.shader.single': 'Single color',\r\n\t\t'options.shader.vertex': 'One color per vertex',\r\n\t\t'options.shape': 'Shape to draw',\r\n\t\t'options.shape.square': 'Square',\r\n\t\t'options.shape.triangle': 'Triangle',\r\n\t\t'options.shape.gasket': 'Sierpinski gasket', // wp: Sierpinski triangle\r\n\t\t'options.animation': 'Animation',\r\n\t\t'options.animation.none': 'None',\r\n\t\t'options.animation.rotation': 'Rotation around z axis',\r\n\r\n\t\t'options.input': 'Input options',\r\n\t\t'options.background.solid.color.r': 'Background color red component',\r\n\t\t'options.background.solid.color.g': 'Background color green component',\r\n\t\t'options.background.solid.color.b': 'Background color blue component',\r\n\t\t'options.background.solid.color.a': 'Background color alpha component',\r\n\t\t'options.shader.single.color.r': 'Fragment color red component',\r\n\t\t'options.shader.single.color.g': 'Fragment color green component',\r\n\t\t'options.shader.single.color.b': 'Fragment color blue component',\r\n\t\t'options.shader.single.color.a': 'Fragment color alpha component',\r\n\t\t'options.shape.gasket.depth': 'Sierpinski gasket recursion depth',\r\n\t\t'options.animation.rotation.speed': 'Z axis rotation speed',\r\n\t\t'options.*.input': 'Make this input available to users',\r\n\t}[id];\r\n};\r\n\r\n$(function(){\r\n\t$('.webgl-starter').each(function(){\r\n\t\tvar containerNode=$(this);\r\n\t\tvar optionsNode;\r\n\t\tvar codeNode;\r\n\t\tvar options=new Options();\r\n\r\n\t\tfunction showHideSuboptionInputs(optionName,optionValue) {\r\n\t\t\t// TODO sub-sub option support?\r\n\t\t\toptionsNode.find(\"[data-option^='\"+optionName+\".']\").show()\r\n\t\t\t\t.not(\"[data-option^='\"+optionName+\".\"+optionValue+\".']\").hide();\r\n\t\t}\r\n\t\tfunction updateCode() {\r\n\t\t\tcodeNode.text(generateCode(options.cloneWithoutHidden(),i18n));\r\n\t\t\tif (window.hljs) hljs.highlightBlock(codeNode[0]);\r\n\t\t}\r\n\t\tfunction writeGeneralOption(option) {\r\n\t\t\tvar id=generateId();\r\n\t\t\treturn $(\"<div>\")\r\n\t\t\t\t.append(\"<label for='\"+id+\"'>\"+i18n('options.'+option.name)+\":</label>\")\r\n\t\t\t\t.append(\" \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<select id='\"+id+\"'>\").append(\r\n\t\t\t\t\t\toption.availableValues.map(function(availableValue){\r\n\t\t\t\t\t\t\treturn $(\"<option>\").val(availableValue).html(i18n('options.'+option.name+'.'+availableValue))\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t).val(options[option.name]).change(function(){\r\n\t\t\t\t\t\toptions[option.name]=this.value;\r\n\t\t\t\t\t\tshowHideSuboptionInputs(option.name,this.value);\r\n\t\t\t\t\t\tupdateCode();\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t}\r\n\t\tfunction writeInputOption(option) {\r\n\t\t\tvar id=generateId();\r\n\t\t\tvar checkboxId=generateId();\r\n\t\t\treturn $(\"<div data-option='\"+option.name+\"'>\")\r\n\t\t\t\t.append(\"<label for='\"+id+\"'>\"+i18n('options.'+option.name)+\":</label>\")\r\n\t\t\t\t.append(\" <span class='min'>\"+option.getMinLabel()+\"</span> \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<input type='range' id='\"+id+\"'>\")\r\n\t\t\t\t\t\t.attr('min',option.getMin())\r\n\t\t\t\t\t\t.attr('max',option.getMax())\r\n\t\t\t\t\t\t.attr('step',option.getStep())\r\n\t\t\t\t\t\t.val(options[option.name])\r\n\t\t\t\t\t\t.change(function(){\r\n\t\t\t\t\t\t\toptions[option.name]=parseFloat(this.value);\r\n\t\t\t\t\t\t\tupdateCode();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t\t.append(\" <span class='max'>\"+option.getMaxLabel()+\"</span> \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<input type='checkbox' id='\"+checkboxId+\"'>\")\r\n\t\t\t\t\t\t.prop('checked',options[option.name+'.input'])\r\n\t\t\t\t\t\t.change(function(){\r\n\t\t\t\t\t\t\toptions[option.name+'.input']=$(this).prop('checked');\r\n\t\t\t\t\t\t\tupdateCode();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t\t.append(\" \")\r\n\t\t\t\t.append(\"<label for='\"+checkboxId+\"'>\"+i18n('options.*.input')+\"</label>\");\r\n\t\t}\r\n\t\tfunction writeOptions() {\r\n\t\t\treturn $(\"<div>\").append(\r\n\t\t\t\t$(\"<fieldset>\").append(\"<legend>\"+i18n('options.general')+\"</legend>\").append(\r\n\t\t\t\t\toptions.generalOptions.map(writeGeneralOption)\r\n\t\t\t\t)\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<fieldset>\").append(\"<legend>\"+i18n('options.input')+\"</legend>\").append(\r\n\t\t\t\t\toptions.inputOptions.map(writeInputOption)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t\tfunction hideSuboptionInputs() {\r\n\t\t\toptions.generalOptions.forEach(function(option){\r\n\t\t\t\tshowHideSuboptionInputs(option.name,options[option.name]);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tcontainerNode.empty().append(optionsNode=writeOptions());\r\n\t\thideSuboptionInputs();\r\n\t\tcontainerNode.append(\r\n\t\t\t$(\"<pre>\").append(codeNode=$(\"<code>\").text(generateCode(options.cloneWithoutHidden(),i18n)))\r\n\t\t);\r\n\t\tif (window.hljs) {\r\n\t\t\thljs.highlightBlock(codeNode[0]);\r\n\t\t} else {\r\n\t\t\tcontainerNode.append(\"<p>\"+i18n('message.hljs')+\"</p>\");\r\n\t\t}\r\n\t\tcontainerNode.append(\r\n\t\t\t$(\"<div>\").append(\r\n\t\t\t\t$(\"<a download='source.html'><button type='button'>Save source code</button></a>\").click(function(){\r\n\t\t\t\t\t// yes I want a button, but download attr is only available for links\r\n\t\t\t\t\t$(this).attr('href',getHtmlDataUri(codeNode.text()));\r\n\t\t\t\t})\r\n\t\t\t).append(\r\n\t\t\t\t\" \"\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<button type='button'>Run in new window</button>\").click(function(){\r\n\t\t\t\t\twindow.open(getHtmlDataUri(codeNode.text()),\"generatedCode\");\r\n\t\t\t\t})\r\n\t\t\t).append(\r\n\t\t\t\t\" these buttons don't work in Internet Explorer, copy-paste the code manually\"\r\n\t\t\t)\r\n\t\t);\r\n\t});\r\n});\r\n","Option=function(name,availableValues,defaultValue){\r\n\tthis.name=name;\r\n\tthis.availableValues=availableValues; // for range its [min,max,step]\r\n\tif (defaultValue===undefined) {\r\n\t\tthis.defaultValue=availableValues[0];\r\n\t} else {\r\n\t\tthis.defaultValue=defaultValue;\r\n\t}\r\n};\r\nOption.prototype.doesValueHideOption=function(value,option){\r\n\tfunction optionStartsWith(prefix) {\r\n\t\treturn option.name.indexOf(prefix)===0;\r\n\t}\r\n\treturn optionStartsWith(this.name+'.') && !optionStartsWith(this.name+'.'+value+'.');\r\n};\r\nOption.prototype.getMin=function(){\r\n\treturn this.availableValues[0];\r\n}\r\nOption.prototype.getMax=function(){\r\n\treturn this.availableValues[1];\r\n}\r\nOption.prototype.getStep=function(){\r\n\tif (this.availableValues.length>=3) {\r\n\t\treturn this.availableValues[2];\r\n\t} else {\r\n\t\treturn 'any';\r\n\t}\r\n}\r\nOption.prototype.getMinLabel=function(){\r\n\treturn this.getMin().toString().replace('-','−');\r\n};\r\nOption.prototype.getMaxLabel=function(){\r\n\treturn this.getMax().toString().replace('-','−');\r\n};\r\n\r\nvar Options=function(){\r\n\tthis.reset();\r\n};\r\nOptions.prototype.generalOptions=[\r\n\tnew Option('background',['none','solid']),\r\n\tnew Option('shader',['single','vertex']),\r\n\tnew Option('shape',['square','triangle','gasket']),\r\n\tnew Option('animation',['none','rotation']),\r\n];\r\nOptions.prototype.inputOptions=[\r\n\tnew Option('background.solid.color.r',[0,1],1),\r\n\tnew Option('background.solid.color.g',[0,1],1),\r\n\tnew Option('background.solid.color.b',[0,1],1),\r\n\tnew Option('background.solid.color.a',[0,1],1),\r\n\tnew Option('shader.single.color.r',[0,1],1),\r\n\tnew Option('shader.single.color.g',[0,1]),\r\n\tnew Option('shader.single.color.b',[0,1]),\r\n\tnew Option('shader.single.color.a',[0,1],1),\r\n\tnew Option('shape.gasket.depth',[0,10,1],6),\r\n\tnew Option('animation.rotation.speed',[-1,1],0.2),\r\n];\r\nOptions.prototype.reset=function(){\r\n\tthis.generalOptions.forEach(function(option){\r\n\t\tthis[option.name]=option.defaultValue;\r\n\t},this);\r\n\tthis.inputOptions.forEach(function(option){\r\n\t\tthis[option.name]=option.defaultValue;\r\n\t\tthis[option.name+'.input']=false;\r\n\t},this);\r\n};\r\nOptions.prototype.hasInputs=function(){\r\n\treturn this.inputOptions.some(function(option){\r\n\t\treturn this[option.name+'.input'];\r\n\t},this);\r\n};\r\nOptions.prototype.hasInputsFor=function(prefix){\r\n\treturn this.inputOptions.filter(function(option){\r\n\t\treturn option.name.indexOf(prefix+'.')===0;\r\n\t},this).some(function(option){\r\n\t\treturn this[option.name+'.input'];\r\n\t},this);\r\n};\r\nOptions.prototype.hasAllInputsFor=function(prefix){\r\n\treturn this.inputOptions.filter(function(option){\r\n\t\treturn option.name.indexOf(prefix+'.')===0;\r\n\t},this).every(function(option){\r\n\t\treturn this[option.name+'.input'];\r\n\t},this);\r\n};\r\nOptions.prototype.getOnlyInputFor=function(prefix){\r\n\tvar matchedOptions=this.inputOptions.filter(function(option){\r\n\t\treturn option.name.indexOf(prefix+'.')===0 && this[option.name+'.input'];\r\n\t},this);\r\n\tif (matchedOptions.length==1) {\r\n\t\treturn matchedOptions[0];\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n};\r\nOptions.prototype.cloneWithoutHidden=function(){\r\n\t// clone and set .input=false for hidden sections\r\n\tvar newOptions=new Options();\r\n\tthis.generalOptions.forEach(function(option){\r\n\t\tnewOptions[option.name]=this[option.name];\r\n\t},this);\r\n\tthis.inputOptions.forEach(function(option){\r\n\t\tnewOptions[option.name]=this[option.name];\r\n\t\tif (\r\n\t\t\tthis.generalOptions.some(function(generalOption){\r\n\t\t\t\treturn generalOption.doesValueHideOption(this[generalOption.name],option);\r\n\t\t\t},this)\r\n\t\t) {\r\n\t\t\tnewOptions[option.name+'.input']=false;\r\n\t\t} else {\r\n\t\t\tnewOptions[option.name+'.input']=this[option.name+'.input'];\r\n\t\t}\r\n\t},this);\r\n\treturn newOptions;\r\n};\r\n\r\nmodule.exports=Options;\r\n"],"sourceRoot":"."}