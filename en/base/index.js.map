{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/code.js","index.js","src/listeners.js","src/main.js","src/options.js","src/shapes.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","listeners","shapes","options","i18n","intOptionValue","name","parseInt","floatOptionValue","toFixed","colorValue","prefix","glslColorValue","g","b","isMousemoveInput","indexOf","indentLines","level","lines","map","line","Array","join","appendLinesToLastLine","addedLines","lastLine","pop","indent","exec","forEach","push","makeShape","className","shape","charAt","toUpperCase","slice","shapeParams","getInputOptionsFor","option","value","changes","min","getMin","max","getMax","shapeCtorArgs","shader","concat","Function","prototype","bind","apply","generateVertexShaderLines","use2dTransform","dim","needsTransform","needAspectUniform","hasInputsFor","needAspectConstant","needTransformedPosition","projection","d","D","optName","varName","needsUniform","transformOrder","transformName","rotate.x","rotate.y","rotate.z","generateFragmentShaderLines","twoSided","generateControlMessageLines","writeOptionGroup","group","filter","inputOptions","transformOptions","generateInputLines","getMinLabel","getStep","getMaxLabel","generateMakeProgramLines","debugShader","generateInputHandlerLines","writeListener","listener","write","isAnimated","debugInputs","canvasUpdater","canvasListener","wh","SliderListener","enter","log","post","colorStates","optionPrefix","updateFnName","stateVarPrefix","c","colorUpdater","allInputsPre","allInputsPost","someInputsPre","someInputsPost","hasAllSliderInputsFor","colorSingleListener","onlyInput","getOnlyInputFor","MultipleSliderListener","colorMultipleListeners","canvasMousemoveListener","prexy","colorListeners","needOnlyOneListener","every","inputType","colorStatesAndUpdaterAndListeners","CanvasMousemoveListener","getInputsFor","varNameWithPrefixReplace","newOptionPrefix","undefined","replace","match","entry","storeFn","usesElements","newVarName","minVarName","maxVarName","cond","updateName","state","generateRenderLines","renderInner","renderInnerTransforms","needStartTime","needPrevTime","needWrap","innerTransformsLines","background","writeDraw","innerLines","hasInputs","hasSliderInputs","writeInit","./listeners.js","./shapes.js",2,"Listener","this","entries","makePushArgs","where","arguments","proxy","pre","innerPrependedLines","bracketFnArg","wrapCall","haveToUpdateCanvas","haveToLogInput","addInnerLine","vertex","innerLinesGraph","prevs","conds","mark","WHITE","innerLinesPrev","closeEntryInnerLines","innerLinesRoot","writeInnerLines","writeLine","newCond","currentCond","recVertex","GRAY","recPrevs","BLACK","outerLines","br","bracketListener","id","Object","create","constructor","query","xLine","yLine",3,"generateId","idCounter","getHtmlDataUri","html","encodeURIComponent","Options","generateCode","message.hljs","options.general","options.background","options.background.none","options.background.solid","options.shader","options.shader.single","options.shader.vertex","options.shader.face","options.shader.light","options.shape","options.shape.square","options.shape.triangle","options.shape.gasket","options.shape.cube","options.shape.hat","options.projection","options.projection.ortho","options.projection.perspective","options.input","options.canvas.width","options.canvas.height","options.background.solid.color.r","options.background.solid.color.g","options.background.solid.color.b","options.background.solid.color.a","options.shader.single.color.r","options.shader.single.color.g","options.shader.single.color.b","options.shader.single.color.a","options.shape.gasket.depth","options.shape.hat.resolution","options.*.input","options.*.input.constant","options.*.input.slider","options.*.input.mousemovex","options.*.input.mousemovey","options.*.input.animated","options.transform","options.rotate.x","options.rotate.x.speed","options.rotate.y","options.rotate.y.speed","options.rotate.z","options.rotate.z.speed","options.debug","options.debugShader","options.debugInputs","controls.type.mousemovex","controls.type.mousemovey","controls.to","$","each","showHideSuboptionInputs","optionName","optionValue","$options","find","show","not","hide","updateCode","clearTimeout","codeUpdateTimeoutId","setTimeout","$code","text","fix","window","hljs","highlightBlock","codeUpdateDelay","writeGeneralOption","append","availableValues","availableValue","val","change","writeInputOption","inputListener","that","checkValidity","parseFloat","sliderInput","numberInput","inputId","attr","getSetupStep","on","click","defaultValue","availableInputTypes","availableInputType","writeDebugOption","prop","makeSortable","$sortableRoot","callback","$dragged","children","prepend","ev","parent","originalEvent","dataTransfer","effectAllowed","setData","setDragImage","addClass","keydown","$handle","$sorted","keyCode","prev","before","focus","next","after","preventDefault","dropEffect","$target","nextAll","is","prevAll","removeClass","writeOptions","$transforms","generalOptions","transforms","transform","debugOptions","get","hideSuboptionInputs","writeButtons","open","$container","empty","./code.js","./options.js",4,"Option","doesValueHideOption","optionStartsWith","InputOption","rangeOfValues","toString","FloatInputOption","IntInputOption","CanvasIntInputOption","DebugOption","OptionsBlueprint","reset","valueOption","speedOption","OptionsInstance","blueprint","groupName","isHidden","some","generalOption","matchedOptions","endsWith","suffix",5,"Shape","shaderType","glPrimitive","getNumbersPerPosition","getNumbersPerNormal","getNumbersPerColor","getNumbersPerVertex","cv","writeArrays","Square","Triangle","Gasket","depth","Cube","Hat","resolution","innerLine"],"mappings":"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","file":"index.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var listeners=require('./listeners.js');\r\nvar shapes=require('./shapes.js');\r\n\r\nmodule.exports=function(options,i18n){\r\n\tfunction intOptionValue(name) {\r\n\t\treturn parseInt(options[name]);\r\n\t}\r\n\tfunction floatOptionValue(name) {\r\n\t\treturn options[name].toFixed(3);\r\n\t}\r\n\tfunction colorValue(prefix) {\r\n\t\treturn floatOptionValue(prefix+'.r')+\",\"+\r\n\t\t       floatOptionValue(prefix+'.g')+\",\"+\r\n\t\t       floatOptionValue(prefix+'.b')+\",\"+\r\n\t\t       floatOptionValue(prefix+'.a');\r\n\t}\r\n\tfunction glslColorValue(prefix) {\r\n\t\tvar r=floatOptionValue(prefix+'.r');\r\n\t\tvar g=floatOptionValue(prefix+'.g');\r\n\t\tvar b=floatOptionValue(prefix+'.b');\r\n\t\tvar a=floatOptionValue(prefix+'.a');\r\n\t\tif (r==a && g==a && b==a) {\r\n\t\t\treturn a; // see OpenGL ES SL section 5.4.2\r\n\t\t} else {\r\n\t\t\treturn r+\",\"+g+\",\"+b+\",\"+a;\r\n\t\t}\r\n\t}\r\n\tfunction isMousemoveInput(name) {\r\n\t\treturn ['mousemovex','mousemovey'].indexOf(options[name+'.input'])>=0;\r\n\t}\r\n\tfunction indentLines(level,lines) {\r\n\t\treturn lines.map(function(line){\r\n\t\t\treturn Array(level+1).join(\"\t\")+line;\r\n\t\t});\r\n\t}\r\n\tfunction appendLinesToLastLine(lines,addedLines) {\r\n\t\tvar lastLine=lines.pop();\r\n\t\tvar indent=/^\\s*/.exec(lastLine)[0];\r\n\t\taddedLines.forEach(function(line,i){\r\n\t\t\tif (i==0) {\r\n\t\t\t\tlines.push(lastLine+line);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(indent+line);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction makeShape() {\r\n\t\tvar className=options.shape.charAt(0).toUpperCase()+options.shape.slice(1);\r\n\t\tvar shapeParams=options.getInputOptionsFor('shape').map(function(option){\r\n\t\t\tif (options[option.name+'.input']=='constant') {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: intOptionValue(option.name),\r\n\t\t\t\t\tchanges: false\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: intOptionValue(option.name),\r\n\t\t\t\t\tchanges: true,\r\n\t\t\t\t\tmin: option.getMin(),\r\n\t\t\t\t\tmax: option.getMax()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar shapeCtorArgs=[null,options.shader].concat(shapeParams);\r\n\t\treturn new (Function.prototype.bind.apply(shapes[className],shapeCtorArgs));\r\n\t}\r\n\tvar shape=makeShape();\r\n\r\n\tfunction generateVertexShaderLines() {\r\n\t\tvar use2dTransform=(\r\n\t\t\tshape.dim==2 &&\r\n\t\t\t!options.needsTransform('rotate.x') &&\r\n\t\t\t!options.needsTransform('rotate.y') &&\r\n\t\t\t options.needsTransform('rotate.z')\r\n\t\t);\r\n\t\tvar needAspectUniform=options.hasInputsFor('canvas');\r\n\t\tvar needAspectConstant=!needAspectUniform && options['canvas.width']!=options['canvas.height'];\r\n\t\tvar needTransformedPosition=options.shader=='light' && options.projection=='perspective';\r\n\t\tvar lines=[];\r\n\t\tif (needAspectUniform) {\r\n\t\t\tlines.push(\"uniform float aspect;\");\r\n\t\t}\r\n\t\t['x','y','z'].forEach(function(d){\r\n\t\t\tvar D=d.toUpperCase();\r\n\t\t\tvar optName='rotate.'+d;\r\n\t\t\tvar varName='rotate'+D;\r\n\t\t\tif (options.needsUniform(optName)) {\r\n\t\t\t\tlines.push(\"uniform float \"+varName+\";\");\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (use2dTransform) {\r\n\t\t\tlines.push(\"attribute vec2 position;\");\r\n\t\t} else {\r\n\t\t\tlines.push(\"attribute vec4 position;\");\r\n\t\t}\r\n\t\tif (options.shader=='light') {\r\n\t\t\tif (options.projection=='perspective') {\r\n\t\t\t\tlines.push(\"varying vec3 interpolatedView;\");\r\n\t\t\t}\r\n\t\t\tif (shape.dim>2) {\r\n\t\t\t\tlines.push(\"attribute vec3 normal;\");\r\n\t\t\t}\r\n\t\t\tlines.push(\"varying vec3 interpolatedNormal;\");\r\n\t\t}\r\n\t\tif (options.shader=='vertex' || options.shader=='face') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"attribute vec4 color;\",\r\n\t\t\t\t\"varying vec4 interpolatedColor;\" // TODO don't interpolate for shader=='face'\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.push(\r\n\t\t\t\"void main() {\"\r\n\t\t);\r\n\t\t['x','y','z'].forEach(function(d){\r\n\t\t\tvar D=d.toUpperCase();\r\n\t\t\tvar optName='rotate.'+d;\r\n\t\t\tvar varName='rotate'+D;\r\n\t\t\tif (options.needsTransform(optName)) {\r\n\t\t\t\tif (options.needsUniform('rotate.'+d)) {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"\tfloat c\"+d+\"=cos(radians(\"+varName+\"));\",\r\n\t\t\t\t\t\t\"\tfloat s\"+d+\"=sin(radians(\"+varName+\"));\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"\tfloat c\"+d+\"=cos(radians(\"+floatOptionValue(optName)+\"));\",\r\n\t\t\t\t\t\t\"\tfloat s\"+d+\"=sin(radians(\"+floatOptionValue(optName)+\"));\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (needAspectConstant) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tfloat aspect=\"+intOptionValue('canvas.width')+\".0/\"+intOptionValue('canvas.height')+\".0;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (options.projection=='perspective') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tfloat fovy=45.0;\",\r\n\t\t\t\t\"\tfloat near=1.0/tan(radians(fovy)/2.0);\",\r\n\t\t\t\t\"\tfloat far=near+2.0;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (needTransformedPosition) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tvec4 transformedPosition=\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tgl_Position=\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (use2dTransform) {\r\n\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\"vec4(position*mat2(\",\r\n\t\t\t\t\"\tcz, -sz,\",\r\n\t\t\t\t\"\tsz,  cz\",\r\n\t\t\t\t\"),0,1)\"\r\n\t\t\t]);\r\n\t\t} else {\r\n\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\"position\"\r\n\t\t\t]);\r\n\t\t\toptions.transformOrder.forEach(function(transformName){\r\n\t\t\t\tif (!options.needsTransform(transformName)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tappendLinesToLastLine(lines,{\r\n\t\t\t\t\t'rotate.x': [\r\n\t\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\t\"\t1.0, 0.0, 0.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0,  cx, -sx, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0,  sx,  cx, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0, 0.0, 0.0, 1.0\",\r\n\t\t\t\t\t\t\")\"\r\n\t\t\t\t\t],\r\n\t\t\t\t\t'rotate.y': [\r\n\t\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\t\"\t cy, 0.0,  sy, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0, 1.0, 0.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t-sy, 0.0,  cy, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0, 0.0, 0.0, 1.0\",\r\n\t\t\t\t\t\t\")\"\r\n\t\t\t\t\t],\r\n\t\t\t\t\t'rotate.z': [\r\n\t\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\t\"\t cz, -sz, 0.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t sz,  cz, 0.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0, 0.0, 1.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0, 0.0, 0.0, 1.0\",\r\n\t\t\t\t\t\t\")\"\r\n\t\t\t\t\t]\r\n\t\t\t\t}[transformName]);\r\n\t\t\t});\r\n\t\t\tif (options.projection=='perspective') {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\"*mat4( // move center of coords inside view\",\r\n\t\t\t\t\t\"\t1.0, 0.0, 0.0, 0.0,\",\r\n\t\t\t\t\t\"\t0.0, 1.0, 0.0, 0.0,\",\r\n\t\t\t\t\t\"\t0.0, 0.0, 1.0, -(near+far)/2.0,\",\r\n\t\t\t\t\t\"\t0.0, 0.0, 0.0, 1.0\",\r\n\t\t\t\t\t\")\"\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (needTransformedPosition) {\r\n\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\";\"\r\n\t\t\t]);\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tgl_Position=transformedPosition\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (options.projection=='ortho') {\r\n\t\t\tif (needAspectUniform || needAspectConstant) {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\"*vec4(1.0/aspect,1.0,-1.0,1.0)\" // correct aspect ratio and make coords right-handed\r\n\t\t\t\t]);\r\n\t\t\t} else if (shape.dim>2) {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\"*vec4(1.0,1.0,-1.0,1.0)\" // make coords right-handed for 3d shapes\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t} else if (options.projection=='perspective') {\r\n\t\t\tif (needAspectUniform || needAspectConstant) {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\"\tnear/aspect, 0.0,  0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,         near, 0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,         0.0,  (near+far)/(near-far), 2.0*near*far/(near-far),\",\r\n\t\t\t\t\t\"\t0.0,         0.0,  -1.0,                  0.0\",\r\n\t\t\t\t\t\")\"\r\n\t\t\t\t]);\r\n\t\t\t} else {\r\n\t\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\"\tnear, 0.0,  0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,  near, 0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,  0.0,  (near+far)/(near-far), 2.0*near*far/(near-far),\",\r\n\t\t\t\t\t\"\t0.0,  0.0,  -1.0,                  0.0\",\r\n\t\t\t\t\t\")\"\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\";\"\r\n\t\t]);\r\n\t\tif (options.shader=='light') {\r\n\t\t\tif (options.projection=='perspective') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tinterpolatedView=-vec3(transformedPosition);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (shape.dim>2) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tinterpolatedNormal=normal\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tinterpolatedNormal=vec3(0.0,0.0,1.0)\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\toptions.transformOrder.forEach(function(transformName){\r\n\t\t\t\tif (!options.needsTransform(transformName)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tappendLinesToLastLine(lines,{\r\n\t\t\t\t\t'rotate.x': [\r\n\t\t\t\t\t\t\"*mat3(\",\r\n\t\t\t\t\t\t\"\t1.0, 0.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0,  cx, -sx,\",\r\n\t\t\t\t\t\t\"\t0.0,  sx,  cx\",\r\n\t\t\t\t\t\t\")\"\r\n\t\t\t\t\t],\r\n\t\t\t\t\t'rotate.y': [\r\n\t\t\t\t\t\t\"*mat3(\",\r\n\t\t\t\t\t\t\"\t cy, 0.0,  sy,\",\r\n\t\t\t\t\t\t\"\t0.0, 1.0, 0.0,\",\r\n\t\t\t\t\t\t\"\t-sy, 0.0,  cy\",\r\n\t\t\t\t\t\t\")\"\r\n\t\t\t\t\t],\r\n\t\t\t\t\t'rotate.z': [\r\n\t\t\t\t\t\t\"*mat3(\",\r\n\t\t\t\t\t\t\"\t cz, -sz, 0.0,\",\r\n\t\t\t\t\t\t\"\t sz,  cz, 0.0,\",\r\n\t\t\t\t\t\t\"\t0.0, 0.0, 1.0\",\r\n\t\t\t\t\t\t\")\"\r\n\t\t\t\t\t]\r\n\t\t\t\t}[transformName]);\r\n\t\t\t});\r\n\t\t\tappendLinesToLastLine(lines,[\r\n\t\t\t\t\";\"\r\n\t\t\t]);\r\n\t\t}\r\n\t\tif (options.shader=='vertex' || options.shader=='face') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tinterpolatedColor=color;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.push(\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateFragmentShaderLines() {\r\n\t\tif (options.shader=='single') {\r\n\t\t\tif (options.hasInputsFor('shader.single.color')) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t\"uniform vec4 color;\",\r\n\t\t\t\t\t\"void main() {\",\r\n\t\t\t\t\t\"\tgl_FragColor=color;\",\r\n\t\t\t\t\t\"}\",\r\n\t\t\t\t];\r\n\t\t\t} else {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t\"void main() {\",\r\n\t\t\t\t\t\"\tgl_FragColor=vec4(\"+glslColorValue('shader.single.color')+\");\",\r\n\t\t\t\t\t\"}\",\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t} else if (options.shader=='vertex' || options.shader=='face') {\r\n\t\t\treturn [\r\n\t\t\t\t\"varying vec4 interpolatedColor;\",\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"\tgl_FragColor=interpolatedColor;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t];\r\n\t\t} else if (options.shader=='light') {\r\n\t\t\tvar lines=[];\r\n\t\t\tif (options.projection=='perspective') {\r\n\t\t\t\tlines.push(\"varying vec3 interpolatedView;\");\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"varying vec3 interpolatedNormal;\",\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"\tvec3 ambientColor=vec3(0.2,0.2,0.2);\",\r\n\t\t\t\t\"\tvec3 diffuseColor=vec3(0.4,0.4,0.4);\",\r\n\t\t\t\t\"\tvec3 specularColor=vec3(0.4,0.4,0.4);\",\r\n\t\t\t\t\"\tfloat shininess=100.0;\"\r\n\t\t\t);\r\n\t\t\tif (options.projection=='ortho') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tvec3 V=vec3( 0.0, 0.0,+1.0);\"\r\n\t\t\t\t);\r\n\t\t\t} else if (options.projection=='perspective') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tvec3 V=normalize(interpolatedView);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tvec3 N=normalize(interpolatedNormal);\"\r\n\t\t\t);\r\n\t\t\tif (shape.twoSided) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tif (!gl_FrontFacing) N=-N;\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tvec3 L=normalize(vec3(-1.0,+1.0,+1.0));\",\r\n\t\t\t\t\"\tvec3 H=normalize(L+V);\",\r\n\t\t\t\t\"\tgl_FragColor=vec4(\",\r\n\t\t\t\t\"\t\tambientColor\",\r\n\t\t\t\t\"\t\t+diffuseColor*max(0.0,dot(L,N))\",\r\n\t\t\t\t\"\t\t+specularColor*pow(max(0.0,dot(H,N)),shininess)\",\r\n\t\t\t\t\"\t,1.0);\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t\treturn lines;\r\n\t\t}\r\n\t}\r\n\tfunction generateControlMessageLines() {\r\n\t\tvar lines=[];\r\n\t\tfunction writeOptionGroup(group) {\r\n\t\t\tgroup.filter(function(option){\r\n\t\t\t\treturn isMousemoveInput(option.name);\r\n\t\t\t}).forEach(function(option){\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t<li>\"+i18n('controls.type.'+options[option.name+'.input'])+\" \"+i18n('controls.to')+\" <strong>\"+i18n('options.'+option.name)+\"</strong></li>\"\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\t\twriteOptionGroup(options.inputOptions);\r\n\t\twriteOptionGroup(options.transformOptions);\r\n\t\tif (lines.length) {\r\n\t\t\treturn [\"<ul>\"].concat(lines,[\"</ul>\"]);\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\tfunction generateInputLines() {\r\n\t\tvar lines=[];\r\n\t\tfunction writeOptionGroup(group) {\r\n\t\t\tgroup.filter(function(option){\r\n\t\t\t\treturn options[option.name+'.input']=='slider';\r\n\t\t\t}).forEach(function(option){\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"<div>\",\r\n\t\t\t\t\t\"\t<label for='\"+option.name+\"'>\"+i18n('options.'+option.name)+\":</label>\",\r\n\t\t\t\t\t\"\t<span class='min'>\"+option.getMinLabel()+\"</span> \"+\r\n\t\t\t\t\t\t(option.getStep()==1\r\n\t\t\t\t\t\t\t? \"<input type='range' id='\"+option.name+\"' min='\"+option.getMin()+\"' max='\"+option.getMax()+\"' value='\"+intOptionValue(option.name)+\"' />\"\r\n\t\t\t\t\t\t\t: \"<input type='range' id='\"+option.name+\"' min='\"+option.getMin()+\"' max='\"+option.getMax()+\"' step='\"+option.getStep()+\"' value='\"+floatOptionValue(option.name)+\"' />\"\r\n\t\t\t\t\t\t)+\r\n\t\t\t\t\t\t\" <span class='max'>\"+option.getMaxLabel()+\"</span>\",\r\n\t\t\t\t\t\"</div>\"\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\t\twriteOptionGroup(options.inputOptions);\r\n\t\twriteOptionGroup(options.transformOptions);\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateMakeProgramLines() {\r\n\t\tlines=[\r\n\t\t\t\"function makeProgram(vertexShaderSrc,fragmentShaderSrc) {\",\r\n\t\t\t\"\tvar vertexShader=gl.createShader(gl.VERTEX_SHADER);\",\r\n\t\t\t\"\tgl.shaderSource(vertexShader,vertexShaderSrc);\",\r\n\t\t\t\"\tgl.compileShader(vertexShader);\",\r\n\t\t];\r\n\t\tif (options.debugShader) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tif (!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(vertexShader));\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.push(\r\n\t\t\t\"\tvar fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);\",\r\n\t\t\t\"\tgl.shaderSource(fragmentShader,fragmentShaderSrc);\",\r\n\t\t\t\"\tgl.compileShader(fragmentShader);\"\r\n\t\t);\r\n\t\tif (options.debugShader) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tif (!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(fragmentShader));\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.push(\r\n\t\t\t\"\tvar program=gl.createProgram();\",\r\n\t\t\t\"\tgl.attachShader(program,vertexShader);\",\r\n\t\t\t\"\tgl.attachShader(program,fragmentShader);\",\r\n\t\t\t\"\tgl.linkProgram(program);\",\r\n\t\t\t\"\treturn program;\",\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateInputHandlerLines() {\r\n\t\tvar lines=[];\r\n\t\tfunction writeListener(listener) {\r\n\t\t\tlines=lines.concat(\r\n\t\t\t\tlistener.write(!options.isAnimated(),options.debugInputs)\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar canvasMousemoveListener=new listeners.CanvasMousemoveListener();\r\n\t\tfunction canvasUpdater() {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"function updateAspect() {\",\r\n\t\t\t\t\"\tgl.viewport(0,0,canvas.width,canvas.height);\",\r\n\t\t\t\t\"\tgl.uniform1f(aspectLoc,canvas.width/canvas.height);\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"updateAspect();\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tfunction canvasListener(wh) {\r\n\t\t\tvar optName='canvas.'+wh;\r\n\t\t\tif (options[optName+'.input']=='slider') {\r\n\t\t\t\tvar listener=new listeners.SliderListener(optName);\r\n\t\t\t\tlistener.enter()\r\n\t\t\t\t\t.log(\"console.log(this.id,'input value:',parseInt(this.value));\")\r\n\t\t\t\t\t.post(\"canvas.\"+wh+\"=parseInt(this.value);\")\r\n\t\t\t\t\t.post(\"updateAspect();\");\r\n\t\t\t\twriteListener(listener);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction colorStates(optionPrefix,updateFnName,stateVarPrefix) {\r\n\t\t\t['r','g','b','a'].forEach(function(c){\r\n\t\t\t\tvar name=optionPrefix+'.'+c;\r\n\t\t\t\tif (isMousemoveInput(name)) {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"var \"+stateVarPrefix+c.toUpperCase()+'='+floatOptionValue(name)+';'\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction colorUpdater(optionPrefix,updateFnName,stateVarPrefix,allInputsPre,allInputsPost,someInputsPre,someInputsPost) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"function \"+updateFnName+\"() {\"\r\n\t\t\t);\r\n\t\t\tif (options.hasAllSliderInputsFor(optionPrefix)) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t\"+allInputsPre+\"['r','g','b','a'].map(function(c){\",\r\n\t\t\t\t\t\"\t\treturn parseFloat(document.getElementById('\"+optionPrefix+\".'+c).value);\",\r\n\t\t\t\t\t\"\t})\"+allInputsPost\r\n\t\t\t\t);\r\n\t\t\t// TODO hasAllStateInputsFor(optionPrefix)\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\t\"+someInputsPre+['r','g','b','a'].map(function(c){\r\n\t\t\t\t\t\tvar name=optionPrefix+'.'+c;\r\n\t\t\t\t\t\tif (options[name+'.input']=='slider') {\r\n\t\t\t\t\t\t\treturn \"parseFloat(document.getElementById('\"+name+\"').value)\";\r\n\t\t\t\t\t\t} else if (isMousemoveInput(name)) {\r\n\t\t\t\t\t\t\treturn stateVarPrefix+c.toUpperCase();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn floatOptionValue(name);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).join()+someInputsPost\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"}\",\r\n\t\t\t\tupdateFnName+\"();\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tfunction colorSingleListener(optionPrefix,updateFnName,stateVarPrefix) {\r\n\t\t\tvar onlyInput=options.getOnlyInputFor(optionPrefix);\r\n\t\t\tvar listener;\r\n\t\t\tif (onlyInput===null) {\r\n\t\t\t\tlistener=new listeners.MultipleSliderListener(\"[id^=\\\"\"+optionPrefix+\".\\\"]\");\r\n\t\t\t} else {\r\n\t\t\t\tlistener=new listeners.SliderListener(onlyInput.name);\r\n\t\t\t}\r\n\t\t\tlistener.enter()\r\n\t\t\t\t.log(\"console.log(this.id,'input value:',parseFloat(this.value));\")\r\n\t\t\t\t.post(updateFnName+\"();\");\r\n\t\t\twriteListener(listener);\r\n\t\t}\r\n\t\tfunction colorMultipleListeners(optionPrefix,updateFnName,stateVarPrefix) {\r\n\t\t\t['r','g','b','a'].forEach(function(c){\r\n\t\t\t\tvar name=optionPrefix+'.'+c;\r\n\t\t\t\tvar varName=stateVarPrefix+c.toUpperCase();\r\n\t\t\t\tif (options[name+'.input']=='slider') {\r\n\t\t\t\t\tvar listener=new listeners.SliderListener(name);\r\n\t\t\t\t\tlistener.enter()\r\n\t\t\t\t\t\t.log(\"console.log(this.id,'input value:',parseFloat(this.value));\")\r\n\t\t\t\t\t\t.post(updateFnName+\"();\");\r\n\t\t\t\t\twriteListener(listener);\r\n\t\t\t\t} else if (isMousemoveInput(name)) {\r\n\t\t\t\t\tcanvasMousemoveListener.enter()\r\n\t\t\t\t\t\t.prexy(\r\n\t\t\t\t\t\t\toptions[name+'.input'],\r\n\t\t\t\t\t\t\tvarName+\"=(ev.clientX-rect.left)/(rect.width-1);\",\r\n\t\t\t\t\t\t\tvarName+\"=(rect.bottom-1-ev.clientY)/(rect.height-1);\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.log(\"console.log('\"+name+\" input value:',\"+varName+\");\")\r\n\t\t\t\t\t\t.post(updateFnName+\"();\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction colorListeners(optionPrefix,updateFnName,stateVarPrefix) {\r\n\t\t\tvar needOnlyOneListener=['r','g','b','a'].every(function(c){\r\n\t\t\t\tvar inputType=options[optionPrefix+'.'+c+'.input'];\r\n\t\t\t\treturn inputType=='constant' || inputType=='slider';\r\n\t\t\t});\r\n\t\t\tif (needOnlyOneListener) {\r\n\t\t\t\tcolorSingleListener(optionPrefix,updateFnName,stateVarPrefix);\r\n\t\t\t} else {\r\n\t\t\t\tcolorMultipleListeners(optionPrefix,updateFnName,stateVarPrefix);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction colorStatesAndUpdaterAndListeners(\r\n\t\t\toptionPrefix,updateFnName,stateVarPrefix,\r\n\t\t\tallInputsPre,allInputsPost,\r\n\t\t\tsomeInputsPre,someInputsPost\r\n\t\t) {\r\n\t\t\tcolorStates(optionPrefix,updateFnName,stateVarPrefix);\r\n\t\t\tcolorUpdater(optionPrefix,updateFnName,stateVarPrefix,allInputsPre,allInputsPost,someInputsPre,someInputsPost);\r\n\t\t\tcolorListeners(optionPrefix,updateFnName,stateVarPrefix);\r\n\t\t}\r\n\t\tif (options.hasInputsFor('canvas')) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var aspectLoc=gl.getUniformLocation(program,'aspect');\"\r\n\t\t\t);\r\n\t\t\tcanvasUpdater();\r\n\t\t\tcanvasListener('width');\r\n\t\t\tcanvasListener('height');\r\n\t\t}\r\n\t\tif (options.hasInputsFor('background.solid.color')) {\r\n\t\t\tcolorStatesAndUpdaterAndListeners(\r\n\t\t\t\t'background.solid.color','updateClearColor','clearColor',\r\n\t\t\t\t'gl.clearColor.apply(gl,',');',\r\n\t\t\t\t'gl.clearColor(',');'\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (options.hasInputsFor('shader.single.color')) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var colorLoc=gl.getUniformLocation(program,'color');\"\r\n\t\t\t);\r\n\t\t\tcolorStatesAndUpdaterAndListeners(\r\n\t\t\t\t'shader.single.color','updateColor','color',\r\n\t\t\t\t'gl.uniform4fv(colorLoc,',');',\r\n\t\t\t\t'gl.uniform4fv(colorLoc,[',']);'\r\n\t\t\t);\r\n\t\t}\r\n\t\toptions.getInputsFor('shape').forEach(function(option){\r\n\t\t\tfunction varNameWithPrefixReplace(optionPrefix,newOptionPrefix) {\r\n\t\t\t\tvar s;\r\n\t\t\t\tif (option.name.indexOf(optionPrefix+'.')===0) {\r\n\t\t\t\t\tif (newOptionPrefix!==undefined) {\r\n\t\t\t\t\t\ts=option.name.replace(optionPrefix,newOptionPrefix);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ts=option.name.replace(optionPrefix+'.','');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// TODO throw\r\n\t\t\t\t\ts=option.name;\r\n\t\t\t\t}\r\n\t\t\t\treturn s.replace(/\\.[a-z]/g,function(match){\r\n\t\t\t\t\treturn match.charAt(1).toUpperCase();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvar entry;\r\n\t\t\tif (options[option.name+'.input']=='slider') {\r\n\t\t\t\tvar listener=new listeners.SliderListener(option.name);\r\n\t\t\t\tentry=listener.enter()\r\n\t\t\t\t\t.log(\"console.log(this.id,'input value:',parseInt(this.value));\")\r\n\t\t\t\t\t.post(shape.storeFn+\"(parseInt(this.value));\")\r\n\t\t\t\t\t.post(\"gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);\");\r\n\t\t\t\tif (shape.usesElements()) {\r\n\t\t\t\t\tentry.post(\"gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);\");\r\n\t\t\t\t}\r\n\t\t\t\twriteListener(listener);\r\n\t\t\t} else if (isMousemoveInput(option.name)) {\r\n\t\t\t\tvar varName=varNameWithPrefixReplace('shape');\r\n\t\t\t\tvar newVarName=varNameWithPrefixReplace('shape','new');\r\n\t\t\t\tvar minVarName=varNameWithPrefixReplace('shape','min');\r\n\t\t\t\tvar maxVarName=varNameWithPrefixReplace('shape','max');\r\n\t\t\t\tentry=canvasMousemoveListener.enter()\r\n\t\t\t\t\t.prexy(\r\n\t\t\t\t\t\toptions[option.name+'.input'],\r\n\t\t\t\t\t\t\"var \"+newVarName+\"=Math.floor(\"+minVarName+\"+(\"+maxVarName+\"-\"+minVarName+\"+1)*(ev.clientX-rect.left)/rect.width);\",\r\n\t\t\t\t\t\t\"var \"+newVarName+\"=Math.floor(\"+minVarName+\"+(\"+maxVarName+\"-\"+minVarName+\"+1)*(rect.bottom-1-ev.clientY)/rect.height);\"\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.cond(newVarName+\"!=\"+varName)\r\n\t\t\t\t\t.log(\"console.log('\"+option.name+\" input value:',\"+newVarName+\");\")\r\n\t\t\t\t\t.post(shape.storeFn+\"(\"+newVarName+\");\")\r\n\t\t\t\t\t.post(\"gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);\");\r\n\t\t\t\tif (shape.usesElements()) {\r\n\t\t\t\t\tentry.post(\"gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t['x','y','z'].forEach(function(d){\r\n\t\t\tvar D=d.toUpperCase();\r\n\t\t\tvar optName='rotate.'+d;\r\n\t\t\tvar varName='rotate'+D;\r\n\t\t\tvar updateName='updateRotate'+D;\r\n\t\t\tif (options[optName+'.input']=='slider') {\r\n\t\t\t\tvar listener=new listeners.SliderListener(optName);\r\n\t\t\t\tvar entry=listener.enter()\r\n\t\t\t\t\t.log(\"console.log(this.id,'input value:',parseFloat(this.value));\");\r\n\t\t\t\tif (options[optName+'.speed']==0 && options[optName+'.speed.input']=='constant') {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"var \"+varName+\"Loc=gl.getUniformLocation(program,'\"+varName+\"');\",\r\n\t\t\t\t\t\t\"function \"+updateName+\"() {\",\r\n\t\t\t\t\t\t\"\tgl.uniform1f(\"+varName+\"Loc,parseFloat(document.getElementById('\"+optName+\"').value));\",\r\n\t\t\t\t\t\t\"};\",\r\n\t\t\t\t\t\tupdateName+\"();\" // have to initialize the uniform even if default value is zero because the browser may keep prev value of slider on page reload\r\n\t\t\t\t\t);\r\n\t\t\t\t\tentry.post(updateName+\"();\");\r\n\t\t\t\t}\r\n\t\t\t\twriteListener(listener);\r\n\t\t\t} else if (isMousemoveInput(optName)) {\r\n\t\t\t\tif (options[optName+'.speed']==0 && options[optName+'.speed.input']=='constant') {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"var \"+varName+\"Loc=gl.getUniformLocation(program,'\"+varName+\"');\",\r\n\t\t\t\t\t\t\"gl.uniform1f(\"+varName+\"Loc,\"+floatOptionValue(optName)+\");\"\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcanvasMousemoveListener.enter()\r\n\t\t\t\t\t\t.prexy(\r\n\t\t\t\t\t\t\toptions[optName+'.input'],\r\n\t\t\t\t\t\t\t\"var \"+varName+\"=180*(-1+2*(ev.clientX-rect.left)/(rect.width-1));\",\r\n\t\t\t\t\t\t\t\"var \"+varName+\"=180*(-1+2*(rect.bottom-1-ev.clientY)/(rect.height-1));\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.log(\"console.log('\"+optName+\" input value:',\"+varName+\");\")\r\n\t\t\t\t\t\t.post(\"gl.uniform1f(\"+varName+\"Loc,\"+varName+\");\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcanvasMousemoveListener.enter()\r\n\t\t\t\t\t\t.state(\"var \"+varName+\"=\"+floatOptionValue(optName)+\";\")\r\n\t\t\t\t\t\t.prexy(\r\n\t\t\t\t\t\t\toptions[optName+'.input'],\r\n\t\t\t\t\t\t\tvarName+\"=180*(-1+2*(ev.clientX-rect.left)/(rect.width-1));\",\r\n\t\t\t\t\t\t\tvarName+\"=180*(-1+2*(rect.bottom-1-ev.clientY)/(rect.height-1));\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.log(\"console.log('\"+optName+\" input value:',\"+varName+\");\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (options[optName+'.speed.input']=='slider') {\r\n\t\t\t\tvar listener=new listeners.SliderListener(optName+'.speed');\r\n\t\t\t\tlistener.enter()\r\n\t\t\t\t\t.log(\"console.log(this.id,'input value:',parseFloat(this.value));\");\r\n\t\t\t\twriteListener(listener);\r\n\t\t\t} else if (isMousemoveInput(optName+'.speed')) {\r\n\t\t\t\tcanvasMousemoveListener.enter()\r\n\t\t\t\t\t.state(\"var \"+varName+\"Speed=\"+floatOptionValue(optName+'.speed')+\";\")\r\n\t\t\t\t\t.prexy(\r\n\t\t\t\t\t\toptions[optName+'.speed.input'],\r\n\t\t\t\t\t\tvarName+\"Speed=360*(-1+2*(ev.clientX-rect.left)/(rect.width-1));\",\r\n\t\t\t\t\t\tvarName+\"Speed=360*(-1+2*(rect.bottom-1-ev.clientY)/(rect.height-1));\"\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.log(\"console.log('\"+optName+\".speed input value:',\"+varName+\"Speed);\");\r\n\t\t\t}\r\n\t\t});\r\n\t\twriteListener(canvasMousemoveListener);\r\n\t\tif (lines.length) lines.push(\"\t\");\r\n\t\treturn lines;\r\n\t}\r\n\tfunction generateRenderLines() {\r\n\t\tvar needStartTime=false; // set by renderInner()\r\n\t\tvar needPrevTime=false; // set by renderInner()\r\n\t\tfunction renderInner() {\r\n\t\t\tvar needWrap=false; // set by renderInnerTransforms()\r\n\t\t\tfunction renderInnerTransforms() {\r\n\t\t\t\tvar lines=[];\r\n\t\t\t\t['x','y','z'].forEach(function(d){\r\n\t\t\t\t\tvar D=d.toUpperCase();\r\n\t\t\t\t\tvar optName='rotate.'+d;\r\n\t\t\t\t\tvar varName='rotate'+D;\r\n\t\t\t\t\tif (options[optName+'.speed']!=0 || options[optName+'.speed.input']!='constant') {\r\n\t\t\t\t\t\tif (options[optName+'.speed.input']=='constant' && options[optName+'.input']=='constant') {\r\n\t\t\t\t\t\t\t// no rotation state branch\r\n\t\t\t\t\t\t\tneedStartTime=true;\r\n\t\t\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\t\t\"var \"+varName+\"=\"+(options[optName]\r\n\t\t\t\t\t\t\t\t\t? floatOptionValue(optName)+\"+\"\r\n\t\t\t\t\t\t\t\t\t: \"\"\r\n\t\t\t\t\t\t\t\t)+floatOptionValue(optName+'.speed')+\"*(time-startTime)/1000;\"\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// rotation state branch\r\n\t\t\t\t\t\t\tneedPrevTime=true;\r\n\t\t\t\t\t\t\tif (options[optName+'.input']=='slider') {\r\n\t\t\t\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\t\t\t\"var \"+varName+\"Input=document.getElementById('\"+optName+\"');\",\r\n\t\t\t\t\t\t\t\t\t\"var \"+varName+\"=parseFloat(\"+varName+\"Input.value);\"\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (options[optName+'.speed.input']=='slider') {\r\n\t\t\t\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\t\t\t\"var \"+varName+\"SpeedInput=document.getElementById('\"+optName+\".speed');\",\r\n\t\t\t\t\t\t\t\t\t\"var \"+varName+\"Speed=parseFloat(\"+varName+\"SpeedInput.value);\"\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\t\tvarName+\"+=\"+(options[optName+'.speed.input']=='constant'\r\n\t\t\t\t\t\t\t\t\t? floatOptionValue(optName+'.speed')\r\n\t\t\t\t\t\t\t\t\t: varName+\"Speed\"\r\n\t\t\t\t\t\t\t\t)+\"*(time-prevTime)/1000;\"\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tif (options[optName+'.input']=='slider') {\r\n\t\t\t\t\t\t\t\tneedWrap=true;\r\n\t\t\t\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\t\t\tvarName+\"=wrap(\"+varName+\",180);\",\r\n\t\t\t\t\t\t\t\t\tvarName+\"Input.value=\"+varName+\";\"\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\t\"gl.uniform1f(\"+varName+\"Loc,\"+varName+\");\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn lines;\r\n\t\t\t}\r\n\t\t\tvar innerTransformsLines=renderInnerTransforms();\r\n\t\t\tvar lines=[];\r\n\t\t\tif (needWrap) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"function wrap(v,maxAbsV) {\",\r\n\t\t\t\t\t\"\tv%=maxAbsV*2;\",\r\n\t\t\t\t\t\"\tif (Math.abs(v)<=maxAbsV) return v;\",\r\n\t\t\t\t\t\"\treturn v-(v>0?1:-1)*maxAbsV*2;\",\r\n\t\t\t\t\t\"}\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (options.background=='solid') {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"gl.clear(gl.COLOR_BUFFER_BIT);\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines=lines.concat(\r\n\t\t\t\tinnerTransformsLines,\r\n\t\t\t\tshape.writeDraw()\r\n\t\t\t);\r\n\t\t\treturn lines;\r\n\t\t}\r\n\t\tvar lines=[];\r\n\t\tvar innerLines=renderInner();\r\n\t\tif (options.isAnimated()) {\r\n\t\t\t['x','y','z'].forEach(function(d){\r\n\t\t\t\tvar D=d.toUpperCase();\r\n\t\t\t\tvar optName='rotate.'+d;\r\n\t\t\t\tvar varName='rotate'+D;\r\n\t\t\t\tif (\r\n\t\t\t\t\toptions.needsUniform(optName) && !(\r\n\t\t\t\t\t\t// no Loc was generated in generateInputHandlerLines()\r\n\t\t\t\t\t\t(options[optName+'.input']=='slider' || isMousemoveInput(optName)) &&\r\n\t\t\t\t\t\toptions[optName+'.speed']==0 && options[optName+'.speed.input']=='constant'\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"var \"+varName+\"Loc=gl.getUniformLocation(program,'\"+varName+\"');\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (options[optName+'.speed.input']!='constant' && options[optName+'.input']=='constant') {\r\n\t\t\t\t\tlines.push(\r\n\t\t\t\t\t\t\"var \"+varName+\"=\"+floatOptionValue(optName)+\";\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (needStartTime && needPrevTime) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var startTime=performance.now();\",\r\n\t\t\t\t\t\"var prevTime=startTime;\"\r\n\t\t\t\t);\r\n\t\t\t} else if (needStartTime) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var startTime=performance.now();\"\r\n\t\t\t\t);\r\n\t\t\t} else if (needPrevTime) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"var prevTime=performance.now();\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// wrap inner render lines in function if needed\r\n\t\tif (options.isAnimated()) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"function renderFrame(time) {\"\r\n\t\t\t);\r\n\t\t\tlines=lines.concat(indentLines(1,innerLines));\r\n\t\t\tif (needPrevTime) {\r\n\t\t\t\tlines.push(\r\n\t\t\t\t\t\"\tprevTime=time;\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\trequestAnimationFrame(renderFrame);\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"requestAnimationFrame(renderFrame);\"\r\n\t\t\t);\r\n\t\t} else if (options.hasInputs()) {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var frameId=null;\",\r\n\t\t\t\t\"function renderFrame() {\"\r\n\t\t\t);\r\n\t\t\tlines=lines.concat(indentLines(1,innerLines));\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\tframeId=null;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"function scheduleFrame() {\",\r\n\t\t\t\t\"\tif (frameId===null) {\",\r\n\t\t\t\t\"\t\tframeId=requestAnimationFrame(renderFrame);\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"scheduleFrame();\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines=lines.concat(innerLines);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\r\n\treturn [].concat([\r\n\t\t\"<!DOCTYPE html>\",\r\n\t\t\"<html lang='en'>\",\r\n\t\t\"<head>\",\r\n\t\t\"<meta charset='utf-8' />\",\r\n\t\t\"<title>Generated code</title>\",\r\n\t],options.hasSliderInputs()?[\r\n\t\t\"<style>\",\r\n\t\t\"\tlabel {\",\r\n\t\t\"\t\tdisplay: inline-block;\",\r\n\t\t\"\t\twidth: 15em;\",\r\n\t\t\"\t\ttext-align: right;\",\r\n\t\t\"\t}\",\r\n\t\t\"\t.min {\",\r\n\t\t\"\t\tdisplay: inline-block;\",\r\n\t\t\"\t\twidth: 3em;\",\r\n\t\t\"\t\ttext-align: right;\",\r\n\t\t\"\t}\",\r\n\t\t\"\t.max {\",\r\n\t\t\"\t\tdisplay: inline-block;\",\r\n\t\t\"\t\twidth: 3em;\",\r\n\t\t\"\t\ttext-align: left;\",\r\n\t\t\"\t}\",\r\n\t\t\"</style>\",\r\n\t]:[],[\r\n\t\t\"<script id='myVertexShader' type='x-shader/x-vertex'>\",\r\n\t],indentLines(1,generateVertexShaderLines()),[\r\n\t\t\"</script>\",\r\n\t\t\"<script id='myFragmentShader' type='x-shader/x-fragment'>\",\r\n\t\t\"\tprecision mediump float;\",\r\n\t],indentLines(1,generateFragmentShaderLines()),[\r\n\t\t\"</script>\",\r\n\t\t\"</head>\",\r\n\t\t\"<body>\",\r\n\t\t\"<div>\",\r\n\t\t\"\t<canvas id='myCanvas' width='\"+intOptionValue('canvas.width')+\"' height='\"+intOptionValue('canvas.height')+\"'></canvas>\",\r\n\t\t\"</div>\",\r\n\t],generateControlMessageLines(),generateInputLines(),[\r\n\t\t\"<script>\",\r\n\t],indentLines(1,generateMakeProgramLines()),[\r\n\t\t\"\t\",\r\n\t\t\"\tvar canvas=document.getElementById('myCanvas');\",\r\n\t\t\"\tvar gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');\",\r\n\t],(\r\n\t\toptions.background=='solid' && !options.hasInputsFor('background.solid.color') && !(\r\n\t\t\t// default clear color in OpenGL\r\n\t\t\toptions['background.solid.color.r']==0 &&\r\n\t\t\toptions['background.solid.color.g']==0 &&\r\n\t\t\toptions['background.solid.color.b']==0 &&\r\n\t\t\toptions['background.solid.color.a']==0\r\n\t\t)\r\n\t)?[\r\n\t\t\"\tgl.clearColor(\"+colorValue('background.solid.color')+\");\",\r\n\t]:[],shape.dim>2?[\r\n\t\t\"\tgl.enable(gl.DEPTH_TEST);\"\r\n\t]:[],[\r\n\t\t\"\tvar program=makeProgram(\",\r\n\t\t\"\t\tdocument.getElementById('myVertexShader').text,\",\r\n\t\t\"\t\tdocument.getElementById('myFragmentShader').text\",\r\n\t\t\"\t);\",\r\n\t\t\"\tgl.useProgram(program);\",\r\n\t\t\"\t\",\r\n\t],indentLines(1,shape.writeInit()),[\r\n\t\t\"\t\",\r\n\t],indentLines(1,generateInputHandlerLines()),indentLines(1,generateRenderLines()),[\r\n\t\t\"</script>\",\r\n\t\t\"</body>\",\r\n\t\t\"</html>\",\r\n\t]).join(\"\\n\");\r\n};\r\n",null,"var Listener=function(){\r\n\tthis.entries=[];\r\n};\r\nListener.prototype.enter=function(){\r\n\tvar entry={\r\n\t\tstate: [],\r\n\t\tpre: [],\r\n\t\tcond: null,\r\n\t\tlog: [],\r\n\t\tpost: [],\r\n\t};\r\n\tthis.entries.push(entry);\r\n\tfunction makePushArgs(where) {\r\n\t\treturn function() {\r\n\t\t\tfor (var i=0;i<arguments.length;i++) {\r\n\t\t\t\twhere.push(arguments[i]);\r\n\t\t\t}\r\n\t\t\treturn proxy;\r\n\t\t};\r\n\t}\r\n\tvar proxy={\r\n\t\tstate: makePushArgs(entry.state),\r\n\t\tpre: makePushArgs(entry.pre),\r\n\t\tcond: function(cond){\r\n\t\t\tentry.cond=cond;\r\n\t\t\treturn proxy;\r\n\t\t},\r\n\t\tlog: makePushArgs(entry.log),\r\n\t\tpost: makePushArgs(entry.post),\r\n\t};\r\n\treturn proxy;\r\n};\r\nListener.prototype.innerPrependedLines=function(){\r\n\treturn [];\r\n};\r\nListener.prototype.bracketFnArg=function(){\r\n\treturn \"\";\r\n};\r\nListener.prototype.wrapCall=function(line){\r\n\treturn line;\r\n};\r\nListener.prototype.write=function(haveToUpdateCanvas,haveToLogInput){\r\n\tfunction indent(line) {\r\n\t\treturn \"\\t\"+line;\r\n\t}\r\n\tvar outerLines=[];\r\n\tvar innerLinesGraph={};\r\n\tvar innerLinesRoot=[];\r\n\tvar innerLinesPrev=null;\r\n\tvar WHITE=0;\r\n\tvar GRAY=1;\r\n\tvar BLACK=2;\r\n\tfunction addInnerLine(line,cond) {\r\n\t\tvar vertex;\r\n\t\tif (line in innerLinesGraph) {\r\n\t\t\tvertex=innerLinesGraph[line];\r\n\t\t} else {\r\n\t\t\tvertex=innerLinesGraph[line]={\r\n\t\t\t\tprevs: [],\r\n\t\t\t\tconds: [],\r\n\t\t\t\tmark: WHITE,\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (vertex.conds!==null) {\r\n\t\t\tif (cond===null) {\r\n\t\t\t\tvertex.conds=null;\r\n\t\t\t} else {\r\n\t\t\t\tvertex.conds.push(cond);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (innerLinesPrev!==null) {\r\n\t\t\tvertex.prevs.push(innerLinesPrev);\r\n\t\t}\r\n\t\tinnerLinesPrev=line;\r\n\t}\r\n\tfunction closeEntryInnerLines() {\r\n\t\tif (innerLinesPrev!==null) {\r\n\t\t\tinnerLinesRoot.push(innerLinesPrev);\r\n\t\t}\r\n\t\tinnerLinesPrev=null;\r\n\t}\r\n\tfunction writeInnerLines() {\r\n\t\tvar lines=[];\r\n\t\tvar currentCond=null;\r\n\t\tfunction writeLine(line,vertex) {\r\n\t\t\tvar newCond=null;\r\n\t\t\tif (vertex.conds!==null) {\r\n\t\t\t\tnewCond=vertex.conds.join(' || ');\r\n\t\t\t}\r\n\t\t\tif (newCond!=currentCond) {\r\n\t\t\t\tif (currentCond!==null) {\r\n\t\t\t\t\tlines.push(\"}\");\r\n\t\t\t\t}\r\n\t\t\t\tcurrentCond=newCond;\r\n\t\t\t\tif (currentCond!==null) {\r\n\t\t\t\t\tlines.push(\"if (\"+currentCond+\") {\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (currentCond!==null) {\r\n\t\t\t\tlines.push(indent(line));\r\n\t\t\t} else {\r\n\t\t\t\tlines.push(line);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction recVertex(line,vertex) {\r\n\t\t\tvertex.mark=GRAY;\r\n\t\t\trecPrevs(vertex.prevs);\r\n\t\t\tvertex.mark=BLACK;\r\n\t\t\twriteLine(line,vertex);\r\n\t\t}\r\n\t\tfunction recPrevs(prevs) {\r\n\t\t\tprevs.forEach(function(line){\r\n\t\t\t\tif (innerLinesGraph[line].mark==WHITE) {\r\n\t\t\t\t\trecVertex(line,innerLinesGraph[line]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\trecPrevs(innerLinesRoot);\r\n\t\tif (currentCond!==null) {\r\n\t\t\tlines.push(\"}\");\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tthis.entries.forEach(function(entry){\r\n\t\touterLines=outerLines.concat(entry.state);\r\n\t\tentry.pre.forEach(function(line){\r\n\t\t\taddInnerLine(line,null);\r\n\t\t});\r\n\t\tif (haveToLogInput) {\r\n\t\t\tentry.log.forEach(function(line){\r\n\t\t\t\taddInnerLine(line,entry.cond);\r\n\t\t\t});\r\n\t\t}\r\n\t\tentry.post.forEach(function(line){\r\n\t\t\taddInnerLine(line,entry.cond);\r\n\t\t});\r\n\t\tif (haveToUpdateCanvas) {\r\n\t\t\taddInnerLine(\"scheduleFrame();\",entry.cond);\r\n\t\t}\r\n\t\tcloseEntryInnerLines();\r\n\t});\r\n\tvar br=this.bracketListener();\r\n\tvar innerLines=writeInnerLines();\r\n\tif (innerLines.length) {\r\n\t\tinnerLines=this.innerPrependedLines().concat(innerLines);\r\n\t}\r\n\tif (innerLines.length==1) {\r\n\t\tvar match=/^(\\w+)\\(\\);$/.exec(innerLines[0]);\r\n\t\tif (match) {\r\n\t\t\treturn outerLines.concat(\r\n\t\t\t\tthis.wrapCall(\r\n\t\t\t\t\t[br[0]+match[1]+br[1]]\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tif (innerLines.length) {\r\n\t\treturn outerLines.concat(\r\n\t\t\tthis.wrapCall([].concat(\r\n\t\t\t\t[br[0]+\"function(\"+this.bracketFnArg()+\"){\"],\r\n\t\t\t\tinnerLines.map(indent),\r\n\t\t\t\t[\"}\"+br[1]]\r\n\t\t\t))\r\n\t\t);\r\n\t} else {\r\n\t\treturn outerLines;\r\n\t}\r\n};\r\n\r\nvar SliderListener=function(id){\r\n\tListener.call(this);\r\n\tthis.id=id;\r\n};\r\nSliderListener.prototype=Object.create(Listener.prototype);\r\nSliderListener.prototype.constructor=SliderListener;\r\nSliderListener.prototype.bracketListener=function(){\r\n\treturn [\"document.getElementById('\"+this.id+\"').addEventListener('change',\",\");\"];\r\n};\r\n\r\nvar MultipleSliderListener=function(query){\r\n\tListener.call(this);\r\n\tthis.query=query;\r\n};\r\nMultipleSliderListener.prototype=Object.create(Listener.prototype);\r\nMultipleSliderListener.prototype.constructor=MultipleSliderListener;\r\nMultipleSliderListener.prototype.wrapCall=function(lines){\r\n\treturn [].concat(\r\n\t\t[\"[].forEach.call(document.querySelectorAll('\"+this.query+\"'),function(el){\"],\r\n\t\tlines.map(function(line){\r\n\t\t\treturn \"\\t\"+line;\r\n\t\t}),\r\n\t\t[\"});\"]\r\n\t);\r\n};\r\nMultipleSliderListener.prototype.bracketListener=function(){\r\n\treturn [\"el.addEventListener('change',\",\");\"];\r\n};\r\n\r\nvar CanvasMousemoveListener=function(){\r\n\tListener.call(this);\r\n};\r\nCanvasMousemoveListener.prototype=Object.create(Listener.prototype);\r\nCanvasMousemoveListener.prototype.constructor=CanvasMousemoveListener;\r\nCanvasMousemoveListener.prototype.enter=function(){\r\n\tvar proxy=Listener.prototype.enter.call(this);\r\n\tproxy.prexy=function(inputType,xLine,yLine){\r\n\t\tif (inputType=='mousemovex') {\r\n\t\t\treturn proxy.pre(xLine);\r\n\t\t} else if (inputType=='mousemovey') {\r\n\t\t\treturn proxy.pre(yLine);\r\n\t\t}\r\n\t\treturn proxy;\r\n\t};\r\n\treturn proxy;\r\n};\r\nCanvasMousemoveListener.prototype.bracketListener=function(){\r\n\treturn [\"canvas.addEventListener('mousemove',\",\");\"];\r\n};\r\nCanvasMousemoveListener.prototype.bracketFnArg=function(){\r\n\treturn \"ev\";\r\n};\r\nCanvasMousemoveListener.prototype.innerPrependedLines=function(){\r\n\treturn [\r\n\t\t\"var rect=this.getBoundingClientRect();\",\r\n\t];\r\n};\r\n\r\nexports.SliderListener=SliderListener;\r\nexports.MultipleSliderListener=MultipleSliderListener;\r\nexports.CanvasMousemoveListener=CanvasMousemoveListener;\r\n","var idCounter=0;\r\nfunction generateId() {\r\n\treturn 'webgl-starter-id-'+(idCounter++);\r\n}\r\n\r\nvar Options=require('./options.js');\r\nvar generateCode=require('./code.js');\r\n\r\nfunction getHtmlDataUri(html) {\r\n\t// with base64: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/btoa\r\n\t//return \"data:text/html;charset=utf-8;base64,\"+window.btoa(unescape(encodeURIComponent(str)));\r\n\t// without base64: https://en.wikipedia.org/wiki/Data_URI_scheme\r\n\treturn 'data:text/html;charset=utf-8,'+encodeURIComponent(html);\r\n}\r\n\r\nvar i18n=function(id){ // fake temporary i18n\r\n\treturn {\r\n\t\t'message.hljs': \"<a href='https://highlightjs.org/'>highlight.js</a> (hosted on cdnjs.cloudflare.com) is not loaded. Syntax highlighting is disabled.\",\r\n\r\n\t\t'options.general': 'General options',\r\n\t\t'options.background': 'Background',\r\n\t\t'options.background.none': 'None (transparent)',\r\n\t\t'options.background.solid': 'Solid color',\r\n\t\t'options.shader': 'Shader',\r\n\t\t'options.shader.single': 'Single color',\r\n\t\t'options.shader.vertex': 'One color per vertex',\r\n\t\t'options.shader.face': 'One color per face',\r\n\t\t'options.shader.light': 'Directional light',\r\n\t\t'options.shape': 'Shape to draw',\r\n\t\t'options.shape.square': 'Square',\r\n\t\t'options.shape.triangle': 'Triangle',\r\n\t\t'options.shape.gasket': 'Sierpinski gasket', // wp: Sierpinski triangle\r\n\t\t'options.shape.cube': 'Cube',\r\n\t\t'options.shape.hat': 'Mexican hat function', // wp: Mexican hat wavelet\r\n\t\t'options.projection': 'Projection',\r\n\t\t'options.projection.ortho': 'Orthogonal',\r\n\t\t'options.projection.perspective': 'Perspective',\r\n\r\n\t\t'options.input': 'Input options',\r\n\t\t'options.canvas.width': 'Canvas width',\r\n\t\t'options.canvas.height': 'Canvas height',\r\n\t\t'options.background.solid.color.r': 'Background color red component',\r\n\t\t'options.background.solid.color.g': 'Background color green component',\r\n\t\t'options.background.solid.color.b': 'Background color blue component',\r\n\t\t'options.background.solid.color.a': 'Background color alpha component',\r\n\t\t'options.shader.single.color.r': 'Fragment color red component',\r\n\t\t'options.shader.single.color.g': 'Fragment color green component',\r\n\t\t'options.shader.single.color.b': 'Fragment color blue component',\r\n\t\t'options.shader.single.color.a': 'Fragment color alpha component',\r\n\t\t'options.shape.gasket.depth': 'Sierpinski gasket recursion depth',\r\n\t\t'options.shape.hat.resolution': 'Mexican hat mesh resolution',\r\n\t\t'options.*.input': 'This value is',\r\n\t\t'options.*.input.constant': 'kept constant',\r\n\t\t'options.*.input.slider': 'updated with a slider',\r\n\t\t'options.*.input.mousemovex': 'updated by moving the mouse horizontally',\r\n\t\t'options.*.input.mousemovey': 'updated by moving the mouse vertically',\r\n\t\t'options.*.input.animated': 'animated',\r\n\r\n\t\t'options.transform': 'Transforms',\r\n\t\t'options.rotate.x': 'Angle of rotation around x axis',\r\n\t\t'options.rotate.x.speed': 'Speed of rotation around x axis',\r\n\t\t'options.rotate.y': 'Angle of rotation around y axis',\r\n\t\t'options.rotate.y.speed': 'Speed of rotation around y axis',\r\n\t\t'options.rotate.z': 'Angle of rotation around z axis',\r\n\t\t'options.rotate.z.speed': 'Speed of rotation around z axis',\r\n\r\n\t\t'options.debug': 'Debug options',\r\n\t\t'options.debugShader': 'Log shader compilation errors',\r\n\t\t'options.debugInputs': 'Log input values',\r\n\r\n\t\t'controls.type.mousemovex': 'Move the mouse pointer horizontally over the canvas',\r\n\t\t'controls.type.mousemovey': 'Move the mouse pointer vertically over the canvas',\r\n\t\t'controls.to': 'to update',\r\n\t\t/*\r\n\t\t// TODO\r\n\t\t'controls.value.background.solid.color.r': 'Background color red component',\r\n\t\t'controls.value.background.solid.color.g': 'Background color green component',\r\n\t\t'controls.value.background.solid.color.b': 'Background color blue component',\r\n\t\t'controls.value.background.solid.color.a': 'Background color alpha component',\r\n\t\t'controls.value.shader.single.color.r': 'Fragment color red component',\r\n\t\t'controls.value.shader.single.color.g': 'Fragment color green component',\r\n\t\t'controls.value.shader.single.color.b': 'Fragment color blue component',\r\n\t\t'controls.value.shader.single.color.a': 'Fragment color alpha component',\r\n\t\t'controls.value.shape.gasket.depth': 'Sierpinski gasket recursion depth',\r\n\t\t'controls.value.animation.rotation.speed': 'Z axis rotation speed',\r\n\t\t*/\r\n\t}[id];\r\n};\r\n\r\n$(function(){\r\n\t$('.webgl-starter').each(function(){\r\n\t\tvar $container=$(this);\r\n\t\tvar $options;\r\n\t\tvar $code;\r\n\t\tvar options=new Options();\r\n\t\tvar codeUpdateTimeoutId=null;\r\n\t\tvar codeUpdateDelay=200;\r\n\r\n\t\tfunction showHideSuboptionInputs(optionName,optionValue) {\r\n\t\t\t// TODO sub-sub option support?\r\n\t\t\t$options.find(\"[data-option^='\"+optionName+\".']\").show()\r\n\t\t\t\t.not(\"[data-option^='\"+optionName+\".\"+optionValue+\".']\").hide();\r\n\t\t}\r\n\t\tfunction updateCode() {\r\n\t\t\tclearTimeout(codeUpdateTimeoutId);\r\n\t\t\tcodeUpdateTimeoutId=setTimeout(function(){\r\n\t\t\t\t$code.text(generateCode(options.fix(),i18n));\r\n\t\t\t\tif (window.hljs) hljs.highlightBlock($code[0]);\r\n\t\t\t},codeUpdateDelay);\r\n\t\t}\r\n\t\tfunction writeGeneralOption(option) {\r\n\t\t\tvar id=generateId();\r\n\t\t\treturn $(\"<div>\")\r\n\t\t\t\t.append(\"<label for='\"+id+\"'>\"+i18n('options.'+option.name)+\":</label>\")\r\n\t\t\t\t.append(\" \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<select id='\"+id+\"'>\").append(\r\n\t\t\t\t\t\toption.availableValues.map(function(availableValue){\r\n\t\t\t\t\t\t\treturn $(\"<option>\").val(availableValue).html(i18n('options.'+option.name+'.'+availableValue))\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t).val(options[option.name]).change(function(){\r\n\t\t\t\t\t\toptions[option.name]=this.value;\r\n\t\t\t\t\t\tshowHideSuboptionInputs(option.name,this.value);\r\n\t\t\t\t\t\tupdateCode();\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t}\r\n\t\tfunction writeInputOption(option) {\r\n\t\t\tvar id=generateId();\r\n\t\t\tvar inputId=generateId();\r\n\t\t\tvar sliderInput,numberInput;\r\n\t\t\tfunction inputListener(that) {\r\n\t\t\t\tif (this.checkValidity()) {\r\n\t\t\t\t\tthat.val(this.value);\r\n\t\t\t\t\toptions[option.name]=parseFloat(this.value);\r\n\t\t\t\t\tupdateCode();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn $(\"<div data-option='\"+option.name+\"'>\")\r\n\t\t\t\t.append(\"<label for='\"+id+\"'>\"+i18n('options.'+option.name)+\":</label>\")\r\n\t\t\t\t.append(\" <span class='min'>\"+option.getMinLabel()+\"</span> \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\tsliderInput=$(\"<input type='range' id='\"+id+\"'>\")\r\n\t\t\t\t\t\t.attr('min',option.getMin())\r\n\t\t\t\t\t\t.attr('max',option.getMax())\r\n\t\t\t\t\t\t.attr('step',option.getSetupStep())\r\n\t\t\t\t\t\t.val(options[option.name])\r\n\t\t\t\t\t\t.on('input change',function(){\r\n\t\t\t\t\t\t\tinputListener.call(this,numberInput);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t\t.append(\" <span class='max'>\"+option.getMaxLabel()+\"</span> \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\tnumberInput=$(\"<input type='number' required>\")\r\n\t\t\t\t\t\t.attr('min',option.getMin())\r\n\t\t\t\t\t\t.attr('max',option.getMax())\r\n\t\t\t\t\t\t.attr('step',option.getSetupStep())\r\n\t\t\t\t\t\t.val(options[option.name])\r\n\t\t\t\t\t\t.on('input change',function(){\r\n\t\t\t\t\t\t\tinputListener.call(this,sliderInput);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t\t.append(\" \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<button type='button'>Reset</button>\").click(function(){\r\n\t\t\t\t\t\tsliderInput.val(option.defaultValue).change();\r\n\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t\t.append(\" \")\r\n\t\t\t\t.append(\"<label for='\"+inputId+\"'>\"+i18n('options.*.input')+\"</label> \")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<select id='\"+inputId+\"'>\").append(\r\n\t\t\t\t\t\toption.availableInputTypes.map(function(availableInputType){\r\n\t\t\t\t\t\t\treturn $(\"<option>\").val(availableInputType).html(i18n('options.*.input.'+availableInputType))\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t).val(options[option.name+'.input']).change(function(){\r\n\t\t\t\t\t\toptions[option.name+'.input']=this.value;\r\n\t\t\t\t\t\tupdateCode();\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t}\r\n\t\tfunction writeDebugOption(option) {\r\n\t\t\tvar id=generateId();\r\n\t\t\treturn $(\"<div>\")\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$(\"<input type='checkbox' id='\"+id+\"'>\")\r\n\t\t\t\t\t\t.prop('checked',options[option.name])\r\n\t\t\t\t\t\t.change(function(){\r\n\t\t\t\t\t\t\toptions[option.name]=$(this).prop('checked');\r\n\t\t\t\t\t\t\tupdateCode();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t\t.append(\" <label for='\"+id+\"'>\"+i18n('options.'+option.name)+\"</label>\");\r\n\t\t}\r\n\t\tfunction makeSortable($sortableRoot,callback) {\r\n\t\t\t// have to make drag handler 'draggable', not the whole item\r\n\t\t\t// because inputs and labels don't like to be inside 'draggable'\r\n\t\t\t// http://stackoverflow.com/questions/13017177/selection-disabled-while-using-html5-drag-and-drop\r\n\t\t\tvar $dragged=null;\r\n\t\t\t$sortableRoot.children().prepend(\r\n\t\t\t\t$(\"<div draggable='true' tabindex='0' title='Drag or press up/down while in focus to reorder transforms'>\").on('dragstart',function(ev){\r\n\t\t\t\t\t$dragged=$(this).parent();\r\n\t\t\t\t\tev.originalEvent.dataTransfer.effectAllowed='move';\r\n\t\t\t\t\tev.originalEvent.dataTransfer.setData('Text',name);\r\n\t\t\t\t\tif (ev.originalEvent.dataTransfer.setDragImage) { // doesn't work in IE\r\n\t\t\t\t\t\tev.originalEvent.dataTransfer.setDragImage($dragged[0],0,0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t$dragged.addClass('ghost');\r\n\t\t\t\t\t},0);\r\n\t\t\t\t})\r\n\t\t\t\t.keydown(function(ev){\r\n\t\t\t\t\tvar $handle=$(this);\r\n\t\t\t\t\tvar $sorted=$handle.parent();\r\n\t\t\t\t\tif (ev.keyCode==38) {\r\n\t\t\t\t\t\t$sorted.prev().before($sorted);\r\n\t\t\t\t\t\t$handle.focus();\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (ev.keyCode==40) {\r\n\t\t\t\t\t\t$sorted.next().after($sorted);\r\n\t\t\t\t\t\t$handle.focus();\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t).on('dragover',function(ev){\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tev.originalEvent.dataTransfer.dropEffect='move';\r\n\t\t\t\tvar $target=$(this);\r\n\t\t\t\tif ($dragged) {\r\n\t\t\t\t\tif ($target.nextAll().is($dragged)) {\r\n\t\t\t\t\t\t$target.before($dragged);\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t} else if ($target.prevAll().is($dragged)) {\r\n\t\t\t\t\t\t$target.after($dragged);\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).on('drop',function(ev){\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}).on('dragend',function(ev){\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tif ($dragged) {\r\n\t\t\t\t\t$dragged.removeClass('ghost');\r\n\t\t\t\t\t$dragged=null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction writeOptions() {\r\n\t\t\tvar $transforms;\r\n\t\t\tvar $options=$(\"<div>\").append(\r\n\t\t\t\t$(\"<fieldset>\").append(\"<legend>\"+i18n('options.general')+\"</legend>\").append(\r\n\t\t\t\t\toptions.generalOptions.map(writeGeneralOption)\r\n\t\t\t\t)\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<fieldset>\").append(\"<legend>\"+i18n('options.input')+\"</legend>\").append(\r\n\t\t\t\t\toptions.inputOptions.map(writeInputOption)\r\n\t\t\t\t)\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<fieldset>\").append(\"<legend>\"+i18n('options.transform')+\"</legend>\").append(\r\n\t\t\t\t\t$transforms=$(\"<div>\").append(\r\n\t\t\t\t\t\toptions.transforms.map(function(transform){\r\n\t\t\t\t\t\t\treturn $(\"<div class='transform' data-transform='\"+transform.name+\"'>\").append(\r\n\t\t\t\t\t\t\t\ttransform.options.map(writeInputOption)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<fieldset>\").append(\"<legend>\"+i18n('options.debug')+\"</legend>\").append(\r\n\t\t\t\t\toptions.debugOptions.map(writeDebugOption)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tmakeSortable($transforms,function(){\r\n\t\t\t\toptions.transformOrder=$transforms.children().map(function(){\r\n\t\t\t\t\treturn $(this).attr('data-transform');\r\n\t\t\t\t}).get();\r\n\t\t\t\tupdateCode();\r\n\t\t\t});\r\n\t\t\treturn $options;\r\n\t\t}\r\n\t\tfunction hideSuboptionInputs() {\r\n\t\t\toptions.generalOptions.forEach(function(option){\r\n\t\t\t\tshowHideSuboptionInputs(option.name,options[option.name]);\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction writeButtons() {\r\n\t\t\treturn $(\"<div>\").append(\r\n\t\t\t\t$(\"<a download='source.html'><button type='button'>Save source code</button></a>\").click(function(){\r\n\t\t\t\t\t// yes I want a button, but download attr is only available for links\r\n\t\t\t\t\t$(this).attr('href',getHtmlDataUri($code.text()));\r\n\t\t\t\t})\r\n\t\t\t).append(\r\n\t\t\t\t\" \"\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<button type='button'>Run in new window</button>\").click(function(){\r\n\t\t\t\t\twindow.open(getHtmlDataUri($code.text()),\"generatedCode\");\r\n\t\t\t\t})\r\n\t\t\t).append(\r\n\t\t\t\t\" these buttons don't work in Internet Explorer, copy-paste the code manually\"\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\t$container.empty().append($options=writeOptions());\r\n\t\thideSuboptionInputs();\r\n\t\t$container.append(writeButtons()).append(\r\n\t\t\t$(\"<pre>\").append($code=$(\"<code>\").text(generateCode(options.fix(),i18n)))\r\n\t\t);\r\n\t\tif (window.hljs) {\r\n\t\t\thljs.highlightBlock($code[0]);\r\n\t\t} else {\r\n\t\t\t$container.append(\"<p>\"+i18n('message.hljs')+\"</p>\");\r\n\t\t}\r\n\t\t$container.append(writeButtons());\r\n\t});\r\n});\r\n","var Option=function(name,availableValues,defaultValue){\r\n\tthis.name=name;\r\n\tthis.availableValues=availableValues; // for range its [min,max,step]\r\n\tif (defaultValue===undefined) {\r\n\t\tthis.defaultValue=availableValues[0];\r\n\t} else {\r\n\t\tthis.defaultValue=defaultValue;\r\n\t}\r\n};\r\nOption.prototype.doesValueHideOption=function(value,option){\r\n\tfunction optionStartsWith(prefix) {\r\n\t\treturn option.name.indexOf(prefix)===0;\r\n\t}\r\n\treturn optionStartsWith(this.name+'.') && !optionStartsWith(this.name+'.'+value+'.');\r\n};\r\n\r\nvar InputOption=function(name,rangeOfValues,defaultValue){\r\n\tOption.call(this,name,rangeOfValues,defaultValue);\r\n};\r\nInputOption.prototype=Object.create(Option.prototype);\r\nInputOption.prototype.constructor=InputOption;\r\nInputOption.prototype.availableInputTypes=['constant','slider','mousemovex','mousemovey'];\r\nInputOption.prototype.getMin=function(){\r\n\treturn this.availableValues[0];\r\n};\r\nInputOption.prototype.getMax=function(){\r\n\treturn this.availableValues[1];\r\n};\r\nInputOption.prototype.getMinLabel=function(){\r\n\treturn this.getMin().toString().replace('-','');\r\n};\r\nInputOption.prototype.getMaxLabel=function(){\r\n\treturn this.getMax().toString().replace('-','');\r\n};\r\n\r\nvar FloatInputOption=function(name,rangeOfValues,defaultValue){\r\n\tInputOption.call(this,name,rangeOfValues,defaultValue);\r\n};\r\nFloatInputOption.prototype=Object.create(InputOption.prototype);\r\nFloatInputOption.prototype.constructor=FloatInputOption;\r\nFloatInputOption.prototype.getStep=function(){\r\n\treturn 'any';\r\n};\r\nFloatInputOption.prototype.getSetupStep=function(){\r\n\tif (this.getMax()>=100) {\r\n\t\treturn '0.1';\r\n\t} else if (this.getMax()>=10) {\r\n\t\treturn '0.01';\r\n\t} else {\r\n\t\treturn '0.001';\r\n\t}\r\n};\r\n\r\nvar IntInputOption=function(name,rangeOfValues,defaultValue){\r\n\tInputOption.call(this,name,rangeOfValues,defaultValue);\r\n};\r\nIntInputOption.prototype=Object.create(InputOption.prototype);\r\nIntInputOption.prototype.constructor=IntInputOption;\r\nIntInputOption.prototype.getStep=function(){\r\n\treturn 1;\r\n};\r\nIntInputOption.prototype.getSetupStep=function(){\r\n\treturn 1;\r\n};\r\n\r\nvar CanvasIntInputOption=function(name,rangeOfValues,defaultValue){\r\n\tIntInputOption.call(this,name,rangeOfValues,defaultValue);\r\n};\r\nCanvasIntInputOption.prototype=Object.create(IntInputOption.prototype);\r\nCanvasIntInputOption.prototype.constructor=CanvasIntInputOption;\r\nCanvasIntInputOption.prototype.availableInputTypes=['constant','slider']; // can't change canvas size by moving mouse over canvas\r\n\r\nvar DebugOption=function(name,defaultValue){\r\n\tOption.call(this,name,[false,true],defaultValue);\r\n};\r\nDebugOption.prototype=Object.create(Option.prototype);\r\nDebugOption.prototype.constructor=DebugOption;\r\n\r\nvar OptionsBlueprint=function(){\r\n\tthis.reset();\r\n};\r\nOptionsBlueprint.prototype.generalOptions=[\r\n\tnew Option('background',['none','solid']),\r\n\tnew Option('shader',['single','vertex','face','light']),\r\n\tnew Option('shape',['square','triangle','gasket','cube','hat']),\r\n\tnew Option('projection',['ortho','perspective']),\r\n];\r\nOptionsBlueprint.prototype.inputOptions=[\r\n\tnew CanvasIntInputOption('canvas.width',[1,1024],512),\r\n\tnew CanvasIntInputOption('canvas.height',[1,1024],512),\r\n\tnew FloatInputOption('background.solid.color.r',[0,1],1),\r\n\tnew FloatInputOption('background.solid.color.g',[0,1],1),\r\n\tnew FloatInputOption('background.solid.color.b',[0,1],1),\r\n\tnew FloatInputOption('background.solid.color.a',[0,1],1),\r\n\tnew FloatInputOption('shader.single.color.r',[0,1],1),\r\n\tnew FloatInputOption('shader.single.color.g',[0,1]),\r\n\tnew FloatInputOption('shader.single.color.b',[0,1]),\r\n\tnew FloatInputOption('shader.single.color.a',[0,1],1),\r\n\tnew IntInputOption('shape.gasket.depth',[0,10],6),\r\n\tnew IntInputOption('shape.hat.resolution',[1,255],32), // max resolution limited by number of vertices <= 2^16\r\n];\r\nOptionsBlueprint.prototype.transformOptions=[];\r\nOptionsBlueprint.prototype.transforms=[];\r\n['rotate.x','rotate.y','rotate.z'].forEach(function(name){\r\n\t// TODO make default angle/speed something like 0.2*360 when able to add/delete transforms\r\n\tvar valueOption=new FloatInputOption(name,[-180,180],0);\r\n\tvar speedOption=new FloatInputOption(name+'.speed',[-360,360],0);\r\n\tOptionsBlueprint.prototype.transformOptions.push(valueOption);\r\n\tOptionsBlueprint.prototype.transformOptions.push(speedOption);\r\n\tOptionsBlueprint.prototype.transforms.push({\r\n\t\tname:name,\r\n\t\toptions:[valueOption,speedOption]\r\n\t});\r\n});\r\nOptionsBlueprint.prototype.debugOptions=[\r\n\tnew DebugOption('debugShader',true),\r\n\tnew DebugOption('debugInputs'), // TODO hide if no inputs?\r\n];\r\nOptionsBlueprint.prototype.reset=function(){\r\n\tthis.generalOptions.forEach(function(option){\r\n\t\tthis[option.name]=option.defaultValue;\r\n\t},this);\r\n\tthis.inputOptions.forEach(function(option){\r\n\t\tthis[option.name]=option.defaultValue;\r\n\t\tthis[option.name+'.input']='constant';\r\n\t},this);\r\n\tthis.transformOptions.forEach(function(option){\r\n\t\tthis[option.name]=option.defaultValue;\r\n\t\tthis[option.name+'.input']='constant';\r\n\t},this);\r\n\tthis.debugOptions.forEach(function(option){\r\n\t\tthis[option.name]=option.defaultValue;\r\n\t},this);\r\n\tthis.transformOrder=this.transforms.map(function(transform){\r\n\t\treturn transform.name;\r\n\t});\r\n};\r\nOptionsBlueprint.prototype.fix=function(){\r\n\treturn new OptionsInstance(this);\r\n};\r\n\r\nvar OptionsInstance=function(blueprint){\r\n\t['generalOptions','inputOptions','transformOptions','debugOptions'].forEach(function(groupName){\r\n\t\tthis[groupName]=[];\r\n\t\tblueprint[groupName].forEach(function(option){\r\n\t\t\tvar isHidden=blueprint.generalOptions.some(function(generalOption){\r\n\t\t\t\treturn generalOption.doesValueHideOption(blueprint[generalOption.name],option);\r\n\t\t\t});\r\n\t\t\tif (!isHidden) {\r\n\t\t\t\tthis[groupName].push(option);\r\n\t\t\t\tthis[option.name]=blueprint[option.name];\r\n\t\t\t\tif (groupName=='inputOptions' || groupName=='transformOptions') {\r\n\t\t\t\t\tthis[option.name+'.input']=blueprint[option.name+'.input'];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},this);\r\n\t},this);\r\n\tthis.transformOrder=blueprint.transformOrder;\r\n};\r\nOptionsInstance.prototype.getInputOptionsFor=function(prefix){\r\n\treturn this.inputOptions.filter(function(option){\r\n\t\treturn option.name.indexOf(prefix+'.')===0;\r\n\t},this);\r\n};\r\nOptionsInstance.prototype.getInputsFor=function(prefix){\r\n\treturn this.inputOptions.filter(function(option){\r\n\t\treturn option.name.indexOf(prefix+'.')===0 && this[option.name+'.input']!='constant';\r\n\t},this);\r\n};\r\nOptionsInstance.prototype.getOnlyInputFor=function(prefix){\r\n\tvar matchedOptions=this.getInputsFor(prefix);\r\n\tif (matchedOptions.length==1) {\r\n\t\treturn matchedOptions[0];\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n};\r\nOptionsInstance.prototype.hasInputs=function(){\r\n\treturn this.inputOptions.some(function(option){\r\n\t\treturn this[option.name+'.input']!='constant';\r\n\t},this) || this.transformOptions.some(function(option){\r\n\t\treturn this[option.name+'.input']!='constant';\r\n\t},this);\r\n};\r\nOptionsInstance.prototype.hasSliderInputs=function(){\r\n\treturn this.inputOptions.some(function(option){\r\n\t\treturn this[option.name+'.input']=='slider';\r\n\t},this) || this.transformOptions.some(function(option){\r\n\t\treturn this[option.name+'.input']=='slider';\r\n\t},this);\r\n};\r\nOptionsInstance.prototype.hasInputsFor=function(prefix){\r\n\treturn this.getInputsFor(prefix).length>0;\r\n};\r\nOptionsInstance.prototype.hasAllSliderInputsFor=function(prefix){\r\n\treturn this.getInputOptionsFor(prefix).every(function(option){\r\n\t\treturn this[option.name+'.input']=='slider';\r\n\t},this);\r\n};\r\nOptionsInstance.prototype.isAnimated=function(){\r\n\tfunction endsWith(name,suffix) {\r\n\t\treturn name.indexOf(suffix,name.length-suffix.length)!==-1;\r\n\t};\r\n\treturn this.transformOptions.some(function(option){\r\n\t\treturn endsWith(option.name,'.speed') && (this[option.name]!=0 || this[option.name+'.input']!='constant');\r\n\t},this);\r\n};\r\nOptionsInstance.prototype.needsUniform=function(prefix){\r\n\treturn (\r\n\t\tthis[prefix+'.input']!='constant' ||\r\n\t\tthis[prefix+'.speed']!=0 || this[prefix+'.speed.input']!='constant'\r\n\t);\r\n};\r\nOptionsInstance.prototype.needsTransform=function(prefix){\r\n\treturn this.needsUniform(prefix) || this[prefix]!=0;\r\n};\r\n\r\nmodule.exports=OptionsBlueprint;\r\n","var Shape=function(shaderType){\r\n\tthis.shaderType=shaderType; // 'vertex' or 'face' for colors, 'light' for normals, anything else for no colors/normals\r\n};\r\nShape.prototype.dim=2;\r\nShape.prototype.twoSided=true; // triangles can be viewed from both sides\r\nShape.prototype.glPrimitive='TRIANGLES';\r\nShape.prototype.usesElements=function(){\r\n\treturn false;\r\n};\r\nShape.prototype.getNumbersPerPosition=function(){\r\n\treturn this.dim;\r\n};\r\nShape.prototype.getNumbersPerNormal=function(){\r\n\treturn (this.shaderType=='light' && this.dim==3) ? 3 : 0;\r\n};\r\nShape.prototype.getNumbersPerColor=function(){\r\n\treturn (this.shaderType=='vertex' || this.shaderType=='face') ? 3 : 0;\r\n};\r\nShape.prototype.getNumbersPerVertex=function(){\r\n\treturn this.getNumbersPerPosition()+this.getNumbersPerNormal()+this.getNumbersPerColor();\r\n};\r\nShape.prototype.writeInit=function(){\r\n\tvar c=(this.shaderType=='vertex' || this.shaderType=='face');\r\n\tvar cv=this.shaderType=='vertex';\r\n\tvar lines=this.writeArrays(c,cv);\r\n\tlines.push(\r\n\t\t\"\",\r\n\t\t\"gl.bindBuffer(gl.ARRAY_BUFFER,gl.createBuffer());\",\r\n\t\t\"gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);\",\r\n\t\t\"\"\r\n\t);\r\n\tif (this.usesElements()) {\r\n\t\tlines.push(\r\n\t\t\t\"gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,gl.createBuffer());\",\r\n\t\t\t\"gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);\",\r\n\t\t\t\"\"\r\n\t\t);\r\n\t}\r\n\tlines.push(\r\n\t\t\"var positionLoc=gl.getAttribLocation(program,'position');\"\r\n\t);\r\n\tif (c) {\r\n\t\tlines.push(\r\n\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\"\tpositionLoc,\"+this.dim+\",gl.FLOAT,false,\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*\"+(this.dim+3)+\",\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*0\",\r\n\t\t\t\");\",\r\n\t\t\t\"gl.enableVertexAttribArray(positionLoc);\",\r\n\t\t\t\"\",\r\n\t\t\t\"var colorLoc=gl.getAttribLocation(program,'color');\",\r\n\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\"\tcolorLoc,3,gl.FLOAT,false,\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*\"+(this.dim+3)+\",\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*\"+this.dim,\r\n\t\t\t\");\",\r\n\t\t\t\"gl.enableVertexAttribArray(colorLoc);\"\r\n\t\t);\r\n\t} else if (this.dim>2 && this.shaderType=='light') {\r\n\t\tlines.push(\r\n\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\"\tpositionLoc,\"+this.dim+\",gl.FLOAT,false,\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*\"+(this.dim+3)+\",\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*0\",\r\n\t\t\t\");\",\r\n\t\t\t\"gl.enableVertexAttribArray(positionLoc);\",\r\n\t\t\t\"\",\r\n\t\t\t\"var normalLoc=gl.getAttribLocation(program,'normal');\",\r\n\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\"\tnormalLoc,3,gl.FLOAT,false,\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*\"+(this.dim+3)+\",\",\r\n\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*\"+this.dim,\r\n\t\t\t\");\",\r\n\t\t\t\"gl.enableVertexAttribArray(normalLoc);\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"gl.vertexAttribPointer(positionLoc,\"+this.dim+\",gl.FLOAT,false,0,0);\",\r\n\t\t\t\"gl.enableVertexAttribArray(positionLoc);\"\r\n\t\t);\r\n\t}\r\n\treturn lines;\r\n};\r\nShape.prototype.writeDraw=function(){\r\n\tif (this.usesElements()) {\r\n\t\treturn [\"gl.drawElements(gl.\"+this.glPrimitive+\",nElements,gl.UNSIGNED_SHORT,0);\"];\r\n\t} else {\r\n\t\treturn [\"gl.drawArrays(gl.\"+this.glPrimitive+\",0,nVertices);\"];\r\n\t}\r\n};\r\n\r\nvar Square=function(shaderType){\r\n\tShape.call(this,shaderType);\r\n};\r\nSquare.prototype=Object.create(Shape.prototype);\r\nSquare.prototype.constructor=Square;\r\nSquare.prototype.glPrimitive='TRIANGLE_FAN';\r\nSquare.prototype.writeArrays=function(c,cv){\r\n\treturn [\r\n\t\t\"var nVertices=4;\",\r\n\t\t\"var vertices=new Float32Array([\",\r\n\t\t\"\t// x    y\"+(c?   \"    r    g    b\":\"\"),\r\n\t\t\"\t-0.5,-0.5,\"+(c?cv?\" 1.0, 0.0, 0.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"\t+0.5,-0.5,\"+(c?cv?\" 0.0, 1.0, 0.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"\t+0.5,+0.5,\"+(c?cv?\" 0.0, 0.0, 1.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"\t-0.5,+0.5,\"+(c?cv?\" 1.0, 1.0, 0.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"]);\",\r\n\t];\r\n};\r\n\r\nvar Triangle=function(shaderType){\r\n\tShape.call(this,shaderType);\r\n};\r\nTriangle.prototype=Object.create(Shape.prototype);\r\nTriangle.prototype.constructor=Triangle;\r\nTriangle.prototype.writeArrays=function(c,cv){\r\n\treturn [\r\n\t\t\"var nVertices=3;\",\r\n\t\t\"var vertices=new Float32Array([\",\r\n\t\t\"\t//                   x                      y\"+(c?\"    r    g    b\":\"\"),\r\n\t\t\"\t-Math.sin(0/3*Math.PI), Math.cos(0/3*Math.PI),\"+(c?cv?\" 1.0, 0.0, 0.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"\t-Math.sin(2/3*Math.PI), Math.cos(2/3*Math.PI),\"+(c?cv?\" 0.0, 1.0, 0.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"\t-Math.sin(4/3*Math.PI), Math.cos(4/3*Math.PI),\"+(c?cv?\" 0.0, 0.0, 1.0,\":\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\"]);\",\r\n\t];\r\n};\r\n\r\nvar Gasket=function(shaderType,depth){\r\n\tShape.call(this,shaderType);\r\n\tthis.depth=depth;\r\n};\r\nGasket.prototype=Object.create(Shape.prototype);\r\nGasket.prototype.constructor=Gasket;\r\nGasket.prototype.storeFn='storeGasketVertices';\r\nGasket.prototype.writeArrays=function(c,cv){\r\n\tlines=[];\r\n\tif (this.depth.changes) {\r\n\t\tlines.push(\r\n\t\t\t\"var minGasketDepth=\"+this.depth.min+\";\",\r\n\t\t\t\"var maxGasketDepth=\"+this.depth.max+\";\",\r\n\t\t\t\"var nMaxVertices=Math.pow(3,maxGasketDepth)*3;\",\r\n\t\t\t\"var vertices=new Float32Array(nMaxVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\"var gasketDepth,nVertices;\",\r\n\t\t\t\"function \"+this.storeFn+\"(newGasketDepth) {\",\r\n\t\t\t\"\tgasketDepth=newGasketDepth;\",\r\n\t\t\t\"\tnVertices=Math.pow(3,gasketDepth)*3;\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"var gasketDepth=\"+this.depth.value+\";\",\r\n\t\t\t\"var nVertices=Math.pow(3,gasketDepth)*3;\",\r\n\t\t\t\"var vertices=new Float32Array(nVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\"function storeGasketVertices() {\"\r\n\t\t);\r\n\t}\r\n\tlines.push(\r\n\t\t\"\tvar iv=0;\"\r\n\t);\r\n\tif (this.shaderType=='face') {\r\n\t\tlines.push(\r\n\t\t\t\"\tvar ic=0;\",\r\n\t\t\t\"\tvar colors=[\",\r\n\t\t\t\"\t\t[1.0, 0.0, 0.0],\",\r\n\t\t\t\"\t\t[0.0, 1.0, 0.0],\",\r\n\t\t\t\"\t\t[0.0, 0.0, 1.0],\",\r\n\t\t\t\"\t\t[1.0, 1.0, 0.0],\",\r\n\t\t\t\"\t];\"\r\n\t\t);\r\n\t}\r\n\tif (this.shaderType=='vertex') {\r\n\t\tlines.push(\r\n\t\t\t\"\tfunction pushVertex(v,r,g,b) {\",\r\n\t\t\t\"\t\tvertices[iv++]=v[0]; vertices[iv++]=v[1];\",\r\n\t\t\t\"\t\tvertices[iv++]=r; vertices[iv++]=g; vertices[iv++]=b;\",\r\n\t\t\t\"\t}\"\r\n\t\t);\r\n\t} else if (this.shaderType=='face') {\r\n\t\tlines.push(\r\n\t\t\t\"\tfunction pushVertex(v,c) {\",\r\n\t\t\t\"\t\tvertices[iv++]=v[0]; vertices[iv++]=v[1];\",\r\n\t\t\t\"\t\tvertices[iv++]=c[0]; vertices[iv++]=c[1]; vertices[iv++]=c[2];\",\r\n\t\t\t\"\t}\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"\tfunction pushVertex(v) {\",\r\n\t\t\t\"\t\tvertices[iv++]=v[0]; vertices[iv++]=v[1];\",\r\n\t\t\t\"\t}\"\r\n\t\t);\r\n\t}\r\n\tlines.push(\r\n\t\t\"\tfunction mix(a,b,m) {\",\r\n\t\t\"\t\treturn [\",\r\n\t\t\"\t\t\ta[0]*(1-m)+b[0]*m,\",\r\n\t\t\"\t\t\ta[1]*(1-m)+b[1]*m,\",\r\n\t\t\"\t\t];\",\r\n\t\t\"\t}\",\r\n\t\t\"\tfunction triangle(depth,a,b,c) {\",\r\n\t\t\"\t\tif (depth<=0) {\"\r\n\t);\r\n\tif (this.shaderType=='vertex') {\r\n\t\tlines.push(\r\n\t\t\t\"\t\t\tpushVertex(a,1.0,0.0,0.0);\",\r\n\t\t\t\"\t\t\tpushVertex(b,0.0,1.0,0.0);\",\r\n\t\t\t\"\t\t\tpushVertex(c,0.0,0.0,1.0);\"\r\n\t\t);\r\n\t} else if (this.shaderType=='face') {\r\n\t\tlines.push(\r\n\t\t\t\"\t\t\tpushVertex(a,colors[ic]);\",\r\n\t\t\t\"\t\t\tpushVertex(b,colors[ic]);\",\r\n\t\t\t\"\t\t\tpushVertex(c,colors[ic]);\",\r\n\t\t\t\"\t\t\tic=(ic+1)%colors.length;\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"\t\t\tpushVertex(a);\",\r\n\t\t\t\"\t\t\tpushVertex(b);\",\r\n\t\t\t\"\t\t\tpushVertex(c);\"\r\n\t\t);\r\n\t}\r\n\tlines.push(\r\n\t\t\"\t\t} else {\",\r\n\t\t\"\t\t\tvar ab=mix(a,b,0.5);\",\r\n\t\t\"\t\t\tvar bc=mix(b,c,0.5);\",\r\n\t\t\"\t\t\tvar ca=mix(c,a,0.5);\",\r\n\t\t\"\t\t\ttriangle(depth-1,a,ab,ca);\",\r\n\t\t\"\t\t\ttriangle(depth-1,b,bc,ab);\",\r\n\t\t\"\t\t\ttriangle(depth-1,c,ca,bc);\",\r\n\t\t\"\t\t}\",\r\n\t\t\"\t}\",\r\n\t\t\"\ttriangle(\",\r\n\t\t\"\t\tgasketDepth,\",\r\n\t\t\"\t\t[-Math.sin(0/3*Math.PI),Math.cos(0/3*Math.PI)],\",\r\n\t\t\"\t\t[-Math.sin(2/3*Math.PI),Math.cos(2/3*Math.PI)],\",\r\n\t\t\"\t\t[-Math.sin(4/3*Math.PI),Math.cos(4/3*Math.PI)]\",\r\n\t\t\"\t);\",\r\n\t\t\"}\"\r\n\t);\r\n\tif (this.depth.changes) {\r\n\t\tlines.push(\r\n\t\t\tthis.storeFn+\"(\"+this.depth.value+\");\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\tthis.storeFn+\"();\"\r\n\t\t);\r\n\t}\r\n\treturn lines;\r\n};\r\n\r\nvar Cube=function(shaderType){\r\n\tShape.call(this,shaderType);\r\n};\r\nCube.prototype=Object.create(Shape.prototype);\r\nCube.prototype.constructor=Cube;\r\nCube.prototype.dim=3;\r\nCube.prototype.twoSided=false;\r\nCube.prototype.usesElements=function(){\r\n\treturn true;\r\n};\r\nCube.prototype.writeArrays=function(c,cv){\r\n\tif (this.shaderType=='face' || this.shaderType=='light') {\r\n\t\tvar n=this.shaderType=='light';\r\n\t\treturn [\r\n\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\"\t// x    y    z \"+(n?\" n.x  n.y  n.z \":\"   r    g    b\"),\r\n\t\t\t\"\t-0.5,-0.5,-0.5,\"+(n?\"-1.0, 0.0, 0.0,\":\" 1.0, 0.0, 0.0,\")+\" // left face\",\r\n\t\t\t\"\t-0.5,-0.5,+0.5,\"+(n?\"-1.0, 0.0, 0.0,\":\" 1.0, 0.0, 0.0,\"),\r\n\t\t\t\"\t-0.5,+0.5,-0.5,\"+(n?\"-1.0, 0.0, 0.0,\":\" 1.0, 0.0, 0.0,\"),\r\n\t\t\t\"\t-0.5,+0.5,+0.5,\"+(n?\"-1.0, 0.0, 0.0,\":\" 1.0, 0.0, 0.0,\"),\r\n\t\t\t\"\t+0.5,-0.5,-0.5,\"+(n?\"+1.0, 0.0, 0.0,\":\" 0.0, 1.0, 0.0,\")+\" // right face\",\r\n\t\t\t\"\t+0.5,+0.5,-0.5,\"+(n?\"+1.0, 0.0, 0.0,\":\" 0.0, 1.0, 0.0,\"),\r\n\t\t\t\"\t+0.5,-0.5,+0.5,\"+(n?\"+1.0, 0.0, 0.0,\":\" 0.0, 1.0, 0.0,\"),\r\n\t\t\t\"\t+0.5,+0.5,+0.5,\"+(n?\"+1.0, 0.0, 0.0,\":\" 0.0, 1.0, 0.0,\"),\r\n\t\t\t\"\t-0.5,-0.5,-0.5,\"+(n?\" 0.0,-1.0, 0.0,\":\" 1.0, 1.0, 0.0,\")+\" // bottom face\",\r\n\t\t\t\"\t+0.5,-0.5,-0.5,\"+(n?\" 0.0,-1.0, 0.0,\":\" 1.0, 1.0, 0.0,\"),\r\n\t\t\t\"\t-0.5,-0.5,+0.5,\"+(n?\" 0.0,-1.0, 0.0,\":\" 1.0, 1.0, 0.0,\"),\r\n\t\t\t\"\t+0.5,-0.5,+0.5,\"+(n?\" 0.0,-1.0, 0.0,\":\" 1.0, 1.0, 0.0,\"),\r\n\t\t\t\"\t-0.5,+0.5,-0.5,\"+(n?\" 0.0,+1.0, 0.0,\":\" 0.0, 0.0, 1.0,\")+\" // top face\",\r\n\t\t\t\"\t-0.5,+0.5,+0.5,\"+(n?\" 0.0,+1.0, 0.0,\":\" 0.0, 0.0, 1.0,\"),\r\n\t\t\t\"\t+0.5,+0.5,-0.5,\"+(n?\" 0.0,+1.0, 0.0,\":\" 0.0, 0.0, 1.0,\"),\r\n\t\t\t\"\t+0.5,+0.5,+0.5,\"+(n?\" 0.0,+1.0, 0.0,\":\" 0.0, 0.0, 1.0,\"),\r\n\t\t\t\"\t-0.5,-0.5,-0.5,\"+(n?\" 0.0, 0.0,-1.0,\":\" 1.0, 0.0, 1.0,\")+\" // back face\",\r\n\t\t\t\"\t-0.5,+0.5,-0.5,\"+(n?\" 0.0, 0.0,-1.0,\":\" 1.0, 0.0, 1.0,\"),\r\n\t\t\t\"\t+0.5,-0.5,-0.5,\"+(n?\" 0.0, 0.0,-1.0,\":\" 1.0, 0.0, 1.0,\"),\r\n\t\t\t\"\t+0.5,+0.5,-0.5,\"+(n?\" 0.0, 0.0,-1.0,\":\" 1.0, 0.0, 1.0,\"),\r\n\t\t\t\"\t-0.5,-0.5,+0.5,\"+(n?\" 0.0, 0.0,+1.0,\":\" 0.0, 1.0, 1.0,\")+\" // front face\",\r\n\t\t\t\"\t+0.5,-0.5,+0.5,\"+(n?\" 0.0, 0.0,+1.0,\":\" 0.0, 1.0, 1.0,\"),\r\n\t\t\t\"\t-0.5,+0.5,+0.5,\"+(n?\" 0.0, 0.0,+1.0,\":\" 0.0, 1.0, 1.0,\"),\r\n\t\t\t\"\t+0.5,+0.5,+0.5,\"+(n?\" 0.0, 0.0,+1.0,\":\" 0.0, 1.0, 1.0,\"),\r\n\t\t\t\"]);\",\r\n\t\t\t\"var nElements=36;\",\r\n\t\t\t\"var elements=new Uint16Array([\",\r\n\t\t\t\"\t 0,  1,  2,  2,  1,  3, // left face\",\r\n\t\t\t\"\t 4,  5,  6,  6,  5,  7, // right face\",\r\n\t\t\t\"\t 8,  9, 10, 10,  9, 11, // bottom face\",\r\n\t\t\t\"\t12, 13, 14, 14, 13, 15, // top face\",\r\n\t\t\t\"\t16, 17, 18, 18, 17, 19, // back face\",\r\n\t\t\t\"\t20, 21, 22, 22, 21, 23, // front face\",\r\n\t\t\t\"]);\",\r\n\t\t];\r\n\t} else {\r\n\t\treturn [\r\n\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\"\t// x    y    z\"+(c?\"    r    g    b\":\"\"),\r\n\t\t\t\"\t-0.5,-0.5,-0.5,\"+(c?\" 0.0, 0.0, 0.0,\":\"\"),\r\n\t\t\t\"\t+0.5,-0.5,-0.5,\"+(c?\" 1.0, 0.0, 0.0,\":\"\"),\r\n\t\t\t\"\t-0.5,+0.5,-0.5,\"+(c?\" 0.0, 1.0, 0.0,\":\"\"),\r\n\t\t\t\"\t+0.5,+0.5,-0.5,\"+(c?\" 1.0, 1.0, 0.0,\":\"\"),\r\n\t\t\t\"\t-0.5,-0.5,+0.5,\"+(c?\" 0.0, 0.0, 1.0,\":\"\"),\r\n\t\t\t\"\t+0.5,-0.5,+0.5,\"+(c?\" 1.0, 0.0, 1.0,\":\"\"),\r\n\t\t\t\"\t-0.5,+0.5,+0.5,\"+(c?\" 0.0, 1.0, 1.0,\":\"\"),\r\n\t\t\t\"\t+0.5,+0.5,+0.5,\"+(c?\" 1.0, 1.0, 1.0,\":\"\"),\r\n\t\t\t\"]);\",\r\n\t\t\t\"var nElements=36;\",\r\n\t\t\t\"var elements=new Uint16Array([\",\r\n\t\t\t\"\t4, 6, 0, 0, 6, 2, // left face\",\r\n\t\t\t\"\t1, 3, 5, 5, 3, 7, // right face\",\r\n\t\t\t\"\t0, 1, 4, 4, 1, 5, // bottom face\",\r\n\t\t\t\"\t2, 6, 3, 3, 6, 7, // top face\",\r\n\t\t\t\"\t0, 2, 1, 1, 2, 3, // back face\",\r\n\t\t\t\"\t5, 7, 4, 4, 7, 6, // front face\",\r\n\t\t\t\"]);\",\r\n\t\t];\r\n\t}\r\n};\r\n\r\nvar Hat=function(shaderType,resolution){\r\n\tShape.call(this,shaderType);\r\n\tthis.resolution=resolution;\r\n};\r\nHat.prototype=Object.create(Shape.prototype);\r\nHat.prototype.constructor=Hat;\r\nHat.prototype.dim=3;\r\nHat.prototype.storeFn=\"storeHatVerticesAndElements\";\r\nHat.prototype.usesElements=function(){\r\n\treturn this.shaderType!='face';\r\n};\r\nHat.prototype.writeArrays=function(c,cv){\r\n\tlines=[];\r\n\tif (this.resolution.changes) {\r\n\t\tlines.push(\r\n\t\t\t\"var minHatResolution=\"+this.resolution.min+\";\",\r\n\t\t\t\"var maxHatResolution=\"+this.resolution.max+\";\"\r\n\t\t);\r\n\t\tif (this.shaderType!='face') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var nMaxVertices=(maxHatResolution+1)*(maxHatResolution+1);\",\r\n\t\t\t\t\"var vertices=new Float32Array(nMaxVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\"var nMaxElements=maxHatResolution*maxHatResolution*6;\",\r\n\t\t\t\t\"var elements=new Uint16Array(nMaxElements);\",\r\n\t\t\t\t\"var hatResolution,nVertices,nElements;\",\r\n\t\t\t\t\"function \"+this.storeFn+\"(newHatResolution) {\",\r\n\t\t\t\t\"\thatResolution=newHatResolution;\",\r\n\t\t\t\t\"\tnVertices=(hatResolution+1)*(hatResolution+1);\",\r\n\t\t\t\t\"\tnElements=hatResolution*hatResolution*6;\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var nMaxVertices=maxHatResolution*maxHatResolution*6;\",\r\n\t\t\t\t\"var vertices=new Float32Array(nMaxVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\"var hatResolution,nVertices;\",\r\n\t\t\t\t\"function \"+this.storeFn+\"(newHatResolution) {\",\r\n\t\t\t\t\"\thatResolution=newHatResolution;\",\r\n\t\t\t\t\"\tnVertices=hatResolution*hatResolution*6;\"\r\n\t\t\t);\r\n\t\t}\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"var hatResolution=\"+this.resolution.value+\";\"\r\n\t\t);\r\n\t\tif (this.shaderType!='face') {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var nVertices=(hatResolution+1)*(hatResolution+1);\",\r\n\t\t\t\t\"var vertices=new Float32Array(nVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\"var nElements=hatResolution*hatResolution*6;\",\r\n\t\t\t\t\"var elements=new Uint16Array(nElements);\",\r\n\t\t\t\t\"function \"+this.storeFn+\"() {\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.push(\r\n\t\t\t\t\"var nVertices=hatResolution*hatResolution*6;\",\r\n\t\t\t\t\"var vertices=new Float32Array(nVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\"function \"+this.storeFn+\"() {\"\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tlines.push(\r\n\t\t\"\tvar xyRange=4;\",\r\n\t\t\"\tvar xyScale=1/(4*Math.sqrt(2));\"\r\n\t);\r\n\tif (this.shaderType!='face') {\r\n\t\tlines.push(\r\n\t\t\t\"\tfunction vertexElement(i,j) {\",\r\n\t\t\t\"\t\treturn i*(hatResolution+1)+j;\",\r\n\t\t\t\"\t}\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"\tfunction vertexElement(i,j,k) {\",\r\n\t\t\t\"\t\treturn (i*hatResolution+j)*6+k;\",\r\n\t\t\t\"\t}\"\r\n\t\t);\r\n\t}\r\n\tif (this.getNumbersPerNormal()) {\r\n\t\tlines.push(\r\n\t\t\t\"\tfunction normalize(v) {\",\r\n\t\t\t\"\t\tvar l=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);\",\r\n\t\t\t\"\t\treturn [v[0]/l,v[1]/l,v[2]/l];\",\r\n\t\t\t\"\t}\"\r\n\t\t);\r\n\t}\r\n\tif (c) {\r\n\t\tlines.push(\r\n\t\t\t\"\tvar colors=[\",\r\n\t\t\t\"\t\t[1.0, 1.0, 0.0],\",\r\n\t\t\t\"\t\t[1.0, 0.0, 0.0],\",\r\n\t\t\t\"\t\t[0.0, 1.0, 0.0],\",\r\n\t\t\t\"\t\t[0.0, 0.0, 1.0],\",\r\n\t\t\t\"\t];\"\r\n\t\t);\r\n\t}\r\n\tvar innerLines=[];\r\n\tinnerLines.push(\r\n\t\t\"var r2=(x*x+y*y)/2;\",\r\n\t\t\"var A=Math.exp(-r2)/Math.PI;\",\r\n\t\t\"var z=A*(1-r2);\",\r\n\t\t\"vertices[vertexOffset+0]=x*xyScale;\",\r\n\t\t\"vertices[vertexOffset+1]=y*xyScale;\",\r\n\t\t\"vertices[vertexOffset+2]=z;\"\r\n\t);\r\n\tif (this.getNumbersPerNormal()) {\r\n\t\tinnerLines.push(\r\n\t\t\t\"var normal=normalize([(z+A)*x/xyScale,(z+A)*y/xyScale,1]);\",\r\n\t\t\t\"vertices[vertexOffset+3]=normal[0];\",\r\n\t\t\t\"vertices[vertexOffset+4]=normal[1];\",\r\n\t\t\t\"vertices[vertexOffset+5]=normal[2];\"\r\n\t\t);\r\n\t} else if (c) {\r\n\t\tinnerLines.push(\r\n\t\t\t\"var ic=(i&1)*2+(j&1);\",\r\n\t\t\t\"vertices[vertexOffset+3]=colors[ic][0];\",\r\n\t\t\t\"vertices[vertexOffset+4]=colors[ic][1];\",\r\n\t\t\t\"vertices[vertexOffset+5]=colors[ic][2];\"\r\n\t\t);\r\n\t}\r\n\tif (this.shaderType!='face') {\r\n\t\tlines.push(\r\n\t\t\t\"\tvar i,j;\",\r\n\t\t\t\"\tfor (i=0;i<=hatResolution;i++) {\",\r\n\t\t\t\"\t\tvar y=i/hatResolution*xyRange*2-xyRange;\",\r\n\t\t\t\"\t\tfor (j=0;j<=hatResolution;j++) {\",\r\n\t\t\t\"\t\t\tvar x=j/hatResolution*xyRange*2-xyRange;\",\r\n\t\t\t\"\t\t\tvar vertexOffset=vertexElement(i,j)*\"+this.getNumbersPerVertex()+\";\"\r\n\t\t);\r\n\t\tinnerLines.forEach(function(innerLine){\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\t\t\t\"+innerLine\r\n\t\t\t);\r\n\t\t});\r\n\t\tlines.push(\r\n\t\t\t\"\t\t}\",\r\n\t\t\t\"\t}\",\r\n\t\t\t\"\tfor (i=0;i<hatResolution;i++) {\",\r\n\t\t\t\"\t\tfor (j=0;j<hatResolution;j++) {\",\r\n\t\t\t\"\t\t\tvar elementOffset=(i*hatResolution+j)*6;\",\r\n\t\t\t\"\t\t\telements[elementOffset+0]=vertexElement(i+0,j+0);\",\r\n\t\t\t\"\t\t\telements[elementOffset+1]=vertexElement(i+0,j+1);\",\r\n\t\t\t\"\t\t\telements[elementOffset+2]=vertexElement(i+1,j+0);\",\r\n\t\t\t\"\t\t\telements[elementOffset+3]=vertexElement(i+1,j+0);\",\r\n\t\t\t\"\t\t\telements[elementOffset+4]=vertexElement(i+0,j+1);\",\r\n\t\t\t\"\t\t\telements[elementOffset+5]=vertexElement(i+1,j+1);\",\r\n\t\t\t\"\t\t}\",\r\n\t\t\t\"\t}\",\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\t\"\tfor (var i=0;i<=hatResolution;i++) {\",\r\n\t\t\t\"\t\tfor (var j=0;j<=hatResolution;j++) {\",\r\n\t\t\t\"\t\t\tfor (var k=0;k<6;k++) {\",\r\n\t\t\t\"\t\t\t\tvar di=[0,0,1,1,0,1][k];\",\r\n\t\t\t\"\t\t\t\tvar dj=[0,1,0,0,1,1][k];\",\r\n\t\t\t\"\t\t\t\tvar y=(i+di)/hatResolution*xyRange*2-xyRange;\",\r\n\t\t\t\"\t\t\t\tvar x=(j+dj)/hatResolution*xyRange*2-xyRange;\",\r\n\t\t\t\"\t\t\t\tvar vertexOffset=vertexElement(i,j,k)*\"+this.getNumbersPerVertex()+\";\"\r\n\t\t);\r\n\t\tinnerLines.forEach(function(innerLine){\r\n\t\t\tlines.push(\r\n\t\t\t\t\"\t\t\t\t\"+innerLine\r\n\t\t\t);\r\n\t\t});\r\n\t\tlines.push(\r\n\t\t\t\"\t\t\t}\",\r\n\t\t\t\"\t\t}\",\r\n\t\t\t\"\t}\",\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t}\r\n\tif (this.resolution.changes) {\r\n\t\tlines.push(\r\n\t\t\t\"\"+this.storeFn+\"(\"+this.resolution.value+\");\"\r\n\t\t);\r\n\t} else {\r\n\t\tlines.push(\r\n\t\t\tthis.storeFn+\"();\"\r\n\t\t);\r\n\t}\r\n\treturn lines;\r\n};\r\n\r\nexports.Square=Square;\r\nexports.Triangle=Triangle;\r\nexports.Gasket=Gasket;\r\nexports.Cube=Cube;\r\nexports.Hat=Hat;\r\n"],"sourceRoot":"."}