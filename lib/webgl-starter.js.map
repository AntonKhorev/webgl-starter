{"version":3,"sources":["webgl-starter.js","node_modules/browserify/node_modules/browser-pack/_prelude.js","src/background.js","src/base/option-classes.js","src/base/options.js","src/call-vector.js","src/canvas.js","src/code.js","src/colorgen.js","src/feature-context.js","src/feature.js","src/fixed-options-helpers.js","src/glsl-vector.js","src/i18n.js","src/illumination.js","src/input-classes.js","src/int-feature.js","src/lines.js","src/listener-classes.js","src/main.js","src/numeric-feature.js","src/option-classes.js","src/options.js","src/shape-classes.js","src/shapes/cube.js","src/shapes/gasket.js","src/shapes/hat.js","src/shapes/lodshape.js","src/shapes/mesh.js","src/shapes/shape.js","src/shapes/square.js","src/shapes/terrain.js","src/shapes/triangle.js","src/transforms.js","src/vector-component.js","src/vector.js"],"names":["babelHelpers","typeof","obj","Symbol","constructor","createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","classCallCheck","instance","TypeError","possibleConstructorReturn","self","call","ReferenceError","inherits","subClass","superClass","defaults","keys","getOwnPropertyNames","value","getOwnPropertyDescriptor","undefined","create","e","t","n","r","s","o","u","a","require","f","Error","code","l","exports",1,"module","Feature","CallVector","Background","_Feature","options","this","_this","isSolid","type","features","push","color","getJsLoopLines","featureContext","lines","./call-vector.js","./feature.js","./lines.js",2,"Base","name","_","isVisible","updateCallback","fullName","_$","updateVisibility","$","toggle","get","set","Input","_Base","data","availableValues","defaultValue","_value","fix","FactorInput","_Input","_this2","RangeInput","_Input2","availableRange","_this3","availableMin","availableMax","Collection","_Base2","entries","_this4","forEach","entry","subData","fixFromIterateOver","iterateOver","defineFn","fn","callback","thisArg","vci","apply","map","every","some","Checkbox","_Input3","Select","_FactorInput","arguments","Root","_Collection","Group","_Collection2","Array","_Base3","availableTypes","availableConstructors","_this9","_entries","entryTypeAndValue","entryType","entryValue","addEntry",3,"Options","simpleUpdateCallback","Option","optionClasses","optionByFullName","optionsWithVisibilityAffectedByFullName","simpleMakeEntry","description","fullNamePath","className","ctorArgsDescription","slice","contents","nScalars","nArrays","arg","isArray","ctorArgs","option","Function","bind","makeEntry","defaultValueOrConstructors","visibilityData","nObjects","x","subName","testName","indexOf","root","entriesDescription","./option-classes.js",4,"Lines","Vector","_Vector","values","calledFn","calledFnDefaultArgs","getJsUpdateLines","componentValue","nValueSliders","components","component","input","modeConstant","join","dotIndex","lastIndexOf","suffixArray","suffix","addPostToListenerEntryAfterComponents","post","./fixed-options-helpers.js","./vector.js",5,"Listener","IntFeature","Canvas","width","height","getHtmlCanvasLines","getGlslVertexDeclarationLines","hasInputs","getGlslVertexOutputLines","needAspectConstant","Number","providesAspect","getJsInitLines","canvasUpdater","canvasListener","wh","listener","Slider","enter","log","getListenerLines","./int-feature.js","./listener-classes.js",6,"Shape","FeatureContext","Transforms","Illumination","i18n","makeShape","shape","charAt","toUpperCase","light","material","scope","illumination","getColorAttrs","getHtmlStyleLines","hasSliders","wrapIfNotEmpty","getVertexShaderLines","needTransformedPosition","wantsTransformedPosition","transforms","eyeAtInfinity","canvas","dim","hasNormals","getGlslVertexNormalTransformLines","wrap","getFragmentShaderLines","getGlslFragmentDeclarationLines","getGlslFragmentOutputLines","twoSided","getHtmlControlMessageLines","feature","getHtmlInputLines","getMakeProgramLines","debugShaders","addWithCommentIfNotEmpty","featureLines","comment","featureNames","getJsAfterInitLines","innerLines","hasClampFn","hasWrapFn","pollsGamepad","hasStartTime","hasPrevTime","isAnimated","hasTime","indent","debug","background","requestFeatureContext","scriptLines","interleave","formatting","parseInt","./background.js","./canvas.js","./feature-context.js","./illumination.js","./shape-classes.js","./transforms.js",7,"colorgenCounter","SingleColorgen","weight","noise","baseColors","defaultBaseColors","colorgenNumber","nextIndex","getNextColorString","baseColor","ci","Math","sin","co","toFixed","Colorgen","colorAttrs","singleColorgens","attr","getHeaderString","singleColorgen",8,"debugOptions","canvasMousemoveListener","CanvasMousemove","write","inputs",9,"getRecursiveLines","method","args",10,"extendCollection","fixedOptionGroup","additionalEntriesDescription","AdditionalOptions","_Options","additionalOptions","fog","afog","v","c","concat","makeCollection","names","EmptyOptions","_Options2","emptyOptions","makeFormatNumber","contextNumber","nonnegativeLimits","lead","max","String","abs","split","splitStep","step","prec","spaces","fmt","formatNumber","number","capNumber","maxValue","capped","min",11,"fixOptHelp","GlslVector","wrapMode","getGlslDeclarationLines","modeFloats","nVars","varName","_ret","variable","getGlslValue","getGlslComponentsValue","selectedComponents","allSuffixString","results","showResult","result","componentsBySuffix","modeVector","allSameConstant","cmp","j","prevResult","pop","getGlslMapDeclarationLines","mapName","mapFn","getGlslMapComponentValue","selectedComponent","getJsDeclarationLines","varNameLoc","addPostToListenerEntryForComponent","vs",12,"toString","replace","plural","word","expandIdAndString","id","string","match","expandRegexp","exec","idStart","idMids","idEnd","stringStart","stringMids","stringEnd","idMid","stringMid","strings","plainValue","pixelValue","dataStrings","message.hljs","message.elements","options.canvas","options.canvas.{width,height}","options.canvas.{width,height}.value","options.background","options.background.type","options.background.type.none","options.background.type.solid","options.background.color","options.background.color.{r,g,b,a}","options.background.color.{r,g,b,a}.value","options.background.color.{r,g,b,a}.speed","options.background.color.{r,g,b,a}.speed.value","options.material","options.material.scope","options.material.scope.global","options.material.scope.vertex","options.material.scope.face","options.material.data","options.material.data.one","options.material.data.sda","options.material.color","options.material.color.{r,g,b,a}","options.material.color.{r,g,b,a}.value","options.material.color.{r,g,b,a}.speed","options.material.color.{r,g,b,a}.speed.value","options.material.{specular,diffuse,ambient}Color","options.material.{specular,diffuse,ambient}Color.{r,g,b}","options.material.{specular,diffuse,ambient}Color.{r,g,b}.value","options.material.{specular,diffuse,ambient}Color.{r,g,b}.speed","options.material.{specular,diffuse,ambient}Color.{r,g,b}.speed.value","options.light","options.light.type","options.light.type.off","options.light.type.phong","options.light.type.blinn","options.light.direction","options.light.direction.{x,y,z}","options.light.direction.{x,y,z}.value","options.light.direction.{x,y,z}.speed","options.light.direction.{x,y,z}.speed.value","options.shape","options.shape.type","options.shape.type.square","options.shape.type.triangle","options.shape.type.gasket","options.shape.type.cube","options.shape.type.hat","options.shape.type.terrain","options.shape.elements","options.shape.elements.0","options.shape.elements.{8,16,32}","options.shape.lod","options.shape.lod.value","options.transforms","options.transforms.projection","options.transforms.projection.ortho","options.transforms.projection.perspective","options.transforms.model","options.transforms.model.rotate.{x,y,z}.add","options.transforms.model.rotate.{x,y,z}","options.transforms.model.rotate.{x,y,z}.value","options.transforms.model.rotate.{x,y,z}.speed","options.transforms.model.rotate.{x,y,z}.speed.value","options.debug","options.debug.shaders","options.debug.arrays","options.debug.inputs","options.debug.animations","options.formatting","options.formatting.indent","options.formatting.indent.tab","options.formatting.indent.{2,4,8}","ui.inputs","ui.inputs.constant","ui.inputs.slider","ui.inputs.mousemove{x,y}","ui.inputs.gamepad{0,1,2,3}","ui.range","ui.reset","ui.addSpeed","ui.drag","ui.delete","controls.type.mousemovex","controls.type.mousemovey","controls.to",13,"colorVector","specularColorVector","specularColor","diffuseColorVector","diffuseColor","ambientColorVector","ambientColor","extendedAmbientColor","lightDirectionVector","direction","enabled","hasNormalAttr","normalTransformLines","colorRGB","colorA","colorRGBA","vector","specularDotArgs","shininessCorrection","./glsl-vector.js","./options.js",14,"createFromString","str","constant","Constant","slider","mousemovex","MouseMove","mousemovey","gamepad0","Gamepad","gamepad1","gamepad2","gamepad3","_str","valueOf","Variable","_Variable","_Variable2","axis","_Variable3","_this5",15,"NumericFeature","_NumericFeature","getHtmlControlMessageForValue","./numeric-feature.js",16,"addFlattenedArgs","flattenArgs","lastLine","level","line","isEmpty","first","begin","end","unshift",17,"makePushArgs","where","proxy","pre","cond","_cond","innerPrependedLines","bracketFnArg","wrapCall","haveToUpdateCanvas","haveToLogInput","innerLinesGraph","innerLinesRoot","innerLinesPrev","WHITE","GRAY","BLACK","addInnerLine","vertex","prevs","conds","mark","closeEntryInnerLines","writeInnerLines","currentCond","writeLine","newCond","recVertex","recPrevs","br","bracketListener","MultipleSlider","query","floatHelper","minMaxFlag","varFlag","inputType","minValue","VarName","dest","prexy","xLine","yLine","minMaxFloat","minMaxVarFloat","newVarInt",18,"generateId","idCounter","getHtmlDataUri","html","encodeURIComponent","generateCode","each","updateCode","clearTimeout","codeUpdateTimeoutId","setTimeout","$code","text","window","hljs","highlightBlock","codeUpdateDelay","writeOption","append","prop","change","availableValue","val","LiveNumber","_writeOption","setInputAttrs","$input","setInputAttrsAndListeners","getOtherInput","on","checkValidity","$that","parseFloat","writeMinMaxInput","minOrMax","inputSelectId","$sliderInput","$numberInput","$inputSelect","$rangeMinInput","$rangeMaxInput","availableInputTypes","availableInputType","$range","click","LiveFloat","$addSpeed","prepend","addSpeed","checked","speed","$dragged","$entries","updateArrayEntries","children","writeDraggableOption","ev","parent","originalEvent","dataTransfer","effectAllowed","setData","setDragImage","addClass","keydown","$handle","$sorted","keyCode","prev","before","focus","next","after","remove","preventDefault","dropEffect","$target","nextAll","is","prevAll","removeClass","$buttons","writeButtons","open","$container","$options","empty","./code.js","./i18n.js",19,"./input-classes.js",20,"imports","_RangeInput","dataValue","dataMin","dataMax","dataInput","_min","_max","_input","_$range","updateInternalVisibility","exportHelper","src","fixToDefaultHelper","fixed","fixHelper","LiveInt","_LiveNumber","CanvasLiveInt","_LiveInt","_LiveNumber2","dataSpeedValue","dataSpeedMin","dataSpeedMax","dataSpeedInput","_speedValue","_speedAvailableMin","_speedMin","_speedAvailableMax","_speedMax","_speedInput","_addSpeed","_speed$","_$addSpeed","notGamepad","speedData",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":153815,"endcol":48,"endline":2741,"pos":153807,"col":40,"line":2741,"value":"fullName","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":153815,"endcol":48,"endline":2741,"pos":153807,"col":40,"line":2741,"value":"fullName","type":"name"},"name":"fullName"},"LiveColor","_Group","colorComponentDefaultValues","cs","./base/option-classes.js",21,"BaseOptions","_BaseOptions","background.type","material.scope","material.data","light.type","shape.type","./base/options.js",22,"Square","Triangle","Gasket","Cube","Hat","Terrain","./shapes/cube.js","./shapes/gasket.js","./shapes/hat.js","./shapes/square.js","./shapes/terrain.js","./shapes/triangle.js",23,"_Shape","writeArrays","colorgen","hasColorsPerFace","nCubeVertices","cubeColors","cubeVertexPositions","nCubeFaces","cubeFaceNames","cubeFaceNormals","cubeFaceVertices","quadToTriangleMap","vertexLines","appendVertex","iFace","iVertex","firstInFace","hasColorsPerVertex","usesElements","_loop","k","_loop2","getElementIndexJsArray","_ret3","elementLines","_loop3","../colorgen.js","../lines.js","./shape.js",24,"LodShape","_LodShape","getDistinctVertexCount","lodSymbol","getFaceVertexCount","getTotalVertexCount","writeStoreShape","writePushVertex","writeTriangle","writeInitialTriangleCall","writeColorData","./lodshape.js",25,"Mesh","_Mesh","writeMeshInit","writeMeshVertex","iv","writeMeshVertexColors","./mesh.js",26,"hasReflections","lod","getMaxPossibleLod","requestedMaxLod","elementIndexBits","nVerticesFn","indexLimit","m","eval","writeArraysAndBufferData","debugArrays","getNumbersPerVertex","writeDebug","writeBufferData","../fixed-options-helpers.js","../input-classes.js","../int-feature.js","../listener-classes.js",27,28,"elements","getElementIndexGlType","arrays","writeVertexAttribArrays","attrs","cmpSize","allSameSize","size","allEnabled","arrayLines","foreachEnableLines","foreachLines","glPrimitive","../feature.js",29,"colorDataForFace",30,"noFaces",31,32,"rotateVectorEntries","transformSequence","model","possibleComponents","rotate","tr","iTr","trData","transform","index","nLayers","isInGap","isStraight","lastStraightIndex","has","makeVector","i18nId","storeSequenceElement","use2dTransform","flatShape","getTransformMatricesLines","maxSuffixLength","pad","mat","rows","row","ts","projection","rve","receivesAspect",33,"capitalize","toCamelCase","w","VectorComponent","vectorName","hasSpeed","hasInput","hasInputClass","inputClass","usesStartTime","usesPrevTime","wrapReady","wrapped","clamped",34,"makeInitialComponentValue","makeUpdatedComponentValue","writeInput","opName","htmlName","getSliderListenerLines","doUpdate","getManyListenersLines","writeListener","updateFnName","getOneListenerLines","manyListenersLines","oneListenerLines","someSpeeds","someValueSliders","someGamepads","varNameSpeed","add","needUpdate","writeGamepad","dotSuffix","varSuffix","minVarName","maxVarName","sfmt","limitFn","dx","incrementLine","base","dt","varNameInput","animations","./vector-component.js"],"mappings":"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","file":"webgl-starter.js","sourcesContent":[null,"(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\r\n\r\nconst Lines=require('./lines.js');\r\nconst Feature=require('./feature.js');\r\nconst CallVector=require('./call-vector.js');\r\n\r\nclass Background extends Feature {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tthis.isSolid=(options.type=='solid');\r\n\t\tif (this.isSolid) {\r\n\t\t\tthis.features.push(\r\n\t\t\t\tnew CallVector('background.color',options.color,'gl.clearColor',[0,0,0,0])\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tgetJsLoopLines(featureContext) {\r\n\t\tconst lines=super.getJsLoopLines(featureContext);\r\n\t\tif (this.isSolid) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl.clear(gl.COLOR_BUFFER_BIT);\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Background;\r\n","'use strict';\r\n\r\n// abstract classes\r\n\r\nclass Base {\r\n\tconstructor(name,_,isVisible,updateCallback,fullName) {\r\n\t\tthis.name=name;\r\n\t\tthis.isVisible=isVisible;\r\n\t\tthis.updateCallback=updateCallback;\r\n\t\tthis.fullName=fullName;\r\n\t\tthis._$=null;\r\n\t}\r\n\tget $() {\r\n\t\treturn this._$;\r\n\t}\r\n\tset $($) {\r\n\t\tthis._$=$;\r\n\t\tthis.updateVisibility();\r\n\t}\r\n\tupdateVisibility() {\r\n\t\tif (this.$) this.$.toggle(this.isVisible());\r\n\t}\r\n}\r\n\r\nclass Input extends Base {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,availableValues,defaultValue) {\r\n\t\tsuper(name,data,isVisible,updateCallback,fullName);\r\n\t\tif (defaultValue!==undefined) {\r\n\t\t\tthis.defaultValue=defaultValue;\r\n\t\t} else {\r\n\t\t\tthis.defaultValue=availableValues[0];\r\n\t\t}\r\n\t\tif (data!==undefined) {\r\n\t\t\tthis._value=data;\r\n\t\t} else {\r\n\t\t\tthis._value=this.defaultValue;\r\n\t\t}\r\n\t}\r\n\tget value() {\r\n\t\treturn this._value;\r\n\t}\r\n\tset value(value) {\r\n\t\tthis._value=value;\r\n\t\tthis.updateCallback();\r\n\t}\r\n\texport() {\r\n\t\treturn this.value!=this.defaultValue ? this.value : null;\r\n\t}\r\n\tfix() {\r\n\t\treturn this.value;\r\n\t}\r\n}\r\n\r\nclass FactorInput extends Input {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,availableValues,defaultValue) {\r\n\t\tsuper(name,data,isVisible,updateCallback,fullName,availableValues,defaultValue);\r\n\t\tthis.availableValues=availableValues;\r\n\t}\r\n}\r\n\r\nclass RangeInput extends Input {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,availableRange,defaultValue) {\r\n\t\tsuper(name,data,isVisible,updateCallback,fullName,availableRange,defaultValue);\r\n\t\tthis.availableMin=availableRange[0];\r\n\t\tthis.availableMax=availableRange[1];\r\n\t}\r\n}\r\n\r\nclass Collection extends Base {\r\n\tconstructor(name,_,isVisible,updateCallback,fullName,entries) {\r\n\t\tsuper(name,_,isVisible,updateCallback,fullName);\r\n\t\tthis.entries=entries;\r\n\t}\r\n\texport() {\r\n\t\tconst data={};\r\n\t\tthis.entries.forEach(entry=>{\r\n\t\t\tconst subData=entry.export();\r\n\t\t\tif (subData!==null) data[entry.name]=subData;\r\n\t\t});\r\n\t\treturn Object.keys(data).length>0 ? data : null;\r\n\t}\r\n\tfixFromIterateOver(iterateOver) {\r\n\t\tconst defineFn=fn=>((callback,thisArg)=>fn.call(iterateOver,vci=>callback.apply(thisArg,vci)));\r\n\t\tconst data={\r\n\t\t\tlength: iterateOver.length,\r\n\t\t\tmap: defineFn([].map),\r\n\t\t\tevery: defineFn([].every),\r\n\t\t\tsome: defineFn([].some),\r\n\t\t\tforEach: defineFn([].forEach),\r\n\t\t};\r\n\t\titerateOver.forEach((vci)=>{\r\n\t\t\tdata[vci[1]]=vci[0];\r\n\t\t});\r\n\t\treturn data;\r\n\t}\r\n\tfix() {\r\n\t\tconst iterateOver=this.entries.map((entry,i)=>[entry.fix(),entry.name,i]);\r\n\t\treturn this.fixFromIterateOver(iterateOver);\r\n\t}\r\n}\r\n\r\n// concrete classes\r\n\r\nclass Checkbox extends Input {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,_,defaultValue) {\r\n\t\tsuper(name,data,isVisible,updateCallback,fullName,_,!!defaultValue);\r\n\t}\r\n}\r\n\r\nclass Select extends FactorInput {\r\n}\r\n\r\nclass Root extends Collection {\r\n}\r\n\r\nclass Group extends Collection {\r\n}\r\n\r\nclass Array extends Base {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,availableTypes,availableConstructors) {\r\n\t\tsuper(name,undefined,isVisible,updateCallback,fullName);\r\n\t\tthis.availableTypes=availableTypes;\r\n\t\tthis.availableConstructors=availableConstructors;\r\n\t\tthis._entries=[];\r\n\t\tif (typeof data == 'object') {\r\n\t\t\tfor (let i in data) {\r\n\t\t\t\tconst entryTypeAndValue=data[i];\r\n\t\t\t\tlet entryType,entryValue;\r\n\t\t\t\tif (typeof entryTypeAndValue == 'string') {\r\n\t\t\t\t\tentryType=entryTypeAndValue;\r\n\t\t\t\t} else if (typeof entryTypeAndValue == 'object') {\r\n\t\t\t\t\tentryType=entryTypeAndValue.type;\r\n\t\t\t\t\tentryValue=entryTypeAndValue.value;\r\n\t\t\t\t}\r\n\t\t\t\tif (availableConstructors[entryType]) {\r\n\t\t\t\t\tthis._entries.push(availableConstructors[entryType](entryValue));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget entries() {\r\n\t\treturn this._entries;\r\n\t}\r\n\tset entries(entries) {\r\n\t\tthis._entries=entries;\r\n\t\tthis.updateCallback();\r\n\t}\r\n\taddEntry(type) {\r\n\t\tconst entry=this.availableConstructors[type]();\r\n\t\tthis._entries.push(entry);\r\n\t\tthis.updateCallback();\r\n\t\treturn entry;\r\n\t}\r\n\texport() {\r\n\t\treturn this._entries.map(entry=>{\r\n\t\t\tconst subData=entry.export();\r\n\t\t\tif (subData!==null) {\r\n\t\t\t\treturn {type: entry.name, value: subData};\r\n\t\t\t} else {\r\n\t\t\t\treturn entry.name;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tfix() {\r\n\t\treturn this._entries.map(entry=>{\r\n\t\t\treturn {type: entry.name, value: entry.fix()};\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexports.Base=Base;\r\nexports.Input=Input;\r\nexports.Checkbox=Checkbox;\r\nexports.FactorInput=FactorInput;\r\nexports.RangeInput=RangeInput;\r\nexports.Collection=Collection;\r\nexports.Select=Select;\r\nexports.Root=Root;\r\nexports.Group=Group;\r\nexports.Array=Array;\r\n","'use strict';\r\n\r\nclass Options {\r\n\tconstructor(data) { // data = imported values, import is done in ctor to avoid calling updateCallback later\r\n\t\tthis.updateCallback=null; // general update callback for stuff like regenerating the code\r\n\t\tconst simpleUpdateCallback=()=>{\r\n\t\t\tif (this.updateCallback) this.updateCallback();\r\n\t\t};\r\n\t\tconst Option=this.optionClasses;\r\n\t\tconst optionByFullName={};\r\n\t\tconst optionsWithVisibilityAffectedByFullName={};\r\n\t\tconst simpleMakeEntry=(description,fullNamePath,data)=>{\r\n\t\t\tconst className=description[0];\r\n\t\t\tif (Option[className]===undefined) {\r\n\t\t\t\tthrow new Error(`invalid option type '${className}'`);\r\n\t\t\t}\r\n\t\t\tconst name=description[1];\r\n\t\t\tconst fullName=fullNamePath+name;\r\n\t\t\tconst ctorArgsDescription=description.slice(2);\r\n\t\t\tlet contents=[];\r\n\t\t\tlet defaultValue;\r\n\t\t\tlet nScalars=0;\r\n\t\t\tlet nArrays=0;\r\n\t\t\tfor (let i=0;i<ctorArgsDescription.length;i++) {\r\n\t\t\t\tlet arg=ctorArgsDescription[i];\r\n\t\t\t\tif (typeof arg == 'string' || typeof arg == 'number' || typeof arg == 'boolean') {\r\n\t\t\t\t\tif (nScalars==0) {\r\n\t\t\t\t\t\tdefaultValue=arg;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"too many scalar arguments\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnScalars++;\r\n\t\t\t\t} else if (Array.isArray(arg)) {\r\n\t\t\t\t\tif (nArrays==0) {\r\n\t\t\t\t\t\tcontents=arg;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"too many array arguments\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnArrays++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown argument type\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst ctorArgs=[null,name,data,()=>true,simpleUpdateCallback,fullName,contents,defaultValue];\r\n\t\t\tconst option=new (Function.prototype.bind.apply(Option[className],ctorArgs));\r\n\t\t\treturn option;\r\n\t\t};\r\n\t\tconst makeEntry=(description,fullNamePath,data)=>{\r\n\t\t\tconst className=description[0];\r\n\t\t\tif (Option[className]===undefined) {\r\n\t\t\t\tthrow new Error(`invalid option type '${className}'`);\r\n\t\t\t}\r\n\t\t\tconst name=description[1];\r\n\t\t\tconst fullName=fullNamePath+name;\r\n\t\t\tconst ctorArgsDescription=description.slice(2);\r\n\t\t\tlet contents=[];\r\n\t\t\tlet defaultValueOrConstructors;\r\n\t\t\tlet visibilityData={};\r\n\t\t\tlet nScalars=0;\r\n\t\t\tlet nArrays=0;\r\n\t\t\tlet nObjects=0;\r\n\t\t\tfor (let i=0;i<ctorArgsDescription.length;i++) {\r\n\t\t\t\tlet arg=ctorArgsDescription[i];\r\n\t\t\t\tif (typeof arg == 'string' || typeof arg == 'number' || typeof arg == 'boolean') {\r\n\t\t\t\t\tif (nScalars==0) {\r\n\t\t\t\t\t\tdefaultValueOrConstructors=arg;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"too many scalar arguments\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnScalars++;\r\n\t\t\t\t} else if (Array.isArray(arg)) {\r\n\t\t\t\t\tif (nArrays==0) {\r\n\t\t\t\t\t\tif (className=='Array') {\r\n\t\t\t\t\t\t\tdefaultValueOrConstructors={};\r\n\t\t\t\t\t\t\targ.forEach(x=>{\r\n\t\t\t\t\t\t\t\tconst type=x[1];\r\n\t\t\t\t\t\t\t\tcontents.push(type);\r\n\t\t\t\t\t\t\t\tdefaultValueOrConstructors[type]=subData=>simpleMakeEntry(x,fullName+'.',subData);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcontents=arg.map(x=>{\r\n\t\t\t\t\t\t\t\tif (Array.isArray(x)) {\r\n\t\t\t\t\t\t\t\t\tconst subName=x[1];\r\n\t\t\t\t\t\t\t\t\tlet subData;\r\n\t\t\t\t\t\t\t\t\tif (typeof data == 'object') subData=data[subName];\r\n\t\t\t\t\t\t\t\t\treturn makeEntry(x,fullName+'.',subData); // nested option\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treturn x; // available value / value range boundary\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"too many array arguments\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnArrays++;\r\n\t\t\t\t} else if (arg instanceof Object) {\r\n\t\t\t\t\tif (nObjects==0) {\r\n\t\t\t\t\t\tvisibilityData=arg;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"too many array arguments\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnObjects++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown argument type\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst isVisible=()=>{\r\n\t\t\t\tfor (let testName in visibilityData) {\r\n\t\t\t\t\tconst value=optionByFullName[testName].value;\r\n\t\t\t\t\tif (visibilityData[testName].indexOf(value)<0) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t\tconst updateCallback=()=>{\r\n\t\t\t\tif (optionsWithVisibilityAffectedByFullName[fullName]!==undefined) {\r\n\t\t\t\t\toptionsWithVisibilityAffectedByFullName[fullName].forEach(option=>{\r\n\t\t\t\t\t\toption.updateVisibility();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (this.updateCallback) this.updateCallback();\r\n\t\t\t};\r\n\t\t\tconst ctorArgs=[null,name,data,isVisible,updateCallback,fullName,contents,defaultValueOrConstructors];\r\n\t\t\tconst option=new (Function.prototype.bind.apply(Option[className],ctorArgs));\r\n\t\t\toptionByFullName[fullName]=option;\r\n\t\t\tfor (let testName in visibilityData) {\r\n\t\t\t\tif (optionsWithVisibilityAffectedByFullName[testName]===undefined) {\r\n\t\t\t\t\toptionsWithVisibilityAffectedByFullName[testName]=[];\r\n\t\t\t\t}\r\n\t\t\t\toptionsWithVisibilityAffectedByFullName[testName].push(option);\r\n\t\t\t}\r\n\t\t\treturn option;\r\n\t\t};\r\n\t\tthis.root=new Option.Root(\r\n\t\t\tnull,data,()=>true,simpleUpdateCallback,null,this.entriesDescription.map(description=>{\r\n\t\t\t\tconst subName=description[1];\r\n\t\t\t\tlet subData;\r\n\t\t\t\tif (typeof data == 'object') subData=data[subName];\r\n\t\t\t\treturn makeEntry(description,'',subData);\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t// methods to be redefined by subclasses\r\n\t// TODO make them static?\r\n\tget optionClasses() {\r\n\t\treturn require('./option-classes.js');\r\n\t}\r\n\tget entriesDescription() {\r\n\t\treturn [];\r\n\t}\r\n\t// public methods\r\n\texport() {\r\n\t\tconst data=this.root.export();\r\n\t\treturn data!==null ? data : {};\r\n\t}\r\n\tfix() {\r\n\t\treturn this.root.fix();\r\n\t}\r\n}\r\n\r\nmodule.exports=Options;\r\n","'use strict';\r\n\r\nconst fixOptHelp=require('./fixed-options-helpers.js');\r\nconst Lines=require('./lines.js');\r\nconst Vector=require('./vector.js');\r\n\r\nclass CallVector extends Vector {\r\n\tconstructor(name,values,calledFn,calledFnDefaultArgs) {\r\n\t\tsuper(name,values);\r\n\t\tthis.calledFn=calledFn;\r\n\t\tthis.calledFnDefaultArgs=calledFnDefaultArgs;\r\n\t}\r\n\t// private:\r\n\tgetJsUpdateLines(componentValue) {\r\n\t\tconst lines=new Lines;\r\n\t\tlet nValueSliders=0;\r\n\t\tthis.components.forEach(component=>{\r\n\t\t\tnValueSliders+=component.value.input=='slider';\r\n\t\t});\r\n\t\tif (this.modeConstant && this.components.every((component,i)=>component.value==this.calledFnDefaultArgs[i])) {\r\n\t\t\t// equal to default values, don't do anything\r\n\t\t} else if (nValueSliders<=1) {\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.calledFn+\"(\"+this.components.map(componentValue).join(\",\")+\");\"\r\n\t\t\t);\r\n\t\t} else if (this.components.every(component=>component.value.input=='slider')) {\r\n\t\t\tlet obj=this.calledFn;\r\n\t\t\tconst dotIndex=obj.lastIndexOf('.');\r\n\t\t\tif (dotIndex>=0) {\r\n\t\t\t\tobj=obj.slice(0,dotIndex);\r\n\t\t\t}\r\n\t\t\tconst suffixArray=\"[\"+this.components.map(component=>\"'\"+component.suffix+\"'\").join(\",\")+\"]\";\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.calledFn+\".apply(\"+obj+\",\"+suffixArray+\".map(function(c){\",\r\n\t\t\t\t\"\treturn parseFloat(document.getElementById('\"+this.name+\".'+c).value);\",\r\n\t\t\t\t\"}));\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.calledFn+\"(\"\r\n\t\t\t);\r\n\t\t\tthis.components.forEach((component,i)=>{\r\n\t\t\t\tif (i>0) {\r\n\t\t\t\t\tlines.t(\",\");\r\n\t\t\t\t}\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"\t\"+componentValue(component)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t\tlines.a(\r\n\t\t\t\t\");\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\taddPostToListenerEntryAfterComponents(entry,componentValue) {\r\n\t\tentry.post(\r\n\t\t\tthis.calledFn+\"(\"+this.components.map(componentValue).join(\",\")+\");\"\r\n\t\t);\r\n\t}\r\n}\r\n\r\nmodule.exports=CallVector;\r\n","'use strict';\r\n\r\nconst Lines=require('./lines.js');\r\nconst Listener=require('./listener-classes.js');\r\nconst Feature=require('./feature.js');\r\nconst IntFeature=require('./int-feature.js');\r\n\r\nclass Canvas extends Feature {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tthis.width=options.width;\r\n\t\tthis.height=options.height;\r\n\t\tthis.features.push(\r\n\t\t\tnew IntFeature('canvas.width' ,options.width),\r\n\t\t\tnew IntFeature('canvas.height',options.height)\r\n\t\t);\r\n\t}\r\n\tgetHtmlCanvasLines() {\r\n\t\treturn new Lines(\r\n\t\t\t\"<div>\",\r\n\t\t\t\"\t<canvas id='myCanvas' width='\"+this.width+\"' height='\"+this.height+\"'></canvas>\",\r\n\t\t\t\"</div>\"\r\n\t\t);\r\n\t}\r\n\tgetGlslVertexDeclarationLines() {\r\n\t\tif (this.hasInputs()) {\r\n\t\t\treturn new Lines(\"uniform float aspect;\");\r\n\t\t} else {\r\n\t\t\treturn new Lines;\r\n\t\t}\r\n\t}\r\n\tgetGlslVertexOutputLines() {\r\n\t\tconst needAspectConstant=!this.hasInputs() && Number(this.width)!=Number(this.height);\r\n\t\tif (needAspectConstant) {\r\n\t\t\treturn new Lines(\r\n\t\t\t\t\"float aspect=\"+this.width+\".0/\"+this.height+\".0;\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new Lines;\r\n\t\t}\r\n\t}\r\n\tprovidesAspect() {\r\n\t\treturn this.hasInputs() || Number(this.width)!=Number(this.height);\r\n\t}\r\n\tgetJsInitLines(featureContext) {\r\n\t\tconst lines=super.getJsInitLines(featureContext);\r\n\t\tconst canvasUpdater=()=>{\r\n\t\t\tlines.a(\r\n\t\t\t\t\"function updateAspect() {\",\r\n\t\t\t\t\"\tgl.viewport(0,0,canvas.width,canvas.height);\",\r\n\t\t\t\t\"\tgl.uniform1f(aspectLoc,canvas.width/canvas.height);\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"updateAspect();\"\r\n\t\t\t);\r\n\t\t};\r\n\t\tconst canvasListener=wh=>{\r\n\t\t\tif (this[wh].input=='slider') {\r\n\t\t\t\tconst listener=new Listener.Slider('canvas.'+wh);\r\n\t\t\t\tlistener.enter()\r\n\t\t\t\t\t.log(\"console.log(this.id,'input value:',parseInt(this.value));\")\r\n\t\t\t\t\t.post(\"canvas.\"+wh+\"=parseInt(this.value);\")\r\n\t\t\t\t\t.post(\"updateAspect();\");\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\tfeatureContext.getListenerLines(listener)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (this.hasInputs()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var aspectLoc=gl.getUniformLocation(program,'aspect');\"\r\n\t\t\t);\r\n\t\t\tcanvasUpdater();\r\n\t\t\tcanvasListener('width');\r\n\t\t\tcanvasListener('height');\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Canvas;\r\n","'use strict';\r\n\r\nconst Lines=require('./lines.js');\r\nconst Shape=require('./shape-classes.js');\r\nconst FeatureContext=require('./feature-context.js');\r\nconst Canvas=require('./canvas.js');\r\nconst Background=require('./background.js');\r\nconst Transforms=require('./transforms.js');\r\nconst Illumination=require('./illumination.js');\r\n\r\nmodule.exports=function(options,i18n){\r\n\tconst featureContext=new FeatureContext(options.debug);\r\n\tconst canvas=new Canvas(options.canvas);\r\n\tconst background=new Background(options.background);\r\n\tconst transforms=new Transforms(options.transforms);\r\n\tconst illumination=new Illumination(options.material,options.light);\r\n\tfunction makeShape() {\r\n\t\tconst className=options.shape.type.charAt(0).toUpperCase()+options.shape.type.slice(1);\r\n\t\treturn new Shape[className](\r\n\t\t\toptions.shape,\r\n\t\t\toptions.light.type!='off',\r\n\t\t\toptions.material.scope=='vertex',\r\n\t\t\toptions.material.scope=='face',\r\n\t\t\tillumination.getColorAttrs()\r\n\t\t);\r\n\t}\r\n\tconst shape=makeShape();\r\n\tconst features=[\r\n\t\tcanvas,\r\n\t\tbackground,\r\n\t\ttransforms,\r\n\t\tillumination,\r\n\t\tshape,\r\n\t];\r\n\tconst featureNames=[\r\n\t\t'canvas',\r\n\t\t'background',\r\n\t\t'transforms',\r\n\t\t'illumination',\r\n\t\t'shape',\r\n\t];\r\n\tfeatures.forEach(feature=>{\r\n\t\tfeature.requestFeatureContext(featureContext);\r\n\t});\r\n\r\n\tfunction getHtmlStyleLines() {\r\n\t\tvar lines=new Lines;\r\n\t\tif (featureContext.hasSliders) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"label {\",\r\n\t\t\t\t\"\tdisplay: inline-block;\",\r\n\t\t\t\t\"\twidth: 15em;\",\r\n\t\t\t\t\"\ttext-align: right;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\".min {\",\r\n\t\t\t\t\"\tdisplay: inline-block;\",\r\n\t\t\t\t\"\twidth: 4em;\",\r\n\t\t\t\t\"\ttext-align: right;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\".max {\",\r\n\t\t\t\t\"\tdisplay: inline-block;\",\r\n\t\t\t\t\"\twidth: 4em;\",\r\n\t\t\t\t\"\ttext-align: left;\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines.wrapIfNotEmpty(\r\n\t\t\t\"<style>\",\r\n\t\t\t\"</style>\"\r\n\t\t);\r\n\t}\r\n\tfunction getVertexShaderLines() {\r\n\t\tconst needTransformedPosition=illumination.wantsTransformedPosition(transforms.eyeAtInfinity);\r\n\t\treturn new Lines(\r\n\t\t\tcanvas.getGlslVertexDeclarationLines(),\r\n\t\t\ttransforms.getGlslVertexDeclarationLines(shape.dim==2),\r\n\t\t\tillumination.getGlslVertexDeclarationLines(transforms.eyeAtInfinity,shape.dim>2),\r\n\t\t\t(new Lines(\r\n\t\t\t\tcanvas.getGlslVertexOutputLines(),\r\n\t\t\t\ttransforms.getGlslVertexOutputLines(shape.dim==2,canvas.providesAspect(),needTransformedPosition),\r\n\t\t\t\tillumination.getGlslVertexOutputLines(transforms.eyeAtInfinity,shape.hasNormals,transforms.getGlslVertexNormalTransformLines())\r\n\t\t\t)).wrap(\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"}\"\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\tfunction getFragmentShaderLines() {\r\n\t\treturn new Lines(\r\n\t\t\t\"precision mediump float;\",\r\n\t\t\tillumination.getGlslFragmentDeclarationLines(transforms.eyeAtInfinity),\r\n\t\t\tillumination.getGlslFragmentOutputLines(transforms.eyeAtInfinity,shape.twoSided).wrap(\r\n\t\t\t\t\"void main() {\",\r\n\t\t\t\t\"}\"\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\tfunction getHtmlControlMessageLines() {\r\n\t\tvar lines=new Lines;\r\n\t\tfeatures.forEach(feature=>{\r\n\t\t\tlines.a(feature.getHtmlControlMessageLines(i18n));\r\n\t\t});\r\n\t\treturn lines.wrapIfNotEmpty(\r\n\t\t\t\"<ul>\",\r\n\t\t\t\"</ul>\"\r\n\t\t);\r\n\t}\r\n\tfunction getHtmlInputLines() {\r\n\t\tvar lines=new Lines;\r\n\t\tfeatures.forEach(feature=>{\r\n\t\t\tlines.a(feature.getHtmlInputLines(i18n));\r\n\t\t});\r\n\t\treturn lines;\r\n\t}\r\n\tfunction getJsInitLines() {\r\n\t\tfunction getMakeProgramLines() {\r\n\t\t\tconst lines=new Lines;\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var vertexShader=gl.createShader(gl.VERTEX_SHADER);\",\r\n\t\t\t\t\"gl.shaderSource(vertexShader,vertexShaderSrc);\",\r\n\t\t\t\t\"gl.compileShader(vertexShader);\"\r\n\t\t\t);\r\n\t\t\tif (options.debugShaders) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"if (!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(vertexShader));\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);\",\r\n\t\t\t\t\"gl.shaderSource(fragmentShader,fragmentShaderSrc);\",\r\n\t\t\t\t\"gl.compileShader(fragmentShader);\"\r\n\t\t\t);\r\n\t\t\tif (options.debugShaders) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"if (!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(fragmentShader));\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var program=gl.createProgram();\",\r\n\t\t\t\t\"gl.attachShader(program,vertexShader);\",\r\n\t\t\t\t\"gl.attachShader(program,fragmentShader);\",\r\n\t\t\t\t\"gl.linkProgram(program);\",\r\n\t\t\t\t\"return program;\"\r\n\t\t\t);\r\n\t\t\treturn lines.wrap(\r\n\t\t\t\t\"function makeProgram(vertexShaderSrc,fragmentShaderSrc) {\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst lines=new Lines;\r\n\t\tlines.a(\r\n\t\t\tgetMakeProgramLines(),\r\n\t\t\t\"var canvas=document.getElementById('myCanvas');\",\r\n\t\t\t\"var gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');\"\r\n\t\t);\r\n\t\tlines.a(\r\n\t\t\t\"var program=makeProgram(\",\r\n\t\t\t\"\tdocument.getElementById('myVertexShader').text,\",\r\n\t\t\t\"\tdocument.getElementById('myFragmentShader').text\",\r\n\t\t\t\");\",\r\n\t\t\t\"gl.useProgram(program);\"\r\n\t\t);\r\n\t\tconst addWithCommentIfNotEmpty=(featureLines,comment)=>{\r\n\t\t\tif (featureLines.data.length>0) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"\",\r\n\t\t\t\t\t\"// \"+comment, // TODO i18n\r\n\t\t\t\t\tfeatureLines\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfeatures.forEach((feature,i)=>{\r\n\t\t\taddWithCommentIfNotEmpty(\r\n\t\t\t\tfeature.getJsInitLines(featureContext),\r\n\t\t\t\t\"init \"+featureNames[i]\r\n\t\t\t);\r\n\t\t});\r\n\t\taddWithCommentIfNotEmpty(\r\n\t\t\tfeatureContext.getJsAfterInitLines(),\r\n\t\t\t\"init mousemove listener\"\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n\tfunction getJsLoopLines() {\r\n\t\tconst innerLines=new Lines;\r\n\t\tif (featureContext.hasClampFn) {\r\n\t\t\tinnerLines.a(\r\n\t\t\t\t\"function clamp(v,min,max) {\",\r\n\t\t\t\t\"\treturn Math.min(Math.max(v,min),max);\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (featureContext.hasWrapFn) {\r\n\t\t\tinnerLines.a(\r\n\t\t\t\t\"function wrap(v,maxAbs) {\",\r\n\t\t\t\t\"\tv%=maxAbs*2;\",\r\n\t\t\t\t\"\tif (Math.abs(v)<=maxAbs) return v;\",\r\n\t\t\t\t\"\treturn v-(v>0?1:-1)*maxAbs*2;\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (featureContext.pollsGamepad) {\r\n\t\t\tinnerLines.a(\r\n\t\t\t\t\"var gamepad;\",\r\n\t\t\t\t\"var gamepads=(navigator.getGamepads ? navigator.getGamepads() : []);\",\r\n\t\t\t\t\"for (var i=0;i<gamepads.length;i++) {\",\r\n\t\t\t\t\"\tif (gamepads[i]) {\",\r\n\t\t\t\t\"\t\tgamepad=gamepads[i];\",\r\n\t\t\t\t\"\t\tbreak;\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tfeatures.forEach(feature=>{\r\n\t\t\tinnerLines.a(feature.getJsLoopLines(featureContext));\r\n\t\t});\r\n\t\tvar lines=new Lines;\r\n\t\tif (featureContext.hasStartTime && featureContext.hasPrevTime) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var startTime=performance.now();\",\r\n\t\t\t\t\"var prevTime=startTime;\"\r\n\t\t\t);\r\n\t\t} else if (featureContext.hasStartTime) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var startTime=performance.now();\"\r\n\t\t\t);\r\n\t\t} else if (featureContext.hasPrevTime) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var prevTime=performance.now();\"\r\n\t\t\t);\r\n\t\t}\r\n\t\t// wrap inner render lines in function if needed\r\n\t\tif (featureContext.isAnimated) {\r\n\t\t\tif (featureContext.hasTime) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"function renderFrame(time) {\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"function renderFrame() {\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.a(\r\n\t\t\t\tinnerLines.indent()\r\n\t\t\t);\r\n\t\t\tif (featureContext.hasPrevTime) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"\tprevTime=time;\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.a(\r\n\t\t\t\t\"\trequestAnimationFrame(renderFrame);\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"requestAnimationFrame(renderFrame);\"\r\n\t\t\t);\r\n\t\t} else if (featureContext.hasInputs) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var frameId=null;\",\r\n\t\t\t\t\"function renderFrame() {\",\r\n\t\t\t\tinnerLines.indent(),\r\n\t\t\t\t\"\tframeId=null;\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"function scheduleFrame() {\",\r\n\t\t\t\t\"\tif (frameId===null) {\",\r\n\t\t\t\t\"\t\tframeId=requestAnimationFrame(renderFrame);\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"scheduleFrame();\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.a(innerLines);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tconst scriptLines=new Lines;\r\n\tscriptLines.interleave(\r\n\t\tgetJsInitLines(),\r\n\t\tgetJsLoopLines()\r\n\t).wrap(\r\n\t\t\"<script>\",\r\n\t\t\"</script>\"\r\n\t);\r\n\tconst lines=new Lines;\r\n\tlines.a(\r\n\t\t\"<!DOCTYPE html>\",\r\n\t\t\"<html lang='en'>\",\r\n\t\t\"<head>\",\r\n\t\t\"<meta charset='utf-8' />\",\r\n\t\t\"<title>Generated code</title>\",\r\n\t\tgetHtmlStyleLines(),\r\n\t\t\"<script id='myVertexShader' type='x-shader/x-vertex'>\",\r\n\t\tgetVertexShaderLines().indent(),\r\n\t\t\"</script>\",\r\n\t\t\"<script id='myFragmentShader' type='x-shader/x-fragment'>\",\r\n\t\tgetFragmentShaderLines().indent(),\r\n\t\t\"</script>\",\r\n\t\t\"</head>\",\r\n\t\t\"<body>\",\r\n\t\tcanvas.getHtmlCanvasLines(),\r\n\t\tgetHtmlControlMessageLines(),\r\n\t\tgetHtmlInputLines(),\r\n\t\tscriptLines,\r\n\t\t\"</body>\",\r\n\t\t\"</html>\"\r\n\t);\r\n\treturn lines.join(\r\n\t\toptions.formatting.indent=='tab' ? '\\t' : Array(parseInt(options.formatting.indent)+1).join(' ')\r\n\t);\r\n};\r\n","var colorgenCounter=0;\r\n\r\nvar SingleColorgen=function(weight,noise,baseColors){\r\n\tthis.weight=weight;\r\n\tthis.noise=noise;\r\n\tif (noise===undefined) this.noise=0.4;\r\n\tthis.baseColors=baseColors||this.defaultBaseColors;\r\n\tthis.colorgenNumber=colorgenCounter++;\r\n\tthis.nextIndex=0;\r\n};\r\nSingleColorgen.prototype.defaultBaseColors=[\r\n\t[1.0, 0.0, 0.0], // TODO 'cube' color order, when cube is not ugly\r\n\t[0.0, 1.0, 0.0],\r\n\t[0.0, 0.0, 1.0],\r\n\t[1.0, 1.0, 0.0],\r\n\t[1.0, 0.0, 1.0],\r\n\t[0.0, 1.0, 1.0],\r\n];\r\nSingleColorgen.prototype.getNextColorString=function(){\r\n\tvar baseColor=this.baseColors[this.nextIndex];\r\n\tthis.nextIndex=(this.nextIndex+1)%this.baseColors.length;\r\n\treturn baseColor.map(function(ci,i){\r\n\t\tvar s=Math.sin(this.colorgenNumber*9000+this.nextIndex*400+i*100);\r\n\t\tvar co=(ci*(1-this.noise)+s*s*this.noise)*this.weight;\r\n\t\treturn \" \"+co.toFixed(1)+\",\";\r\n\t},this).join(\"\");\r\n};\r\n\r\nvar Colorgen=function(colorAttrs,noise,baseColors){\r\n\tthis.colorAttrs=colorAttrs;\r\n\tthis.singleColorgens=this.colorAttrs.map(function(attr){\r\n\t\treturn new SingleColorgen(attr.weight,noise,baseColors);\r\n\t});\r\n};\r\nColorgen.prototype.getHeaderString=function(){\r\n\treturn this.colorAttrs.map(function(){\r\n\t\treturn \"    r    g    b\";\r\n\t}).join(\"\");\r\n};\r\nColorgen.prototype.getNextColorString=function(){\r\n\treturn this.singleColorgens.map(function(singleColorgen){\r\n\t\treturn singleColorgen.getNextColorString();\r\n\t}).join(\"\");\r\n};\r\n\r\nmodule.exports=Colorgen;\r\n","'use strict';\r\n\r\nconst Listener=require('./listener-classes.js');\r\n\r\nclass FeatureContext {\r\n\tconstructor(debugOptions) {\r\n\t\tthis.debugOptions=debugOptions;\r\n\t\tthis.canvasMousemoveListener=new Listener.CanvasMousemove();\r\n\t\t//// to be set by features:\r\n\t\t// for html:\r\n\t\tthis.hasSliders=false;\r\n\t\t// for js:\r\n\t\tthis.hasInputs=false; // must have renderFrame()\r\n\t\tthis.hasStartTime=false;\r\n\t\tthis.hasPrevTime=false;\r\n\t\tthis.pollsGamepad=false;\r\n\t\tthis.hasClampFn=false;\r\n\t\tthis.hasWrapFn=false;\r\n\t}\r\n\tget hasTime() {\r\n\t\treturn this.hasStartTime || this.hasPrevTime;\r\n\t}\r\n\tget isAnimated() {\r\n\t\treturn this.hasStartTime || this.hasPrevTime || this.pollsGamepad;\r\n\t}\r\n\tgetJsAfterInitLines() {\r\n\t\treturn this.canvasMousemoveListener.write(!this.isAnimated,this.debugOptions.inputs);\r\n\t}\r\n\tgetListenerLines(listener) {\r\n\t\treturn listener.write(!this.isAnimated,this.debugOptions.inputs);\r\n\t}\r\n}\r\n\r\nmodule.exports=FeatureContext;\r\n","'use strict';\r\n\r\nconst Lines=require('./lines.js');\r\n\r\nclass Feature {\r\n\tconstructor() {\r\n\t\tthis.features=[];\r\n\t}\r\n\t// private:\r\n\tgetRecursiveLines(method,args) {\r\n\t\tconst lines=new Lines;\r\n\t\tthis.features.forEach(feature=>{\r\n\t\t\tlines.a(feature[method].apply(feature,args));\r\n\t\t});\r\n\t\treturn lines;\r\n\t}\r\n\t// methods to be redefined:\r\n\thasInputs() {\r\n\t\treturn this.features.some(feature=>feature.hasInputs());\r\n\t}\r\n\trequestFeatureContext(featureContext) {\r\n\t\tthis.features.forEach(feature=>{\r\n\t\t\tfeature.requestFeatureContext(featureContext);\r\n\t\t});\r\n\t}\r\n\tgetHtmlInputLines(i18n) {\r\n\t\treturn this.getRecursiveLines('getHtmlInputLines',arguments);\r\n\t}\r\n\tgetHtmlControlMessageLines(i18n) {\r\n\t\treturn this.getRecursiveLines('getHtmlControlMessageLines',arguments);\r\n\t}\r\n\tgetJsInitLines(featureContext) {\r\n\t\treturn this.getRecursiveLines('getJsInitLines',arguments);\r\n\t}\r\n\tgetJsLoopLines(featureContext) {\r\n\t\treturn this.getRecursiveLines('getJsLoopLines',arguments);\r\n\t}\r\n}\r\n\r\nmodule.exports=Feature;\r\n","'use strict';\r\n\r\nfunction extendCollection(fixedOptionGroup,Options,additionalEntriesDescription) {\r\n\tclass AdditionalOptions extends Options {\r\n\t\tget entriesDescription() {\r\n\t\t\treturn additionalEntriesDescription;\r\n\t\t}\r\n\t}\r\n\tconst additionalOptions=new AdditionalOptions;\r\n\tconst fog=fixedOptionGroup;\r\n\tconst afog=additionalOptions.fix();\r\n\tconst iterateOver=fog.map((v,c,i)=>[v,c,i]).concat(afog.map((v,c,i)=>[v,c,i+fog.length]));\r\n\treturn additionalOptions.root.fixFromIterateOver(iterateOver);\r\n}\r\n\r\nfunction makeCollection(values,names,Options) {\r\n\tclass EmptyOptions extends Options {\r\n\t\tget entriesDescription() {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\tconst emptyOptions=new EmptyOptions;\r\n\tconst iterateOver=values.map((v,i)=>[v,names[i],i]);\r\n\treturn emptyOptions.root.fixFromIterateOver(iterateOver);\r\n}\r\n\r\n// fixed-width number formatting - don't use it for min width\r\nfunction makeFormatNumber(contextNumber) {\r\n\tconst nonnegativeLimits=(contextNumber.availableMin>=0 && contextNumber.availableMax>=0);\r\n\tconst lead=Math.max(\r\n\t\tString(Math.abs(contextNumber.availableMin)).split('.')[0].length,\r\n\t\tString(Math.abs(contextNumber.availableMax)).split('.')[0].length\r\n\t);\r\n\tconst splitStep=String(contextNumber.step).split('.'); // http://stackoverflow.com/a/9553423\r\n\tconst prec=(splitStep.length>1 ? splitStep[1].length : 0);\r\n\tconst width=lead+prec+(prec>0);\r\n\tconst spaces='          '; // http://stackoverflow.com/q/10073699\r\n\tconst fmt=n=>(spaces+n.toFixed(prec)).slice(-width);\r\n\tif (nonnegativeLimits) {\r\n\t\treturn n=>fmt(n);\r\n\t} else {\r\n\t\treturn n=>(n<=0 ? n<0 ? '-' : ' ' : '+')+fmt(Math.abs(n));\r\n\t}\r\n}\r\n\r\nfunction formatNumber(number) {\r\n\treturn makeFormatNumber(number)(number);\r\n}\r\n\r\nfunction capNumber(number,maxValue) {\r\n\tconst capped=new Number(Math.min(maxValue,number));\r\n\tcapped.min=number.min;\r\n\tcapped.max=Math.min(maxValue,number.max);\r\n\tcapped.input=number.input;\r\n\t// needed for formatting:\r\n\tcapped.availableMin=number.availableMin;\r\n\tcapped.availableMax=number.availableMax;\r\n\tcapped.step=number.step;\r\n\treturn capped;\r\n}\r\n\r\nexports.extendCollection=extendCollection;\r\nexports.makeCollection=makeCollection;\r\nexports.makeFormatNumber=makeFormatNumber;\r\nexports.formatNumber=formatNumber;\r\nexports.capNumber=capNumber;\r\n","'use strict';\r\n\r\nconst fixOptHelp=require('./fixed-options-helpers.js');\r\nconst Lines=require('./lines.js');\r\nconst Vector=require('./vector.js');\r\n\r\nclass GlslVector extends Vector {\r\n\tconstructor(name,values,wrapMode) {\r\n\t\tsuper(name,values,wrapMode);\r\n\t}\r\n\t// public:\r\n\tgetGlslDeclarationLines() {\r\n\t\tif (this.modeConstant) {\r\n\t\t\treturn new Lines;\r\n\t\t} else if (this.modeFloats) {\r\n\t\t\tconst lines=new Lines;\r\n\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\tif (component.variable) {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"uniform float \"+component.varName+\";\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn lines;\r\n\t\t} else {\r\n\t\t\treturn new Lines(\r\n\t\t\t\t\"uniform vec\"+this.nVars+\" \"+this.varName+\";\"\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tgetGlslValue() {\r\n\t\treturn this.getGlslComponentsValue(this.components.map(component=>component.suffix).join(''));\r\n\t}\r\n\tgetGlslComponentsValue(selectedComponents) {\r\n\t\tconst allSuffixString=this.components.map(component=>component.suffix).slice(0,this.nVars).join('');\r\n\t\tconst results=[]; // [[isConstant,componentName]]\r\n\t\tconst showResult=result=>{\r\n\t\t\tif (result[0]) {\r\n\t\t\t\treturn fixOptHelp.formatNumber(this.componentsBySuffix[result[1]].value);\r\n\t\t\t} else {\r\n\t\t\t\tif (this.modeVector) {\r\n\t\t\t\t\tif (result[1]==allSuffixString) {\r\n\t\t\t\t\t\treturn this.varName;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn this.varName+\".\"+result[1];\r\n\t\t\t\t\t}\r\n \t\t\t\t} else {\r\n\t\t\t\t\treturn this.componentsBySuffix[result[1]].varName;\r\n \t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst allSameConstant=()=>{\r\n\t\t\tif (!results[0][0]) return false;\r\n\t\t\tconst cmp=fixOptHelp.formatNumber(this.componentsBySuffix[results[0][1]].value);\r\n\t\t\treturn results.every(result=>(result[0] && fixOptHelp.formatNumber(this.componentsBySuffix[result[1]].value)==cmp));\r\n\t\t};\r\n\t\tfor (let j=0;j<selectedComponents.length;j++) {\r\n\t\t\tconst c=selectedComponents.charAt(j);\r\n\t\t\tif (!this.componentsBySuffix[c].variable) {\r\n\t\t\t\tresults.push([true,c]);\r\n\t\t\t} else {\r\n\t\t\t\tif (this.modeVector && results.length>0) {\r\n\t\t\t\t\tconst prevResult=results.pop();\r\n\t\t\t\t\tif (prevResult[0]) {\r\n\t\t\t\t\t\tresults.push(prevResult,[false,c]); // prev is constant, don't merge\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresults.push([prevResult[0],prevResult[1]+c]); // merge\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresults.push([false,c]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (results.length==1) {\r\n\t\t\tif (this.modeVector && selectedComponents==allSuffixString) {\r\n\t\t\t\treturn this.varName;\r\n\t\t\t} else {\r\n\t\t\t\treturn showResult(results[0]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (allSameConstant()) {\r\n\t\t\t\treturn \"vec\"+selectedComponents.length+\"(\"+showResult(results[0])+\")\"; // see OpenGL ES SL section 5.4.2\r\n\t\t\t} else {\r\n\t\t\t\treturn \"vec\"+selectedComponents.length+\"(\"+results.map(showResult).join(\",\")+\")\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tgetGlslMapDeclarationLines(mapName,mapFn) {\r\n\t\tif (this.components.length>1) {\r\n\t\t\treturn new Lines(\r\n\t\t\t\t\"vec\"+this.components.length+\" \"+mapName+\"=\"+mapFn(this.getGlslValue())+\";\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new Lines(\r\n\t\t\t\t\"float \"+mapName+this.components[0].suffix+\"=\"+mapFn(this.getGlslValue())+\";\"\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tgetGlslMapComponentValue(mapName,selectedComponent) {\r\n\t\tif (this.components.length>1) {\r\n\t\t\treturn mapName+\".\"+selectedComponent;\r\n\t\t} else {\r\n\t\t\treturn mapName+selectedComponent;\r\n\t\t}\r\n\t}\r\n\t// private:\r\n\tgetJsDeclarationLines() {\r\n\t\tconst lines=new Lines;\r\n\t\tif (this.modeConstant) {\r\n\t\t\treturn lines;\r\n\t\t}\r\n\t\tif (this.modeFloats) {\r\n\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\tif (component.variable) {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"var \"+component.varNameLoc+\"=gl.getUniformLocation(program,'\"+component.varName+\"');\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var \"+this.varName+\"Loc=gl.getUniformLocation(program,'\"+this.varName+\"');\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetJsUpdateLines(componentValue) {\r\n\t\tconst lines=new Lines;\r\n\t\tif (this.modeVector) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl.uniform\"+this.nVars+\"f(\"+this.varName+\"Loc\"\r\n\t\t\t);\r\n\t\t\tif (this.components.every(component=>component.value.input!='slider')) { // all values are short, no getElement... queries\r\n\t\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\t\tif (component.variable) {\r\n\t\t\t\t\t\tlines.t(\r\n\t\t\t\t\t\t\t\",\"+componentValue(component)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\");\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\t\tif (component.variable) {\r\n\t\t\t\t\t\tlines.t(\r\n\t\t\t\t\t\t\t\",\",\r\n\t\t\t\t\t\t\t\"\t\"+componentValue(component)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\");\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\tif (component.variable) {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"gl.uniform1f(\"+component.varNameLoc+\",\"+componentValue(component)+\");\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\taddPostToListenerEntryForComponent(entry,component) {\r\n\t\tif (this.modeVector) {\r\n\t\t\t// written at the end as a vector\r\n\t\t} else {\r\n\t\t\tentry.post(\"gl.uniform1f(\"+component.varNameLoc+\",\"+component.varName+\");\");\r\n\t\t}\r\n\t}\r\n\taddPostToListenerEntryAfterComponents(entry,componentValue) {\r\n\t\tif (this.modeVector) {\r\n\t\t\tconst vs=[];\r\n\t\t\tthis.components.forEach((component,i)=>{\r\n\t\t\t\tif (i<this.nVars) {\r\n\t\t\t\t\tvs.push(component.varName);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tentry.post(\"gl.uniform\"+this.nVars+\"f(\"+this.varName+\"Loc,\"+vs.join(\",\")+\");\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports=GlslVector;\r\n","'use strict';\r\n\r\nfunction number(n) {\r\n\treturn n.toString().replace('-','−');\r\n}\r\nfunction plural(n,word) {\r\n\tif (n==1) {\r\n\t\treturn word;\r\n\t} else {\r\n\t\treturn word+'s';\r\n\t}\r\n}\r\nconst plainValue=x=>number(x);\r\nconst pixelValue=n=>number(n)+\" <abbr title='\"+plural(n,'pixel')+\"'>px</abbr>\";\r\n\r\nconst dataStrings={\r\n\t'message.hljs': \"<a href='https://highlightjs.org/'>highlight.js</a> (hosted on cdnjs.cloudflare.com) is not loaded. Syntax highlighting is disabled.\",\r\n\t'message.elements': \"choosing 8- or 16-bit index may limit available shape detail levels\",\r\n\r\n\t'options.canvas': \"Canvas\",\r\n\t'options.canvas.{width,height}': \"Canvas {width,height}\",\r\n\t'options.canvas.{width,height}.value': pixelValue,\r\n\r\n\t'options.background': \"Background\",\r\n\t'options.background.type': \"Background type\",\r\n\t'options.background.type.none': \"none (transparent)\",\r\n\t'options.background.type.solid': \"solid color\",\r\n\t'options.background.color': \"Background color\",\r\n\t'options.background.color.{r,g,b,a}': 'Background color {red,green,blue,alpha} component',\r\n\t'options.background.color.{r,g,b,a}.value': plainValue,\r\n\t'options.background.color.{r,g,b,a}.speed': 'Background color {red,green,blue,alpha} speed',\r\n\t'options.background.color.{r,g,b,a}.speed.value': plainValue,\r\n\r\n\t'options.material': \"Material\",\r\n\t'options.material.scope': \"Set material color for objects\",\r\n\t'options.material.scope.global': \"entire scene\",\r\n\t'options.material.scope.vertex': \"shape vertices\",\r\n\t'options.material.scope.face': \"shape faces\",\r\n\t'options.material.data': \"For each object have\",\r\n\t'options.material.data.one': \"one color\",\r\n\t'options.material.data.sda': \"specular/diffuse/ambient colors\",\r\n\t'options.material.color': \"Material color\",\r\n\t'options.material.color.{r,g,b,a}': \"Material color {red,green,blue,alpha} component\",\r\n\t'options.material.color.{r,g,b,a}.value': plainValue,\r\n\t'options.material.color.{r,g,b,a}.speed': \"Material color {red,green,blue,alpha} speed\",\r\n\t'options.material.color.{r,g,b,a}.speed.value': plainValue,\r\n\t'options.material.{specular,diffuse,ambient}Color': \"Material {specular,diffuse,ambient} color\",\r\n\t'options.material.{specular,diffuse,ambient}Color.{r,g,b}': \"{Specular,Diffuse,Ambient} color {red,green,blue} component\",\r\n\t'options.material.{specular,diffuse,ambient}Color.{r,g,b}.value': plainValue,\r\n\t'options.material.{specular,diffuse,ambient}Color.{r,g,b}.speed': \"Material {specular,diffuse,ambient} color {red,green,blue,alpha} speed\",\r\n\t'options.material.{specular,diffuse,ambient}Color.{r,g,b}.speed.value': plainValue,\r\n\r\n\t'options.light': \"Light\", // directional if on\r\n\t'options.light.type': \"Light type\",\r\n\t'options.light.type.off': \"off\",\r\n\t'options.light.type.phong': \"on with Phong reflections\", // wp: Phong reflection model\r\n\t'options.light.type.blinn': \"on with Blinn–Phong reflections\", // wp: Blinn–Phong shading model\r\n\t'options.light.direction': \"Light direction\",\r\n\t'options.light.direction.{x,y,z}': \"Light direction {x,y,z} component\",\r\n\t'options.light.direction.{x,y,z}.value': plainValue,\r\n\t'options.light.direction.{x,y,z}.speed': \"Light direction {x,y,z} speed\",\r\n\t'options.light.direction.{x,y,z}.speed.value': plainValue,\r\n\r\n\t'options.shape': \"Shape\",\r\n\t'options.shape.type': \"Shape to draw\",\r\n\t'options.shape.type.square': \"square\",\r\n\t'options.shape.type.triangle': \"triangle\",\r\n\t'options.shape.type.gasket': \"Sierpinski gasket\", // wp: Sierpinski triangle\r\n\t'options.shape.type.cube': \"cube\",\r\n\t'options.shape.type.hat': \"Mexican hat function\", // wp: Mexican hat wavelet\r\n\t'options.shape.type.terrain': \"diamond-square fractal terrain\", // wp: Diamond-square algorithm\r\n\t'options.shape.elements': \"Element array\",\r\n\t'options.shape.elements.0': \"not used\",\r\n\t'options.shape.elements.{8,16,32}': \"with {8,16,32}-bit index\",\r\n\t'options.shape.lod': \"Shape detail level\", // recursion depth for fractal shapes\r\n\t'options.shape.lod.value': plainValue,\r\n\r\n\t'options.transforms': \"Transforms\",\r\n\t'options.transforms.projection': \"Projection\",\r\n\t'options.transforms.projection.ortho': \"orthogonal\",\r\n\t'options.transforms.projection.perspective': \"perspective\",\r\n\t'options.transforms.model': \"Model transform\",\r\n\t'options.transforms.model.rotate.{x,y,z}.add': \"Add rotation around {x,y,z} axis\",\r\n\t'options.transforms.model.rotate.{x,y,z}': \"Angle of rotation around {x,y,z} axis\",\r\n\t'options.transforms.model.rotate.{x,y,z}.value': plainValue,\r\n\t'options.transforms.model.rotate.{x,y,z}.speed': \"Speed of rotation around {x,y,z} axis\",\r\n\t'options.transforms.model.rotate.{x,y,z}.speed.value': plainValue,\r\n\r\n\t'options.debug': \"Debug options\",\r\n\t'options.debug.shaders': \"Log shader compilation errors\",\r\n\t'options.debug.arrays': \"Log allocated array sizes\",\r\n\t'options.debug.inputs': \"Log input values\",\r\n\t'options.debug.animations': \"Log animated values\",\r\n\r\n\t'options.formatting': \"Code formatting options\",\r\n\t'options.formatting.indent': \"Indent\",\r\n\t'options.formatting.indent.tab': \"tab\",\r\n\t'options.formatting.indent.{2,4,8}': \"{2,4,8} spaces\",\r\n\r\n\t'ui.inputs': \"Input method\",\r\n\t'ui.inputs.constant': \"none\",\r\n\t'ui.inputs.slider': \"slider\",\r\n\t'ui.inputs.mousemove{x,y}': \"mouse {x,y} axis\",\r\n\t'ui.inputs.gamepad{0,1,2,3}': \"gamepad {0,1,2,3} axis\",\r\n\t'ui.range': \"with range\",\r\n\t'ui.reset': \"Reset\",\r\n\t'ui.addSpeed': \"Add speed\",\r\n\t'ui.drag': \"Drag or press up/down while in focus to reorder transforms\",\r\n\t'ui.delete': \"Delete transform\",\r\n\r\n\t'controls.type.mousemovex': \"Move the mouse pointer horizontally over the canvas\",\r\n\t'controls.type.mousemovey': \"Move the mouse pointer vertically over the canvas\",\r\n\t'controls.to': \"to update\",\r\n};\r\n\r\nconst strings={};\r\nconst expandRegexp=/^([^{]*)\\{([^}]*)\\}(.*)$/;\r\nfunction expandIdAndString(id,string) {\r\n\tlet match;\r\n\tif (match=expandRegexp.exec(id)) {\r\n\t\tconst idStart=match[1];\r\n\t\tconst idMids=match[2].split(',');\r\n\t\tconst idEnd=match[3];\r\n\t\tif ((typeof string=='string') && (match=expandRegexp.exec(string))) {\r\n\t\t\tconst stringStart=match[1];\r\n\t\t\tconst stringMids=match[2].split(',');\r\n\t\t\tconst stringEnd=match[3];\r\n\t\t\tidMids.forEach((idMid,i)=>{\r\n\t\t\t\tconst stringMid=stringMids[i];\r\n\t\t\t\texpandIdAndString(idStart+idMid+idEnd,stringStart+stringMid+stringEnd);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tidMids.forEach(idMid=>{\r\n\t\t\t\texpandIdAndString(idStart+idMid+idEnd,string);\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tstrings[id]=string;\r\n\t}\r\n}\r\nfor (let id in dataStrings) {\r\n\texpandIdAndString(id,dataStrings[id]);\r\n}\r\n\r\nmodule.exports=function(id,n){\r\n\tif (strings[id]===undefined) {\r\n\t\tthrow new Error(\"undefined string \"+id);\r\n\t} if (typeof strings[id] == 'string') {\r\n\t\treturn strings[id];\r\n\t} else {\r\n\t\treturn strings[id](n);\r\n\t}\r\n};\r\n","'use strict';\r\n\r\nconst Options=require('./options.js');\r\nconst fixOptHelp=require('./fixed-options-helpers.js');\r\nconst Lines=require('./lines.js');\r\nconst Feature=require('./feature.js');\r\nconst GlslVector=require('./glsl-vector.js');\r\n\r\nclass Illumination extends Feature {\r\n\tconstructor(material,light) {\r\n\t\tsuper();\r\n\t\tthis.material=material;\r\n\t\tthis.light=light;\r\n\t\t// possible options checks:\r\n\t\t// material.scope=='global': constant or user input -> uniform\r\n\t\t// material.scope!='global': colors in model data -> attribute\r\n\t\t// material.data=='one': one color\r\n\t\t// material.data!='one': s/d/a colors\r\n\t\t// light.type=='off'\r\n\t\t// light.type!='off'\r\n\t\t// light.type=='blinn'\r\n\t\tif (material.scope=='global') {\r\n\t\t\tif (material.data=='one') {\r\n\t\t\t\tthis.features.push(\r\n\t\t\t\t\tthis.colorVector=new GlslVector('material.color',material.color)\r\n\t\t\t\t);\r\n\t\t\t} else if (light.type!='off') {\r\n\t\t\t\tthis.features.push(\r\n\t\t\t\t\tthis.specularColorVector=new GlslVector('material.specularColor',material.specularColor),\r\n\t\t\t\t\tthis.diffuseColorVector =new GlslVector('material.diffuseColor' ,material.diffuseColor),\r\n\t\t\t\t\tthis.ambientColorVector =new GlslVector('material.ambientColor' ,material.ambientColor)\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst extendedAmbientColor=fixOptHelp.extendCollection(\r\n\t\t\t\t\tmaterial.ambientColor,\r\n\t\t\t\t\tOptions,\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t['LiveFloat','a',[0,1],1],\r\n\t\t\t\t\t]\r\n\t\t\t\t);\r\n\t\t\t\tthis.features.push(\r\n\t\t\t\t\tthis.ambientColorVector=new GlslVector('material.ambientColor',extendedAmbientColor)\r\n\t\t\t\t);\r\n\t\t\t\t// TODO consider extendind .specularColor and .diffuseColor, b/c they would be present if vertex scope is chosen\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (light.type!='off') {\r\n\t\t\tthis.features.push(\r\n\t\t\t\tthis.lightDirectionVector=new GlslVector('light.direction',light.direction)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tgetColorAttrs() {\r\n\t\tif (this.material.scope=='global') {\r\n\t\t\treturn [];\r\n\t\t} else {\r\n\t\t\tif (this.material.data=='one') {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t{name:\"color\",enabled:true,weight:1.0}\r\n\t\t\t\t];\r\n\t\t\t} else {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t{name:\"specularColor\",enabled:this.light.type!='off',weight:0.4},\r\n\t\t\t\t\t{name:\"diffuseColor\" ,enabled:this.light.type!='off',weight:0.4},\r\n\t\t\t\t\t{name:\"ambientColor\" ,enabled:true                  ,weight:0.2}\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\twantsTransformedPosition(eyeAtInfinity) {\r\n\t\treturn !eyeAtInfinity && this.light.type!='off' && this.material.data!='one';\r\n\t}\r\n\tgetGlslVertexDeclarationLines(eyeAtInfinity,hasNormalAttr) {\r\n\t\tconst lines=new Lines;\r\n\t\tif (this.wantsTransformedPosition(eyeAtInfinity)) {\r\n\t\t\tlines.a(\"varying vec3 interpolatedView;\");\r\n\t\t}\r\n\t\tif (this.light.type!='off') {\r\n\t\t\tif (hasNormalAttr) {\r\n\t\t\t\tlines.a(\"attribute vec3 normal;\");\r\n\t\t\t}\r\n\t\t\tlines.a(\"varying vec3 interpolatedNormal;\");\r\n\t\t}\r\n\t\tif (this.material.scope!='global') {\r\n\t\t\tif (this.material.data=='one') {\r\n\t\t\t\tlines.a(\"attribute vec4 color;\");\r\n\t\t\t\tlines.a(\"varying vec4 interpolatedColor;\");\r\n\t\t\t} else {\r\n\t\t\t\tif (this.light.type=='off') {\r\n\t\t\t\t\tlines.a(\"attribute vec4 ambientColor;\");\r\n\t\t\t\t\tlines.a(\"varying vec4 interpolatedColor;\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"attribute vec3 specularColor;\",\r\n\t\t\t\t\t\t\"attribute vec3 diffuseColor;\",\r\n\t\t\t\t\t\t\"attribute vec3 ambientColor;\",\r\n\t\t\t\t\t\t\"varying vec3 interpolatedSpecularColor;\",\r\n\t\t\t\t\t\t\"varying vec3 interpolatedDiffuseColor;\",\r\n\t\t\t\t\t\t\"varying vec3 interpolatedAmbientColor;\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetGlslVertexOutputLines(eyeAtInfinity,hasNormalAttr,normalTransformLines) {\r\n\t\tconst lines=new Lines;\r\n\t\tif (this.wantsTransformedPosition(eyeAtInfinity)) {\r\n\t\t\tlines.a(\"interpolatedView=-transformedPosition.xyz;\");\r\n\t\t}\r\n\t\tif (this.light.type!='off') {\r\n\t\t\tlines.a(\"interpolatedNormal=\");\r\n\t\t\tif (hasNormalAttr) {\r\n\t\t\t\tlines.t(\"normal\");\r\n\t\t\t} else {\r\n\t\t\t\tlines.t(\"vec3(0.0,0.0,1.0)\");\r\n\t\t\t}\r\n\t\t\tlines.t(normalTransformLines);\r\n\t\t\tlines.t(\";\");\r\n\t\t}\r\n\t\tif (this.material.scope!='global') {\r\n\t\t\tif (this.material.data=='one') {\r\n\t\t\t\tlines.a(\"interpolatedColor=color;\");\r\n\t\t\t} else {\r\n\t\t\t\tif (this.light.type=='off') {\r\n\t\t\t\t\tlines.a(\"interpolatedColor=ambientColor;\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"interpolatedSpecularColor=specularColor;\",\r\n\t\t\t\t\t\t\"interpolatedDiffuseColor=diffuseColor;\",\r\n\t\t\t\t\t\t\"interpolatedAmbientColor=ambientColor;\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetGlslFragmentDeclarationLines(eyeAtInfinity) {\r\n\t\tconst lines=new Lines;\r\n\t\tif (this.wantsTransformedPosition(eyeAtInfinity)) {\r\n\t\t\tlines.a(\"varying vec3 interpolatedView;\");\r\n\t\t}\r\n\t\tif (this.light.type!='off') {\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.lightDirectionVector.getGlslDeclarationLines(),\r\n\t\t\t\t\"varying vec3 interpolatedNormal;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.material.scope=='global') {\r\n\t\t\tif (this.material.data=='one') {\r\n\t\t\t\tlines.a(this.colorVector.getGlslDeclarationLines());\r\n\t\t\t} else {\r\n\t\t\t\tif (this.light.type!='off') {\r\n\t\t\t\t\tlines.a(this.specularColorVector.getGlslDeclarationLines());\r\n\t\t\t\t\tlines.a(this.diffuseColorVector.getGlslDeclarationLines());\r\n\t\t\t\t}\r\n\t\t\t\tlines.a(this.ambientColorVector.getGlslDeclarationLines());\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.material.data=='one' || this.light.type=='off') {\r\n\t\t\t\tlines.a(\"varying vec4 interpolatedColor;\");\r\n\t\t\t} else {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"varying vec3 interpolatedSpecularColor;\",\r\n\t\t\t\t\t\"varying vec3 interpolatedDiffuseColor;\",\r\n\t\t\t\t\t\"varying vec3 interpolatedAmbientColor;\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetGlslFragmentOutputLines(eyeAtInfinity,twoSided) {\r\n\t\tconst lines=new Lines;\r\n\t\tlet colorRGB,colorA,colorRGBA;\r\n\t\tif (this.material.scope=='global') {\r\n\t\t\tconst vector=(this.material.data=='one'\r\n\t\t\t\t? this.colorVector\r\n\t\t\t\t: this.ambientColorVector\r\n\t\t\t);\r\n\t\t\tcolorRGB =()=>vector.getGlslComponentsValue('rgb');\r\n\t\t\tcolorA   =()=>vector.getGlslComponentsValue('a');\r\n\t\t\tcolorRGBA=()=>vector.getGlslValue();\r\n\t\t} else {\r\n\t\t\tcolorRGB =()=>\"interpolatedColor.rgb\"; // TODO don't pass it as vec4 if light is on\r\n\t\t\tcolorA   =()=>\"interpolatedColor.a\";\r\n\t\t\tcolorRGBA=()=>\"interpolatedColor\";\r\n\t\t}\r\n\t\tif (this.light.type=='off') {\r\n\t\t\tlines.a(\"gl_FragColor=\"+colorRGBA()+\";\");\r\n\t\t} else {\r\n\t\t\tlines.a(\"vec3 N=normalize(interpolatedNormal);\");\r\n\t\t\tif (twoSided) {\r\n\t\t\t\tlines.a(\"if (!gl_FrontFacing) N=-N;\");\r\n\t\t\t}\r\n\t\t\tlines.a(\"vec3 L=normalize(\"+this.lightDirectionVector.getGlslValue()+\");\");\r\n\t\t\tif (this.material.data=='one') {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"gl_FragColor=vec4(\"+colorRGB()+\"*max(0.0,dot(L,N)),\"+colorA()+\");\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tif (this.wantsTransformedPosition(eyeAtInfinity)) {\r\n\t\t\t\t\tlines.a(\"vec3 V=normalize(interpolatedView);\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\"vec3 V=vec3(0.0,0.0,1.0);\");\r\n\t\t\t\t}\r\n\t\t\t\tlet specularDotArgs=\"H,N\";\r\n\t\t\t\tlet shininessCorrection=\"\";\r\n\t\t\t\tif (this.light.type=='blinn') {\r\n\t\t\t\t\tlines.a(\"vec3 H=normalize(L+V);\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\"vec3 R=reflect(-L,N);\");\r\n\t\t\t\t\tspecularDotArgs=\"R,V\";\r\n\t\t\t\t\tshininessCorrection=\"/4.0\";\r\n\t\t\t\t}\r\n\t\t\t\tlines.a(\"float shininess=100.0;\");\r\n\t\t\t\tlines.a((this.material.scope=='global'\r\n\t\t\t\t\t? new Lines(\r\n\t\t\t\t\t\t\"+\"+this.specularColorVector.getGlslValue()+\"*pow(max(0.0,dot(\"+specularDotArgs+\")),shininess\"+shininessCorrection+\")\",\r\n\t\t\t\t\t\t\"+\"+this.diffuseColorVector.getGlslValue()+\"*max(0.0,dot(L,N))\",\r\n\t\t\t\t\t\t\"+\"+this.ambientColorVector.getGlslValue()\r\n\t\t\t\t\t)\r\n\t\t\t\t\t: new Lines(\r\n\t\t\t\t\t\t\"+interpolatedSpecularColor*pow(max(0.0,dot(\"+specularDotArgs+\")),shininess\"+shininessCorrection+\")\",\r\n\t\t\t\t\t\t\"+interpolatedDiffuseColor*max(0.0,dot(L,N))\",\r\n\t\t\t\t\t\t\"+interpolatedAmbientColor\"\r\n\t\t\t\t\t)\r\n\t\t\t\t).wrap(\r\n\t\t\t\t\t\"gl_FragColor=vec4(\",\r\n\t\t\t\t\t\",1.0);\"\r\n\t\t\t\t));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Illumination;\r\n","'use strict';\r\n\r\nclass Base {\r\n\tconstructor(str) {\r\n\t\tthis._str=str;\r\n\t}\r\n\ttoString() {\r\n\t\treturn this._str;\r\n\t}\r\n\tvalueOf() {\r\n\t\treturn this._str;\r\n\t}\r\n}\r\n\r\nclass Constant extends Base {\r\n}\r\n\r\nclass Variable extends Base {\r\n}\r\n\r\nclass Slider extends Variable {\r\n}\r\n\r\nclass MouseMove extends Variable {\r\n\tconstructor(str) {\r\n\t\tsuper(str);\r\n\t\tthis.axis=str.slice(-1);\r\n\t}\r\n}\r\n\r\nclass Gamepad extends Variable {\r\n\tconstructor(str) {\r\n\t\tsuper(str);\r\n\t\tthis.axis=Number(str.slice(-1));\r\n\t}\r\n}\r\n\r\nfunction createFromString(str) {\r\n\treturn new {\r\n\t\t'constant':   Constant,\r\n\t\t'slider':     Slider,\r\n\t\t'mousemovex': MouseMove,\r\n\t\t'mousemovey': MouseMove,\r\n\t\t'gamepad0':   Gamepad,\r\n\t\t'gamepad1':   Gamepad,\r\n\t\t'gamepad2':   Gamepad,\r\n\t\t'gamepad3':   Gamepad,\r\n\t}[str](str);\r\n}\r\n\r\nexports.Base=Base;\r\nexports.Constant=Constant;\r\nexports.Variable=Variable;\r\nexports.Slider=Slider;\r\nexports.MouseMove=MouseMove;\r\nexports.Gamepad=Gamepad;\r\nexports.createFromString=createFromString;\r\n","'use strict';\r\n\r\nconst NumericFeature=require('./numeric-feature.js');\r\n\r\nclass IntFeature extends NumericFeature {\r\n\tconstructor(name,value) {\r\n\t\tsuper();\r\n\t\tthis.name=name;\r\n\t\tthis.value=value;\r\n\t}\r\n\thasInputs() {\r\n\t\treturn super.hasInputs() || this.value.input!='constant';\r\n\t}\r\n\trequestFeatureContext(featureContext) {\r\n\t\tsuper.requestFeatureContext(featureContext);\r\n\t\tif (this.value.input!='constant') {\r\n\t\t\tfeatureContext.hasInputs=true;\r\n\t\t}\r\n\t\tif (this.value.input=='slider') {\r\n\t\t\tfeatureContext.hasSliders=true;\r\n\t\t}\r\n\t}\r\n\tgetHtmlControlMessageLines(i18n) {\r\n\t\tconst lines=super.getHtmlControlMessageLines(i18n);\r\n\t\tlines.a(\r\n\t\t\tthis.getHtmlControlMessageForValue(i18n,this.value,this.name)\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n\tgetHtmlInputLines(i18n) {\r\n\t\tconst lines=super.getHtmlInputLines(i18n);\r\n\t\tconst v=this.value;\r\n\t\tif (v.input=='slider') {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"<div>\",\r\n\t\t\t\t\"\t<label for='\"+this.name+\"'>\"+i18n('options.'+this.name)+\":</label>\",\r\n\t\t\t\t\"\t<span class='min'>\"+i18n('options.'+this.name+'.value',v.min)+\"</span>\",\r\n\t\t\t\t\"\t<input type='range' id='\"+this.name+\"' min='\"+v.min+\"' max='\"+v.max+\"' value='\"+v+\"' />\",\r\n\t\t\t\t\"\t<span class='max'>\"+i18n('options.'+this.name+'.value',v.max)+\"</span>\",\r\n\t\t\t\t\"</div>\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=IntFeature;\r\n","/*\r\n.a = add AFTER last line\r\n.t = add TO last line\r\n*/\r\n\r\nvar Lines=function(){\r\n\tthis.data=[];\r\n\tthis.addFlattenedArgs(\r\n\t\tthis.flattenArgs(arguments)\r\n\t);\r\n};\r\n\r\n// private\r\nLines.prototype.flattenArgs=function(s){\r\n\tvar r=[];\r\n\tfor (var i=0;i<s.length;i++) {\r\n\t\tif (typeof s[i] == 'string') {\r\n\t\t\tr.push(s[i]);\r\n\t\t} else if (Array.isArray(s[i])) {\r\n\t\t\tArray.prototype.push.apply(r,s[i]);\r\n\t\t} else if (s[i] instanceof Lines) {\r\n\t\t\tArray.prototype.push.apply(r,s[i].data);\r\n\t\t}\r\n\t}\r\n\treturn r;\r\n};\r\nLines.prototype.addFlattenedArgs=function(s){\r\n\tArray.prototype.push.apply(this.data,s);\r\n};\r\n\r\n// public\r\nLines.prototype.a=function(){\r\n\tthis.addFlattenedArgs(\r\n\t\tthis.flattenArgs(arguments)\r\n\t);\r\n\treturn this;\r\n};\r\nLines.prototype.t=function(){\r\n\tvar lastLine=this.data.pop();\r\n\tvar s=this.flattenArgs(arguments);\r\n\ts[0]=lastLine+s[0];\r\n\tthis.addFlattenedArgs(s);\r\n\treturn this;\r\n};\r\nLines.prototype.indent=function(level){\r\n\tif (level===undefined) {\r\n\t\tlevel=1;\r\n\t}\r\n\tthis.data=this.data.map(function(line){\r\n\t\treturn Array(level+1).join('\\t')+line;\r\n\t});\r\n\treturn this;\r\n};\r\nLines.prototype.isEmpty=function(){\r\n\treturn this.data.length<=0;\r\n};\r\nLines.prototype.interleave=function(){\r\n\tvar first=true;\r\n\tfor (var i=0;i<arguments.length;i++) {\r\n\t\tvar r=this.flattenArgs([arguments[i]]);\r\n\t\tif (r.length>0) {\r\n\t\t\tif (first) {\r\n\t\t\t\tfirst=false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.data.push('');\r\n\t\t\t}\r\n\t\t\tthis.addFlattenedArgs(r);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\nLines.prototype.wrap=function(begin,end){\r\n\tthis.indent();\r\n\tthis.data.unshift(begin);\r\n\tthis.data.push(end);\r\n\treturn this;\r\n};\r\nLines.prototype.wrapIfNotEmpty=function(begin,end){\r\n\tif (!this.isEmpty()) {\r\n\t\tthis.wrap(begin,end);\r\n\t}\r\n\treturn this;\r\n};\r\n/*\r\nLines.prototype.wrapEachLine=function(begin,end){\r\n\tthis.data=this.data.map(function(line){\r\n\t\treturn begin+line+end;\r\n\t});\r\n\treturn this;\r\n};\r\nLines.prototype.map=function(fn){\r\n\tthis.data=this.data.map(fn);\r\n\treturn this;\r\n};\r\n*/\r\nLines.prototype.join=function(indent){\r\n\treturn this.data.map(function(line){\r\n\t\treturn line.replace(/^(\\t)+/,function(match){\r\n\t\t\treturn Array(match.length+1).join(indent);\r\n\t\t});\r\n\t}).join('\\n');\r\n};\r\n\r\nmodule.exports=Lines;\r\n","'use strict';\r\n\r\nconst Lines=require('./lines.js');\r\n\r\nclass Base {\r\n\tconstructor() {\r\n\t\tthis.entries=[];\r\n\t}\r\n\tenter() {\r\n\t\tconst entry={\r\n\t\t\tpre: [],\r\n\t\t\tcond: null,\r\n\t\t\tlog: [],\r\n\t\t\tpost: [],\r\n\t\t};\r\n\t\tthis.entries.push(entry);\r\n\t\tfunction makePushArgs(where){\r\n\t\t\treturn function(){\r\n\t\t\t\tfor (let i=0;i<arguments.length;i++) {\r\n\t\t\t\t\twhere.push(arguments[i]);\r\n\t\t\t\t}\r\n\t\t\t\treturn proxy;\r\n\t\t\t};\r\n\t\t}\r\n\t\tconst proxy={\r\n\t\t\tpre: makePushArgs(entry.pre),\r\n\t\t\tcond: function(cond){\r\n\t\t\t\tentry.cond=cond;\r\n\t\t\t\treturn proxy;\r\n\t\t\t},\r\n\t\t\tlog: makePushArgs(entry.log),\r\n\t\t\tpost: makePushArgs(entry.post),\r\n\t\t};\r\n\t\treturn proxy;\r\n\t}\r\n\tinnerPrependedLines() {\r\n\t\treturn [];\r\n\t}\r\n\tbracketFnArg() {\r\n\t\treturn \"\";\r\n\t}\r\n\twrapCall(line) {\r\n\t\treturn line;\r\n\t}\r\n\twrite(haveToUpdateCanvas,haveToLogInput) {\r\n\t\tconst innerLinesGraph={};\r\n\t\tconst innerLinesRoot=[];\r\n\t\tlet innerLinesPrev=null;\r\n\t\tconst WHITE=0;\r\n\t\tconst GRAY=1;\r\n\t\tconst BLACK=2;\r\n\t\tconst addInnerLine=(line,cond)=>{\r\n\t\t\tlet vertex;\r\n\t\t\tif (line in innerLinesGraph) {\r\n\t\t\t\tvertex=innerLinesGraph[line];\r\n\t\t\t} else {\r\n\t\t\t\tvertex=innerLinesGraph[line]={\r\n\t\t\t\t\tprevs: [],\r\n\t\t\t\t\tconds: [],\r\n\t\t\t\t\tmark: WHITE,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (vertex.conds!==null) {\r\n\t\t\t\tif (cond===null) {\r\n\t\t\t\t\tvertex.conds=null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvertex.conds.push(cond);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (innerLinesPrev!==null) {\r\n\t\t\t\tvertex.prevs.push(innerLinesPrev);\r\n\t\t\t}\r\n\t\t\tinnerLinesPrev=line;\r\n\t\t};\r\n\t\tconst closeEntryInnerLines=()=>{\r\n\t\t\tif (innerLinesPrev!==null) {\r\n\t\t\t\tinnerLinesRoot.push(innerLinesPrev);\r\n\t\t\t}\r\n\t\t\tinnerLinesPrev=null;\r\n\t\t};\r\n\t\tconst writeInnerLines=()=>{\r\n\t\t\tconst lines=[];\r\n\t\t\tlet currentCond=null;\r\n\t\t\tconst writeLine=(line,vertex)=>{\r\n\t\t\t\tlet newCond=null;\r\n\t\t\t\tif (vertex.conds!==null) {\r\n\t\t\t\t\tnewCond=vertex.conds.join(' || ');\r\n\t\t\t\t}\r\n\t\t\t\tif (newCond!=currentCond) {\r\n\t\t\t\t\tif (currentCond!==null) {\r\n\t\t\t\t\t\tlines.push(\"}\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrentCond=newCond;\r\n\t\t\t\t\tif (currentCond!==null) {\r\n\t\t\t\t\t\tlines.push(\"if (\"+currentCond+\") {\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (currentCond!==null) {\r\n\t\t\t\t\tlines.push('\\t'+line);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.push(line);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst recVertex=(line,vertex)=>{\r\n\t\t\t\tvertex.mark=GRAY;\r\n\t\t\t\trecPrevs(vertex.prevs);\r\n\t\t\t\tvertex.mark=BLACK;\r\n\t\t\t\twriteLine(line,vertex);\r\n\t\t\t};\r\n\t\t\tconst recPrevs=(prevs)=>{\r\n\t\t\t\tprevs.forEach((line)=>{\r\n\t\t\t\t\tif (innerLinesGraph[line].mark==WHITE) {\r\n\t\t\t\t\t\trecVertex(line,innerLinesGraph[line]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\trecPrevs(innerLinesRoot);\r\n\t\t\tif (currentCond!==null) {\r\n\t\t\t\tlines.push(\"}\");\r\n\t\t\t}\r\n\t\t\treturn new Lines(lines);\r\n\t\t};\r\n\t\tthis.entries.forEach((entry)=>{\r\n\t\t\tentry.pre.forEach(line=>{\r\n\t\t\t\taddInnerLine(line,null);\r\n\t\t\t});\r\n\t\t\tif (haveToLogInput) {\r\n\t\t\t\tentry.log.forEach(line=>{\r\n\t\t\t\t\taddInnerLine(line,entry.cond);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tentry.post.forEach(line=>{\r\n\t\t\t\taddInnerLine(line,entry.cond);\r\n\t\t\t});\r\n\t\t\tif (haveToUpdateCanvas) {\r\n\t\t\t\taddInnerLine(\"scheduleFrame();\",entry.cond);\r\n\t\t\t}\r\n\t\t\tcloseEntryInnerLines();\r\n\t\t});\r\n\t\tconst br=this.bracketListener();\r\n\t\tlet innerLines=writeInnerLines();\r\n\t\tif (!innerLines.isEmpty()) {\r\n\t\t\tinnerLines=new Lines(\r\n\t\t\t\tthis.innerPrependedLines(),\r\n\t\t\t\tinnerLines\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (innerLines.data.length==1) {\r\n\t\t\tconst match=/^(\\w+)\\(\\);$/.exec(innerLines.data[0]);\r\n\t\t\tif (match) {\r\n\t\t\t\treturn this.wrapCall(\r\n\t\t\t\t\tnew Lines(\r\n\t\t\t\t\t\tbr[0]+match[1]+br[1]\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t// TODO what if no match?\r\n\t\t}\r\n\t\tif (innerLines.data.length) {\r\n\t\t\treturn this.wrapCall(\r\n\t\t\t\tinnerLines.wrap(\r\n\t\t\t\t\tbr[0]+\"function(\"+this.bracketFnArg()+\"){\",\r\n\t\t\t\t\t\"}\"+br[1]\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new Lines;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass Slider extends Base {\r\n\tconstructor(id) {\r\n\t\tsuper();\r\n\t\tthis.id=id;\r\n\t}\r\n\tbracketListener() {\r\n\t\treturn [\"document.getElementById('\"+this.id+\"').addEventListener('change',\",\");\"];\r\n\t}\r\n}\r\n\r\nclass MultipleSlider extends Base {\r\n\tconstructor(query) {\r\n\t\tsuper();\r\n\t\tthis.query=query;\r\n\t}\r\n\twrapCall(lines) {\r\n\t\treturn lines.wrap(\r\n\t\t\t\"[].forEach.call(document.querySelectorAll('\"+this.query+\"'),function(el){\",\r\n\t\t\t\"});\"\r\n\t\t);\r\n\t}\r\n\tbracketListener() {\r\n\t\treturn [\"el.addEventListener('change',\",\");\"];\r\n\t}\r\n}\r\n\r\nclass CanvasMousemove extends Base {\r\n\tenter() {\r\n\t\tconst proxy=super.enter();\r\n\t\tconst floatHelper=(minMaxFlag,varFlag,inputType,varName,minValue,maxValue)=>{\r\n\t\t\tconst VarName=varName.charAt(0).toUpperCase()+varName.slice(1);\r\n\t\t\tlet dest;\r\n\t\t\tif (minValue==0 && maxValue==1) {\r\n\t\t\t\tdest=(varFlag?\"var \":\"\")+varName+\"=\";\r\n\t\t\t} else {\r\n\t\t\t\tproxy.pre(\"var min\"+VarName+\"=\"+minValue+\";\");\r\n\t\t\t\tproxy.pre(\"var max\"+VarName+\"=\"+maxValue+\";\");\r\n\t\t\t\tdest=(varFlag?\"var \":\"\")+varName+\"=min\"+VarName+\"+(max\"+VarName+\"-min\"+VarName+\")*\";\r\n\t\t\t}\r\n\t\t\treturn proxy.prexy(\r\n\t\t\t\tinputType,\r\n\t\t\t\tdest+\"(ev.clientX-rect.left)/(rect.width-1);\",\r\n\t\t\t\tdest+\"(rect.bottom-1-ev.clientY)/(rect.height-1);\"\r\n\t\t\t);\r\n\t\t};\r\n\t\tproxy.prexy=function(inputType,xLine,yLine){\r\n\t\t\tif (inputType.axis=='x') {\r\n\t\t\t\treturn proxy.pre(xLine);\r\n\t\t\t} else if (inputType.axis=='y') {\r\n\t\t\t\treturn proxy.pre(yLine);\r\n\t\t\t}\r\n\t\t\treturn proxy;\r\n\t\t};\r\n\t\tproxy.minMaxFloat=function(inputType,varName,minValue,maxValue){\r\n\t\t\treturn floatHelper(true,false,inputType,varName,minValue,maxValue);\r\n\t\t};\r\n\t\tproxy.minMaxVarFloat=function(inputType,varName,minValue,maxValue){\r\n\t\t\treturn floatHelper(true,true,inputType,varName,minValue,maxValue);\r\n\t\t};\r\n\t\tproxy.newVarInt=function(inputType,varName){\r\n\t\t\tconst VarName=varName.charAt(0).toUpperCase()+varName.slice(1);\r\n\t\t\treturn proxy.prexy(\r\n\t\t\t\tinputType,\r\n\t\t\t\t\"var new\"+VarName+\"=Math.floor(min\"+VarName+\"+(max\"+VarName+\"-min\"+VarName+\"+1)*(ev.clientX-rect.left)/rect.width);\",\r\n\t\t\t\t\"var new\"+VarName+\"=Math.floor(min\"+VarName+\"+(max\"+VarName+\"-min\"+VarName+\"+1)*(rect.bottom-1-ev.clientY)/rect.height);\"\r\n\t\t\t);\r\n\t\t};\r\n\t\treturn proxy;\r\n\t}\r\n\tbracketListener() {\r\n\t\treturn [\"canvas.addEventListener('mousemove',\",\");\"];\r\n\t}\r\n\tbracketFnArg() {\r\n\t\treturn \"ev\";\r\n\t}\r\n\tinnerPrependedLines() {\r\n\t\treturn [\r\n\t\t\t\"var rect=this.getBoundingClientRect();\",\r\n\t\t];\r\n\t}\r\n}\r\n\r\nexports.Slider=Slider;\r\nexports.MultipleSlider=MultipleSlider;\r\nexports.CanvasMousemove=CanvasMousemove;\r\n","'use strict';\r\n\r\nlet idCounter=0;\r\nfunction generateId() {\r\n\treturn 'webgl-starter-id-'+(idCounter++);\r\n}\r\n\r\nconst i18n=require('./i18n.js');\r\nconst Option=require('./option-classes.js');\r\nconst Options=require('./options.js');\r\nconst generateCode=require('./code.js');\r\n\r\nfunction getHtmlDataUri(html) {\r\n\t// with base64: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/btoa\r\n\t//return \"data:text/html;charset=utf-8;base64,\"+window.btoa(unescape(encodeURIComponent(str)));\r\n\t// without base64: https://en.wikipedia.org/wiki/Data_URI_scheme\r\n\treturn 'data:text/html;charset=utf-8,'+encodeURIComponent(html);\r\n}\r\n\r\n$(function(){\r\n\t$('.webgl-starter').each(function(){\r\n\t\tconst $container=$(this);\r\n\t\tlet $options,$code;\r\n\t\tconst options=new Options();\r\n\t\tconst codeUpdateDelay=200;\r\n\t\tlet codeUpdateTimeoutId=null;\r\n\t\tfunction updateCode() {\r\n\t\t\tclearTimeout(codeUpdateTimeoutId);\r\n\t\t\tcodeUpdateTimeoutId=setTimeout(function(){\r\n\t\t\t\t$code.text(generateCode(options.fix(),i18n));\r\n\t\t\t\tif (window.hljs) hljs.highlightBlock($code[0]);\r\n\t\t\t},codeUpdateDelay);\r\n\t\t}\r\n\t\toptions.updateCallback=updateCode;\r\n\t\tfunction writeOption(option) {\r\n\t\t\tif (option instanceof Option.Root) {\r\n\t\t\t\treturn option.$=$(\"<div>\").append(\r\n\t\t\t\t\toption.entries.map(writeOption)\r\n\t\t\t\t);\r\n\t\t\t} else if (option instanceof Option.Group) {\r\n\t\t\t\treturn option.$=$(\"<fieldset>\").append(\"<legend>\"+i18n('options.'+option.fullName)+\"</legend>\").append(\r\n\t\t\t\t\toption.entries.map(writeOption)\r\n\t\t\t\t);\r\n\t\t\t} else if (option instanceof Option.Checkbox) {\r\n\t\t\t\tconst id=generateId();\r\n\t\t\t\treturn option.$=$(\"<div>\")\r\n\t\t\t\t\t.append(\r\n\t\t\t\t\t\t$(\"<input type='checkbox' id='\"+id+\"'>\")\r\n\t\t\t\t\t\t\t.prop('checked',option.value)\r\n\t\t\t\t\t\t\t.change(function(){\r\n\t\t\t\t\t\t\t\toption.value=$(this).prop('checked');\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.append(\" <label for='\"+id+\"'>\"+i18n('options.'+option.fullName)+\"</label>\");\r\n\t\t\t} else if (option instanceof Option.Select) {\r\n\t\t\t\tconst id=generateId();\r\n\t\t\t\toption.$=$(\"<div>\")\r\n\t\t\t\t\t.append(\"<label for='\"+id+\"'>\"+i18n('options.'+option.fullName)+\":</label>\")\r\n\t\t\t\t\t.append(\" \")\r\n\t\t\t\t\t.append(\r\n\t\t\t\t\t\t$(\"<select id='\"+id+\"'>\").append(\r\n\t\t\t\t\t\t\toption.availableValues.map(function(availableValue){\r\n\t\t\t\t\t\t\t\treturn $(\"<option>\").val(availableValue).html(i18n('options.'+option.fullName+'.'+availableValue))\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t).val(option.value).change(function(){\r\n\t\t\t\t\t\t\toption.value=this.value;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\tif (option.name=='elements') {\r\n\t\t\t\t\toption.$.append(\" \"+i18n('message.elements'));\r\n\t\t\t\t}\r\n\t\t\t\treturn option.$;\r\n\t\t\t} else if (option instanceof Option.LiveNumber) {\r\n\t\t\t\tconst writeOption=option=>{\r\n\t\t\t\t\tconst setInputAttrs=$input=>$input\r\n\t\t\t\t\t\t.attr('min',option.availableMin)\r\n\t\t\t\t\t\t.attr('max',option.availableMax)\r\n\t\t\t\t\t\t.attr('step',option.step);\r\n\t\t\t\t\tconst setInputAttrsAndListeners=($input,getOtherInput)=>setInputAttrs($input)\r\n\t\t\t\t\t\t.val(option.value)\r\n\t\t\t\t\t\t.on('input change',function(){\r\n\t\t\t\t\t\t\tif (this.checkValidity()) {\r\n\t\t\t\t\t\t\t\tconst $that=getOtherInput();\r\n\t\t\t\t\t\t\t\t$that.val(this.value);\r\n\t\t\t\t\t\t\t\toption.value=parseFloat(this.value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\tconst writeMinMaxInput=minOrMax=>setInputAttrs($(\"<input type='number' required>\"))\r\n\t\t\t\t\t\t.val(option[minOrMax])\r\n\t\t\t\t\t\t.on('input change',function(){\r\n\t\t\t\t\t\t\tif (this.checkValidity()) {\r\n\t\t\t\t\t\t\t\toption[minOrMax]=parseFloat(this.value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\tconst id=generateId();\r\n\t\t\t\t\tconst inputSelectId=generateId();\r\n\t\t\t\t\tlet $sliderInput,$numberInput,$inputSelect;\r\n\t\t\t\t\tlet $rangeMinInput,$rangeMaxInput;\r\n\t\t\t\t\treturn $(\"<div>\").append(\"<label for='\"+id+\"'>\"+i18n('options.'+option.fullName)+\":</label>\")\r\n\t\t\t\t\t\t.append(\" <span class='min'>\"+i18n(`options.${option.fullName}.value`,option.availableMin)+\"</span> \")\r\n\t\t\t\t\t\t.append($sliderInput=setInputAttrsAndListeners(\r\n\t\t\t\t\t\t\t$(\"<input type='range' id='\"+id+\"'>\"),\r\n\t\t\t\t\t\t\t()=>$numberInput\r\n\t\t\t\t\t\t))\r\n\t\t\t\t\t\t.append(\" <span class='max'>\"+i18n(`options.${option.fullName}.value`,option.availableMax)+\"</span> \")\r\n\t\t\t\t\t\t.append($numberInput=setInputAttrsAndListeners(\r\n\t\t\t\t\t\t\t$(\"<input type='number' required>\"),\r\n\t\t\t\t\t\t\t()=>$sliderInput\r\n\t\t\t\t\t\t))\r\n\t\t\t\t\t\t.append(\" <label for='\"+inputSelectId+\"'>\"+i18n('ui.inputs')+\":</label> \")\r\n\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t$inputSelect=$(\"<select id='\"+inputSelectId+\"'>\").append(\r\n\t\t\t\t\t\t\t\toption.availableInputTypes.map(availableInputType=>\r\n\t\t\t\t\t\t\t\t\t$(\"<option>\").val(availableInputType).html(i18n('ui.inputs.'+availableInputType))\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t).val(option.input).change(function(){\r\n\t\t\t\t\t\t\t\toption.input=this.value;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.append(\" \")\r\n\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\toption.$range=$(\"<span class='range'>\")\r\n\t\t\t\t\t\t\t\t.append(i18n('ui.range')+\" \")\r\n\t\t\t\t\t\t\t\t.append($rangeMinInput=writeMinMaxInput('min'))\r\n\t\t\t\t\t\t\t\t.append(\" .. \")\r\n\t\t\t\t\t\t\t\t.append($rangeMaxInput=writeMinMaxInput('max'))\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.append(\" \")\r\n\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t$(\"<button type='button'>\"+i18n('ui.reset')+\"</button>\").click(function(){\r\n\t\t\t\t\t\t\t\t$sliderInput.val(option.defaultValue).change();\r\n\t\t\t\t\t\t\t\t$inputSelect.val('constant').change();\r\n\t\t\t\t\t\t\t\t$rangeMinInput.val(option.availableMin).change();\r\n\t\t\t\t\t\t\t\t$rangeMaxInput.val(option.availableMax).change();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t\toption.$=writeOption(option);\r\n\t\t\t\tif (option instanceof Option.LiveFloat) {\r\n\t\t\t\t\toption.$.append(\r\n\t\t\t\t\t\toption.$addSpeed=$(\"<label> \"+i18n('ui.addSpeed')+\"</label>\").prepend(\r\n\t\t\t\t\t\t\t$(\"<input type='checkbox'>\")\r\n\t\t\t\t\t\t\t\t.prop('checked',option.addSpeed)\r\n\t\t\t\t\t\t\t\t.change(function(){\r\n\t\t\t\t\t\t\t\t\toption.addSpeed=this.checked;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t\t\toption.$.append(\" \").append(option.speed.$=writeOption(option.speed));\r\n\t\t\t\t}\r\n\t\t\t\treturn option.$;\r\n\t\t\t} else if (option instanceof Option.Array) {\r\n\t\t\t\tlet $dragged=null;\r\n\t\t\t\tlet $entries;\r\n\t\t\t\tconst updateArrayEntries=()=>{\r\n\t\t\t\t\toption.entries=$entries.children().map(function(){\r\n\t\t\t\t\t\treturn $(this).data('option');\r\n\t\t\t\t\t}).get();\r\n\t\t\t\t};\r\n\t\t\t\tconst writeDraggableOption=option=>{\r\n\t\t\t\t\t// have to make drag handler 'draggable', not the whole item\r\n\t\t\t\t\t// because inputs and labels don't like to be inside 'draggable'\r\n\t\t\t\t\t// http://stackoverflow.com/questions/13017177/selection-disabled-while-using-html5-drag-and-drop\r\n\t\t\t\t\treturn $(\"<div class='draggable-with-handle'>\")\r\n\t\t\t\t\t\t.data('option',option)\r\n\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t$(\"<div draggable='true' tabindex='0' title='\"+i18n('ui.drag')+\"'>\")\r\n\t\t\t\t\t\t\t\t.on('dragstart',function(ev){\r\n\t\t\t\t\t\t\t\t\t$dragged=$(this).parent();\r\n\t\t\t\t\t\t\t\t\tev.originalEvent.dataTransfer.effectAllowed='move';\r\n\t\t\t\t\t\t\t\t\tev.originalEvent.dataTransfer.setData('Text',name);\r\n\t\t\t\t\t\t\t\t\tif (ev.originalEvent.dataTransfer.setDragImage) { // doesn't work in IE\r\n\t\t\t\t\t\t\t\t\t\tev.originalEvent.dataTransfer.setDragImage($dragged[0],0,0);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\t\t\t\t$dragged.addClass('ghost');\r\n\t\t\t\t\t\t\t\t\t},0);\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.keydown(function(ev){\r\n\t\t\t\t\t\t\t\t\tconst $handle=$(this);\r\n\t\t\t\t\t\t\t\t\tconst $sorted=$handle.parent();\r\n\t\t\t\t\t\t\t\t\tif (ev.keyCode==38) {\r\n\t\t\t\t\t\t\t\t\t\t$sorted.prev().before($sorted);\r\n\t\t\t\t\t\t\t\t\t\t$handle.focus();\r\n\t\t\t\t\t\t\t\t\t\tupdateArrayEntries();\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t} else if (ev.keyCode==40) {\r\n\t\t\t\t\t\t\t\t\t\t$sorted.next().after($sorted);\r\n\t\t\t\t\t\t\t\t\t\t$handle.focus();\r\n\t\t\t\t\t\t\t\t\t\tupdateArrayEntries();\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.append(writeOption(option))\r\n\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t$(\"<div tabindex='0' class='delete' title='\"+i18n('ui.delete')+\"'>×</div>\")\r\n\t\t\t\t\t\t\t\t.click(function(){\r\n\t\t\t\t\t\t\t\t\t$(this).parent().remove();\r\n\t\t\t\t\t\t\t\t\tupdateArrayEntries();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.keydown(function(ev){\r\n\t\t\t\t\t\t\t\t\tif (ev.keyCode==13 || ev.keyCode==32) {\r\n\t\t\t\t\t\t\t\t\t\t$(this).parent().remove();\r\n\t\t\t\t\t\t\t\t\t\tupdateArrayEntries();\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.on('dragover',function(ev){\r\n\t\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\t\tev.originalEvent.dataTransfer.dropEffect='move';\r\n\t\t\t\t\t\t\tconst $target=$(this);\r\n\t\t\t\t\t\t\tif ($dragged) {\r\n\t\t\t\t\t\t\t\tif ($target.nextAll().is($dragged)) {\r\n\t\t\t\t\t\t\t\t\t$target.before($dragged);\r\n\t\t\t\t\t\t\t\t\tupdateArrayEntries();\r\n\t\t\t\t\t\t\t\t} else if ($target.prevAll().is($dragged)) {\r\n\t\t\t\t\t\t\t\t\t$target.after($dragged);\r\n\t\t\t\t\t\t\t\t\tupdateArrayEntries();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on('drop',function(ev){\r\n\t\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on('dragend',function(ev){\r\n\t\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\t\tif ($dragged) {\r\n\t\t\t\t\t\t\t\t$dragged.removeClass('ghost');\r\n\t\t\t\t\t\t\t\t$dragged=null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\toption.$=$(\"<fieldset>\").append(\"<legend>\"+i18n('options.'+option.fullName)+\"</legend>\")\r\n\t\t\t\t\t.append(\r\n\t\t\t\t\t\t$entries=$(\"<div>\")\r\n\t\t\t\t\t\t\t.append(option.entries.map(writeDraggableOption))\r\n\t\t\t\t\t);\r\n\t\t\t\tconst $buttons=$(\"<div>\");\r\n\t\t\t\toption.availableTypes.forEach((type,i)=>{\r\n\t\t\t\t\tif (i) $buttons.append(\" \");\r\n\t\t\t\t\t$buttons.append(\r\n\t\t\t\t\t\t$(\"<button type='button'>\")\r\n\t\t\t\t\t\t\t.html(i18n('options.'+option.fullName+'.'+type+'.add'))\r\n\t\t\t\t\t\t\t.click(function(){\r\n\t\t\t\t\t\t\t\tconst entry=option.addEntry(type);\r\n\t\t\t\t\t\t\t\t$entries.append(writeDraggableOption(entry));\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t\toption.$.append($buttons);\r\n\t\t\t\treturn option.$;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction writeButtons() {\r\n\t\t\treturn $(\"<div>\").append(\r\n\t\t\t\t$(\"<a download='source.html'><button type='button'>Save source code</button></a>\").click(function(){\r\n\t\t\t\t\t// yes I want a button, but download attr is only available for links\r\n\t\t\t\t\t$(this).attr('href',getHtmlDataUri($code.text()));\r\n\t\t\t\t})\r\n\t\t\t).append(\r\n\t\t\t\t\" \"\r\n\t\t\t).append(\r\n\t\t\t\t$(\"<button type='button'>Run in new window</button>\").click(function(){\r\n\t\t\t\t\twindow.open(getHtmlDataUri($code.text()),\"generatedCode\");\r\n\t\t\t\t})\r\n\t\t\t).append(\r\n\t\t\t\t\" these buttons don't work in Internet Explorer, copy-paste the code manually\"\r\n\t\t\t)\r\n\t\t}\r\n\t\t$container.empty().append($options=writeOption(options.root));\r\n\t\t$container.append(writeButtons()).append(\r\n\t\t\t$(\"<pre>\").append($code=$(\"<code>\").text(generateCode(options.fix(),i18n)))\r\n\t\t);\r\n\t\tif (window.hljs) {\r\n\t\t\thljs.highlightBlock($code[0]);\r\n\t\t} else {\r\n\t\t\t$container.append(\"<p>\"+i18n('message.hljs')+\"</p>\");\r\n\t\t}\r\n\t\t$container.append(writeButtons());\r\n\t});\r\n});\r\n","'use strict';\r\n\r\nconst Input=require('./input-classes.js');\r\nconst Lines=require('./lines.js');\r\nconst Feature=require('./feature.js');\r\n\r\nclass NumericFeature extends Feature {\r\n\t// private:\r\n\tgetHtmlControlMessageForValue(i18n,value,name) {\r\n\t\tif (value.input instanceof Input.MouseMove) {\r\n\t\t\treturn new Lines(\r\n\t\t\t\t\"<li>\"+i18n('controls.type.'+value.input)+\" \"+i18n('controls.to')+\" <strong>\"+i18n('options.'+name)+\"</strong></li>\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new Lines;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports=NumericFeature;\r\n","'use strict';\r\n\r\nconst Input=require('./input-classes.js');\r\nconst imports=require('./base/option-classes.js');\r\n\r\nconst RangeInput=imports.RangeInput;\r\nconst Group=imports.Group;\r\n\r\n// abstract classes\r\n\r\nclass LiveNumber extends RangeInput {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,availableRange,defaultValue) {\r\n\t\tlet dataValue,dataMin,dataMax,dataInput;\r\n\t\tif (typeof data == 'object') {\r\n\t\t\tdataValue=data.value;\r\n\t\t\tdataMin  =data.min;\r\n\t\t\tdataMax  =data.max;\r\n\t\t\tdataInput=data.input;\r\n\t\t} else {\r\n\t\t\tdataValue=data;\r\n\t\t}\r\n\t\tsuper(name,dataValue,isVisible,updateCallback,fullName,availableRange,defaultValue);\r\n\t\tthis._min=(dataMin!==undefined)?dataMin:this.availableMin;\r\n\t\tthis._max=(dataMax!==undefined)?dataMax:this.availableMax;\r\n\t\tthis._input=(dataInput!==undefined)?dataInput:'constant';\r\n\t\tthis._$range=null;\r\n\t}\r\n\tupdateInternalVisibility() {\r\n\t\tif (this._$range) this._$range.toggle(this._input!='constant');\r\n\t}\r\n\tget input() {\r\n\t\treturn this._input;\r\n\t}\r\n\tset input(input) {\r\n\t\tthis._input=input;\r\n\t\tthis.updateInternalVisibility();\r\n\t\tthis.updateCallback();\r\n\t}\r\n\tget min() {\r\n\t\treturn this._min;\r\n\t}\r\n\tset min(min) {\r\n\t\tthis._min=min;\r\n\t\tthis.updateCallback();\r\n\t}\r\n\tget max() {\r\n\t\treturn this._max;\r\n\t}\r\n\tset max(max) {\r\n\t\tthis._max=max;\r\n\t\tthis.updateCallback();\r\n\t}\r\n\tget $range() {\r\n\t\treturn this._$range;\r\n\t}\r\n\tset $range($range) {\r\n\t\tthis._$range=$range;\r\n\t\tthis.updateInternalVisibility();\r\n\t}\r\n\texportHelper(src,data) {\r\n\t\tif (src.min!=src.availableMin) data.min=src.min;\r\n\t\tif (src.max!=src.availableMax) data.max=src.max;\r\n\t\tif (src.input!='constant') data.input=src.input;\r\n\t\tif (Object.keys(data).length>0) {\r\n\t\t\tif (src.value!=src.defaultValue) data.value=src.value;\r\n\t\t\treturn data;\r\n\t\t} else {\r\n\t\t\treturn src.value!=src.defaultValue ? src.value : null;\r\n\t\t}\r\n\t}\r\n\texport() {\r\n\t\treturn this.exportHelper(this,{});\r\n\t}\r\n\tfixToDefaultHelper(src) {\r\n\t\tconst fixed=new Number(src.defaultValue);\r\n\t\tfixed.min=src.availableMin;\r\n\t\tfixed.max=src.availableMax;\r\n\t\tfixed.input=Input.createFromString('constant');\r\n\t\t// needed for formatting:\r\n\t\tfixed.availableMin=src.availableMin;\r\n\t\tfixed.availableMax=src.availableMax;\r\n\t\tfixed.step=src.step;\r\n\t\treturn fixed;\r\n\t}\r\n\tfixHelper(src) {\r\n\t\tconst fixed=new Number(src.value); // TODO try it's own class like Input\r\n\t\tfixed.min=src.min;\r\n\t\tfixed.max=src.max;\r\n\t\tfixed.input=Input.createFromString(src.input);\r\n\t\t// needed for formatting and to decide on clamp()/wrap():\r\n\t\tfixed.availableMin=src.availableMin;\r\n\t\tfixed.availableMax=src.availableMax;\r\n\t\tfixed.step=src.step;\r\n\t\treturn fixed;\r\n\t}\r\n\tfix() {\r\n\t\treturn this.fixHelper(this);\r\n\t}\r\n}\r\n\r\n// concrete classes\r\n\r\nclass LiveInt extends LiveNumber {\r\n\tget step() {\r\n\t\treturn 1;\r\n\t}\r\n\tget availableInputTypes() {\r\n\t\treturn ['constant','slider','mousemovex','mousemovey'];\r\n\t}\r\n}\r\n\r\nclass CanvasLiveInt extends LiveInt {\r\n\tget availableInputTypes() {\r\n\t\treturn ['constant','slider'];\r\n\t}\r\n}\r\n\r\nclass LiveFloat extends LiveNumber {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,availableRange,defaultValue) {\r\n\t\tlet dataSpeedValue,dataSpeedMin,dataSpeedMax,dataSpeedInput;\r\n\t\tif (typeof data == 'object') {\r\n\t\t\tif (typeof data.speed == 'object') {\r\n\t\t\t\tdataSpeedValue=data.speed.value;\r\n\t\t\t\tdataSpeedMin  =data.speed.min;\r\n\t\t\t\tdataSpeedMax  =data.speed.max;\r\n\t\t\t\tdataSpeedInput=data.speed.input;\r\n\t\t\t} else {\r\n\t\t\t\tdataSpeedValue=data.speed;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsuper(name,data,isVisible,updateCallback,fullName,availableRange,defaultValue);\r\n\t\tthis._speedValue=(dataSpeedValue!==undefined)?dataSpeedValue:0;\r\n\t\tthis._speedAvailableMin=availableRange[2]; this._speedMin=(dataSpeedMin!==undefined)?dataSpeedMin:this._speedAvailableMin;\r\n\t\tthis._speedAvailableMax=availableRange[3]; this._speedMax=(dataSpeedMax!==undefined)?dataSpeedMax:this._speedAvailableMax;\r\n\t\tthis._speedInput=(dataSpeedInput!==undefined)?dataSpeedInput:'constant';\r\n\t\tthis._addSpeed=!(\r\n\t\t\tthis._speedValue==0 &&\r\n\t\t\tthis._speedMin==this._speedAvailableMin &&\r\n\t\t\tthis._speedMax==this._speedAvailableMax &&\r\n\t\t\tthis._speedInput=='constant'\r\n\t\t);\r\n\t\tthis._speed$=null;\r\n\t\tthis._$addSpeed=null;\r\n\t}\r\n\tupdateInternalVisibility() {\r\n\t\tsuper.updateInternalVisibility();\r\n\t\tconst notGamepad=['gamepad0','gamepad1','gamepad2','gamepad3'].indexOf(this._input)<0;\r\n\t\tif (this._speed$) this._speed$.toggle(\r\n\t\t\tthis._addSpeed && notGamepad\r\n\t\t);\r\n\t\tif (this._$addSpeed) this._$addSpeed.toggle(notGamepad);\r\n\t}\r\n\tget addSpeed() {\r\n\t\treturn this._addSpeed;\r\n\t}\r\n\tset addSpeed(addSpeed) {\r\n\t\tthis._addSpeed=addSpeed;\r\n\t\tthis.updateInternalVisibility();\r\n\t\tthis.updateCallback();\r\n\t}\r\n\tget step() {\r\n\t\tif (this.availableMax>=100) {\r\n\t\t\treturn '0.1';\r\n\t\t} else if (this.availableMax>=10) {\r\n\t\t\treturn '0.01';\r\n\t\t} else {\r\n\t\t\treturn '0.001';\r\n\t\t}\r\n\t}\r\n\tget availableInputTypes() {\r\n\t\treturn ['constant','slider','mousemovex','mousemovey','gamepad0','gamepad1','gamepad2','gamepad3'];\r\n\t}\r\n\tget speed() {\r\n\t\tconst option=this;\r\n\t\treturn {\r\n\t\t\tget fullName() {\r\n\t\t\t\treturn option.fullName+'.speed';\r\n\t\t\t},\r\n\t\t\tget defaultValue() {\r\n\t\t\t\treturn 0;\r\n\t\t\t},\r\n\t\t\tget value() {\r\n\t\t\t\treturn option._speedValue;\r\n\t\t\t},\r\n\t\t\tset value(value) {\r\n\t\t\t\toption._speedValue=value;\r\n\t\t\t\toption.updateCallback();\r\n\t\t\t},\r\n\t\t\tget input() {\r\n\t\t\t\treturn option._speedInput;\r\n\t\t\t},\r\n\t\t\tset input(input) {\r\n\t\t\t\toption._speedInput=input;\r\n\t\t\t\toption.updateCallback();\r\n\t\t\t},\r\n\t\t\tget availableMin() {\r\n\t\t\t\treturn option._speedAvailableMin;\r\n\t\t\t},\r\n\t\t\tget availableMax() {\r\n\t\t\t\treturn option._speedAvailableMax;\r\n\t\t\t},\r\n\t\t\tget min() {\r\n\t\t\t\treturn option._speedMin;\r\n\t\t\t},\r\n\t\t\tset min(min) {\r\n\t\t\t\toption._speedMin=min;\r\n\t\t\t\toption.updateCallback();\r\n\t\t\t},\r\n\t\t\tget max() {\r\n\t\t\t\treturn option._speedMax;\r\n\t\t\t},\r\n\t\t\tset max(max) {\r\n\t\t\t\toption._speedMax=max;\r\n\t\t\t\toption.updateCallback();\r\n\t\t\t},\r\n\t\t\tget step() {\r\n\t\t\t\treturn option.step;\r\n\t\t\t},\r\n\t\t\tget availableInputTypes() {\r\n\t\t\t\treturn option.availableInputTypes;\r\n\t\t\t},\r\n\t\t\tget $() {\r\n\t\t\t\treturn option._speed$;\r\n\t\t\t},\r\n\t\t\tset $($) {\r\n\t\t\t\toption._speed$=$;\r\n\t\t\t\toption.updateInternalVisibility();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tget $addSpeed() {\r\n\t\treturn this._$addSpeed;\r\n\t}\r\n\tset $addSpeed($addSpeed) {\r\n\t\tthis._$addSpeed=$addSpeed;\r\n\t\tthis.updateInternalVisibility();\r\n\t}\r\n\texport() {\r\n\t\tconst notGamepad=['gamepad0','gamepad1','gamepad2','gamepad3'].indexOf(this.input)<0\r\n\t\tconst data={};\r\n\t\tlet speedData=null;\r\n\t\tif (notGamepad && this.addSpeed) speedData=this.exportHelper(this.speed,{});\r\n\t\tif (speedData!==null) data.speed=speedData;\r\n\t\treturn this.exportHelper(this,data);\r\n\t}\r\n\tfix() {\r\n\t\tconst notGamepad=['gamepad0','gamepad1','gamepad2','gamepad3'].indexOf(this.input)<0\r\n\t\tconst fixed=this.fixHelper(this);\r\n\t\tif (notGamepad && this.addSpeed) {\r\n\t\t\tfixed.speed=this.fixHelper(this.speed);\r\n\t\t} else {\r\n\t\t\tfixed.speed=this.fixToDefaultHelper(this.speed);\r\n\t\t}\r\n\t\treturn fixed;\r\n\t}\r\n}\r\n\r\nclass LiveColor extends Group {\r\n\tconstructor(name,data,isVisible,updateCallback,fullName,colorComponentDefaultValues) {\r\n\t\tconst cs='rgba';\r\n\t\tsuper(name,undefined,isVisible,updateCallback,fullName,colorComponentDefaultValues.map((defaultValue,i)=>{\r\n\t\t\tconst c=cs.charAt(i);\r\n\t\t\tlet subData;\r\n\t\t\tif (typeof data == 'object') subData=data[c];\r\n\t\t\treturn new LiveFloat(c,subData,()=>true,updateCallback,fullName+'.'+c,[0,1,-1,+1],defaultValue);\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nmodule.exports={};\r\nfor (let c in imports) {\r\n\tmodule.exports[c]=imports[c];\r\n}\r\nmodule.exports.LiveNumber=LiveNumber;\r\nmodule.exports.LiveInt=LiveInt;\r\nmodule.exports.CanvasLiveInt=CanvasLiveInt;\r\nmodule.exports.LiveFloat=LiveFloat;\r\nmodule.exports.LiveColor=LiveColor;\r\n","'use strict';\r\n\r\nvar BaseOptions=require('./base/options.js');\r\n\r\nclass Options extends BaseOptions {\r\n\tget optionClasses() {\r\n\t\treturn require('./option-classes.js');\r\n\t}\r\n\tget entriesDescription() {\r\n\t\treturn [\r\n\t\t\t['Group','canvas',[\r\n\t\t\t\t['CanvasLiveInt','width',[1,1024],512],\r\n\t\t\t\t['CanvasLiveInt','height',[1,1024],512],\r\n\t\t\t]],\r\n\t\t\t['Group','background',[\r\n\t\t\t\t['Select','type',['none','solid']],\r\n\t\t\t\t['LiveColor','color',[1,1,1,1],{'background.type':'solid'}],\r\n\t\t\t]],\r\n\t\t\t['Group','material',[\r\n\t\t\t\t['Select','scope',['global','vertex','face']], // partly related to shape\r\n\t\t\t\t['Select','data',['one','sda']], // partly related to shape\r\n\t\t\t\t['LiveColor','color',[1,0,0,1],{'material.scope':'global','material.data':'one'}],\r\n\t\t\t\t['LiveColor','specularColor',[0.4,0.4,0.4],{'material.scope':'global','material.data':'sda'}],\r\n\t\t\t\t['LiveColor','diffuseColor' ,[0.4,0.4,0.4],{'material.scope':'global','material.data':'sda'}],\r\n\t\t\t\t['LiveColor','ambientColor' ,[0.2,0.2,0.2],{'material.scope':'global','material.data':'sda'}],\r\n\t\t\t]],\r\n\t\t\t['Group','light',[\r\n\t\t\t\t['Select','type',['off','phong','blinn']],\r\n\t\t\t\t['Group','direction',[\r\n\t\t\t\t\t['LiveFloat','x',[-4,+4,-4,+4],-1],\r\n\t\t\t\t\t['LiveFloat','y',[-4,+4,-4,+4],+1],\r\n\t\t\t\t\t['LiveFloat','z',[-4,+4,-4,+4],+1],\r\n\t\t\t\t],{'light.type':['phong','blinn']}],\r\n\t\t\t]],\r\n\t\t\t['Group','shape',[\r\n\t\t\t\t['Select','type',['square','triangle','gasket','cube','hat','terrain']],\r\n\t\t\t\t['Select','elements',['0','8','16','32']],\r\n\t\t\t\t['LiveInt','lod',[0,10],6,{'shape.type':['gasket','hat','terrain']}],\r\n\t\t\t]],\r\n\t\t\t['Group','transforms',[\r\n\t\t\t\t['Select','projection',['ortho','perspective']],\r\n\t\t\t\t['Array','model',[\r\n\t\t\t\t\t['LiveFloat','rotate.x',[-180,+180,-360,+360],0],\r\n\t\t\t\t\t['LiveFloat','rotate.y',[-180,+180,-360,+360],0],\r\n\t\t\t\t\t['LiveFloat','rotate.z',[-180,+180,-360,+360],0],\r\n\t\t\t\t]],\r\n\t\t\t]],\r\n\t\t\t['Group','debug',[\r\n\t\t\t\t['Checkbox','shaders',true],\r\n\t\t\t\t['Checkbox','arrays'],\r\n\t\t\t\t['Checkbox','inputs'], // TODO hide if no inputs?\r\n\t\t\t\t['Checkbox','animations'],\r\n\t\t\t]],\r\n\t\t\t['Group','formatting',[\r\n\t\t\t\t['Select','indent',['tab','2','4','8']],\r\n\t\t\t]],\r\n\t\t];\r\n\t}\r\n}\r\n\r\nmodule.exports=Options;\r\n","'use strict';\r\n\r\nexports.Square=require('./shapes/square.js');\r\nexports.Triangle=require('./shapes/triangle.js');\r\nexports.Gasket=require('./shapes/gasket.js');\r\nexports.Cube=require('./shapes/cube.js');\r\nexports.Hat=require('./shapes/hat.js');\r\nexports.Terrain=require('./shapes/terrain.js');\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst Colorgen=require('../colorgen.js');\r\nconst Shape=require('./shape.js');\r\n\r\nclass Cube extends Shape {\r\n\tget dim() { return 3; }\r\n\tget twoSided() { return false; }\r\n\twriteArrays() {\r\n\t\tconst colorgen=new Colorgen(\r\n\t\t\tthis.colorAttrs,\r\n\t\t\t0, // TODO remove 'clean' colors after bilinear interp is implemented\r\n\t\t\tthis.hasColorsPerFace?undefined:[\r\n\t\t\t\t[0.0, 0.0, 0.0],\r\n\t\t\t\t[1.0, 0.0, 0.0],\r\n\t\t\t\t[0.0, 1.0, 0.0],\r\n\t\t\t\t[1.0, 1.0, 0.0],\r\n\t\t\t\t[0.0, 0.0, 1.0],\r\n\t\t\t\t[1.0, 0.0, 1.0],\r\n\t\t\t\t[0.0, 1.0, 1.0],\r\n\t\t\t\t[1.0, 1.0, 1.0],\r\n\t\t\t]\r\n\t\t);\r\n\t\tconst nCubeVertices=8;\r\n\t\tconst cubeColors=[];\r\n\t\tfor (let i=0;i<nCubeVertices;i++) {\r\n\t\t\tcubeColors.push(colorgen.getNextColorString());\r\n\t\t}\r\n\t\tconst cubeVertexPositions=[\r\n\t\t\t\"-0.5,-0.5,-0.5,\",\r\n\t\t\t\"+0.5,-0.5,-0.5,\",\r\n\t\t\t\"-0.5,+0.5,-0.5,\",\r\n\t\t\t\"+0.5,+0.5,-0.5,\",\r\n\t\t\t\"-0.5,-0.5,+0.5,\",\r\n\t\t\t\"+0.5,-0.5,+0.5,\",\r\n\t\t\t\"-0.5,+0.5,+0.5,\",\r\n\t\t\t\"+0.5,+0.5,+0.5,\",\r\n\t\t];\r\n\t\tconst nCubeFaces=6;\r\n\t\tconst cubeFaceNames=[\r\n\t\t\t\"left\",\r\n\t\t\t\"right\",\r\n\t\t\t\"bottom\",\r\n\t\t\t\"top\",\r\n\t\t\t\"back\",\r\n\t\t\t\"front\",\r\n\t\t];\r\n\t\tconst cubeFaceNormals=[\r\n\t\t\t\"-1.0, 0.0, 0.0,\",\r\n\t\t\t\"+1.0, 0.0, 0.0,\",\r\n\t\t\t\" 0.0,-1.0, 0.0,\",\r\n\t\t\t\" 0.0,+1.0, 0.0,\",\r\n\t\t\t\" 0.0, 0.0,-1.0,\",\r\n\t\t\t\" 0.0, 0.0,+1.0,\",\r\n\t\t];\r\n\t\tconst cubeFaceVertices=[\r\n\t\t\t[4, 6, 0, 2],\r\n\t\t\t[1, 3, 5, 7],\r\n\t\t\t[0, 1, 4, 5],\r\n\t\t\t[2, 6, 3, 7],\r\n\t\t\t[0, 2, 1, 3],\r\n\t\t\t[5, 7, 4, 6],\r\n\t\t];\r\n\t\tconst quadToTriangleMap=[0, 1, 2, 2, 1, 3];\r\n\t\tconst vertexLines=new Lines;\r\n\t\tvertexLines.a(\"// x    y    z\");\r\n\t\tif (this.hasNormals) {\r\n\t\t\tvertexLines.t(\"  n.x  n.y  n.z\");\r\n\t\t}\r\n\t\tvertexLines.t(colorgen.getHeaderString());\r\n\t\tconst appendVertex=(iFace,iVertex,firstInFace)=>{\r\n\t\t\tvertexLines.a(cubeVertexPositions[iVertex]);\r\n\t\t\tif (this.hasNormals) {\r\n\t\t\t\tvertexLines.t(cubeFaceNormals[iFace]);\r\n\t\t\t}\r\n\t\t\tif (this.hasColorsPerVertex) {\r\n\t\t\t\tvertexLines.t(cubeColors[iVertex]);\r\n\t\t\t} else if (this.hasColorsPerFace) {\r\n\t\t\t\tvertexLines.t(cubeColors[iFace]);\r\n\t\t\t}\r\n\t\t\tif (firstInFace) {\r\n\t\t\t\tvertexLines.t(\" // \"+cubeFaceNames[iFace]+\" face\");\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (!this.usesElements()) {\r\n\t\t\tfor (let i=0;i<nCubeFaces;i++) {\r\n\t\t\t\tquadToTriangleMap.forEach(function(j,k){\r\n\t\t\t\t\tappendVertex(i,cubeFaceVertices[i][j],k==0);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn new Lines(\r\n\t\t\t\t\"var nVertices=36;\",\r\n\t\t\t\tvertexLines.wrap(\r\n\t\t\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\t\t\"]);\"\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else if (this.hasColorsPerFace || this.hasNormals) {\r\n\t\t\t// elements, face data\r\n\t\t\tfor (let i=0;i<nCubeFaces;i++) {\r\n\t\t\t\tcubeFaceVertices[i].forEach(function(j,k){\r\n\t\t\t\t\tappendVertex(i,j,k==0);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn new Lines(\r\n\t\t\t\tvertexLines.wrap(\r\n\t\t\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\t\t\"]);\"\r\n\t\t\t\t),\r\n\t\t\t\t\"var nElements=36;\",\r\n\t\t\t\t\"var elements=new \"+this.getElementIndexJsArray()+\"([\",\r\n\t\t\t\t\"\t 0,  1,  2,  2,  1,  3, // left face\",\r\n\t\t\t\t\"\t 4,  5,  6,  6,  5,  7, // right face\",\r\n\t\t\t\t\"\t 8,  9, 10, 10,  9, 11, // bottom face\",\r\n\t\t\t\t\"\t12, 13, 14, 14, 13, 15, // top face\",\r\n\t\t\t\t\"\t16, 17, 18, 18, 17, 19, // back face\",\r\n\t\t\t\t\"\t20, 21, 22, 22, 21, 23, // front face\",\r\n\t\t\t\t\"]);\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\t// elements, no face data\r\n\t\t\tfor (let i=0;i<nCubeVertices;i++) {\r\n\t\t\t\tvertexLines.a(cubeVertexPositions[i]);\r\n\t\t\t\tif (this.hasColorsPerVertex) {\r\n\t\t\t\t\tvertexLines.t(cubeColors[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst elementLines=new Lines;\r\n\t\t\tfor (let i=0;i<nCubeFaces;i++) {\r\n\t\t\t\telementLines.a(\"\");\r\n\t\t\t\tquadToTriangleMap.forEach(function(j){\r\n\t\t\t\t\telementLines.t(cubeFaceVertices[i][j]+\", \");\r\n\t\t\t\t});\r\n\t\t\t\telementLines.t(\"// \"+cubeFaceNames[i]+\" face\");\r\n\t\t\t}\r\n\t\t\treturn new Lines(\r\n\t\t\t\tvertexLines.wrap(\r\n\t\t\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\t\t\"]);\"\r\n\t\t\t\t),\r\n\t\t\t\t\"var nElements=36;\",\r\n\t\t\t\telementLines.wrap(\r\n\t\t\t\t\t\"var elements=new \"+this.getElementIndexJsArray()+\"([\",\r\n\t\t\t\t\t\"]);\"\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports=Cube;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst LodShape=require('./lodshape.js');\r\n\r\nclass Gasket extends LodShape {\r\n\tgetDistinctVertexCount(lodSymbol) {\r\n\t\treturn \"(Math.pow(3,\"+lodSymbol+\"+1)+3)/2\";\r\n\t}\r\n\tgetFaceVertexCount(lodSymbol) {\r\n\t\treturn \"Math.pow(3,\"+lodSymbol+\")*3\";\r\n\t}\r\n\tgetTotalVertexCount(lodSymbol) {\r\n\t\treturn \"Math.pow(3,\"+lodSymbol+\")*3\";\r\n\t}\r\n\twriteStoreShape() {\r\n\t\tconst writePushVertex=()=>{\r\n\t\t\tconst lines=new Lines;\r\n\t\t\tlines.a(\r\n\t\t\t\t\"vertices[nextIndexIntoVertices++]=p[0];\",\r\n\t\t\t\t\"vertices[nextIndexIntoVertices++]=p[1];\"\r\n\t\t\t);\r\n\t\t\tif (this.hasColorsPerVertex || this.hasColorsPerFace) {\r\n\t\t\t\tif (!this.usesElements() || this.hasColorsPerFace) {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"colors[nextIndexIntoColors]\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"colors[nextElement%colors.length]\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\".forEach(function(cc){\",\r\n\t\t\t\t\t\"\tvertices[nextIndexIntoVertices++]=cc;\",\r\n\t\t\t\t\t\"});\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (this.usesElements()) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"return nextElement++;\"\r\n\t\t\t\t);\r\n\t\t\t} else if (this.hasColorsPerVertex) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"nextIndexIntoColors=(nextIndexIntoColors+1)%colors.length;\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn lines.wrap(\r\n\t\t\t\t\"function pushVertex(p) {\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t};\r\n\t\tconst writeTriangle=()=>{\r\n\t\t\tconst lines=new Lines;\r\n\t\t\tlines.a(\r\n\t\t\t\t\"if (depth<=0) {\"\r\n\t\t\t);\r\n\t\t\tif (!this.usesElements()) {\r\n\t\t\t\tif (this.hasColorsPerFace) {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"\tpushVertex(p0);\",\r\n\t\t\t\t\t\t\"\tpushVertex(p1);\",\r\n\t\t\t\t\t\t\"\tpushVertex(p2);\",\r\n\t\t\t\t\t\t\"\tnextIndexIntoColors=(nextIndexIntoColors+1)%colors.length;\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"\tpushVertex(p0);\",\r\n\t\t\t\t\t\t\"\tpushVertex(p1);\",\r\n\t\t\t\t\t\t\"\tpushVertex(p2);\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.hasColorsPerFace) {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"\tpushElement(pushVertex(p0));\",\r\n\t\t\t\t\t\t\"\tpushElement(pushVertex(p1));\",\r\n\t\t\t\t\t\t\"\tpushElement(pushVertex(p2));\",\r\n\t\t\t\t\t\t\"\tnextIndexIntoColors=(nextIndexIntoColors+1)%colors.length;\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"\tif (es[0]===null) es[0]=pushVertex(p0);\",\r\n\t\t\t\t\t\t\"\tif (es[1]===null) es[1]=pushVertex(p1);\",\r\n\t\t\t\t\t\t\"\tif (es[2]===null) es[2]=pushVertex(p2);\",\r\n\t\t\t\t\t\t\"\tpushElement(es[0]);\",\r\n\t\t\t\t\t\t\"\tpushElement(es[1]);\",\r\n\t\t\t\t\t\t\"\tpushElement(es[2]);\",\r\n\t\t\t\t\t\t\"\treturn es;\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlines.a(\r\n\t\t\t\t\"} else {\",\r\n\t\t\t\t\"\tvar p01=mix(p0,p1);\",\r\n\t\t\t\t\"\tvar p12=mix(p1,p2);\",\r\n\t\t\t\t\"\tvar p20=mix(p2,p0);\"\r\n\t\t\t);\r\n\t\t\tif (!this.usesElements()) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"\ttriangle(depth-1,p0,p01,p20);\",\r\n\t\t\t\t\t\"\ttriangle(depth-1,p1,p12,p01);\",\r\n\t\t\t\t\t\"\ttriangle(depth-1,p2,p20,p12);\"\r\n\t\t\t\t);\r\n\t\t\t} else if (this.hasColorsPerFace) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"\tvar es0=triangle(depth-1,p0,p01,p20);\",\r\n\t\t\t\t\t\"\tvar es1=triangle(depth-1,p1,p12,p01);\",\r\n\t\t\t\t\t\"\tvar es2=triangle(depth-1,p2,p20,p12);\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"\tvar es0=triangle(depth-1,p0,p01,p20,[es[0],null,null]);\",\r\n\t\t\t\t\t\"\tvar es1=triangle(depth-1,p1,p12,p01,[es[1],null,es0[1]]);\",\r\n\t\t\t\t\t\"\tvar es2=triangle(depth-1,p2,p20,p12,[es[2],es0[2],es1[1]]);\",\r\n\t\t\t\t\t\"\treturn [es0[0],es1[0],es2[0]];\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlines.a(\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t\tif (!this.usesElements() || this.hasColorsPerFace) {\r\n\t\t\t\treturn lines.wrap(\r\n\t\t\t\t\t\"function triangle(depth,p0,p1,p2) {\",\r\n\t\t\t\t\t\"}\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\treturn lines.wrap(\r\n\t\t\t\t\t\"function triangle(depth,p0,p1,p2,es) {\",\r\n\t\t\t\t\t\"}\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst writeInitialTriangleCall=()=>{\r\n\t\t\tconst lines=new Lines;\r\n\t\t\tlines.a(\r\n\t\t\t\t\"shapeLod,\",\r\n\t\t\t\t\"[-Math.sin(0/3*Math.PI),Math.cos(0/3*Math.PI)],\",\r\n\t\t\t\t\"[-Math.sin(2/3*Math.PI),Math.cos(2/3*Math.PI)],\",\r\n\t\t\t\t\"[-Math.sin(4/3*Math.PI),Math.cos(4/3*Math.PI)]\"\r\n\t\t\t);\r\n\t\t\tif (this.usesElements() && !this.hasColorsPerFace) {\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\",\",\"[null,null,null]\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn lines.wrap(\r\n\t\t\t\t\"triangle(\",\r\n\t\t\t\t\");\"\r\n\t\t\t);\r\n\t\t};\r\n\t\tconst lines=new Lines;\r\n\t\tlines.a(\r\n\t\t\t\"var nextIndexIntoVertices=0;\"\r\n\t\t);\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var nextIndexIntoElements=0;\",\r\n\t\t\t\t\"var nextElement=0;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.hasColorsPerVertex || this.hasColorsPerFace) {\r\n\t\t\tlines.a(\"// p = position, cc = color component, e = element, es = elements\");\r\n\t\t\tlines.a(this.writeColorData());\r\n\t\t\tif (!this.usesElements() || this.hasColorsPerFace) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var nextIndexIntoColors=0;\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"// p = position, e = element, es = elements\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(writePushVertex());\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"function pushElement(e) {\",\r\n\t\t\t\t\"\telements[nextIndexIntoElements++]=e;\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(\r\n\t\t\t\"function mix(pa,pb) {\",\r\n\t\t\t\"\treturn [\",\r\n\t\t\t\"\t\t(pa[0]+pb[0])/2,\",\r\n\t\t\t\"\t\t(pa[1]+pb[1])/2,\",\r\n\t\t\t\"\t];\",\r\n\t\t\t\"}\",\r\n\t\t\twriteTriangle(),\r\n\t\t\twriteInitialTriangleCall()\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Gasket;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst Mesh=require('./mesh.js');\r\n\r\nclass Hat extends Mesh {\r\n\twriteMeshInit() {\r\n\t\treturn new Lines(\r\n\t\t\t\"var xyRange=4;\",\r\n\t\t\t\"var xyScale=1/(4*Math.sqrt(2));\"\r\n\t\t);\r\n\t}\r\n\twriteMeshVertex() {\r\n\t\tconst lines=new Lines;\r\n\t\tlet iv=0;\r\n\t\tlines.a(\r\n\t\t\t\"var r2=(x*x+y*y)/2;\",\r\n\t\t\t\"var A=Math.exp(-r2)/Math.PI;\",\r\n\t\t\t\"var z=A*(1-r2);\",\r\n\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=x*xyScale;\",\r\n\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=y*xyScale;\",\r\n\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=z;\"\r\n\t\t);\r\n\t\tif (this.hasNormals) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var normal=normalize([(z+A)*x/xyScale,(z+A)*y/xyScale,1]);\",\r\n\t\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=normal[0];\",\r\n\t\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=normal[1];\",\r\n\t\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=normal[2];\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(this.writeMeshVertexColors(iv));\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Hat;\r\n","'use strict';\r\n\r\nconst fixOptHelp=require('../fixed-options-helpers.js');\r\nconst Input=require('../input-classes.js');\r\nconst Lines=require('../lines.js');\r\nconst Listener=require('../listener-classes.js');\r\nconst Colorgen=require('../colorgen.js');\r\nconst Shape=require('./shape.js');\r\nconst IntFeature=require('../int-feature.js');\r\n\r\nclass LodShape extends Shape {\r\n\tconstructor(options,hasReflections,hasColorsPerVertex,hasColorsPerFace,colorAttrs) {\r\n\t\tsuper(options,hasReflections,hasColorsPerVertex,hasColorsPerFace,colorAttrs);\r\n\t\tthis.lod=fixOptHelp.capNumber(options.lod,this.getMaxPossibleLod(options.lod.max));\r\n\t\tthis.features.push(\r\n\t\t\tnew IntFeature('shape.lod',this.lod)\r\n\t\t);\r\n\t}\r\n\tgetMaxPossibleLod(requestedMaxLod) { // due to element index type\r\n\t\tif (!this.usesElements() || this.elementIndexBits>=31) { // 1<<31 is a negative number, can't compare with it\r\n\t\t\treturn requestedMaxLod; // no need to limit lod if elements are not used or index type is large enough\r\n\t\t}\r\n\t\tconst nVerticesFn = this.hasColorsPerFace\r\n\t\t\t? this.getFaceVertexCount\r\n\t\t\t: this.getDistinctVertexCount;\r\n\t\tconst indexLimit=1<<this.elementIndexBits;\r\n\t\tfor (let m=requestedMaxLod;m>=0;m--) {\r\n\t\t\tlet n=eval(nVerticesFn(m));\r\n\t\t\tif (n<=indexLimit) {\r\n\t\t\t\treturn m;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// TODO fail here\r\n\t}\r\n\twriteColorData() {\r\n\t\tconst lines=new Lines;\r\n\t\tconst colorgen=new Colorgen(this.colorAttrs,0);\r\n\t\tfor (let i=0;i<4;i++) {\r\n\t\t\tlines.a(\"[\"+colorgen.getNextColorString().slice(1,-1)+\"],\");\r\n\t\t}\r\n\t\treturn lines.wrap(\r\n\t\t\t\"var colors=[\",\r\n\t\t\t\"];\"\r\n\t\t);\r\n\t}\r\n\t// abstract getDistinctVertexCount(lodSymbol) {} // # of distinct vertices where one vertex can be shared between different faces and output primitives\r\n\t// abstract getFaceVertexCount(lodSymbol) {} // # of distinct (vertex,face) pairs that still can be shared between output primitives\r\n\t// abstract getTotalVertexCount(lodSymbol) {} // # of vertices in output primitives = # of elements when element arrays are in use\r\n\t// abstract writeStoreShape() {}\r\n\twriteArraysAndBufferData(debugArrays) {\r\n\t\tconst nVerticesFn = this.hasColorsPerFace\r\n\t\t\t? this.getFaceVertexCount\r\n\t\t\t: this.getDistinctVertexCount;\r\n\t\tconst lines=new Lines;\r\n\t\tif (this.lod.input!='constant') {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var minShapeLod=\"+this.lod.min+\";\",\r\n\t\t\t\t\"var maxShapeLod=\"+this.lod.max+\";\"\r\n\t\t\t);\r\n\t\t\tif (this.usesElements()) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var nMaxVertices=\"+nVerticesFn(\"maxShapeLod\")+\";\",\r\n\t\t\t\t\t\"var vertices=new Float32Array(nMaxVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\t\"var nMaxElements=\"+this.getTotalVertexCount(\"maxShapeLod\")+\";\",\r\n\t\t\t\t\t\"var elements=new \"+this.getElementIndexJsArray()+\"(nMaxElements);\",\r\n\t\t\t\t\tthis.writeDebug(debugArrays),\r\n\t\t\t\t\t\"var shapeLod,nVertices,nElements;\",\r\n\t\t\t\t\t\"function storeShape(newShapeLod) {\",\r\n\t\t\t\t\t\"\tshapeLod=newShapeLod;\",\r\n\t\t\t\t\t\"\tnVertices=\"+nVerticesFn(\"shapeLod\")+\";\",\r\n\t\t\t\t\t\"\tnElements=\"+this.getTotalVertexCount(\"shapeLod\")+\";\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var nMaxVertices=\"+this.getTotalVertexCount(\"maxShapeLod\")+\";\",\r\n\t\t\t\t\t\"var vertices=new Float32Array(nMaxVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\tthis.writeDebug(debugArrays),\r\n\t\t\t\t\t\"var shapeLod,nVertices;\",\r\n\t\t\t\t\t\"function storeShape(newShapeLod) {\",\r\n\t\t\t\t\t\"\tshapeLod=newShapeLod;\",\r\n\t\t\t\t\t\"\tnVertices=\"+this.getTotalVertexCount(\"shapeLod\")+\";\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var shapeLod=\"+this.lod+\";\"\r\n\t\t\t);\r\n\t\t\tif (this.usesElements()) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var nVertices=\"+nVerticesFn(\"shapeLod\")+\";\",\r\n\t\t\t\t\t\"var vertices=new Float32Array(nVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\t\"var nElements=\"+this.getTotalVertexCount(\"shapeLod\")+\";\",\r\n\t\t\t\t\t\"var elements=new \"+this.getElementIndexJsArray()+\"(nElements);\",\r\n\t\t\t\t\tthis.writeDebug(debugArrays),\r\n\t\t\t\t\t\"function storeShape() {\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var nVertices=\"+this.getTotalVertexCount(\"shapeLod\")+\";\",\r\n\t\t\t\t\t\"var vertices=new Float32Array(nVertices*\"+this.getNumbersPerVertex()+\");\",\r\n\t\t\t\t\tthis.writeDebug(debugArrays),\r\n\t\t\t\t\t\"function storeShape() {\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlines.a(\r\n\t\t\tthis.writeStoreShape().indent(),\r\n\t\t\tthis.writeBufferData().indent(),\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t\tif (this.lod.input!='constant') {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"storeShape(\"+this.lod+\");\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"storeShape();\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetJsInitLines(featureContext) {\r\n\t\tconst lines=super.getJsInitLines(featureContext);\r\n\t\tif (this.lod.input=='slider') {\r\n\t\t\tvar listener=new Listener.Slider('shape.lod');\r\n\t\t\tlistener.enter()\r\n\t\t\t\t.log(\"console.log(this.id,'input value:',parseInt(this.value));\")\r\n\t\t\t\t.post(\"storeShape(parseInt(this.value));\");\r\n\t\t\tlines.a(\r\n\t\t\t\tfeatureContext.getListenerLines(listener)\r\n\t\t\t);\r\n\t\t} else if (this.lod.input instanceof Input.MouseMove) {\r\n\t\t\tfeatureContext.canvasMousemoveListener.enter()\r\n\t\t\t\t.newVarInt(this.lod.input,'shapeLod')\r\n\t\t\t\t.cond(\"newShapeLod!=shapeLod\")\r\n\t\t\t\t.log(\"console.log('shapeLod input value:',newShapeLod);\")\r\n\t\t\t\t.post(\"storeShape(newShapeLod);\");\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=LodShape;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst LodShape=require('./lodshape.js');\r\n\r\nclass Mesh extends LodShape {\r\n\tget dim() { return 3; }\r\n\tgetDistinctVertexCount(lodSymbol) {\r\n\t\treturn \"Math.pow((1<<\"+lodSymbol+\")+1,2)\";\r\n\t}\r\n\tgetFaceVertexCount(lodSymbol) {\r\n\t\treturn \"Math.pow((1<<\"+lodSymbol+\"),2)*4\";\r\n\t}\r\n\tgetTotalVertexCount(lodSymbol) {\r\n\t\treturn \"Math.pow((1<<\"+lodSymbol+\"),2)*6\";\r\n\t}\r\n\twriteMeshVertexColors(iv) {\r\n\t\tif (this.hasColorsPerVertex || this.hasColorsPerFace) {\r\n\t\t\treturn new Lines(\r\n\t\t\t\t((!this.usesElements() && !this.hasColorsPerFace)\r\n\t\t\t\t\t?\"var ic=((i+di)&1)*2+((j+dj)&1);\"\r\n\t\t\t\t\t:\"var ic=(i&1)*2+(j&1);\"\r\n\t\t\t\t),\r\n\t\t\t\t\"colors[ic].forEach(function(cc,icc){\",\r\n\t\t\t\t\"\tvertices[vertexOffset+\"+iv+\"+icc]=cc;\",\r\n\t\t\t\t\"});\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new Lines;\r\n\t\t}\r\n\t}\r\n\t// abstract writeMeshInit() {}\r\n\t// abstract writeMeshVertex() {}\r\n\twriteStoreShape() {\r\n\t\tconst lines=new Lines;\r\n\t\tlines.a(\r\n\t\t\t\"var res=(1<<shapeLod);\"\r\n\t\t);\r\n\t\tif (!this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"function vertexElement(i,j,k) {\",\r\n\t\t\t\t\"\treturn (i*res+j)*6+k;\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t} else if (this.hasColorsPerFace) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"function vertexElement(i,j,k) {\",\r\n\t\t\t\t\"\treturn (i*res+j)*4+k;\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"function vertexElement(i,j) {\",\r\n\t\t\t\t\"\treturn i*(res+1)+j;\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.hasNormals) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"function normalize(v) {\",\r\n\t\t\t\t\"\tvar l=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);\",\r\n\t\t\t\t\"\treturn [v[0]/l,v[1]/l,v[2]/l];\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.hasColorsPerVertex || this.hasColorsPerFace) {\r\n\t\t\tlines.a(this.writeColorData());\r\n\t\t}\r\n\t\tlines.a(\r\n\t\t\tthis.writeMeshInit()\r\n\t\t);\r\n\t\tif (!this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"for (var i=0;i<res;i++) {\",\r\n\t\t\t\t\"\tfor (var j=0;j<res;j++) {\",\r\n\t\t\t\t\"\t\tfor (var k=0;k<6;k++) {\",\r\n\t\t\t\t\"\t\t\tvar di=[0,0,1,1,0,1][k];\",\r\n\t\t\t\t\"\t\t\tvar dj=[0,1,0,0,1,1][k];\",\r\n\t\t\t\t\"\t\t\tvar y=(i+di)/res*xyRange*2-xyRange;\",\r\n\t\t\t\t\"\t\t\tvar x=(j+dj)/res*xyRange*2-xyRange;\",\r\n\t\t\t\t\"\t\t\tvar vertexOffset=vertexElement(i,j,k)*\"+this.getNumbersPerVertex()+\";\",\r\n\t\t\t\tthis.writeMeshVertex().indent(3),\r\n\t\t\t\t\"\t\t}\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t} else if (this.hasColorsPerFace) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var i,j;\",\r\n\t\t\t\t\"for (i=0;i<res;i++) {\",\r\n\t\t\t\t\"\tfor (j=0;j<res;j++) {\",\r\n\t\t\t\t\"\t\tfor (var k=0;k<4;k++) {\",\r\n\t\t\t\t\"\t\t\tvar di=[0,0,1,1][k];\",\r\n\t\t\t\t\"\t\t\tvar dj=[0,1,0,1][k];\",\r\n\t\t\t\t\"\t\t\tvar y=(i+di)/res*xyRange*2-xyRange;\",\r\n\t\t\t\t\"\t\t\tvar x=(j+dj)/res*xyRange*2-xyRange;\",\r\n\t\t\t\t\"\t\t\tvar vertexOffset=vertexElement(i,j,k)*\"+this.getNumbersPerVertex()+\";\",\r\n\t\t\t\tthis.writeMeshVertex().indent(3),\r\n\t\t\t\t\"\t\t}\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"for (i=0;i<res;i++) {\",\r\n\t\t\t\t\"\tfor (j=0;j<res;j++) {\",\r\n\t\t\t\t\"\t\tvar elementOffset=(i*res+j)*6;\",\r\n\t\t\t\t\"\t\telements[elementOffset+0]=vertexElement(i,j,0);\",\r\n\t\t\t\t\"\t\telements[elementOffset+1]=vertexElement(i,j,1);\",\r\n\t\t\t\t\"\t\telements[elementOffset+2]=vertexElement(i,j,2);\",\r\n\t\t\t\t\"\t\telements[elementOffset+3]=vertexElement(i,j,2);\",\r\n\t\t\t\t\"\t\telements[elementOffset+4]=vertexElement(i,j,1);\",\r\n\t\t\t\t\"\t\telements[elementOffset+5]=vertexElement(i,j,3);\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var i,j;\",\r\n\t\t\t\t\"for (i=0;i<=res;i++) {\",\r\n\t\t\t\t\"\tvar y=i/res*xyRange*2-xyRange;\",\r\n\t\t\t\t\"\tfor (j=0;j<=res;j++) {\",\r\n\t\t\t\t\"\t\tvar x=j/res*xyRange*2-xyRange;\",\r\n\t\t\t\t\"\t\tvar vertexOffset=vertexElement(i,j)*\"+this.getNumbersPerVertex()+\";\",\r\n\t\t\t\tthis.writeMeshVertex().indent(2),\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\",\r\n\t\t\t\t\"for (i=0;i<res;i++) {\",\r\n\t\t\t\t\"\tfor (j=0;j<res;j++) {\",\r\n\t\t\t\t\"\t\tvar elementOffset=(i*res+j)*6;\",\r\n\t\t\t\t\"\t\telements[elementOffset+0]=vertexElement(i+0,j+0);\",\r\n\t\t\t\t\"\t\telements[elementOffset+1]=vertexElement(i+0,j+1);\",\r\n\t\t\t\t\"\t\telements[elementOffset+2]=vertexElement(i+1,j+0);\",\r\n\t\t\t\t\"\t\telements[elementOffset+3]=vertexElement(i+1,j+0);\",\r\n\t\t\t\t\"\t\telements[elementOffset+4]=vertexElement(i+0,j+1);\",\r\n\t\t\t\t\"\t\telements[elementOffset+5]=vertexElement(i+1,j+1);\",\r\n\t\t\t\t\"\t}\",\r\n\t\t\t\t\"}\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Mesh;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst Feature=require('../feature.js');\r\n\r\nclass Shape extends Feature {\r\n\tconstructor(options,hasReflections,hasColorsPerVertex,hasColorsPerFace,colorAttrs) {\r\n\t\tsuper();\r\n\t\tthis.elementIndexBits=parseInt(options.elements); // 0 if don't want element arrays; 8, 16 or 32 bits per element index, limits lod of shape\r\n\t\tthis.hasNormals=(hasReflections && this.dim==3); // true = need normals, unless shape is flat\r\n\t\tthis.hasColorsPerVertex=hasColorsPerVertex; // TODO support for both hasColorsPerVertex and hasColorsPerFace == true\r\n\t\tthis.hasColorsPerFace=hasColorsPerFace;\r\n\t\tthis.colorAttrs=colorAttrs; // array of color attribute structs {name,enabled,weight}\r\n\t}\r\n\tget dim() { return 2; }\r\n\tget twoSided() { return true; } // triangles can be viewed from both sides\r\n\tget glPrimitive() { return 'TRIANGLES'; }\r\n\tusesElements() { // TODO convert to getter\r\n\t\treturn this.elementIndexBits>0;\r\n\t}\r\n\tgetNumbersPerVertex() {\r\n\t\treturn this.dim+(this.hasNormals?3:0)+this.colorAttrs.length*3;\r\n\t}\r\n\tgetElementIndexJsArray() {\r\n\t\treturn \"Uint\"+this.elementIndexBits+\"Array\";\r\n\t}\r\n\tgetElementIndexGlType() {\r\n\t\tif (this.elementIndexBits==8) {\r\n\t\t\treturn \"gl.UNSIGNED_BYTE\"; // not recommended by ms [https://msdn.microsoft.com/en-us/library/dn798776%28v=vs.85%29.aspx]\r\n\t\t} else if (this.elementIndexBits==16) {\r\n\t\t\treturn \"gl.UNSIGNED_SHORT\"; // mozilla examples use this\r\n\t\t} else if (this.elementIndexBits==32) {\r\n\t\t\treturn \"gl.UNSIGNED_INT\"; // needs extension\r\n\t\t}\r\n\t}\r\n\twriteDebug(debugArrays) {\r\n\t\tconst lines=new Lines;\r\n\t\tif (debugArrays) {\r\n\t\t\tlines.a(\"console.log('vertex array byte length:',vertices.byteLength);\");\r\n\t\t\tif (this.usesElements()) {\r\n\t\t\t\tlines.a(\"console.log('element array byte length:',elements.byteLength);\");\r\n\t\t\t\tlines.a(\"console.log('vertex+element array byte length:',vertices.byteLength+elements.byteLength);\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\twriteBufferData() {\r\n\t\tconst lines=new Lines;\r\n\t\tlines.a(\r\n\t\t\t\"gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);\"\r\n\t\t);\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,elements,gl.STATIC_DRAW);\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\twriteArraysAndBufferData(debugArrays) {\r\n\t\treturn new Lines(\r\n\t\t\tthis.writeArrays(),\r\n\t\t\tthis.writeDebug(debugArrays),\r\n\t\t\tthis.writeBufferData()\r\n\t\t);\r\n\t}\r\n\t// public:\r\n\tgetJsInitLines(featureContext) {\r\n\t\tconst lines=super.getJsInitLines(featureContext);\r\n\t\tif (this.elementIndexBits==32) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl.getExtension('OES_element_index_uint');\" // TODO check if null is returned and don't allow more elements\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.dim>2) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl.enable(gl.DEPTH_TEST);\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(\r\n\t\t\t\"gl.bindBuffer(gl.ARRAY_BUFFER,gl.createBuffer());\"\r\n\t\t);\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,gl.createBuffer());\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(\r\n\t\t\tthis.writeArraysAndBufferData(featureContext.debugOptions.arrays)\r\n\t\t);\r\n\t\tconst writeVertexAttribArrays=(attrs)=>{\r\n\t\t\tconst cmpSize=attrs[0][0];\r\n\t\t\tconst allSameSize=attrs.every((attr)=>{\r\n\t\t\t\tvar size=attr[0];\r\n\t\t\t\treturn size==cmpSize;\r\n\t\t\t});\r\n\t\t\tlet allEnabled=true;\r\n\t\t\tconst arrayLines=new Lines;\r\n\t\t\tattrs.forEach((attr)=>{\r\n\t\t\t\tconst size=attr[0];\r\n\t\t\t\tconst name=attr[1];\r\n\t\t\t\tconst enabled=attr[2];\r\n\t\t\t\tif (enabled) {\r\n\t\t\t\t\tarrayLines.a(allSameSize\r\n\t\t\t\t\t\t? \"'\"+name+\"',\"\r\n\t\t\t\t\t\t: \"[\"+size+\",'\"+name+\"'],\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tarrayLines.a(allSameSize\r\n\t\t\t\t\t\t? \"null,\"\r\n\t\t\t\t\t\t: \"[\"+size+\",null],\"\r\n\t\t\t\t\t);\r\n\t\t\t\t\tarrayLines.t(\" // attribute \"+name+\" disabled\");\r\n\t\t\t\t\tallEnabled=false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst foreachEnableLines=new Lines(\r\n\t\t\t\t\"var attrLoc=gl.getAttribLocation(program,attrName);\",\r\n\t\t\t\t\"gl.vertexAttribPointer(\",\r\n\t\t\t\t\"\tattrLoc,attrSize,gl.FLOAT,false,\",\r\n\t\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*bufferStride,\",\r\n\t\t\t\t\"\tFloat32Array.BYTES_PER_ELEMENT*bufferOffset\",\r\n\t\t\t\t\");\",\r\n\t\t\t\t\"gl.enableVertexAttribArray(attrLoc);\"\r\n\t\t\t);\r\n\t\t\tif (!allEnabled) {\r\n\t\t\t\tforeachEnableLines.wrap(\"if (name!==null) {\",\"}\");\r\n\t\t\t}\r\n\t\t\tconst foreachLines=new Lines;\r\n\t\t\tif (allSameSize) {\r\n\t\t\t\tforeachLines.a(\r\n\t\t\t\t\t\"var attrSize=\"+cmpSize+\";\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tforeachLines.a(\r\n\t\t\t\t\t\"var attrSize=attr[0];\",\r\n\t\t\t\t\t\"var attrName=attr[1];\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tforeachLines.a(\r\n\t\t\t\tforeachEnableLines,\r\n\t\t\t\t\"bufferOffset+=attrSize;\"\r\n\t\t\t);\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var bufferStride=\"+this.getNumbersPerVertex()+\";\",\r\n\t\t\t\t\"var bufferOffset=0;\",\r\n\t\t\t\tarrayLines.wrap(\"[\",\"]\")\r\n\t\t\t);\r\n\t\t\tlines.t(\r\n\t\t\t\tforeachLines.wrap(\".forEach(function(\"+(allSameSize?\"attrName\":\"attr\")+\"){\",\"});\")\r\n\t\t\t);\r\n\t\t};\r\n\t\tif (!this.hasNormals && this.colorAttrs.length<=0) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var positionLoc=gl.getAttribLocation(program,'position');\",\r\n\t\t\t\t\"gl.vertexAttribPointer(positionLoc,\"+this.dim+\",gl.FLOAT,false,0,0);\",\r\n\t\t\t\t\"gl.enableVertexAttribArray(positionLoc);\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\twriteVertexAttribArrays(\r\n\t\t\t\t[[this.dim,'position',true]].concat(\r\n\t\t\t\t\tthis.hasNormals?[[3,'normal',true]]:[],\r\n\t\t\t\t\tthis.colorAttrs.map(function(attr){\r\n\t\t\t\t\t\treturn [3,attr.name,attr.enabled];\r\n\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetJsLoopLines(featureContext) {\r\n\t\tconst lines=super.getJsLoopLines(featureContext);\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\"gl.drawElements(gl.\"+this.glPrimitive+\",nElements,\"+this.getElementIndexGlType()+\",0);\");\r\n\t\t} else {\r\n\t\t\tlines.a(\"gl.drawArrays(gl.\"+this.glPrimitive+\",0,nVertices);\");\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Shape;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst Colorgen=require('../colorgen.js');\r\nconst Shape=require('./shape.js');\r\n\r\nclass Square extends Shape {\r\n\tget glPrimitive() { return 'TRIANGLE_FAN'; }\r\n\twriteArrays() {\r\n\t\tconst colorgen=new Colorgen(this.colorAttrs,0);\r\n\t\tlet colorDataForFace;\r\n\t\tconst writeColorData=()=>{\r\n\t\t\tif (this.hasColorsPerFace && !this.hasColorsPerVertex) {\r\n\t\t\t\tif (colorDataForFace===undefined) {\r\n\t\t\t\t\tcolorDataForFace=colorgen.getNextColorString();\r\n\t\t\t\t}\r\n\t\t\t\treturn colorDataForFace;\r\n\t\t\t} else {\r\n\t\t\t\treturn colorgen.getNextColorString();\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst lines=new Lines(\r\n\t\t\t\"var nVertices=4;\",\r\n\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\"\t// x    y\"+colorgen.getHeaderString(),\r\n\t\t\t\"\t-0.5,-0.5,\"+writeColorData(),\r\n\t\t\t\"\t+0.5,-0.5,\"+writeColorData(),\r\n\t\t\t\"\t+0.5,+0.5,\"+writeColorData(),\r\n\t\t\t\"\t-0.5,+0.5,\"+writeColorData(),\r\n\t\t\t\"]);\"\r\n\t\t);\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var nElements=4;\",\r\n\t\t\t\t\"var elements=new \"+this.getElementIndexJsArray()+\"([0,1,2,3]);\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Square;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst Mesh=require('./mesh.js');\r\n\r\nclass Terrain extends Mesh {\r\n\twriteMeshInit() {\r\n\t\tconst noFaces=(this.usesElements() && !this.hasColorsPerFace);\r\n\t\tconst lines=new Lines;\r\n\t\tlines.a(\r\n\t\t\t\"var xyRange=1/Math.sqrt(2);\",\r\n\t\t\t\"var zRange=xyRange;\",\r\n\t\t\t\"var mask=res-1;\",\r\n\t\t\t\"function zOffset(i,j) {\",\r\n\t\t\t\"\treturn vertexElement(i,j\"+(noFaces?\"\":\",0\")+\")*\"+this.getNumbersPerVertex()+\"+2;\",\r\n\t\t\t\"}\",\r\n\t\t\t\"function noise(depth) {\",\r\n\t\t\t\"\tvar r=zRange/Math.pow(2,shapeLod-depth-1);\",\r\n\t\t\t\"\treturn Math.random()*2*r-r;\",\r\n\t\t\t\"}\",\r\n\t\t\t\"vertices[2]=0.0;\",\r\n\t\t\t\"var i0,i1,i2,i3;\",\r\n\t\t\t\"var j0,j1,j2,j3;\",\r\n\t\t\t\"for (var depth=shapeLod-1;depth>=0;depth--) {\",\r\n\t\t\t\"\tvar d=1<<depth;\",\r\n\t\t\t\"\t// diamond step\",\r\n\t\t\t\"\tfor (i2=d;i2<res;i2+=2*d) {\",\r\n\t\t\t\"\t\tfor (j2=d;j2<res;j2+=2*d) {\",\r\n\t\t\t\"\t\t\ti1=i2-d;\",\r\n\t\t\t\"\t\t\tj1=j2-d;\",\r\n\t\t\t\"\t\t\ti3=(i2+d)&mask;\",\r\n\t\t\t\"\t\t\tj3=(j2+d)&mask;\",\r\n\t\t\t\"\t\t\tvertices[zOffset(i2,j2)]=(\",\r\n\t\t\t\"\t\t\t\tvertices[zOffset(i1,j1)]+vertices[zOffset(i1,j3)]+\",\r\n\t\t\t\"\t\t\t\tvertices[zOffset(i3,j1)]+vertices[zOffset(i3,j3)]\",\r\n\t\t\t\"\t\t\t)/4+noise(depth);\",\r\n\t\t\t\"\t\t}\",\r\n\t\t\t\"\t}\",\r\n\t\t\t\"\t// square step\",\r\n\t\t\t\"\tfor (i2=d;i2<res;i2+=2*d) {\",\r\n\t\t\t\"\t\tfor (j2=d;j2<res;j2+=2*d) {\",\r\n\t\t\t\"\t\t\ti0=(i2-2*d)&mask;\",\r\n\t\t\t\"\t\t\tj0=(j2-2*d)&mask;\",\r\n\t\t\t\"\t\t\ti1=(i2-d);\",\r\n\t\t\t\"\t\t\tj1=(j2-d);\",\r\n\t\t\t\"\t\t\ti3=(i2+d)&mask;\",\r\n\t\t\t\"\t\t\tj3=(j2+d)&mask;\",\r\n\t\t\t\"\t\t\tvertices[zOffset(i2,j1)]=(\",\r\n\t\t\t\"\t\t\t\tvertices[zOffset(i2,j0)]+vertices[zOffset(i1,j1)]+\",\r\n\t\t\t\"\t\t\t\tvertices[zOffset(i2,j2)]+vertices[zOffset(i3,j1)]\",\r\n\t\t\t\"\t\t\t)/4+noise(depth);\",\r\n\t\t\t\"\t\t\tvertices[zOffset(i1,j2)]=(\",\r\n\t\t\t\"\t\t\t\tvertices[zOffset(i0,j2)]+vertices[zOffset(i1,j1)]+\",\r\n\t\t\t\"\t\t\t\tvertices[zOffset(i2,j2)]+vertices[zOffset(i1,j3)]\",\r\n\t\t\t\"\t\t\t)/4+noise(depth);\",\r\n\t\t\t\"\t\t}\",\r\n\t\t\t\"\t}\",\r\n\t\t\t\"}\"\r\n\t\t);\r\n\t\tif (noFaces) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"for (i0=0;i0<res;i0++) vertices[zOffset(i0,res)]=vertices[zOffset(i0,0)];\",\r\n\t\t\t\t\"for (j0=0;j0<res;j0++) vertices[zOffset(res,j0)]=vertices[zOffset(0,j0)];\",\r\n\t\t\t\t\"vertices[zOffset(res,res)]=vertices[zOffset(0,0)];\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\twriteMeshVertex() {\r\n\t\tconst noFaces=(this.usesElements() && !this.hasColorsPerFace);\r\n\t\tconst lines=new Lines;\r\n\t\tlines.a(\r\n\t\t\t\"vertices[vertexOffset+0]=x;\",\r\n\t\t\t\"vertices[vertexOffset+1]=y;\",\r\n\t\t\t(noFaces\r\n\t\t\t\t?\"// vertices[vertexOffset+2] already written\"\r\n\t\t\t\t:\"vertices[vertexOffset+2]=vertices[zOffset((i+di)&mask,(j+dj)&mask)];\"\r\n\t\t\t)\r\n\t\t);\r\n\t\tlet iv=3;\r\n\t\tif (this.hasNormals) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var d=4*xyRange/res;\",\r\n\t\t\t\t\"var normal=normalize([\",\r\n\t\t\t\t(noFaces\r\n\t\t\t\t\t?\"\t(vertices[zOffset(i,(j-1)&mask)]-vertices[zOffset(i,(j+1)&mask)])/d,\"\r\n\t\t\t\t\t:\"\t(vertices[zOffset((i+di)&mask,(j+dj-1)&mask)]-vertices[zOffset((i+di)&mask,(j+dj+1)&mask)])/d,\"\r\n\t\t\t\t),\r\n\t\t\t\t(noFaces\r\n\t\t\t\t\t?\"\t(vertices[zOffset((i-1)&mask,j)]-vertices[zOffset((i+1)&mask,j)])/d,\"\r\n\t\t\t\t\t:\"\t(vertices[zOffset((i+di-1)&mask,(j+dj)&mask)]-vertices[zOffset((i+di+1)&mask,(j+dj)&mask)])/d,\"\r\n\t\t\t\t),\r\n\t\t\t\t\"1]);\",\r\n\t\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=normal[0];\",\r\n\t\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=normal[1];\",\r\n\t\t\t\t\"vertices[vertexOffset+\"+(iv++)+\"]=normal[2];\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(this.writeMeshVertexColors(iv));\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Terrain;\r\n","'use strict';\r\n\r\nconst Lines=require('../lines.js');\r\nconst Colorgen=require('../colorgen.js');\r\nconst Shape=require('./shape.js');\r\n\r\nclass Triangle extends Shape {\r\n\twriteArrays() {\r\n\t\tconst colorgen=new Colorgen(this.colorAttrs,0);\r\n\t\tlet colorDataForFace;\r\n\t\tconst writeColorData=()=>{\r\n\t\t\tif (this.hasColorsPerFace && !this.hasColorsPerVertex) {\r\n\t\t\t\tif (colorDataForFace===undefined) {\r\n\t\t\t\t\tcolorDataForFace=colorgen.getNextColorString();\r\n\t\t\t\t}\r\n\t\t\t\treturn colorDataForFace;\r\n\t\t\t} else {\r\n\t\t\t\treturn colorgen.getNextColorString();\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst lines=new Lines(\r\n\t\t\t\"var nVertices=3;\",\r\n\t\t\t\"var vertices=new Float32Array([\",\r\n\t\t\t\"\t//                   x                      y\"+colorgen.getHeaderString(),\r\n\t\t\t\"\t-Math.sin(0/3*Math.PI), Math.cos(0/3*Math.PI),\"+writeColorData(),\r\n\t\t\t\"\t-Math.sin(2/3*Math.PI), Math.cos(2/3*Math.PI),\"+writeColorData(),\r\n\t\t\t\"\t-Math.sin(4/3*Math.PI), Math.cos(4/3*Math.PI),\"+writeColorData(),\r\n\t\t\t\"]);\"\r\n\t\t);\r\n\t\tif (this.usesElements()) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"var nElements=3;\",\r\n\t\t\t\t\"var elements=new \"+this.getElementIndexJsArray()+\"([0,1,2]);\"\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Triangle;\r\n","'use strict';\r\n\r\nconst Options=require('./options.js');\r\nconst fixOptHelp=require('./fixed-options-helpers.js');\r\nconst Lines=require('./lines.js');\r\nconst Feature=require('./feature.js');\r\nconst GlslVector=require('./glsl-vector.js');\r\n\r\nclass Transforms extends Feature {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tthis.options=options;\r\n\t\tthis.rotateVectorEntries=[]; // [{vector,suffix}] like features, but vectors have additional methods that don't follow feature interfaces\r\n\t\tthis.transformSequence=new Array(options.model.length); // [{vector,component,suffix}]\r\n\t\tconst possibleComponents=['x','y','z'];\r\n\t\tconst rotate=[[],[],[]];\r\n\t\toptions.model.forEach((tr,iTr)=>{\r\n\t\t\tconst trData={\r\n\t\t\t\ttransform: tr.value,\r\n\t\t\t\tindex: iTr,\r\n\t\t\t};\r\n\t\t\tif (tr.type=='rotate.x') {\r\n\t\t\t\trotate[0].push(trData);\r\n\t\t\t} else if (tr.type=='rotate.y') {\r\n\t\t\t\trotate[1].push(trData);\r\n\t\t\t} else if (tr.type=='rotate.z') {\r\n\t\t\t\trotate[2].push(trData);\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst nLayers=Math.max.apply(null,rotate.map(r=>r.length));\r\n\t\tfor (let i=0;i<nLayers;i++) {\r\n\t\t\tlet isInGap=false;\r\n\t\t\tlet isStraight=true;\r\n\t\t\tlet lastStraightIndex=-1;\r\n\t\t\tfor (let j=0;j<3;j++) {\r\n\t\t\t\tconst has=i<rotate[j].length;\r\n\t\t\t\tif (isInGap) {\r\n\t\t\t\t\tif (has) {\r\n\t\t\t\t\t\tisStraight=false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (has) {\r\n\t\t\t\t\t\tlastStraightIndex=j;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisInGap=true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst suffix=(nLayers>1?String(i):'');\r\n\t\t\tconst makeVector=(values,names)=>{\r\n\t\t\t\tconst vector=new GlslVector('rotate'+(nLayers>1?'.'+i:''),fixOptHelp.makeCollection(values,names,Options),true);\r\n\t\t\t\tvector.i18nId='transforms.model.rotate';\r\n\t\t\t\tthis.features.push(vector);\r\n\t\t\t\tthis.rotateVectorEntries.push({\r\n\t\t\t\t\tvector: vector,\r\n\t\t\t\t\tsuffix: suffix,\r\n\t\t\t\t});\r\n\t\t\t\treturn vector;\r\n\t\t\t};\r\n\t\t\tconst storeSequenceElement=(vector,j)=>{\r\n\t\t\t\tthis.transformSequence[rotate[j][i].index]={\r\n\t\t\t\t\tvector: vector,\r\n\t\t\t\t\tcomponent: possibleComponents[j],\r\n\t\t\t\t\tsuffix: suffix,\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tif (isStraight) {\r\n\t\t\t\tconst vector=makeVector(\r\n\t\t\t\t\trotate.slice(0,lastStraightIndex+1).map(r=>r[i].transform),\r\n\t\t\t\t\tpossibleComponents.slice(0,lastStraightIndex+1)\r\n\t\t\t\t);\r\n\t\t\t\tfor (let j=0;j<=lastStraightIndex;j++) {\r\n\t\t\t\t\tstoreSequenceElement(vector,j);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let j=0;j<3;j++) {\r\n\t\t\t\t\tconst has=i<rotate[j].length;\r\n\t\t\t\t\tif (has) {\r\n\t\t\t\t\t\tconst vector=makeVector(\r\n\t\t\t\t\t\t\t[rotate[j][i].transform],\r\n\t\t\t\t\t\t\tpossibleComponents.slice(j,j+1)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tstoreSequenceElement(vector,j);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget eyeAtInfinity() {\r\n\t\treturn this.options.projection=='ortho';\r\n\t}\r\n\t// private:\r\n\tuse2dTransform(flatShape) { // has flat shape and exactly one z rotation TODO multiple z rotations\r\n\t\treturn flatShape && this.options.model.length==1 && this.options.model[0].type=='rotate.z';\r\n\t}\r\n\tgetTransformMatricesLines(dim) { // dim==3 for normal transform, dim==4 for position transform\r\n\t\tconst lines=new Lines(\"\");\r\n\t\tconst maxSuffixLength=1; // TODO calculate it\r\n\t\tconst width=4+maxSuffixLength; // 1(sign)+3(c.x)+(max suffix length)\r\n\t\tconst pad=e=>{\r\n\t\t\tif (e.length<width) {\r\n\t\t\t\treturn (\"          \"+e).slice(-width);\r\n\t\t\t} else {\r\n\t\t\t\treturn e;\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst mat=(rows,comment)=>{\r\n\t\t\tlines.t(\"*mat\"+dim+\"( // \"+comment);\r\n\t\t\trows.forEach((row,i)=>{\r\n\t\t\t\tif (i>=dim) return;\r\n\t\t\t\tlines.a(\"\t\");\r\n\t\t\t\trow.forEach((e,j)=>{\r\n\t\t\t\t\tif (j>=dim) return;\r\n\t\t\t\t\tlines.t(pad(e));\r\n\t\t\t\t\tif (i<dim-1 || j<dim-1) lines.t(\",\");\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tlines.a(\")\");\r\n\t\t};\r\n\t\tthis.transformSequence.forEach(ts=>{\r\n\t\t\tif (!ts) return;\r\n\t\t\tconst c=ts.vector.getGlslMapComponentValue('c'+ts.suffix,ts.component);\r\n\t\t\tconst s=ts.vector.getGlslMapComponentValue('s'+ts.suffix,ts.component);\r\n\t\t\tif (ts.component=='x') {\r\n\t\t\t\tmat([\r\n\t\t\t\t\t[\"1.0\",\"0.0\",\"0.0\",\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",    c,\"-\"+s,\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",    s,    c,\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",\"0.0\",\"0.0\",\"1.0\"],\r\n\t\t\t\t],\"rotate around x axis\");\r\n\t\t\t} else if (ts.component=='y') {\r\n\t\t\t\tmat([\r\n\t\t\t\t\t[    c,\"0.0\",    s,\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",\"1.0\",\"0.0\",\"0.0\"],\r\n\t\t\t\t\t[\"-\"+s,\"0.0\",    c,\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",\"0.0\",\"0.0\",\"1.0\"],\r\n\t\t\t\t],\"rotate around y axis\");\r\n\t\t\t} else if (ts.component=='z') {\r\n\t\t\t\tmat([\r\n\t\t\t\t\t[    c,\"-\"+s,\"0.0\",\"0.0\"],\r\n\t\t\t\t\t[    s,    c,\"0.0\",\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",\"0.0\",\"1.0\",\"0.0\"],\r\n\t\t\t\t\t[\"0.0\",\"0.0\",\"0.0\",\"1.0\"],\r\n\t\t\t\t],\"rotate around z axis\");\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (dim==4 && this.options.projection=='perspective') {\r\n\t\t\tmat([\r\n\t\t\t\t[\"1.0\",\"0.0\",\"0.0\",\"0.0\"],\r\n\t\t\t\t[\"0.0\",\"1.0\",\"0.0\",\"0.0\"],\r\n\t\t\t\t[\"0.0\",\"0.0\",\"1.0\",\"-(near+far)/2.0\"],\r\n\t\t\t\t[\"0.0\",\"0.0\",\"0.0\",\"1.0\"],\r\n\t\t\t],\"move center of coords inside view\");\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\t// public:\r\n\tgetGlslVertexDeclarationLines(flatShape) {\r\n\t\tconst lines=new Lines;\r\n\t\tthis.rotateVectorEntries.forEach(rve=>{\r\n\t\t\tlines.a(rve.vector.getGlslDeclarationLines())\r\n\t\t});\r\n\t\tif (this.use2dTransform(flatShape)) {\r\n\t\t\tlines.a(\"attribute vec2 position;\");\r\n\t\t} else {\r\n\t\t\tlines.a(\"attribute vec4 position;\");\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetGlslVertexOutputLines(flatShape,receivesAspect,needTransformedPosition) {\r\n\t\tconst lines=new Lines;\r\n\t\tthis.rotateVectorEntries.forEach(rve=>{\r\n\t\t\tlines.a(\r\n\t\t\t\trve.vector.getGlslMapDeclarationLines('c'+rve.suffix,v=>`cos(radians(${v}))`),\r\n\t\t\t\trve.vector.getGlslMapDeclarationLines('s'+rve.suffix,v=>`sin(radians(${v}))`)\r\n\t\t\t);\r\n\t\t});\r\n\t\tif (this.options.projection=='perspective') {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"float fovy=45.0;\",\r\n\t\t\t\t\"float near=1.0/tan(radians(fovy)/2.0);\",\r\n\t\t\t\t\"float far=near+2.0;\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (needTransformedPosition) {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"vec4 transformedPosition=\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl_Position=\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.use2dTransform(flatShape)) {\r\n\t\t\tlines.t(\r\n\t\t\t\t\"vec4(position*mat2(\",\r\n\t\t\t\t\"\tcz, -sz,\",\r\n\t\t\t\t\"\tsz,  cz\",\r\n\t\t\t\t\"),0,1)\"\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tlines.t(\r\n\t\t\t\t\"position\"\r\n\t\t\t);\r\n\t\t\tlines.t(\r\n\t\t\t\tthis.getTransformMatricesLines(4)\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (needTransformedPosition) {\r\n\t\t\tlines.t(\r\n\t\t\t\t\";\"\r\n\t\t\t);\r\n\t\t\tlines.a(\r\n\t\t\t\t\"gl_Position=transformedPosition\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.options.projection=='ortho') {\r\n\t\t\tif (receivesAspect) {\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\"*vec4(1.0/aspect,1.0,-1.0,1.0)\" // correct aspect ratio and make coords right-handed\r\n\t\t\t\t);\r\n\t\t\t} else if (!flatShape) {\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\"*vec4(1.0,1.0,-1.0,1.0)\" // make coords right-handed for 3d shapes\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else if (this.options.projection=='perspective') {\r\n\t\t\tif (receivesAspect) {\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\"\tnear/aspect, 0.0,  0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,         near, 0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,         0.0,  (near+far)/(near-far), 2.0*near*far/(near-far),\",\r\n\t\t\t\t\t\"\t0.0,         0.0,  -1.0,                  0.0\",\r\n\t\t\t\t\t\")\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tlines.t(\r\n\t\t\t\t\t\"*mat4(\",\r\n\t\t\t\t\t\"\tnear, 0.0,  0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,  near, 0.0,                   0.0,\",\r\n\t\t\t\t\t\"\t0.0,  0.0,  (near+far)/(near-far), 2.0*near*far/(near-far),\",\r\n\t\t\t\t\t\"\t0.0,  0.0,  -1.0,                  0.0\",\r\n\t\t\t\t\t\")\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlines.t(\r\n\t\t\t\";\"\r\n\t\t);\r\n\t\treturn lines;\r\n\t}\r\n\tgetGlslVertexNormalTransformLines() {\r\n\t\treturn this.getTransformMatricesLines(3);\r\n\t}\r\n}\r\n\r\nmodule.exports=Transforms;\r\n","'use strict';\r\n\r\nfunction capitalize(s) {\r\n\treturn s.charAt(0).toUpperCase()+s.slice(1);\r\n}\r\nfunction toCamelCase(s) {\r\n\treturn s.split('.').map((w,i)=>i>0?capitalize(w):w).join('');\r\n}\r\n\r\nclass VectorComponent {\r\n\tconstructor(value,vectorName,suffix,wrapMode) {\r\n\t\tthis.value=value; // value from options.fix()\r\n\t\tthis.vectorName=vectorName;\r\n\t\tthis.suffix=suffix; // usually one letter\r\n\t\tthis.wrapMode=!!wrapMode; // if true and components min/max == their default values, use wrap() instead of clamp()\r\n\t}\r\n\tget name() { return this.vectorName+'.'+this.suffix; }\r\n\tget varName() { return toCamelCase(this.name); }\r\n\tget varNameLoc() { return this.varName+'Loc'; }\r\n\tget varNameSpeed() { return this.varName+'Speed'; }\r\n\tget varNameInput() { return this.varName+'Input'; }\r\n\tget minVarName() { return toCamelCase('min.'+this.name); }\r\n\tget maxVarName() { return toCamelCase('max.'+this.name); }\r\n\tget variable() {\r\n\t\treturn this.value.input!='constant' || this.hasSpeed();\r\n\t}\r\n\thasSpeed() {\r\n\t\treturn this.value.speed!=0 || this.value.speed.input!='constant';\r\n\t}\r\n\thasInput() {\r\n\t\treturn this.value.input!='constant' || this.value.speed.input!='constant';\r\n\t}\r\n\thasInputClass(inputClass) {\r\n\t\treturn this.value.input instanceof inputClass || this.value.speed.input instanceof inputClass;\r\n\t}\r\n\tusesStartTime() {\r\n\t\treturn (this.value.input=='constant' && this.value.speed!=0) && this.value.speed.input=='constant';\r\n\t}\r\n\tusesPrevTime() {\r\n\t\treturn (this.value.input!='constant' && this.value.speed!=0) || this.value.speed.input!='constant';\r\n\t}\r\n\tget wrapReady() {\r\n\t\treturn (\r\n\t\t\tthis.wrapMode &&\r\n\t\t\tthis.value.min==this.value.availableMin && this.value.max==this.value.availableMax && // can wrap only if limits are not changed\r\n\t\t\tthis.value.min==-this.value.max // currently can limit only by absolute value\r\n\t\t);\r\n\t}\r\n\tget wrapped() {\r\n\t\treturn this.hasSpeed() && this.wrapReady && this.value.input=='slider'; // need to wrap only if input with state is used\r\n\t}\r\n\tget clamped() {\r\n\t\treturn !this.wrapped && this.value.speed.input!='constant' && !this.wrapReady;\r\n\t}\r\n\tget capped() {\r\n\t\treturn !this.wrapped && !this.clamped && this.hasSpeed() && !this.wrapReady;\r\n\t}\r\n}\r\n\r\nmodule.exports=VectorComponent;\r\n","'use strict';\r\n\r\nconst fixOptHelp=require('./fixed-options-helpers.js');\r\nconst Input=require('./input-classes.js');\r\nconst Lines=require('./lines.js');\r\nconst Listener=require('./listener-classes.js');\r\nconst VectorComponent=require('./vector-component.js');\r\nconst NumericFeature=require('./numeric-feature.js');\r\n\r\nfunction capitalize(s) {\r\n\treturn s.charAt(0).toUpperCase()+s.slice(1);\r\n}\r\nfunction toCamelCase(s) {\r\n\treturn s.split('.').map((w,i)=>i>0?capitalize(w):w).join('');\r\n}\r\n\r\nclass Vector extends NumericFeature {\r\n\tconstructor(name,values,wrapMode) {\r\n\t\tsuper();\r\n\t\tthis.name=name; // name with dots like \"material.color\", transformed into \"materialColor\" for js var names\r\n\t\tthis.components=[];\r\n\t\tthis.componentsBySuffix={};\r\n\t\tvalues.forEach((v,c)=>{\r\n\t\t\tconst component=new VectorComponent(v,name,c,wrapMode);\r\n\t\t\tthis.components.push(component);\r\n\t\t\tthis.componentsBySuffix[c]=component;\r\n\t\t});\r\n\t\t// { TODO extra ctor args\r\n\t\tthis.i18nId=name;\r\n\t\t// }\r\n\t\tthis.nVars=0;\r\n\t\tthis.modeConstant=true; // all vector components are constants\r\n\t\tthis.modeFloats=false; // one/some vector components are variable, such components get their own glsl vars\r\n\t\tthis.components.forEach((component,i)=>{\r\n\t\t\tif (component.variable) {\r\n\t\t\t\tthis.modeConstant=false;\r\n\t\t\t\tif (this.nVars++!=i) {\r\n\t\t\t\t\tthis.modeFloats=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (this.nVars==1) {\r\n\t\t\tthis.modeFloats=true;\r\n\t\t}\r\n\t\tthis.modeVector=(!this.modeConstant && !this.modeFloats); // first consecutive components are variable, packed into one glsl vector\r\n\t}\r\n\tget varName() { // js/glsl var name\r\n\t\treturn toCamelCase(this.name);\r\n\t}\r\n\tget updateFnName() {\r\n\t\treturn toCamelCase('update.'+this.name);\r\n\t}\r\n\t// fns that can be mapped over components:\r\n\tmakeInitialComponentValue() {\r\n\t\treturn component=>{\r\n\t\t\tif (component.value.input=='slider') {\r\n\t\t\t\treturn \"parseFloat(document.getElementById('\"+component.name+\"').value)\"; // b/c slider could be init'd to a value different than the default\r\n\t\t\t} else {\r\n\t\t\t\treturn fixOptHelp.formatNumber(component.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tmakeUpdatedComponentValue() {\r\n\t\treturn component=>{\r\n\t\t\tif (\r\n\t\t\t\tcomponent.value.speed!=0 || component.value.speed.input!='constant' ||\r\n\t\t\t\tcomponent.value.input instanceof Input.MouseMove || component.value.input instanceof Input.Gamepad\r\n\t\t\t) {\r\n\t\t\t\treturn component.varName;\r\n\t\t\t} else if (component.value.input=='slider') {\r\n\t\t\t\treturn \"parseFloat(document.getElementById('\"+component.name+\"').value)\";\r\n\t\t\t} else {\r\n\t\t\t\treturn fixOptHelp.formatNumber(component.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// abstract fns:\r\n\tgetJsDeclarationLines() { return new Lines; } // Locs etc\r\n\tgetJsUpdateLines(componentValue) { return new Lines; }\r\n\taddPostToListenerEntryForComponent(entry,component) {} // do necessary entry.post()\r\n\taddPostToListenerEntryAfterComponents(entry,componentValue) {} // TODO check if we need componentValue - GlslVector doesn't use it\r\n\t// public:\r\n\thasInputs() {\r\n\t\treturn super.hasInputs() || this.components.some(component=>component.hasInput());\r\n\t}\r\n\trequestFeatureContext(featureContext) {\r\n\t\tsuper.requestFeatureContext(featureContext);\r\n\t\tthis.components.forEach(component=>{\r\n\t\t\tif (component.hasInput()) featureContext.hasInputs=true;\r\n\t\t\tif (component.hasInputClass(Input.Slider)) featureContext.hasSliders=true;\r\n\t\t\tif (component.hasInputClass(Input.Gamepad)) featureContext.pollsGamepad=true;\r\n\t\t\tif (component.usesStartTime()) featureContext.hasStartTime=true;\r\n\t\t\tif (component.usesPrevTime()) featureContext.hasPrevTime=true;\r\n\t\t\tif (component.wrapped) featureContext.hasWrapFn=true;\r\n\t\t\tif (component.clamped) featureContext.hasClampFn=true;\r\n\t\t});\r\n\t}\r\n\tgetHtmlControlMessageLines(i18n) {\r\n\t\tconst lines=super.getHtmlControlMessageLines(i18n);\r\n\t\tthis.components.forEach(component=>{\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.getHtmlControlMessageForValue(i18n,component.value,this.i18nId+'.'+component.suffix),\r\n\t\t\t\tthis.getHtmlControlMessageForValue(i18n,component.value.speed,this.i18nId+'.'+component.suffix+'.speed')\r\n\t\t\t);\r\n\t\t});\r\n\t\treturn lines;\r\n\t}\r\n\tgetHtmlInputLines(i18n) {\r\n\t\tconst lines=super.getHtmlInputLines(i18n);\r\n\t\tconst writeInput=(v,opName,htmlName)=>{\r\n\t\t\tif (v.input!='slider') return;\r\n\t\t\tconst fmt=fixOptHelp.makeFormatNumber(v);\r\n\t\t\tlines.a(\r\n\t\t\t\t\"<div>\",\r\n\t\t\t\t\"\t<label for='\"+htmlName+\"'>\"+i18n(opName)+\":</label>\",\r\n\t\t\t\t\"\t<span class='min'>\"+i18n(opName+'.value',v.min)+\"</span>\",\r\n\t\t\t\t\"\t<input type='range' id='\"+htmlName+\"' min='\"+fmt(v.min)+\"' max='\"+fmt(v.max)+\"' value='\"+fmt(v)+\"' step='any' />\",\r\n\t\t\t\t\"\t<span class='max'>\"+i18n(opName+'.value',v.max)+\"</span>\",\r\n\t\t\t\t\"</div>\"\r\n\t\t\t);\r\n\t\t};\r\n\t\tthis.components.forEach(component=>{\r\n\t\t\twriteInput(\r\n\t\t\t\tcomponent.value,\r\n\t\t\t\t'options.'+this.i18nId+'.'+component.suffix,\r\n\t\t\t\tcomponent.name\r\n\t\t\t);\r\n\t\t\twriteInput(\r\n\t\t\t\tcomponent.value.speed,\r\n\t\t\t\t'options.'+this.i18nId+'.'+component.suffix+'.speed',\r\n\t\t\t\tcomponent.name+'.speed'\r\n\t\t\t);\r\n\t\t});\r\n\t\treturn lines;\r\n\t}\r\n\tgetJsInitLines(featureContext) {\r\n\t\tconst getSliderListenerLines=(doUpdate)=>{\r\n\t\t\tconst getManyListenersLines=()=>{\r\n\t\t\t\tconst lines=new Lines;\r\n\t\t\t\tconst writeListener=(v,htmlName)=>{\r\n\t\t\t\t\tif (v.input!='slider') return;\r\n\t\t\t\t\tconst listener=new Listener.Slider(htmlName);\r\n\t\t\t\t\tconst entry=listener.enter();\r\n\t\t\t\t\tentry.log(\"console.log(this.id,'input value:',parseFloat(this.value));\");\r\n\t\t\t\t\tif (doUpdate) {\r\n\t\t\t\t\t\tentry.post(this.updateFnName+\"();\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\tfeatureContext.getListenerLines(listener)\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\t\twriteListener(component.value,component.name);\r\n\t\t\t\t\twriteListener(component.value.speed,component.name+'.speed');\r\n\t\t\t\t});\r\n\t\t\t\treturn lines;\r\n\t\t\t};\r\n\t\t\tconst getOneListenerLines=()=>{\r\n\t\t\t\tconst listener=new Listener.MultipleSlider(\"[id^=\\\"\"+this.name+\".\\\"]\"); // will also handle speed sliders, but it's ok\r\n\t\t\t\tconst entry=listener.enter();\r\n\t\t\t\tentry.log(\"console.log(this.id,'input value:',parseFloat(this.value));\");\r\n\t\t\t\tif (doUpdate) {\r\n\t\t\t\t\tentry.post(this.updateFnName+\"();\");\r\n\t\t\t\t}\r\n\t\t\t\treturn new Lines(\r\n\t\t\t\t\tfeatureContext.getListenerLines(listener)\r\n\t\t\t\t);\r\n\t\t\t};\r\n\t\t\tconst manyListenersLines=getManyListenersLines();\r\n\t\t\tconst oneListenerLines=getOneListenerLines();\r\n\t\t\treturn manyListenersLines.data.length<=oneListenerLines.data.length ? manyListenersLines : oneListenerLines;\r\n\t\t};\r\n\t\tconst lines=super.getJsInitLines(featureContext);\r\n\t\tlines.a(\r\n\t\t\tthis.getJsDeclarationLines()\r\n\t\t);\r\n\t\tif (this.modeConstant) {\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.getJsUpdateLines(this.makeInitialComponentValue())\r\n\t\t\t);\r\n\t\t\treturn lines;\r\n\t\t}\r\n\t\tconst someSpeeds=this.components.some(component=>component.hasSpeed());\r\n\t\tconst someValueSliders=this.components.some(component=>component.value.input=='slider');\r\n\t\tconst someGamepads=this.components.some(component=>component.hasInputClass(Input.Gamepad));\r\n\t\tthis.components.forEach(component=>{\r\n\t\t\tif (\r\n\t\t\t\t(component.value.input instanceof Input.MouseMove && (someValueSliders || someSpeeds || someGamepads)) || // mouse input required elsewhere\r\n\t\t\t\t(component.value.speed.input!='constant' && component.value.input!='slider') // variable speed and no value input capable of storing the state\r\n\t\t\t) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var \"+component.varName+\"=\"+fixOptHelp.formatNumber(component.value)+\";\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (component.value.speed.input instanceof Input.MouseMove) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var \"+component.varNameSpeed+\"=\"+fixOptHelp.formatNumber(component.value.speed)+\";\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (!someSpeeds && someValueSliders && !someGamepads) {\r\n\t\t\tlines.a(\r\n\t\t\t\tthis.getJsUpdateLines(this.makeUpdatedComponentValue()).wrap(\r\n\t\t\t\t\t\"function \"+this.updateFnName+\"() {\",\r\n\t\t\t\t\t\"}\"\r\n\t\t\t\t),\r\n\t\t\t\tthis.updateFnName+\"();\"\r\n\t\t\t);\r\n\t\t}\r\n\t\tlines.a(\r\n\t\t\tgetSliderListenerLines(!someSpeeds && !someGamepads)\r\n\t\t);\r\n\t\tif (this.components.some(component=>(component.value.input instanceof Input.MouseMove))) {\r\n\t\t\tif (!someSpeeds && !someValueSliders && !someGamepads) {\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\tthis.getJsUpdateLines(this.makeInitialComponentValue())\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tconst entry=featureContext.canvasMousemoveListener.enter();\r\n\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\tif (component.value.input instanceof Input.MouseMove) {\r\n\t\t\t\t\tconst fmt=fixOptHelp.makeFormatNumber(component.value);\r\n\t\t\t\t\t((!someSpeeds && !someValueSliders && !someGamepads) ? entry.minMaxVarFloat : entry.minMaxFloat)(\r\n\t\t\t\t\t\tcomponent.value.input,component.varName,\r\n\t\t\t\t\t\tfmt(component.value.min),\r\n\t\t\t\t\t\tfmt(component.value.max)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tentry.log(\"console.log('\"+component.name+\" input value:',\"+component.varName+\");\");\r\n\t\t\t\t\tif (!someSpeeds && !someValueSliders && !someGamepads) {\r\n\t\t\t\t\t\tthis.addPostToListenerEntryForComponent(entry,component);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!someSpeeds && !someGamepads) {\r\n\t\t\t\tif (!someValueSliders) {\r\n\t\t\t\t\tthis.addPostToListenerEntryAfterComponents(entry,this.makeUpdatedComponentValue());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tentry.post(this.updateFnName+\"();\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.components.some(component=>(component.value.speed.input instanceof Input.MouseMove))) {\r\n\t\t\tconst entry=featureContext.canvasMousemoveListener.enter();\r\n\t\t\tthis.components.forEach(component=>{\r\n\t\t\t\tconst fmt=fixOptHelp.makeFormatNumber(component.value.speed);\r\n\t\t\t\tif (component.value.speed.input instanceof Input.MouseMove) {\r\n\t\t\t\t\tentry.minMaxFloat(component.value.speed.input,component.varNameSpeed,fmt(component.value.speed.min),fmt(component.value.speed.max))\r\n\t\t\t\t\t\t.log(\"console.log('\"+component.name+\".speed input value:',\"+component.varNameSpeed+\");\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\tgetJsLoopLines(featureContext) {\r\n\t\tconst lines=super.getJsLoopLines(featureContext);\r\n\t\tconst add=(s)=>{\r\n\t\t\tconst c=s.charAt(0);\r\n\t\t\tif (c=='-' || c=='+') {\r\n\t\t\t\treturn s;\r\n\t\t\t} else {\r\n\t\t\t\treturn \"+\"+s;\r\n\t\t\t}\r\n\t\t};\r\n\t\tlet needUpdate=false;\r\n\t\tconst writeGamepad=(component,v,dotSuffix,varSuffix)=>{\r\n\t\t\tif (v.input instanceof Input.Gamepad) {\r\n\t\t\t\tneedUpdate=true;\r\n\t\t\t\tconst fmt=fixOptHelp.makeFormatNumber(v);\r\n\t\t\t\tlines.a(\r\n\t\t\t\t\t\"var \"+component.minVarName+varSuffix+\"=\"+fmt(v.min)+\";\",\r\n\t\t\t\t\t\"var \"+component.maxVarName+varSuffix+\"=\"+fmt(v.max)+\";\",\r\n\t\t\t\t\t\"var \"+component.varName+varSuffix+\"=\"+fmt(v)+\";\",\r\n\t\t\t\t\t\"if (gamepad && gamepad.axes.length>\"+v.input.axis+\") {\",\r\n\t\t\t\t\t\"\t\"+component.varName+varSuffix+\"=\"+component.minVarName+varSuffix+\"+(\"+component.maxVarName+varSuffix+\"-\"+component.minVarName+varSuffix+\")*(gamepad.axes[\"+v.input.axis+\"]+1)/2;\",\r\n\t\t\t\t\t\"}\"\r\n\t\t\t\t);\r\n\t\t\t\tif (featureContext && featureContext.debugOptions.inputs) { // TODO always pass featureContext\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"console.log('\"+component.name+dotSuffix+\" input value:',\"+component.varName+varSuffix+\");\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.components.forEach(component=>{\r\n\t\t\tconst v=component.value;\r\n\t\t\twriteGamepad(component,v,'','');\r\n\t\t\twriteGamepad(component,v.speed,'.speed','Speed');\r\n\t\t\tif (component.hasSpeed()) {\r\n\t\t\t\tneedUpdate=true;\r\n\t\t\t\tconst fmt=fixOptHelp.makeFormatNumber(v);\r\n\t\t\t\tconst sfmt=fixOptHelp.makeFormatNumber(v.speed);\r\n\t\t\t\tlet addSpeed;\r\n\t\t\t\tif (v.speed.input=='slider') {\r\n\t\t\t\t\taddSpeed=\"+parseFloat(document.getElementById('\"+component.name+\".speed').value)\";\r\n\t\t\t\t} else if (v.speed.input instanceof Input.MouseMove || v.speed.input instanceof Input.Gamepad) {\r\n\t\t\t\t\taddSpeed=\"+\"+component.varNameSpeed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\taddSpeed=add(sfmt(v.speed));\r\n\t\t\t\t}\r\n\t\t\t\tlet limitFn=(x,dx)=>{\r\n\t\t\t\t\tif (x==component.varName) {\r\n\t\t\t\t\t\treturn dx.charAt(0)+\"=\"+dx.slice(1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn \"=\"+x+dx;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (component.wrapped) {\r\n\t\t\t\t\tlimitFn=(x,dx)=>\"=wrap(\"+x+dx+\",\"+fmt(v.max)+\")\";\r\n\t\t\t\t} else if (component.clamped) {\r\n\t\t\t\t\tlimitFn=(x,dx)=>\"=clamp(\"+x+dx+\",\"+fmt(v.min)+\",\"+fmt(v.max)+\")\";\r\n\t\t\t\t} else if (component.capped) {\r\n\t\t\t\t\tlimitFn=(x,dx)=>\"=Math.\"+(v.speed<0?\"max\":\"min\")+\"(\"+x+dx+\",\"+(v.speed<0?fmt(v.min):fmt(v.max))+\")\";\r\n\t\t\t\t}\r\n\t\t\t\tconst incrementLine=(base,dt)=>component.varName+limitFn(base,addSpeed+\"*\"+dt+\"/1000\")+\";\";\r\n\t\t\t\tif (v.input=='slider') {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"var \"+component.varNameInput+\"=document.getElementById('\"+component.name+\"');\",\r\n\t\t\t\t\t\t\"var \"+incrementLine(\"parseFloat(\"+component.varNameInput+\".value)\",\"(time-prevTime)\"),\r\n\t\t\t\t\t\tcomponent.varNameInput+\".value=\"+component.varName+\";\"\r\n\t\t\t\t\t);\r\n\t\t\t\t} else if (v.input instanceof Input.MouseMove || v.speed.input!='constant') {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\tincrementLine(component.varName,\"(time-prevTime)\")\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"var \"+incrementLine(fmt(v),\"(time-startTime)\")\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (featureContext && featureContext.debugOptions.animations) { // TODO always pass featureContext\r\n\t\t\t\t\tlines.a(\r\n\t\t\t\t\t\t\"console.log('\"+component.name+\" animation value:',\"+component.varName+\");\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (needUpdate) {\r\n\t\t\tlines.a(this.getJsUpdateLines(this.makeUpdatedComponentValue()));\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n}\r\n\r\nmodule.exports=Vector;\r\n"],"sourceRoot":"."}